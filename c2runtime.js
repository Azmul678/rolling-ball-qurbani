// Generated by Construct 3, the game and app creator :: https://www.construct.net
"use strict";window.cr={},cr.plugins_={},cr.behaviors={},"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf=function(e){return e.__proto__}),function(){function e(e,t){this.x=e,this.y=t,cr.seal(this)}function t(e,t,n,a){this.set(e,t,n,a),cr.seal(this)}function n(){this.tlx=0,this.tly=0,this.trx=0,this.try_=0,this.brx=0,this.bry=0,this.blx=0,this.bly=0,cr.seal(this)}function a(e,t,n,a){e<t?n<a?(O=e<n?e:n,E=t>a?t:a):(O=e<a?e:a,E=t>n?t:n):n<a?(O=t<n?t:n,E=e>a?e:a):(O=t<a?t:a,E=e>n?e:n)}function r(e){return 0===e&&0>1/e}function i(){this.s=null,this.items=null,this.item_count=0,L&&(this.s=new Set),this.values_cache=[],this.cache_valid=!0,cr.seal(this)}function o(e){R[k++]=e}function s(){this.c=0,this.y=0,this.t=0,this.sum=0,cr.seal(this)}function l(e){this.pts_cache=[],this.bboxLeft=0,this.bboxTop=0,this.bboxRight=0,this.bboxBottom=0,this.convexpolys=null,this.set_pts(e),cr.seal(this)}function p(e,t){this.cellwidth=e,this.cellheight=t,this.cells={}}function d(e,t){this.cellwidth=e,this.cellheight=t,this.cells={}}function c(e,t,n){var a;return p.prototype.totalCellCount++,B.length?(a=B.pop(),a.grid=e,a.x=t,a.y=n,a):new cr.GridCell(e,t,n)}function u(e){p.prototype.totalCellCount--,e.objects.clear(),1e3>B.length&&B.push(e)}function g(e,t,n){this.grid=e,this.x=t,this.y=n,this.objects=new cr.ObjectSet}function m(e,t,n){var a;return d.prototype.totalCellCount++,j.length?(a=j.pop(),a.grid=e,a.x=t,a.y=n,a):new cr.RenderCell(e,t,n)}function _(e){d.prototype.totalCellCount--,e.reset(),1e3>j.length&&j.push(e)}function y(e,t,n){this.grid=e,this.x=t,this.y=n,this.objects=[],this.is_sorted=!0,this.pending_removal=new cr.ObjectSet,this.any_pending_removal=!1}function h(e,t){return e.zindex-t.zindex}var f=Math.acos,x=Math.floor,b=Math.max,v=Math.min,T=Math.cos,S=Math.sin,w=Math.PI;cr.logexport=function(e){window.console&&window.console.log&&window.console.log(e)},cr.logerror=function(e){window.console&&window.console.error&&window.console.error(e)},cr.seal=function(e){return e},cr.freeze=function(e){return e},cr.is_undefined=function(e){return"undefined"==typeof e},cr.is_number=function(e){return"number"==typeof e},cr.is_string=function(e){return"string"==typeof e},cr.isPOT=function(e){return 0<e&&0==(e-1&e)},cr.nextHighestPowerOfTwo=function(e){--e;for(var t=1;32>t;t<<=1)e|=e>>t;return e+1},cr.abs=function(e){return 0>e?-e:e},cr.max=function(e,t){return e>t?e:t},cr.min=function(e,t){return e<t?e:t},cr.PI=w,cr.round=function(e){return 0|e+.5},cr.floor=function(e){return 0<=e?0|e:(0|e)-1},cr.ceil=function(e){var t=0|e;return t===e?t:t+1};e.prototype.offset=function(e,t){return this.x+=e,this.y+=t,this},e.prototype.mul=function(e,t){return this.x*=e,this.y*=t,this},cr.vector2=e,cr.segments_intersect=function(e,t,n,a,r,i,o,s){var l,p,c,u,g,m,y,_;if(e<n?(p=e,l=n):(p=n,l=e),r<o?(m=r,g=o):(m=o,g=r),l<m||p>g)return!1;if(t<a?(u=t,c=a):(u=a,c=t),i<s?(_=i,y=s):(_=s,y=i),c<_||u>y)return!1;var h=r-e+o-n,f=i-t+s-a,x=n-e,b=a-t,v=o-r,w=s-i,T=cr.abs(b*v-w*x);if(cr.abs(v*f-w*h)>T)return!1;return cr.abs(x*f-b*h)<=T};t.prototype.set=function(e,t,n,a){this.left=e,this.top=t,this.right=n,this.bottom=a},t.prototype.copy=function(e){this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom},t.prototype.width=function(){return this.right-this.left},t.prototype.height=function(){return this.bottom-this.top},t.prototype.offset=function(e,t){return this.left+=e,this.top+=t,this.right+=e,this.bottom+=t,this},t.prototype.normalize=function(){var e=0;this.left>this.right&&(e=this.left,this.left=this.right,this.right=e),this.top>this.bottom&&(e=this.top,this.top=this.bottom,this.bottom=e)},t.prototype.intersects_rect=function(e){return!(e.right<this.left||e.bottom<this.top||e.left>this.right||e.top>this.bottom)},t.prototype.intersects_rect_off=function(e,t,n){return!(e.right+t<this.left||e.bottom+n<this.top||e.left+t>this.right||e.top+n>this.bottom)},t.prototype.contains_pt=function(e,t){return e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom},t.prototype.equals=function(e){return this.left===e.left&&this.top===e.top&&this.right===e.right&&this.bottom===e.bottom},cr.rect=t;n.prototype.set_from_rect=function(e){this.tlx=e.left,this.tly=e.top,this.trx=e.right,this.try_=e.top,this.brx=e.right,this.bry=e.bottom,this.blx=e.left,this.bly=e.bottom},n.prototype.set_from_rotated_rect=function(e,t){if(0===t)this.set_from_rect(e);else{var n=S(t),a=T(t),r=e.left*n,i=e.top*n,o=e.right*n,s=e.bottom*n,l=e.left*a,p=e.top*a,d=e.right*a,c=e.bottom*a;this.tlx=l-i,this.tly=p+r,this.trx=d-i,this.try_=p+o,this.brx=d-s,this.bry=c+o,this.blx=l-s,this.bly=c+r}},n.prototype.offset=function(e,t){return this.tlx+=e,this.tly+=t,this.trx+=e,this.try_+=t,this.brx+=e,this.bry+=t,this.blx+=e,this.bly+=t,this};var O=0,E=0;n.prototype.bounding_box=function(e){a(this.tlx,this.trx,this.brx,this.blx),e.left=O,e.right=E,a(this.tly,this.try_,this.bry,this.bly),e.top=O,e.bottom=E},n.prototype.contains_pt=function(e,t){var n=this.tlx,a=this.tly,r=this.trx-n,i=this.try_-a,o=this.brx-n,s=this.bry-a,l=e-n,p=t-a,d=r*r+i*i,c=r*o+i*s,g=r*l+i*p,m=o*o+s*s,y=o*l+s*p,_=1/(d*m-c*c),h=(m*g-c*y)*_,f=(d*y-c*g)*_;if(0<=h&&0<f&&1>h+f)return!0;r=this.blx-n,i=this.bly-a;var d=r*r+i*i,c=r*o+i*s,g=r*l+i*p;return _=1/(d*m-c*c),h=(m*g-c*y)*_,f=(d*y-c*g)*_,0<=h&&0<f&&1>h+f},n.prototype.at=function(e,t){return t?0===e?this.tlx:1===e?this.trx:2===e?this.brx:3===e?this.blx:4===e?this.tlx:this.tlx:0===e?this.tly:1===e?this.try_:2===e?this.bry:3===e?this.bly:4===e?this.tly:this.tly},n.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4},n.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4},n.prototype.intersects_segment=function(e,t,n,a){if(this.contains_pt(e,t)||this.contains_pt(n,a))return!0;var r,o,s,l,p;for(p=0;4>p;p++)if(r=this.at(p,!0),o=this.at(p,!1),s=this.at(p+1,!0),l=this.at(p+1,!1),cr.segments_intersect(e,t,n,a,r,o,s,l))return!0;return!1},n.prototype.intersects_quad=function(e){var t=e.midX(),n=e.midY();if(this.contains_pt(t,n))return!0;if(t=this.midX(),n=this.midY(),e.contains_pt(t,n))return!0;var a,r,o,s,l,p,d,c,u,g;for(u=0;4>u;u++)for(g=0;4>g;g++)if(a=this.at(u,!0),r=this.at(u,!1),o=this.at(u+1,!0),s=this.at(u+1,!1),l=e.at(g,!0),p=e.at(g,!1),d=e.at(g+1,!0),c=e.at(g+1,!1),cr.segments_intersect(a,r,o,s,l,p,d,c))return!0;return!1},cr.quad=n,cr.RGB=function(e,t,n){return b(v(e,255),0)|b(v(t,255),0)<<8|b(v(n,255),0)<<16};cr.RGBAEx=function(e,t,n,a){return e=cr.clamp(x(1024*e),-8192,8191),t=cr.clamp(x(1024*t),-8192,8191),n=cr.clamp(x(1024*n),-8192,8191),a=cr.clamp(x(1024*a),0,1024),0>e&&(e+=16384),0>t&&(t+=16384),0>n&&(n+=16384),-(1024*(16384*(16384*e))+1024*(16384*t)+1024*n+a)},cr.RGBEx=function(e,t,n){return cr.RGBAEx(e,t,n,1)},cr.GetRValue=function(e){if(0<=e)return(255&e)/255;var t=x(-e/274877906944);return 8191<t&&(t-=16384),t/1024},cr.GetGValue=function(e){if(0<=e)return((65280&e)>>8)/255;var t=x(-e%274877906944/16777216);return 8191<t&&(t-=16384),t/1024},cr.GetBValue=function(e){if(0<=e)return((16711680&e)>>16)/255;var t=x(-e%16777216/1024);return 8191<t&&(t-=16384),t/1024},cr.GetAValue=function(e){if(r(e))return 0;if(0<=e)return 1;var t=x(-e%1024);return t/1024},cr.shallowCopy=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},cr.arrayRemove=function(e,t){var n,a;if(t=cr.floor(t),!(0>t||t>=e.length)){for(n=t,a=e.length-1;n<a;n++)e[n]=e[n+1];cr.truncateArray(e,a)}},cr.truncateArray=function(e,t){e.length=t},cr.clearArray=function(e){cr.truncateArray(e,0)},cr.shallowAssignArray=function(e,t){cr.clearArray(e);var n,a;for(n=0,a=t.length;n<a;++n)e[n]=t[n]},cr.appendArray=function(e,t){e.push.apply(e,t)},cr.fastIndexOf=function(e,t){var n,a;for(n=0,a=e.length;n<a;++n)if(e[n]===t)return n;return-1},cr.arrayFindRemove=function(e,t){var n=cr.fastIndexOf(e,t);-1!==n&&cr.arrayRemove(e,n)},cr.clamp=function(e,t,n){return e<t?t:e>n?n:e},cr.to_radians=function(e){return e/(180/cr.PI)},cr.to_degrees=function(e){return e*(180/cr.PI)},cr.clamp_angle_degrees=function(e){return e%=360,0>e&&(e+=360),e},cr.clamp_angle=function(e){return e%=2*cr.PI,0>e&&(e+=2*cr.PI),e},cr.to_clamped_degrees=function(e){return cr.clamp_angle_degrees(cr.to_degrees(e))},cr.to_clamped_radians=function(e){return cr.clamp_angle(cr.to_radians(e))},cr.angleTo=function(e,t,n,a){return Math.atan2(a-t,n-e)},cr.angleDiff=function(e,t){if(e===t)return 0;var a=S(e),r=T(e),i=S(t),o=T(t),s=a*i+r*o;return 1<=s?0:-1>=s?cr.PI:f(s)},cr.angleRotate=function(e,t,n){var a=S(e),r=T(e),i=S(t),o=T(t);return f(a*i+r*o)>n?0<r*i-a*o?cr.clamp_angle(e+n):cr.clamp_angle(e-n):cr.clamp_angle(t)},cr.angleClockwise=function(e,t){var n=S(e),a=T(e),r=S(t),i=T(t);return 0>=a*r-n*i},cr.rotatePtAround=function(e,t,n,a,r,i){if(0===n)return i?e:t;var o=S(n),s=T(n);e-=a,t-=r;var l=e*o,p=t*o,d=e*s,c=t*s;return e=d-p,t=c+l,e+=a,t+=r,i?e:t},cr.distanceTo=function(e,t,n,a){var r=n-e,i=a-t;return Math.sqrt(r*r+i*i)},cr.xor=function(e,t){return!e!=!t},cr.lerp=function(e,t,n){return e+(t-e)*n},cr.unlerp=function(e,t,n){return e===t?0:(n-e)/(t-e)},cr.anglelerp=function(e,t,n){var a=cr.angleDiff(e,t);return cr.angleClockwise(t,e)?e+a*n:e-a*n},cr.qarp=function(e,t,n,a){return cr.lerp(cr.lerp(e,t,a),cr.lerp(t,n,a),a)},cr.cubic=function(e,t,n,a,r){return cr.lerp(cr.qarp(e,t,n,r),cr.qarp(t,n,a,r),r)},cr.cosp=function(e,t,n){return(e+t+(e-t)*T(n*w))/2},cr.hasAnyOwnProperty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1},cr.wipe=function(e){for(var t in e)e.hasOwnProperty(t)&&delete e[t]};var C=+new Date;cr.performance_now=function(){if("undefined"!=typeof window.performance){var e=window.performance;if("undefined"!=typeof e.now)return e.now();if("undefined"!=typeof e.webkitNow)return e.webkitNow();if("undefined"!=typeof e.mozNow)return e.mozNow();if("undefined"!=typeof e.msNow)return e.msNow()}return Date.now()-C};var A=!1,P=!1,I=!1;"undefined"!=typeof window&&(A=/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent),P=!A&&/safari/i.test(navigator.userAgent),I=/(iphone|ipod|ipad)/i.test(navigator.userAgent));var L="undefined"!=typeof Set&&"undefined"!=typeof Set.prototype.forEach;i.prototype.contains=function(e){return!this.isEmpty()&&(L?this.s.has(e):this.items&&this.items.hasOwnProperty(e))},i.prototype.add=function(e){if(L)this.s.has(e)||(this.s.add(e),this.cache_valid=!1);else{var t=e.toString(),n=this.items;n?!n.hasOwnProperty(t)&&(n[t]=e,this.item_count++,this.cache_valid=!1):(this.items={},this.items[t]=e,this.item_count=1,this.cache_valid=!1)}},i.prototype.remove=function(e){if(!this.isEmpty())if(L)this.s.has(e)&&(this.s["delete"](e),this.cache_valid=!1);else if(this.items){var t=e.toString(),n=this.items;n.hasOwnProperty(t)&&(delete n[t],this.item_count--,this.cache_valid=!1)}},i.prototype.clear=function(){this.isEmpty()||(L?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)},i.prototype.isEmpty=function(){return 0===this.count()},i.prototype.count=function(){return L?this.s.size:this.item_count};var R=null,k=0;i.prototype.update_cache=function(){if(!this.cache_valid){if(L)cr.clearArray(this.values_cache),R=this.values_cache,k=0,this.s.forEach(o),R=null,k=0;else{var e=this.values_cache;cr.clearArray(e);var t=0,a=this.items,r;if(a)for(r in a)a.hasOwnProperty(r)&&(e[t++]=a[r])}this.cache_valid=!0}},i.prototype.valuesRef=function(){return this.update_cache(),this.values_cache},cr.ObjectSet=i;var F=new cr.ObjectSet;cr.removeArrayDuplicates=function(e){var t,n;for(t=0,n=e.length;t<n;++t)F.add(e[t]);cr.shallowAssignArray(e,F.valuesRef()),F.clear()},cr.arrayRemoveAllFromObjectSet=function(e,t){L?cr.arrayRemoveAll_set(e,t.s):cr.arrayRemoveAll_arr(e,t.valuesRef())},cr.arrayRemoveAll_set=function(e,t){var n,a,r,o;for(n=0,a=0,r=e.length;n<r;++n)o=e[n],t.has(o)||(e[a++]=o);cr.truncateArray(e,a)},cr.arrayRemoveAll_arr=function(e,t){var n,a,r,o;for(n=0,a=0,r=e.length;n<r;++n)o=e[n],-1===cr.fastIndexOf(t,o)&&(e[a++]=o);cr.truncateArray(e,a)};s.prototype.add=function(e){this.y=e-this.c,this.t=this.sum+this.y,this.c=this.t-this.sum-this.y,this.sum=this.t},s.prototype.reset=function(){this.c=0,this.y=0,this.t=0,this.sum=0},cr.KahanAdder=s,cr.regexp_escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};l.prototype.set_pts=function(e){this.pts_array=e,this.pts_count=e.length/2,this.pts_cache.length=e.length,this.cache_width=-1,this.cache_height=-1,this.cache_angle=0},l.prototype.is_empty=function(){return!this.pts_array.length},l.prototype.update_bbox=function(){for(var e=this.pts_cache,t=e[0],n=t,a=e[1],r=a,o=1,s=this.pts_count,l,p,d;o<s;++o)d=2*o,l=e[d],p=e[d+1],l<t&&(t=l),l>n&&(n=l),p<a&&(a=p),p>r&&(r=p);this.bboxLeft=t,this.bboxRight=n,this.bboxTop=a,this.bboxBottom=r},l.prototype.set_from_rect=function(e,t,n){this.pts_cache.length=8,this.pts_count=4;var a=this.pts_cache;a[0]=e.left-t,a[1]=e.top-n,a[2]=e.right-t,a[3]=e.top-n,a[4]=e.right-t,a[5]=e.bottom-n,a[6]=e.left-t,a[7]=e.bottom-n,this.cache_width=e.right-e.left,this.cache_height=e.bottom-e.top,this.update_bbox()},l.prototype.set_from_quad=function(e,t,n,a,r){this.pts_cache.length=8,this.pts_count=4;var i=this.pts_cache;i[0]=e.tlx-t,i[1]=e.tly-n,i[2]=e.trx-t,i[3]=e.try_-n,i[4]=e.brx-t,i[5]=e.bry-n,i[6]=e.blx-t,i[7]=e.bly-n,this.cache_width=a,this.cache_height=r,this.update_bbox()},l.prototype.set_from_poly=function(e){this.pts_count=e.pts_count,cr.shallowAssignArray(this.pts_cache,e.pts_cache),this.bboxLeft=e.bboxLeft,this.bboxTop-e.bboxTop,this.bboxRight=e.bboxRight,this.bboxBottom=e.bboxBottom},l.prototype.cache_poly=function(e,t,n){if(this.cache_width!==e||this.cache_height!==t||this.cache_angle!==n){this.cache_width=e,this.cache_height=t,this.cache_angle=n;var a=0,r=1,o=this.pts_array,s=this.pts_cache,l,p,d,c,u,g;for(0!==n&&(a=S(n),r=T(n)),l=0,c=this.pts_count;l<c;l++)p=2*l,d=p+1,u=o[p]*e,g=o[d]*t,s[p]=u*r-g*a,s[d]=g*r+u*a;this.update_bbox()}},l.prototype.contains_pt=function(e,t){var n=this.pts_cache;if(e===n[0]&&t===n[1])return!0;var a=this.pts_count,r=this.bboxLeft-110,o=this.bboxTop-101,s=this.bboxRight+131,l=this.bboxBottom+120,p=0,d=0,c,u,g,m,y,_,h;for(c=0;c<a;c++)u=2*c,g=2*((c+1)%a),m=n[u],y=n[u+1],_=n[g],h=n[g+1],cr.segments_intersect(r,o,e,t,m,y,_,h)&&p++,cr.segments_intersect(s,l,e,t,m,y,_,h)&&d++;return 1==p%2||1==d%2},l.prototype.intersects_poly=function(e,t,n){var a=e.pts_cache,r=this.pts_cache;if(this.contains_pt(a[0]+t,a[1]+n))return!0;if(e.contains_pt(r[0]-t,r[1]-n))return!0;var o,s,l,p,d,c,u,g,m,y,_,h,f,x,b,v;for(o=0,p=this.pts_count;o<p;o++)for(s=2*o,l=2*((o+1)%p),m=r[s],y=r[s+1],_=r[l],h=r[l+1],(d=0,g=e.pts_count);d<g;d++)if(c=2*d,u=2*((d+1)%g),f=a[c]+t,x=a[c+1]+n,b=a[u]+t,v=a[u+1]+n,cr.segments_intersect(m,y,_,h,f,x,b,v))return!0;return!1},l.prototype.intersects_segment=function(e,t,n,a,r,o){var s=this.pts_cache;if(this.contains_pt(n-e,a-t))return!0;var l,p,d,c,u,g,m,y;for(l=0,p=this.pts_count;l<p;l++)if(d=2*l,c=2*((l+1)%p),u=s[d]+e,g=s[d+1]+t,m=s[c]+e,y=s[c+1]+t,cr.segments_intersect(n,a,r,o,u,g,m,y))return!0;return!1},l.prototype.mirror=function(e){var t,n,a;for(t=0,n=this.pts_count;t<n;++t)a=2*t,this.pts_cache[a]=2*e-this.pts_cache[a]},l.prototype.flip=function(e){var t,n,a;for(t=0,n=this.pts_count;t<n;++t)a=2*t+1,this.pts_cache[a]=2*e-this.pts_cache[a]},l.prototype.diag=function(){var e,t,n,a,r;for(e=0,t=this.pts_count;e<t;++e)n=2*e,a=n+1,r=this.pts_cache[n],this.pts_cache[n]=this.pts_cache[a],this.pts_cache[a]=r},cr.CollisionPoly=l;p.prototype.totalCellCount=0,p.prototype.getCell=function(e,t,n){var a=this.cells[e],r;return a?(r=a[t],r?r:n?(r=c(this,e,t),this.cells[e][t]=r,r):null):n?(r=c(this,e,t),this.cells[e]={},this.cells[e][t]=r,r):null},p.prototype.XToCell=function(e){return cr.floor(e/this.cellwidth)},p.prototype.YToCell=function(e){return cr.floor(e/this.cellheight)},p.prototype.update=function(e,t,n){var a,r,i,o,s;if(t)for(a=t.left,r=t.right;a<=r;++a)for(i=t.top,o=t.bottom;i<=o;++i)n&&n.contains_pt(a,i)||(s=this.getCell(a,i,!1),s&&(s.remove(e),s.isEmpty()&&(u(s),this.cells[a][i]=null)));if(n)for(a=n.left,r=n.right;a<=r;++a)for(i=n.top,o=n.bottom;i<=o;++i)t&&t.contains_pt(a,i)||this.getCell(a,i,!0).insert(e)},p.prototype.queryRange=function(e,t){var n,a,r,i,o,s;for(n=this.XToCell(e.left),r=this.YToCell(e.top),a=this.XToCell(e.right),o=this.YToCell(e.bottom);n<=a;++n)for(i=r;i<=o;++i)s=this.getCell(n,i,!1),s&&s.dump(t)},cr.SparseGrid=p;d.prototype.totalCellCount=0,d.prototype.getCell=function(e,t,n){var a=this.cells[e],r;return a?(r=a[t],r?r:n?(r=m(this,e,t),this.cells[e][t]=r,r):null):n?(r=m(this,e,t),this.cells[e]={},this.cells[e][t]=r,r):null},d.prototype.XToCell=function(e){return cr.floor(e/this.cellwidth)},d.prototype.YToCell=function(e){return cr.floor(e/this.cellheight)},d.prototype.update=function(e,t,n){var a,r,i,o,s;if(t)for(a=t.left,r=t.right;a<=r;++a)for(i=t.top,o=t.bottom;i<=o;++i)n&&n.contains_pt(a,i)||(s=this.getCell(a,i,!1),s&&(s.remove(e),s.isEmpty()&&(_(s),this.cells[a][i]=null)));if(n)for(a=n.left,r=n.right;a<=r;++a)for(i=n.top,o=n.bottom;i<=o;++i)t&&t.contains_pt(a,i)||this.getCell(a,i,!0).insert(e)},d.prototype.queryRange=function(e,t,n,a,r){var i,o,s,l,p,d;for(i=this.XToCell(e),s=this.YToCell(t),o=this.XToCell(n),p=this.YToCell(a);i<=o;++i)for(l=s;l<=p;++l)d=this.getCell(i,l,!1),d&&d.dump(r)},d.prototype.markRangeChanged=function(e){var t,n,a,r,i,o;for(t=e.left,a=e.top,n=e.right,i=e.bottom;t<=n;++t)for(r=a;r<=i;++r)o=this.getCell(t,r,!1),o&&(o.is_sorted=!1)},cr.RenderGrid=d;var B=[];g.prototype.isEmpty=function(){return this.objects.isEmpty()},g.prototype.insert=function(e){this.objects.add(e)},g.prototype.remove=function(e){this.objects.remove(e)},g.prototype.dump=function(e){cr.appendArray(e,this.objects.valuesRef())},cr.GridCell=g;var j=[];y.prototype.isEmpty=function(){return!this.objects.length||!(this.objects.length>this.pending_removal.count())&&(this.flush_pending(),!0)},y.prototype.insert=function(e){if(this.pending_removal.contains(e))return this.pending_removal.remove(e),void(this.pending_removal.isEmpty()&&(this.any_pending_removal=!1));if(this.objects.length){var t=this.objects[this.objects.length-1];t.get_zindex()>e.get_zindex()&&(this.is_sorted=!1),this.objects.push(e)}else this.objects.push(e),this.is_sorted=!0},y.prototype.remove=function(e){this.pending_removal.add(e),this.any_pending_removal=!0,30<=this.pending_removal.count()&&this.flush_pending()},y.prototype.flush_pending=function(){return this.any_pending_removal?this.pending_removal.count()===this.objects.length?void this.reset():void(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1):void 0};y.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(h),this.is_sorted=!0)},y.prototype.reset=function(){cr.clearArray(this.objects),this.is_sorted=!0,this.pending_removal.clear(),this.any_pending_removal=!1},y.prototype.dump=function(e){this.flush_pending(),this.ensure_sorted(),this.objects.length&&e.push(this.objects)},cr.RenderCell=y;var N=["lighter","xor","copy","destination-over","source-in","destination-in","source-out","destination-out","source-atop","destination-atop"];cr.effectToCompositeOp=function(e){return 0>=e||11<=e?"source-over":N[e-1]},cr.setGLBlend=function(e,t,n){if(n)switch(e.srcBlend=n.ONE,e.destBlend=n.ONE_MINUS_SRC_ALPHA,t){case 1:e.srcBlend=n.ONE,e.destBlend=n.ONE;break;case 2:break;case 3:e.srcBlend=n.ONE,e.destBlend=n.ZERO;break;case 4:e.srcBlend=n.ONE_MINUS_DST_ALPHA,e.destBlend=n.ONE;break;case 5:e.srcBlend=n.DST_ALPHA,e.destBlend=n.ZERO;break;case 6:e.srcBlend=n.ZERO,e.destBlend=n.SRC_ALPHA;break;case 7:e.srcBlend=n.ONE_MINUS_DST_ALPHA,e.destBlend=n.ZERO;break;case 8:e.srcBlend=n.ZERO,e.destBlend=n.ONE_MINUS_SRC_ALPHA;break;case 9:e.srcBlend=n.DST_ALPHA,e.destBlend=n.ONE_MINUS_SRC_ALPHA;break;case 10:e.srcBlend=n.ONE_MINUS_DST_ALPHA,e.destBlend=n.SRC_ALPHA;}},cr.round6dp=function(e){return Math.round(1e6*e)/1e6},cr.equals_nocase=function(e,t){return"string"==typeof e&&"string"==typeof t&&!(e.length!==t.length)&&(!(e!==t)||e.toLowerCase()===t.toLowerCase())},cr.cssToCamelCase=function(e){var t="",n=!1,a,r,o;for(a=0,r=e.length;a<r;++a)o=e.charAt(a),"-"===o?n=!0:n?(t+=o.toUpperCase(),n=!1):t+=o;return t},cr.isCanvasInputEvent=function(t){var e=t.target;return!e||!(e!==document&&e!==window)||!!(document&&document.body&&e===document.body)||!!cr.equals_nocase(e.tagName,"canvas")}}();var MatrixArray="undefined"==typeof Float32Array?Array:Float32Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(e){var t=new MatrixArray(3);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2]),t},vec3.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},vec3.add=function(e,t,n){return n&&e!==n?(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)},vec3.subtract=function(e,t,n){return n&&e!==n?(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n):(e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e)},vec3.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},vec3.scale=function(e,t,n){return n&&e!==n?(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n):(e[0]*=t,e[1]*=t,e[2]*=t,e)},vec3.normalize=function(t,n){n||(n=t);var a=t[0],r=t[1],i=t[2],e=Math.sqrt(a*a+r*r+i*i);if(!e)return n[0]=0,n[1]=0,n[2]=0,n;return 1===e?(n[0]=a,n[1]=r,n[2]=i,n):(e=1/e,n[0]=a*e,n[1]=r*e,n[2]=i*e,n)},vec3.cross=function(t,n,r){r||(r=t);var i=t[0],o=t[1],t=t[2],e=n[0],s=n[1],n=n[2];return r[0]=o*n-t*s,r[1]=t*e-i*n,r[2]=i*s-o*e,r},vec3.length=function(e){var t=e[0],n=e[1],e=e[2];return Math.sqrt(t*t+n*n+e*e)},vec3.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},vec3.direction=function(t,n,r){r||(r=t);var i=t[0]-n[0],o=t[1]-n[1],t=t[2]-n[2],n=Math.sqrt(i*i+o*o+t*t);return n?(n=1/n,r[0]=i*n,r[1]=o*n,r[2]=t*n,r):(r[0]=0,r[1]=0,r[2]=0,r)},vec3.lerp=function(e,t,n,a){return a||(a=e),a[0]=e[0]+n*(t[0]-e[0]),a[1]=e[1]+n*(t[1]-e[1]),a[2]=e[2]+n*(t[2]-e[2]),a},vec3.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"},mat3.create=function(e){var t=new MatrixArray(9);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]),t},mat3.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mat3.transpose=function(t,n){if(!n||t===n){var a=t[1],r=t[2],i=t[5];return t[1]=t[3],t[2]=t[6],t[3]=a,t[5]=t[7],t[6]=r,t[7]=i,t}return n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8],n},mat3.toMat4=function(e,t){return t||(t=mat4.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},mat3.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"},mat4.create=function(e){var t=new MatrixArray(16);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},mat4.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},mat4.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.transpose=function(t,n){if(!n||t===n){var a=t[1],r=t[2],i=t[3],e=t[6],o=t[7],s=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=a,t[6]=t[9],t[7]=t[13],t[8]=r,t[9]=e,t[11]=t[14],t[12]=i,t[13]=o,t[14]=s,t}return n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15],n},mat4.determinant=function(t){var r=t[0],s=t[1],c=t[2],d=t[3],e=t[4],u=t[5],g=t[6],y=t[7],i=t[8],_=t[9],h=t[10],l=t[11],n=t[12],o=t[13],m=t[14],t=t[15];return n*_*g*d-i*o*g*d-n*u*h*d+e*o*h*d+i*u*m*d-e*_*m*d-n*_*c*y+i*o*c*y+n*s*h*y-r*o*h*y-i*s*m*y+r*_*m*y+n*u*c*l-e*o*c*l-n*s*g*l+r*o*g*l+e*s*m*l-r*u*m*l-i*u*c*t+e*_*c*t+i*s*g*t-r*_*g*t-e*s*h*t+r*u*h*t},mat4.inverse=function(_,a){a||(a=_);var T=_[0],c=_[1],d=_[2],e=_[3],g=_[4],f=_[5],h=_[6],i=_[7],S=_[8],O=_[9],l=_[10],n=_[11],o=_[12],m=_[13],p=_[14],r=_[15],s=T*f-c*g,A=T*h-d*g,P=T*i-e*g,t=c*h-d*f,u=c*i-e*f,v=d*i-e*h,w=S*m-O*o,x=S*p-l*o,y=S*r-n*o,I=O*p-l*m,C=O*r-n*m,L=l*r-n*p,E=1/(s*L-A*C+P*I+t*y-u*x+v*w);return a[0]=(f*L-h*C+i*I)*E,a[1]=(-c*L+d*C-e*I)*E,a[2]=(m*v-p*u+r*t)*E,a[3]=(-O*v+l*u-n*t)*E,a[4]=(-g*L+h*y-i*x)*E,a[5]=(T*L-d*y+e*x)*E,a[6]=(-o*v+p*P-r*A)*E,a[7]=(S*v-l*P+n*A)*E,a[8]=(g*C-f*y+i*w)*E,a[9]=(-T*C+c*y-e*w)*E,a[10]=(o*u-m*P+r*s)*E,a[11]=(-S*u+O*P-n*s)*E,a[12]=(-g*I+f*x-h*w)*E,a[13]=(T*I-c*x+d*w)*E,a[14]=(-o*t+m*A-p*s)*E,a[15]=(S*t-O*A+l*s)*E,a},mat4.toRotationMat=function(e,t){return t||(t=mat4.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.toMat3=function(e,t){return t||(t=mat3.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},mat4.toInverseMat3=function(t,a){var r=t[0],s=t[1],p=t[2],e=t[4],d=t[5],c=t[6],u=t[8],i=t[9],g=t[10],y=g*d-c*i,l=-g*e+c*u,n=i*e-d*u,o=r*y+s*l+p*n;return o?(o=1/o,a||(a=mat3.create()),a[0]=y*o,a[1]=(-g*s+p*i)*o,a[2]=(c*s-p*d)*o,a[3]=l*o,a[4]=(g*r-p*u)*o,a[5]=(-c*r+p*e)*o,a[6]=n*o,a[7]=(-i*r+s*u)*o,a[8]=(d*r-s*e)*o,a):null},mat4.multiply=function(_,T,S){S||(S=_);var O=_[0],d=_[1],e=_[2],g=_[3],f=_[4],h=_[5],i=_[6],P=_[7],I=_[8],l=_[9],n=_[10],o=_[11],m=_[12],p=_[13],r=_[14],_=_[15],s=T[0],A=T[1],L=T[2],t=T[3],u=T[4],v=T[5],w=T[6],x=T[7],y=T[8],R=T[9],C=T[10],k=T[11],E=T[12],B=T[13],F=T[14],T=T[15];return S[0]=s*O+A*f+L*I+t*m,S[1]=s*d+A*h+L*l+t*p,S[2]=s*e+A*i+L*n+t*r,S[3]=s*g+A*P+L*o+t*_,S[4]=u*O+v*f+w*I+x*m,S[5]=u*d+v*h+w*l+x*p,S[6]=u*e+v*i+w*n+x*r,S[7]=u*g+v*P+w*o+x*_,S[8]=y*O+R*f+C*I+k*m,S[9]=y*d+R*h+C*l+k*p,S[10]=y*e+R*i+C*n+k*r,S[11]=y*g+R*P+C*o+k*_,S[12]=E*O+B*f+F*I+T*m,S[13]=E*d+B*h+F*l+T*p,S[14]=E*e+B*i+F*n+T*r,S[15]=E*g+B*P+F*o+T*_,S},mat4.multiplyVec3=function(t,n,a){a||(a=n);var r=n[0],i=n[1],n=n[2];return a[0]=t[0]*r+t[4]*i+t[8]*n+t[12],a[1]=t[1]*r+t[5]*i+t[9]*n+t[13],a[2]=t[2]*r+t[6]*i+t[10]*n+t[14],a},mat4.multiplyVec4=function(t,n,a){a||(a=n);var r=n[0],i=n[1],e=n[2],n=n[3];return a[0]=t[0]*r+t[4]*i+t[8]*e+t[12]*n,a[1]=t[1]*r+t[5]*i+t[9]*e+t[13]*n,a[2]=t[2]*r+t[6]*i+t[10]*e+t[14]*n,a[3]=t[3]*r+t[7]*i+t[11]*e+t[15]*n,a},mat4.translate=function(t,a,s){var c=a[0],d=a[1],a=a[2],e,u,y,_,x,v,w,T,S,O,E,C;return s&&t!==s?(e=t[0],u=t[1],y=t[2],_=t[3],x=t[4],v=t[5],w=t[6],T=t[7],S=t[8],O=t[9],E=t[10],C=t[11],s[0]=e,s[1]=u,s[2]=y,s[3]=_,s[4]=x,s[5]=v,s[6]=w,s[7]=T,s[8]=S,s[9]=O,s[10]=E,s[11]=C,s[12]=e*c+x*d+S*a+t[12],s[13]=u*c+v*d+O*a+t[13],s[14]=y*c+w*d+E*a+t[14],s[15]=_*c+T*d+C*a+t[15],s):(t[12]=t[0]*c+t[4]*d+t[8]*a+t[12],t[13]=t[1]*c+t[5]*d+t[9]*a+t[13],t[14]=t[2]*c+t[6]*d+t[10]*a+t[14],t[15]=t[3]*c+t[7]*d+t[11]*a+t[15],t)},mat4.scale=function(t,n,a){var r=n[0],i=n[1],n=n[2];return a&&t!==a?(a[0]=t[0]*r,a[1]=t[1]*r,a[2]=t[2]*r,a[3]=t[3]*r,a[4]=t[4]*i,a[5]=t[5]*i,a[6]=t[6]*i,a[7]=t[7]*i,a[8]=t[8]*n,a[9]=t[9]*n,a[10]=t[10]*n,a[11]=t[11]*n,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a):(t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=i,t[5]*=i,t[6]*=i,t[7]*=i,t[8]*=n,t[9]*=n,t[10]*=n,t[11]*=n,t)},mat4.rotate=function(_,a,T,S){var O=T[0],E=T[1],T=T[2],C=Math.sqrt(O*O+E*E+T*T),P,I,L,R,F,N,D,M,V,U,G,W,X,q,Y,J,H,K,Z,Q;return C?(1!==C&&(C=1/C,O*=C,E*=C,T*=C),P=Math.sin(a),I=Math.cos(a),L=1-I,a=_[0],C=_[1],R=_[2],F=_[3],N=_[4],D=_[5],M=_[6],V=_[7],U=_[8],G=_[9],W=_[10],X=_[11],q=O*O*L+I,Y=E*O*L+T*P,J=T*O*L-E*P,H=O*E*L-T*P,K=E*E*L+I,Z=T*E*L+O*P,Q=O*T*L+E*P,O=E*T*L-O*P,E=T*T*L+I,S?_!==S&&(S[12]=_[12],S[13]=_[13],S[14]=_[14],S[15]=_[15]):S=_,S[0]=a*q+N*Y+U*J,S[1]=C*q+D*Y+G*J,S[2]=R*q+M*Y+W*J,S[3]=F*q+V*Y+X*J,S[4]=a*H+N*K+U*Z,S[5]=C*H+D*K+G*Z,S[6]=R*H+M*K+W*Z,S[7]=F*H+V*K+X*Z,S[8]=a*Q+N*O+U*E,S[9]=C*Q+D*O+G*E,S[10]=R*Q+M*O+W*E,S[11]=F*Q+V*O+X*E,S):null},mat4.rotateX=function(t,n,a){var r=Math.sin(n),n=Math.cos(n),o=t[4],e=t[5],s=t[6],p=t[7],d=t[8],i=t[9],u=t[10],g=t[11];return a?t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]):a=t,a[4]=o*n+d*r,a[5]=e*n+i*r,a[6]=s*n+u*r,a[7]=p*n+g*r,a[8]=o*-r+d*n,a[9]=e*-r+i*n,a[10]=s*-r+u*n,a[11]=p*-r+g*n,a},mat4.rotateY=function(t,n,a){var r=Math.sin(n),n=Math.cos(n),o=t[0],e=t[1],s=t[2],p=t[3],d=t[8],i=t[9],u=t[10],g=t[11];return a?t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]):a=t,a[0]=o*n+d*-r,a[1]=e*n+i*-r,a[2]=s*n+u*-r,a[3]=p*n+g*-r,a[8]=o*r+d*n,a[9]=e*r+i*n,a[10]=s*r+u*n,a[11]=p*r+g*n,a},mat4.rotateZ=function(t,n,a){var r=Math.sin(n),n=Math.cos(n),o=t[0],e=t[1],s=t[2],p=t[3],d=t[4],i=t[5],u=t[6],g=t[7];return a?t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]):a=t,a[0]=o*n+d*r,a[1]=e*n+i*r,a[2]=s*n+u*r,a[3]=p*n+g*r,a[4]=o*-r+d*n,a[5]=e*-r+i*n,a[6]=s*-r+u*n,a[7]=p*-r+g*n,a},mat4.frustum=function(t,n,a,r,o,e,s){s||(s=mat4.create());var l=n-t,p=r-a,i=e-o;return s[0]=2*o/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*o/p,s[6]=0,s[7]=0,s[8]=(n+t)/l,s[9]=(r+a)/p,s[10]=-(e+o)/i,s[11]=-1,s[12]=0,s[13]=0,s[14]=-(2*(e*o))/i,s[15]=0,s},mat4.perspective=function(t,n,r,i,o){return t=r*Math.tan(t*Math.PI/360),n*=t,mat4.frustum(-n,n,-t,t,r,i,o)},mat4.ortho=function(t,n,a,r,o,e,s){s||(s=mat4.create());var l=n-t,p=r-a,i=e-o;return s[0]=2/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/p,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2/i,s[11]=0,s[12]=-(t+n)/l,s[13]=-(r+a)/p,s[14]=-(e+o)/i,s[15]=1,s},mat4.lookAt=function(t,r,s,p){var u=Math.sqrt;p||(p=mat4.create());var m=t[0],n=t[1],t=t[2],o,y,_,x,v,w,T,S;return(y=s[0],_=s[1],o=s[2],s=r[1],w=r[2],m===r[0]&&n===s&&t===w)?mat4.identity(p):(s=m-r[0],w=n-r[1],T=t-r[2],S=1/u(s*s+w*w+T*T),s*=S,w*=S,T*=S,r=_*T-o*w,o=o*s-y*T,y=y*w-_*s,(S=u(r*r+o*o+y*y))?(S=1/S,r*=S,o*=S,y*=S):y=o=r=0,_=w*y-T*o,x=T*r-s*y,v=s*o-w*r,(S=u(_*_+x*x+v*v))?(S=1/S,_*=S,x*=S,v*=S):v=x=_=0,p[0]=r,p[1]=_,p[2]=s,p[3]=0,p[4]=o,p[5]=x,p[6]=w,p[7]=0,p[8]=y,p[9]=v,p[10]=T,p[11]=0,p[12]=-(r*m+o*n+y*t),p[13]=-(_*m+x*n+v*t),p[14]=-(s*m+w*n+T*t),p[15]=1,p)},mat4.fromRotationTranslation=function(t,n,r){r||(r=mat4.create());var o=t[0],s=t[1],p=t[2],u=t[3],m=o+o,y=s+s,_=p+p,t=o*m,x=o*y;o*=_;var b=s*y;return s*=_,p*=_,m*=u,y*=u,u*=_,r[0]=1-(b+p),r[1]=x+u,r[2]=o-y,r[3]=0,r[4]=x-u,r[5]=1-(t+p),r[6]=s+m,r[7]=0,r[8]=o+y,r[9]=s-m,r[10]=1-(t+b),r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r},mat4.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"},quat4.create=function(e){var t=new MatrixArray(4);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t},quat4.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},quat4.calculateW=function(t,n){var a=Math.abs,r=Math.sqrt,i=t[0],o=t[1],s=t[2];return n&&t!==n?(n[0]=i,n[1]=o,n[2]=s,n[3]=-r(a(1-i*i-o*o-s*s)),n):(t[3]=-r(a(1-i*i-o*o-s*s)),t)},quat4.inverse=function(e,t){return t&&e!==t?(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t):(e[0]*=-1,e[1]*=-1,e[2]*=-1,e)},quat4.length=function(e){var t=e[0],n=e[1],r=e[2],e=e[3];return Math.sqrt(t*t+n*n+r*r+e*e)},quat4.normalize=function(t,n){n||(n=t);var a=t[0],r=t[1],i=t[2],e=t[3],o=Math.sqrt(a*a+r*r+i*i+e*e);return 0===o?(n[0]=0,n[1]=0,n[2]=0,n[3]=0,n):(o=1/o,n[0]=a*o,n[1]=r*o,n[2]=i*o,n[3]=e*o,n)},quat4.multiply=function(t,n,r){r||(r=t);var o=t[0],s=t[1],e=t[2],t=t[3],l=n[0],p=n[1],d=n[2],n=n[3];return r[0]=o*n+t*l+s*d-e*p,r[1]=s*n+t*p+e*l-o*d,r[2]=e*n+t*d+o*p-s*l,r[3]=t*n-o*l-s*p-e*d,r},quat4.multiplyVec3=function(t,n,r){r||(r=n);var o=n[0],s=n[1],e=n[2],n=t[0],l=t[1],p=t[2],t=t[3],u=t*o+l*e-p*s,i=t*s+p*o-n*e,g=t*e+n*s-l*o,o=-n*o-l*s-p*e;return r[0]=u*t+o*-n+i*-p-g*-l,r[1]=i*t+o*-l+g*-n-u*-p,r[2]=g*t+o*-p+u*-l-i*-n,r},quat4.toMat3=function(t,n){n||(n=mat3.create());var a=t[0],r=t[1],o=t[2],s=t[3],p=a+a,u=r+r,m=o+o,i=a*p,y=a*u;a*=m;var _=r*u;return r*=m,o*=m,p*=s,u*=s,s*=m,n[0]=1-(_+o),n[1]=y+s,n[2]=a-u,n[3]=y-s,n[4]=1-(i+o),n[5]=r+p,n[6]=a+u,n[7]=r-p,n[8]=1-(i+_),n},quat4.toMat4=function(t,n){n||(n=mat4.create());var a=t[0],r=t[1],o=t[2],s=t[3],p=a+a,u=r+r,m=o+o,i=a*p,y=a*u;a*=m;var _=r*u;return r*=m,o*=m,p*=s,u*=s,s*=m,n[0]=1-(_+o),n[1]=y+s,n[2]=a-u,n[3]=0,n[4]=y-s,n[5]=1-(i+o),n[6]=r+p,n[7]=0,n[8]=a+u,n[9]=r-p,n[10]=1-(i+_),n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},quat4.slerp=function(t,n,a,r){var i=Math.abs,o=Math.sin;r||(r=t);var s=t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3],l,p;return 1<=i(s)?(r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]),r):(l=Math.acos(s),p=Math.sqrt(1-s*s),.001>i(p))?(r[0]=.5*t[0]+.5*n[0],r[1]=.5*t[1]+.5*n[1],r[2]=.5*t[2]+.5*n[2],r[3]=.5*t[3]+.5*n[3],r):(s=o((1-a)*l)/p,a=o(a*l)/p,r[0]=t[0]*s+n[0]*a,r[1]=t[1]*s+n[1]*a,r[2]=t[2]*s+n[2]*a,r[3]=t[3]*s+n[3]*a,r)},quat4.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},function(){function e(e,t,n){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent),this.width=0,this.height=0,this.enableFrontToBack=!!n,this.isEarlyZPass=!1,this.isBatchInEarlyZPass=!1,this.currentZ=0,this.zNear=1,this.zFar=1e3,this.zIncrement=(this.zFar-this.zNear)/32768,this.zA=this.zFar/(this.zFar-this.zNear),this.zB=this.zFar*this.zNear/(this.zNear-this.zFar),this.kzA=65536*this.zA,this.kzB=65536*this.zB,this.cam=vec3.create([0,0,100]),this.look=vec3.create([0,0,0]),this.up=vec3.create([0,1,0]),this.worldScale=vec3.create([1,1,1]),this.enable_mipmaps=!0,this.matP=mat4.create(),this.matMV=mat4.create(),this.lastMV=mat4.create(),this.currentMV=mat4.create(),this.gl=e,this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1,this.timerExt=null,this.isTiming=!1,this.timerExt=2===this.version?this.gl.getExtension("EXT_disjoint_timer_query_webgl2")||this.gl.getExtension("EXT_disjoint_timer_query"):this.gl.getExtension("EXT_disjoint_timer_query"),this.frameNumber=0,this.timerResults=[],this.initState()}function t(e,t,n){this.gl=e,this.shaderProgram=t,this.name=n,this.locAPos=e.getAttribLocation(t,"aPos"),this.locATex=e.getAttribLocation(t,"aTex"),this.locMatP=e.getUniformLocation(t,"matP"),this.locMatMV=e.getUniformLocation(t,"matMV"),this.locOpacity=e.getUniformLocation(t,"opacity"),this.locColorFill=e.getUniformLocation(t,"colorFill"),this.locSamplerFront=e.getUniformLocation(t,"samplerFront"),this.locSamplerBack=e.getUniformLocation(t,"samplerBack"),this.locSrcStart=e.getUniformLocation(t,"srcStart"),this.locSrcEnd=e.getUniformLocation(t,"srcEnd"),this.locSrcOriginStart=e.getUniformLocation(t,"srcOriginStart"),this.locSrcOriginEnd=e.getUniformLocation(t,"srcOriginEnd"),this.locLayoutStart=e.getUniformLocation(t,"layoutStart"),this.locLayoutEnd=e.getUniformLocation(t,"layoutEnd"),this.locDestStart=e.getUniformLocation(t,"destStart"),this.locDestEnd=e.getUniformLocation(t,"destEnd"),this.locSeconds=e.getUniformLocation(t,"seconds"),this.locPixelSize=e.getUniformLocation(t,"pixelSize"),this.locLayerScale=e.getUniformLocation(t,"layerScale"),this.locLayerAngle=e.getUniformLocation(t,"layerAngle"),this.hasAnyOptionalUniforms=!!(this.locPixelSize||this.locSeconds||this.locSamplerBack||this.locSrcStart||this.locSrcEnd||this.locSrcOriginStart||this.locSrcOriginEnd||this.locLayoutStart||this.locLayoutEnd||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle),this.lpPixelWidth=-999,this.lpPixelHeight=-999,this.lpOpacity=1,this.lpSrcStartX=0,this.lpSrcStartY=0,this.lpSrcEndX=0,this.lpSrcEndY=0,this.lpSrcOriginStartX=0,this.lpSrcOriginStartY=0,this.lpSrcOriginEndX=0,this.lpSrcOriginEndY=0,this.lpLayoutStartX=0,this.lpLayoutStartY=0,this.lpLayoutEndX=0,this.lpLayoutEndY=0,this.lpDestStartX=0,this.lpDestStartY=0,this.lpDestEndX=1,this.lpDestEndY=1,this.lpLayerScale=1,this.lpLayerAngle=0,this.lpSeconds=0,this.lastCustomParams=[],this.lpMatMV=mat4.create(),this.locOpacity&&e.uniform1f(this.locOpacity,1),this.locColorFill&&e.uniform4f(this.locColorFill,1,1,1,1),this.locSamplerFront&&e.uniform1i(this.locSamplerFront,0),this.locSamplerBack&&e.uniform1i(this.locSamplerBack,1),this.locSrcStart&&e.uniform2f(this.locSrcStart,0,0),this.locSrcEnd&&e.uniform2f(this.locSrcEnd,1,1),this.locSrcOriginStart&&e.uniform2f(this.locSrcOriginStart,0,0),this.locSrcOriginEnd&&e.uniform2f(this.locSrcOriginEnd,0,0),this.locLayoutStart&&e.uniform2f(this.locLayoutStart,0,0),this.locLayoutEnd&&e.uniform2f(this.locLayoutEnd,0,0),this.locDestStart&&e.uniform2f(this.locDestStart,0,0),this.locDestEnd&&e.uniform2f(this.locDestEnd,1,1),this.locLayerScale&&e.uniform1f(this.locLayerScale,1),this.locLayerAngle&&e.uniform1f(this.locLayerAngle,0),this.locSeconds&&e.uniform1f(this.locSeconds,0),this.hasCurrentMatMV=!1}function n(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function a(e,t){this.type=e,this.glwrap=t,this.gl=t.gl,this.opacityParam=0,this.startIndex=0,this.indexCount=0,this.texParam=null,this.mat4param=null,this.layoutRect=quat4.create(),this.srcOriginRect=quat4.create(),this.shaderParams=[],cr.seal(this)}var r=mat4.create();e.prototype.initState=function(){var e=this.gl,t,n;for(this.lastOpacity=1,this.lastTexture0=null,this.lastTexture1=null,this.currentOpacity=1,e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.disable(e.CULL_FACE),e.disable(e.STENCIL_TEST),e.disable(e.DITHER),this.enableFrontToBack?(e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.lastSrcBlend=e.ONE,this.lastDestBlend=e.ONE_MINUS_SRC_ALPHA,this.vertexData=new Float32Array(8000*(this.enableFrontToBack?3:2)),this.texcoordData=new Float32Array(16000),this.pointData=new Float32Array(32000),this.pointBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.pointBuffer),e.bufferData(e.ARRAY_BUFFER,this.pointData.byteLength,e.DYNAMIC_DRAW),this.vertexBuffers=[,,,,],this.texcoordBuffers=[,,,,],t=0;4>t;t++)this.vertexBuffers[t]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.vertexData.byteLength,e.DYNAMIC_DRAW),this.texcoordBuffers[t]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.texcoordData.byteLength,e.DYNAMIC_DRAW);this.curBuffer=0,this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var a=new Uint16Array(12000);t=0,n=12000;for(var r=0;t<n;)a[t++]=r,a[t++]=r+1,a[t++]=r+2,a[t++]=r,a[t++]=r+2,a[t++]=r+3,r+=4;e.bufferData(e.ELEMENT_ARRAY_BUFFER,a,e.STATIC_DRAW),this.vertexPtr=0,this.texPtr=0,this.pointPtr=0;var o,s;this.shaderPrograms=[],o="varying mediump vec2 vTex;\nuniform lowp float opacity;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex);\n\tgl_FragColor *= opacity;\n}",s=this.enableFrontToBack?"attribute highp vec3 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);\n\tvTex = aTex;\n}":"attribute highp vec2 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tvTex = aTex;\n}";var l=this.createShaderProgram({src:o},s,"<default>");this.shaderPrograms.push(l),o="uniform mediump sampler2D samplerFront;\nvarying lowp float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);\n\tgl_FragColor *= opacity;\n}";l=this.createShaderProgram({src:o},"attribute vec4 aPos;\nvarying float opacity;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tgl_PointSize = aPos.z;\n\topacity = aPos.w;\n}","<point>"),this.shaderPrograms.push(l),o="varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tif (texture2D(samplerFront, vTex).a < 1.0)\n\t\tdiscard;\n}";var l=this.createShaderProgram({src:o},s,"<earlyz>");this.shaderPrograms.push(l),o="uniform lowp vec4 colorFill;\nvoid main(void) {\n\tgl_FragColor = colorFill;\n}";var l=this.createShaderProgram({src:o},s,"<fill>");for(var p in this.shaderPrograms.push(l),cr.shaders)cr.shaders.hasOwnProperty(p)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[p],s,p));e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),this.batch=[],this.batchPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.lastProgram=-1,this.currentProgram=-1,this.currentShader=null,this.fbo=e.createFramebuffer(),this.renderToTex=null,this.depthBuffer=null,this.attachedDepthBuffer=!1,this.enableFrontToBack&&(this.depthBuffer=e.createRenderbuffer()),this.tmpVec3=vec3.create([0,0,0]);var d=e.getParameter(e.ALIASED_POINT_SIZE_RANGE);this.minPointSize=d[0],this.maxPointSize=d[1],2048<this.maxPointSize&&(this.maxPointSize=2048),this.switchProgram(0),cr.seal(this)};t.prototype.updateMatMV=function(e){n(this.lpMatMV,e)||(mat4.set(e,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,e))},e.prototype.createShaderProgram=function(e,n,a){var r=this.gl,o=r.createShader(r.FRAGMENT_SHADER);if(r.shaderSource(o,e.src),r.compileShader(o),!r.getShaderParameter(o,r.COMPILE_STATUS)){var s=r.getShaderInfoLog(o);throw r.deleteShader(o),new Error("error compiling fragment shader: "+s)}var l=r.createShader(r.VERTEX_SHADER);if(r.shaderSource(l,n),r.compileShader(l),!r.getShaderParameter(l,r.COMPILE_STATUS)){var s=r.getShaderInfoLog(l);throw r.deleteShader(o),r.deleteShader(l),new Error("error compiling vertex shader: "+s)}var p=r.createProgram();if(r.attachShader(p,o),r.attachShader(p,l),r.linkProgram(p),!r.getProgramParameter(p,r.LINK_STATUS)){var s=r.getProgramInfoLog(p);throw r.deleteShader(o),r.deleteShader(l),r.deleteProgram(p),new Error("error linking shader program: "+s)}r.useProgram(p),r.deleteShader(o),r.deleteShader(l);var d=new t(r,p,a);d.extendBoxHorizontal=e.extendBoxHorizontal||0,d.extendBoxVertical=e.extendBoxVertical||0,d.crossSampling=!!e.crossSampling,d.preservesOpaqueness=!!e.preservesOpaqueness,d.animated=!!e.animated,d.parameters=e.parameters||[];var c,u;for(c=0,u=d.parameters.length;c<u;c++)d.parameters[c][1]=r.getUniformLocation(p,d.parameters[c][0]),d.lastCustomParams.push(0);return cr.seal(d),d},e.prototype.getShaderIndex=function(e){var t,n;for(t=0,n=this.shaderPrograms.length;t<n;t++)if(this.shaderPrograms[t].name===e)return t;return-1},e.prototype.project=function(e,t,n){var a=this.matMV,r=this.matP,i=[0,0,0,0,0,0,0,0];i[0]=a[0]*e+a[4]*t+a[12],i[1]=a[1]*e+a[5]*t+a[13],i[2]=a[2]*e+a[6]*t+a[14],i[3]=a[3]*e+a[7]*t+a[15],i[4]=r[0]*i[0]+r[4]*i[1]+r[8]*i[2]+r[12]*i[3],i[5]=r[1]*i[0]+r[5]*i[1]+r[9]*i[2]+r[13]*i[3],i[6]=r[2]*i[0]+r[6]*i[1]+r[10]*i[2]+r[14]*i[3],i[7]=-i[2];0===i[7]||(i[7]=1/i[7],i[4]*=i[7],i[5]*=i[7],i[6]*=i[7],n[0]=(.5*i[4]+.5)*this.width,n[1]=(.5*i[5]+.5)*this.height)},e.prototype.setSize=function(e,t,n){if(this.width!==e||this.height!==t||n){this.endBatch();var a=this.gl;if(this.width=e,this.height=t,a.viewport(0,0,e,t),mat4.lookAt(this.cam,this.look,this.up,this.matMV),this.enableFrontToBack)mat4.ortho(-e/2,e/2,t/2,-t/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1;else{mat4.perspective(45,e/t,this.zNear,this.zFar,this.matP);var r=[0,0],o=[0,0];this.project(0,0,r),this.project(1,1,o),this.worldScale[0]=1/(o[0]-r[0]),this.worldScale[1]=-1/(o[1]-r[1])}var l,p,d;for(l=0,p=this.shaderPrograms.length;l<p;l++)d=this.shaderPrograms[l],d.hasCurrentMatMV=!1,d.locMatP&&(a.useProgram(d.shaderProgram),a.uniformMatrix4fv(d.locMatP,!1,this.matP));a.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE0),this.lastTexture0=null,this.lastTexture1=null,this.depthBuffer&&(a.bindFramebuffer(a.FRAMEBUFFER,this.fbo),a.bindRenderbuffer(a.RENDERBUFFER,this.depthBuffer),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this.width,this.height),!this.attachedDepthBuffer&&(a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),a.bindRenderbuffer(a.RENDERBUFFER,null),a.bindFramebuffer(a.FRAMEBUFFER,null),this.renderToTex=null)}},e.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV),mat4.scale(this.matMV,this.worldScale)},e.prototype.translate=function(e,t){0===e&&0===t||(this.tmpVec3[0]=e,this.tmpVec3[1]=t,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3))},e.prototype.scale=function(e,t){1===e&&1===t||(this.tmpVec3[0]=e,this.tmpVec3[1]=t,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3))},e.prototype.rotateZ=function(e){0===e||mat4.rotateZ(this.matMV,e)},e.prototype.updateModelView=function(){if(!n(this.lastMV,this.matMV)){var e=this.pushBatch();e.type=5,e.mat4param?mat4.set(this.matMV,e.mat4param):e.mat4param=mat4.create(this.matMV),mat4.set(this.matMV,this.lastMV),this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.setEarlyZIndex=function(e){this.enableFrontToBack&&(32760<e&&(e=32760),this.currentZ=this.cam[2]-this.zNear-e*this.zIncrement)};a.prototype.doSetEarlyZPass=function(){var e=this.gl,t=this.glwrap;0===this.startIndex?(e.depthMask(!1),e.colorMask(!0,!0,!0,!0),e.enable(e.BLEND),t.isBatchInEarlyZPass=!1):(e.depthMask(!0),e.colorMask(!1,!1,!1,!1),e.disable(e.BLEND),e.bindFramebuffer(e.FRAMEBUFFER,t.fbo),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0),e.clear(e.DEPTH_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,null),t.isBatchInEarlyZPass=!0)},a.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)},a.prototype.doSetTexture1=function(){var e=this.gl;e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.texParam),e.activeTexture(e.TEXTURE0)},a.prototype.doSetOpacity=function(){var e=this.opacityParam,t=this.glwrap;t.currentOpacity=e;var n=t.currentShader;n.locOpacity&&n.lpOpacity!==e&&(n.lpOpacity=e,this.gl.uniform1f(n.locOpacity,e))},a.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)},a.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)},a.prototype.doUpdateModelView=function(){var e=this.glwrap.shaderPrograms,t=this.glwrap.currentProgram,n,a,r;for(n=0,a=e.length;n<a;n++)r=e[n],n===t&&r.locMatMV?(r.updateMatMV(this.mat4param),r.hasCurrentMatMV=!0):r.hasCurrentMatMV=!1;mat4.set(this.mat4param,this.glwrap.currentMV)},a.prototype.doRenderToTexture=function(){var e=this.gl,t=this.glwrap;this.texParam?(t.lastTexture1===this.texParam&&(e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,null),t.lastTexture1=null,e.activeTexture(e.TEXTURE0)),e.bindFramebuffer(e.FRAMEBUFFER,t.fbo),!t.isBatchInEarlyZPass&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texParam,0)):(!t.enableFrontToBack&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0),e.bindFramebuffer(e.FRAMEBUFFER,null))},a.prototype.doClear=function(){var e=this.gl,t=this.startIndex;0===t?(e.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),e.clear(e.COLOR_BUFFER_BIT)):1===t?(e.enable(e.SCISSOR_TEST),e.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.SCISSOR_TEST)):e.clear(e.DEPTH_BUFFER_BIT)},a.prototype.doSetDepthTestEnabled=function(){var e=this.gl,t=this.startIndex;0===t?e.disable(e.DEPTH_TEST):e.enable(e.DEPTH_TEST)},a.prototype.doPoints=function(){var e=this.gl,t=this.glwrap;t.enableFrontToBack&&e.disable(e.DEPTH_TEST);var n=t.shaderPrograms[1];e.useProgram(n.shaderProgram),!n.hasCurrentMatMV&&n.locMatMV&&(n.updateMatMV(t.currentMV),n.hasCurrentMatMV=!0),e.enableVertexAttribArray(n.locAPos),e.bindBuffer(e.ARRAY_BUFFER,t.pointBuffer),e.vertexAttribPointer(n.locAPos,4,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,this.startIndex/4,this.indexCount),n=t.currentShader,e.useProgram(n.shaderProgram),0<=n.locAPos&&(e.enableVertexAttribArray(n.locAPos),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffers[t.curBuffer]),e.vertexAttribPointer(n.locAPos,t.enableFrontToBack?3:2,e.FLOAT,!1,0,0)),0<=n.locATex&&(e.enableVertexAttribArray(n.locATex),e.bindBuffer(e.ARRAY_BUFFER,t.texcoordBuffers[t.curBuffer]),e.vertexAttribPointer(n.locATex,2,e.FLOAT,!1,0,0)),t.enableFrontToBack&&e.enable(e.DEPTH_TEST)},a.prototype.doSetProgram=function(){var e=this.gl,t=this.glwrap,n=t.shaderPrograms[this.startIndex];t.currentProgram=this.startIndex,t.currentShader=n,e.useProgram(n.shaderProgram),!n.hasCurrentMatMV&&n.locMatMV&&(n.updateMatMV(t.currentMV),n.hasCurrentMatMV=!0),n.locOpacity&&n.lpOpacity!==t.currentOpacity&&(n.lpOpacity=t.currentOpacity,e.uniform1f(n.locOpacity,t.currentOpacity)),0<=n.locAPos&&(e.enableVertexAttribArray(n.locAPos),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffers[t.curBuffer]),e.vertexAttribPointer(n.locAPos,t.enableFrontToBack?3:2,e.FLOAT,!1,0,0)),0<=n.locATex&&(e.enableVertexAttribArray(n.locATex),e.bindBuffer(e.ARRAY_BUFFER,t.texcoordBuffers[t.curBuffer]),e.vertexAttribPointer(n.locATex,2,e.FLOAT,!1,0,0))},a.prototype.doSetColor=function(){var e=this.glwrap.currentShader,t=this.mat4param;this.gl.uniform4f(e.locColorFill,t[0],t[1],t[2],t[3])},a.prototype.doSetProgramParameters=function(){var e=this.glwrap.currentShader,t=this.gl,n=this.mat4param,a=this.layoutRect,r=this.srcOriginRect,o,s;e.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.texParam),this.glwrap.lastTexture1=this.texParam,t.activeTexture(t.TEXTURE0));var l=n[0],p=n[1];if(e.locPixelSize&&(l!==e.lpPixelWidth||p!==e.lpPixelHeight)&&(e.lpPixelWidth=l,e.lpPixelHeight=p,t.uniform2f(e.locPixelSize,l,p)),l=n[2],p=n[3],e.locDestStart&&(l!==e.lpDestStartX||p!==e.lpDestStartY)&&(e.lpDestStartX=l,e.lpDestStartY=p,t.uniform2f(e.locDestStart,l,p)),l=n[4],p=n[5],e.locDestEnd&&(l!==e.lpDestEndX||p!==e.lpDestEndY)&&(e.lpDestEndX=l,e.lpDestEndY=p,t.uniform2f(e.locDestEnd,l,p)),l=n[6],e.locLayerScale&&l!==e.lpLayerScale&&(e.lpLayerScale=l,t.uniform1f(e.locLayerScale,l)),l=n[7],e.locLayerAngle&&l!==e.lpLayerAngle&&(e.lpLayerAngle=l,t.uniform1f(e.locLayerAngle,l)),l=n[12],p=n[13],e.locSrcStart&&(l!==e.lpSrcStartX||p!==e.lpSrcStartY)&&(e.lpSrcStartX=l,e.lpSrcStartY=p,t.uniform2f(e.locSrcStart,l,p)),l=n[14],p=n[15],e.locSrcEnd&&(l!==e.lpSrcEndX||p!==e.lpSrcEndY)&&(e.lpSrcEndX=l,e.lpSrcEndY=p,t.uniform2f(e.locSrcEnd,l,p)),l=r[0],p=r[1],e.locSrcOriginStart&&(l!==e.lpSrcOriginStartX||p!==e.lpSrcOriginStartY)&&(e.lpSrcOriginStartX=l,e.lpSrcOriginStartY=p,t.uniform2f(e.locSrcOriginStart,l,p)),l=r[2],p=r[3],e.locSrcOriginEnd&&(l!==e.lpSrcOriginEndX||p!==e.lpSrcOriginEndY)&&(e.lpSrcOriginEndX=l,e.lpSrcOriginEndY=p,t.uniform2f(e.locSrcOriginEnd,l,p)),l=a[0],p=a[1],e.locLayoutStart&&(l!==e.lpLayoutStartX||p!==e.lpLayoutStartY)&&(e.lpLayoutStartX=l,e.lpLayoutStartY=p,t.uniform2f(e.locLayoutStart,l,p)),l=a[2],p=a[3],e.locLayoutEnd&&(l!==e.lpLayoutEndX||p!==e.lpLayoutEndY)&&(e.lpLayoutEndX=l,e.lpLayoutEndY=p,t.uniform2f(e.locLayoutEnd,l,p)),l=this.startIndex,e.locSeconds&&l!==e.lpSeconds&&(e.lpSeconds=l,t.uniform1f(e.locSeconds,l)),e.parameters.length)for(o=0,s=e.parameters.length;o<s;o++)l=this.shaderParams[o],Array.isArray(l)?t.uniform3fv(e.parameters[o][1],l):l!==e.lastCustomParams[o]&&(e.lastCustomParams[o]=l,t.uniform1f(e.parameters[o][1],l))},e.prototype.pushBatch=function(){return this.batchPtr===this.batch.length&&this.batch.push(new a(0,this)),this.batch[this.batchPtr++]},e.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){this.maybeStartTiming();var e=this.gl;if(0<this.pointPtr&&(e.bindBuffer(e.ARRAY_BUFFER,this.pointBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),t&&0<=t.locAPos&&"<point>"===t.name&&e.vertexAttribPointer(t.locAPos,4,e.FLOAT,!1,0,0)),0<this.vertexPtr){var t=this.currentShader;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]),e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexData.subarray(0,this.vertexPtr)),t&&0<=t.locAPos&&"<point>"!==t.name&&e.vertexAttribPointer(t.locAPos,this.enableFrontToBack?3:2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]),e.bufferSubData(e.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr)),t&&0<=t.locATex&&"<point>"!==t.name&&e.vertexAttribPointer(t.locATex,2,e.FLOAT,!1,0,0)}var n,a,r;for(n=0,a=this.batchPtr;n<a;n++)switch(r=this.batch[n],r.type){case 1:r.doQuad();break;case 2:r.doSetTexture();break;case 3:r.doSetOpacity();break;case 4:r.doSetBlend();break;case 5:r.doUpdateModelView();break;case 6:r.doRenderToTexture();break;case 7:r.doClear();break;case 8:r.doPoints();break;case 9:r.doSetProgram();break;case 10:r.doSetProgramParameters();break;case 11:r.doSetTexture1();break;case 12:r.doSetColor();break;case 13:r.doSetDepthTestEnabled();break;case 14:r.doSetEarlyZPass();}this.batchPtr=0,this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isBatchInEarlyZPass=!1,this.curBuffer++,4<=this.curBuffer&&(this.curBuffer=0)}},e.prototype.maybeStartTiming=function(){if(!this.isTiming&&this.timerExt){this.isTiming=!0;var e={frameNumber:this.frameNumber,query:null,result:0};if(2===this.version?(e.query=this.gl.createQuery(),this.gl.beginQuery(this.timerExt.TIME_ELAPSED_EXT,e.query)):(e.query=this.timerExt.createQueryEXT(),this.timerExt.beginQueryEXT(this.timerExt.TIME_ELAPSED_EXT,e.query)),this.timerResults.push(e),1e3<this.timerResults.length){var t=this.timerResults.shift();t.query&&(2===this.version?this.gl.deleteQuery(t.query):this.timerExt.deleteQueryEXT(t.query))}}},e.prototype.maybeFinishTiming=function(){if(this.isTiming&&this.timerResults.length){this.timerResults[this.timerResults.length-1];2===this.version?this.gl.endQuery(this.timerExt.TIME_ELAPSED_EXT):this.timerExt.endQueryEXT(this.timerExt.TIME_ELAPSED_EXT),this.isTiming=!1}},e.prototype.checkForTimerResults=function(e){var t,n,a,r,s;for(t=0,n=this.timerResults.length;t<n;++t){if(a=this.timerResults[t],a.frameNumber>=e)return;a.query&&(r=2===this.version?this.gl.getQueryParameter(a.query,this.gl.QUERY_RESULT_AVAILABLE):this.timerExt.getQueryObjectEXT(a.query,this.timerExt.QUERY_RESULT_AVAILABLE_EXT),s=this.gl.getParameter(this.timerExt.GPU_DISJOINT_EXT),r&&!s&&(a.result=2===this.version?this.gl.getQueryParameter(a.query,this.gl.QUERY_RESULT):this.timerExt.getQueryObjectEXT(a.query,this.timerExt.QUERY_RESULT_EXT),a.result/=1e9),(r||s)&&(2===this.version?this.gl.deleteQuery(a.query):this.timerExt.deleteQueryEXT(a.query),a.query=null))}},e.prototype.getFrameRangeTimerResults=function(e,t){if(t<=e)return-1;var n=0,a=0,r,s,l;for(r=0,s=this.timerResults.length;r<s&&(l=this.timerResults[r],!(l.frameNumber>=t));++r)if(l.frameNumber>=e){if(l.query)return-1;n+=l.result,a++}return a<t-e?-1:n},e.prototype.deleteTimerResultsToFrame=function(e){var t,n,a;for(t=0,n=this.timerResults.length;t<n;++t)if(a=this.timerResults[t],a.frameNumber>=e)return void(0<t&&this.timerResults.splice(0,t))},e.prototype.setOpacity=function(e){if(e!==this.lastOpacity&&!this.isEarlyZPass){var t=this.pushBatch();t.type=3,t.opacityParam=e,this.lastOpacity=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.setTexture=function(e){if(e!==this.lastTexture0){var t=this.pushBatch();t.type=2,t.texParam=e,this.lastTexture0=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.setBlend=function(e,t){if((e!==this.lastSrcBlend||t!==this.lastDestBlend)&&!this.isEarlyZPass){var n=this.pushBatch();n.type=4,n.startIndex=e,n.indexCount=t,this.lastSrcBlend=e,this.lastDestBlend=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA},e.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)},e.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};e.prototype.quad=function(e,n,a,r,i,o,s,l){this.vertexPtr>=15992&&this.endBatch();var p=this.vertexPtr,d=this.texPtr,c=this.vertexData,u=this.texcoordData,g=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var m=this.pushBatch();m.type=1,m.startIndex=this.enableFrontToBack?p:3*(p/2),m.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(c[p++]=e,c[p++]=n,c[p++]=g,c[p++]=a,c[p++]=r,c[p++]=g,c[p++]=i,c[p++]=o,c[p++]=g,c[p++]=s,c[p++]=l,c[p++]=g):(c[p++]=e,c[p++]=n,c[p++]=a,c[p++]=r,c[p++]=i,c[p++]=o,c[p++]=s,c[p++]=l),u[d++]=0,u[d++]=0,u[d++]=1,u[d++]=0,u[d++]=1,u[d++]=1,u[d++]=0,u[d++]=1,this.vertexPtr=p,this.texPtr=d},e.prototype.quadTex=function(e,n,a,r,i,o,s,l,p){this.vertexPtr>=15992&&this.endBatch();var d=this.vertexPtr,c=this.texPtr,u=this.vertexData,g=this.texcoordData,m=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var y=this.pushBatch();y.type=1,y.startIndex=this.enableFrontToBack?d:3*(d/2),y.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}var _=p.left,h=p.top,f=p.right,x=p.bottom;this.enableFrontToBack?(u[d++]=e,u[d++]=n,u[d++]=m,u[d++]=a,u[d++]=r,u[d++]=m,u[d++]=i,u[d++]=o,u[d++]=m,u[d++]=s,u[d++]=l,u[d++]=m):(u[d++]=e,u[d++]=n,u[d++]=a,u[d++]=r,u[d++]=i,u[d++]=o,u[d++]=s,u[d++]=l),g[c++]=_,g[c++]=h,g[c++]=f,g[c++]=h,g[c++]=f,g[c++]=x,g[c++]=_,g[c++]=x,this.vertexPtr=d,this.texPtr=c},e.prototype.quadTexUV=function(e,n,a,r,i,o,s,l,p,d,c,u,g,m,y,_){this.vertexPtr>=15992&&this.endBatch();var h=this.vertexPtr,f=this.texPtr,x=this.vertexData,w=this.texcoordData,T=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var S=this.pushBatch();S.type=1,S.startIndex=this.enableFrontToBack?h:3*(h/2),S.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(x[h++]=e,x[h++]=n,x[h++]=T,x[h++]=a,x[h++]=r,x[h++]=T,x[h++]=i,x[h++]=o,x[h++]=T,x[h++]=s,x[h++]=l,x[h++]=T):(x[h++]=e,x[h++]=n,x[h++]=a,x[h++]=r,x[h++]=i,x[h++]=o,x[h++]=s,x[h++]=l),w[f++]=p,w[f++]=d,w[f++]=c,w[f++]=u,w[f++]=g,w[f++]=m,w[f++]=y,w[f++]=_,this.vertexPtr=h,this.texPtr=f},e.prototype.convexPoly=function(e){var t=e.length/2;var n=t-2,a=e[0],r=e[1],o,s,l,p,d,c,u,g;for(o=0;o<n;o+=2)s=2*o,l=e[s+2],p=e[s+3],d=e[s+4],c=e[s+5],o===n-1?this.quad(a,r,l,p,d,c,d,c):(u=e[s+6],g=e[s+7],this.quad(a,r,l,p,d,c,u,g))};e.prototype.point=function(e,t,n,a){this.pointPtr>=7996&&this.endBatch();var r=this.pointPtr,i=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var o=this.pushBatch();o.type=8,o.startIndex=r,o.indexCount=1,this.hasPointBatchTop=!0,this.hasQuadBatchTop=!1}i[r++]=e,i[r++]=t,i[r++]=n,i[r++]=a,this.pointPtr=r},e.prototype.switchProgram=function(e){if(this.lastProgram!==e){var t=this.shaderPrograms[e];if(!t){if(0===this.lastProgram)return;e=0,t=this.shaderPrograms[0]}var n=this.pushBatch();n.type=9,n.startIndex=e,this.lastProgram=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.programUsesDest=function(e){var t=this.shaderPrograms[e];return!!(t.locDestStart||t.locDestEnd)},e.prototype.programUsesCrossSampling=function(e){var t=this.shaderPrograms[e];return!!(t.locDestStart||t.locDestEnd||t.crossSampling)},e.prototype.programPreservesOpaqueness=function(e){return this.shaderPrograms[e].preservesOpaqueness},e.prototype.programExtendsBox=function(e){var t=this.shaderPrograms[e];return 0!==t.extendBoxHorizontal||0!==t.extendBoxVertical},e.prototype.getProgramBoxExtendHorizontal=function(e){return this.shaderPrograms[e].extendBoxHorizontal},e.prototype.getProgramBoxExtendVertical=function(e){return this.shaderPrograms[e].extendBoxVertical},e.prototype.getProgramParameterType=function(e,t){return this.shaderPrograms[e].parameters[t][2]},e.prototype.programIsAnimated=function(e){return this.shaderPrograms[e].animated},e.prototype.setProgramParameters=function(e,t,n,a,r,o,l,p,d,c,u,g,m,y,_,h,f,x,v,w,T,S,O){var E=this.shaderPrograms[this.lastProgram],s,C,A,P,I,L,R;if(E.hasAnyOptionalUniforms||O.length){if(A=this.pushBatch(),A.type=10,A.mat4param?mat4.set(this.matMV,A.mat4param):A.mat4param=mat4.create(),P=A.mat4param,P[0]=t,P[1]=n,P[2]=h,P[3]=f,P[4]=x,P[5]=v,P[6]=w,P[7]=T,P[12]=a,P[13]=r,P[14]=o,P[15]=l,L=A.srcOriginRect,L[0]=p,L[1]=d,L[2]=c,L[3]=u,R=A.layoutRect,R[0]=g,R[1]=_,R[2]=y,R[3]=m,A.startIndex=S,(A.texParam=E.locSamplerBack?e:null,O.length))for(I=A.shaderParams,I.length=O.length,(s=0,C=O.length);s<C;s++)I[s]=O[s];this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.clear=function(e,t,n,r){var a=this.pushBatch();a.type=7,a.startIndex=0,a.mat4param||(a.mat4param=mat4.create()),a.mat4param[0]=e,a.mat4param[1]=t,a.mat4param[2]=n,a.mat4param[3]=r,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},e.prototype.clearRect=function(e,t,n,a){if(!(0>n||0>a)){var r=this.pushBatch();r.type=7,r.startIndex=1,r.mat4param||(r.mat4param=mat4.create()),r.mat4param[0]=e,r.mat4param[1]=t,r.mat4param[2]=n,r.mat4param[3]=a,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.clearDepth=function(){var e=this.pushBatch();e.type=7,e.startIndex=2,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},e.prototype.setEarlyZPass=function(t){if(this.enableFrontToBack&&(t=!!t,this.isEarlyZPass!==t)){var n=this.pushBatch();n.type=14,n.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isEarlyZPass=t,this.renderToTex=null,this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}},e.prototype.setDepthTestEnabled=function(t){if(this.enableFrontToBack){var e=this.pushBatch();e.type=13,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,r),this.resetModelView(),this.updateModelView();var e=this.width/2,t=this.height/2;this.quad(-e,t,e,t,e,-t,-e,-t),mat4.set(r,this.matMV),this.updateModelView()},e.prototype.setColorFillMode=function(e,t,n,a){this.switchProgram(3);var r=this.pushBatch();r.type=12,r.mat4param||(r.mat4param=mat4.create()),r.mat4param[0]=e,r.mat4param[1]=t,r.mat4param[2]=n,r.mat4param[3]=a,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},e.prototype.setTextureFillMode=function(){this.switchProgram(0)},e.prototype.restoreEarlyZMode=function(){this.switchProgram(2)},e.prototype.getFrameNumber=function(){return this.frameNumber},e.prototype.present=function(){this.endBatch(),this.maybeFinishTiming(),this.gl.flush(),this.checkForTimerResults(this.frameNumber),this.frameNumber++},e.prototype.supportsGpuProfiling=function(){return!!this.timerExt};var o=[],i={};e.prototype.contextLost=function(){cr.clearArray(o),i={}};e.prototype.loadTexture=function(e,t,n,a,r,s){t=!!t,n=!!n;var l=e.src+","+t+","+n+(t?","+r:""),p=null;if("undefined"!=typeof e.src&&i.hasOwnProperty(l))return p=i[l],p.c2refcount++,p;this.endBatch();var d=this.gl,c=cr.isPOT(e.width)&&cr.isPOT(e.height);p=d.createTexture(),d.bindTexture(d.TEXTURE_2D,p),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var u=d.RGBA,g=d.RGBA,m=d.UNSIGNED_BYTE;if(a&&!this.isIE&&(1===a?(u=d.RGB,g=d.RGB):2===a?m=d.UNSIGNED_SHORT_4_4_4_4:3===a?m=d.UNSIGNED_SHORT_5_5_5_1:4===a?(u=d.RGB,g=d.RGB,m=d.UNSIGNED_SHORT_5_6_5):void 0),1===this.version&&!c&&t){var y=document.createElement("canvas");y.width=cr.nextHighestPowerOfTwo(e.width),y.height=cr.nextHighestPowerOfTwo(e.height);var _=y.getContext("2d");_.imageSmoothingEnabled=n,_.drawImage(e,0,0,e.width,e.height,0,0,y.width,y.height),d.texImage2D(d.TEXTURE_2D,0,u,g,m,y)}else d.texImage2D(d.TEXTURE_2D,0,u,g,m,e);return t?"repeat-x"===r?(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE)):"repeat-y"===r?(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT)):(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT)):(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE)),n?(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),(c||2<=this.version)&&this.enable_mipmaps&&!s?(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR),d.generateMipmap(d.TEXTURE_2D)):d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR)):(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST)),d.bindTexture(d.TEXTURE_2D,null),this.lastTexture0=null,p.c2width=e.width,p.c2height=e.height,p.c2refcount=1,p.c2texkey=l,o.push(p),i[l]=p,p},e.prototype.createEmptyTexture=function(e,t,n,a,r){this.endBatch();var i=this.gl;this.isIE&&(a=!1);var s=i.createTexture();return i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,a?i.UNSIGNED_SHORT_4_4_4_4:i.UNSIGNED_BYTE,null),r?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n?i.LINEAR:i.NEAREST),i.bindTexture(i.TEXTURE_2D,null),this.lastTexture0=null,s.c2width=e,s.c2height=t,o.push(s),s},e.prototype.videoToTexture=function(e,t,n){this.endBatch();var a=this.gl;this.isIE&&(n=!1),a.bindTexture(a.TEXTURE_2D,t),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);try{a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,n?a.UNSIGNED_SHORT_4_4_4_4:a.UNSIGNED_BYTE,e)}catch(t){console&&console.error&&console.error("Error updating WebGL texture: ",t)}a.bindTexture(a.TEXTURE_2D,null),this.lastTexture0=null},e.prototype.deleteTexture=function(e){return e?"undefined"!=typeof e.c2refcount&&1<e.c2refcount?void e.c2refcount--:void(this.endBatch(),e===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),e===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(o,e),"undefined"!=typeof e.c2texkey&&delete i[e.c2texkey],this.gl.deleteTexture(e)):void 0},e.prototype.estimateVRAM=function(){var e=2*(4*(this.width*this.height)),n,a,r;for(n=0,a=o.length;n<a;n++)r=o[n],e+=4*(r.c2width*r.c2height);return e},e.prototype.textureCount=function(){return o.length},e.prototype.setRenderingToTexture=function(e){if(e!==this.renderToTex){var t=this.pushBatch();t.type=6,t.texParam=e,this.renderToTex=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},cr.GLWrap=e}();(function(){function e(e){var t=e.canvas,n=e.projectDataUrl;if(t||(t=document.createElement("canvas"),document.body.appendChild(t)),t&&t.getContext){window.c3runtime=this,window.c3canvas=t;var a=this;this.exportType=e.exportType,this.isPreview="preview"===this.exportType,this.isRemotePreview=!!e.isRemotePreview,this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!!("undefined"!=typeof window.c2isCrosswalk&&window.c2isCrosswalk),this.isCordova="cordova"===this.exportType,this.isPhoneGap=this.isCordova,this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent),this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge,this.isTizen=/tizen/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge,this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isiPad=/ipad/i.test(navigator.userAgent),this.isiOS=this.isiPhone||this.isiPad,this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge,this.isWindows=/windows/i.test(navigator.userAgent),this.isNWjs="nwjs"===this.exportType||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent),this.isNodeWebkit=this.isNWjs,this.isArcade="scirra-arcade"===this.exportType,this.isWindows8App=!!("undefined"!=typeof window.c2isWindows8&&window.c2isWindows8),this.isWindowsPhone8=!!("undefined"!=typeof window.c2isWindowsPhone8&&window.c2isWindowsPhone8),this.isWindowsPhone81=!!("undefined"!=typeof window.c2isWindowsPhone81&&window.c2isWindowsPhone81),this.isWindows10="windows-uwp"===this.exportType,this.isWinJS=this.isWindows8App||this.isWindowsPhone81||this.isWindows10,this.isBlackberry10=!!("undefined"!=typeof window.c2isBlackberry10&&window.c2isBlackberry10),this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp,this.devicePixelRatio=1,this.isMobile=this.isCordova||this.isCrosswalk||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen,this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent)),this.isWKWebView=!!(this.isiOS&&this.isCordova),this.isPreview&&!this.isNWjs&&("?nw"===window.location.search||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent))&&(this.isNWjs=!0),this.isDebug=this.isPreview&&-1<window.location.search.indexOf("debug"),this.useFbInstant="undefined"!=typeof FBInstant&&!this.isPreview&&!this.isCordova,this.hasInitialized=!1,this.canvas=t,this.gl=null,this.glwrap=null,this.glUnmaskedRenderer="(unavailable)",this.enableFrontToBack=!1,this.earlyz_index=0,this.ctx=null,this.firstInFullscreen=!1,this.oldWidth=0,this.oldHeight=0,this.canvas.oncontextmenu=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.onselectstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.ontouchstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.isNWjs&&(window.ondragover=function(t){return t.preventDefault(),!1},window.ondrop=function(t){return t.preventDefault(),!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache()),this.projectDataUrl=n||"",this.width=t.width,this.height=t.height,this.draw_width=this.width,this.draw_height=this.height,this.cssWidth=this.width,this.cssHeight=this.height,this.lastWindowWidth=window.innerWidth,this.lastWindowHeight=window.innerHeight,this.forceCanvasAlpha=!1,this.redraw=!0,this.isSuspended=!1,Date.now||(Date.now=function(){return+new Date}),this.plugins=[],this.types={},this.types_lowercase={},this.types_by_index=[],this.behaviors=[],this.layouts={},this.layouts_by_index=[],this.eventsheets={},this.eventsheets_by_index=[],this.wait_for_textures=[],this.triggers_to_postinit=[],this.all_global_vars=[],this.all_local_vars=[],this.solidBehavior=null,this.jumpthruBehavior=null,this.shadowcasterBehavior=null,this.deathRow={},this.hasPendingInstances=!1,this.isInClearDeathRow=!1,this.isInOnDestroy=0,this.isRunningEvents=!1,this.isEndingLayout=!1,this.createRow=[],this.isLoadingState=!1,this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null,this.lastSaveJson="",this.signalledContinuousPreview=!1,this.suspendDrawing=!1,this.fireOnCreateAfterLoad=[],this.dt=0,this.dt1=0,this.minimumFramerate=30,this.logictime=0,this.cpuutilisation=0,this.timescale=1,this.kahanTime=new cr.KahanAdder,this.wallTime=new cr.KahanAdder,this.last_tick_time=0,this.fps=0,this.last_fps_time=0,this.tickcount=0,this.tickcount_nosave=0,this.execcount=0,this.framecount=0,this.objectcount=0,this.gpuTimeStartFrame=0,this.gpuTimeEndFrame=0,this.gpuCurUtilisation=-1,this.gpuLastUtilisation=0,this.changelayout=null,this.destroycallbacks=[],this.event_stack=[],this.event_stack_index=-1,this.localvar_stack=[[]],this.localvar_stack_index=0,this.trigger_depth=0,this.pushEventStack(null),this.loop_stack=[],this.loop_stack_index=-1,this.next_uid=0,this.next_puid=0,this.layout_first_tick=!0,this.family_count=0,this.suspend_events=[],this.raf_id=-1,this.timeout_id=-1,this.isloading=!0,this.loadingprogress=0,this.stackLocalCount=0,this.audioInstance=null,this.had_a_click=!1,this.isInUserInputEvent=!1,this.objects_to_pretick=new cr.ObjectSet,this.objects_to_tick=new cr.ObjectSet,this.objects_to_tick2=new cr.ObjectSet,this.registered_collisions=[],this.temp_poly=new cr.CollisionPoly([]),this.temp_poly2=new cr.CollisionPoly([]),this.allGroups=[],this.groups_by_name={},this.cndsBySid={},this.actsBySid={},this.varsBySid={},this.blocksBySid={},this.running_layout=null,this.layer_canvas=null,this.layer_ctx=null,this.layer_tex=null,this.layout_tex=null,this.layout_canvas=null,this.layout_ctx=null,this.is_WebGL_context_lost=!1,this.uses_background_blending=!1,this.fx_tex=[null,null],this.fullscreen_scaling=0,this.files_subfolder="",this.objectsByUid={},this.loaderlogos=null,this.webFontNames=null,this.enhancedAccelerationPrecision=!0,this.snapshotCanvas=null,this.snapshotData="",this.objectRefTable=[],"html5"===this.exportType&&"file"===location.protocol.substr(0,4)&&alert("Exported games won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)"),this.useFbInstant?(FBInstant.initializeAsync().then(function(){a.requestProjectData()}).catch(function(e){console.warn("[Instant Games] Unable to load: ",e),a.requestProjectData()}),window.setTimeout(function(){a.hasInitialized||(console.warn("[Instant Games] Initialization timed out after 4 seconds. Continuing with Instant Games disabled."),a.useFbInstant=!1,a.requestProjectData())},4e3)):this.requestProjectData()}}function t(e,t){L&&L.width===e&&L.height===t||(L=document.createElement("canvas"),L.width=e,L.height=t,R=L.getContext("2d"))}function n(e,t){return 128>=t?e[2]:256>=t?e[1]:e[0]}function a(){return F.length?F.pop():new cr.ObjectSet}function r(e){e.clear(),F.push(e)}function i(){try{return!!window.indexedDB}catch(t){return!1}}function o(t){var e=t.target.result;e.createObjectStore("saves",{keyPath:"slot"})}function s(t,n,a,r){try{var e=indexedDB.open("_C2SaveStates");e.onupgradeneeded=o,e.onerror=r,e.onsuccess=function(i){var e=i.target.result;e.onerror=r;var o=e.transaction(["saves"],"readwrite"),s=o.objectStore("saves"),l=s.put({slot:t,data:n});l.onsuccess=a}}catch(e){r(e)}}function l(t,e,n){try{var a=indexedDB.open("_C2SaveStates");a.onupgradeneeded=o,a.onerror=n,a.onsuccess=function(a){var r=a.target.result;r.onerror=n;var i=r.transaction(["saves"]),o=i.objectStore("saves"),s=o.get(t);s.onsuccess=function(){s.result?e(s.result.data):e(null)}}}catch(e){n(e)}}function p(){cr.logexport("Reloading for continuous preview"),-1<window.location.search.indexOf("continuous")?window.location.reload(!0):window.location+="?continuous"}function d(e){var t={},n;for(n in e)if(e.hasOwnProperty(n)){if(e[n]instanceof cr.ObjectSet)continue;if(e[n]&&"undefined"!=typeof e[n].c2userdata)continue;if("spriteCreatedDestroyCallback"===n)continue;t[n]=e[n]}return t}var c=Math.ceil,u=Math.round,g=Math.floor,m=Math.max,y=Math.min,_=Math.cos,h=Math.sin,f=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,x=new Audio,v={"audio/webm; codecs=opus":!!x.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!x.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!x.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!x.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!x.canPlayType("audio/mp4"),"audio/mpeg":!!x.canPlayType("audio/mpeg")};x=null;e.prototype.requestProjectData=function(){if(!this.hasInitialized){this.hasInitialized=!0;var e=this;if(this.isWKWebView)return void this.fetchLocalFileViaCordovaAsText("data.js",function(t){e.loadProject(JSON.parse(t))},function(){alert("Error fetching data.js")});var t=this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var n=this.projectDataUrl||"data.js";(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)&&(n="data.json"),t.open("GET",n,!0);var a=!1;if("response"in t&&"responseType"in t)try{t.responseType="json",a="json"===t.responseType}catch(t){a=!1}if(!a&&"responseType"in t)try{t.responseType="text"}catch(t){}if("overrideMimeType"in t)try{t.overrideMimeType("application/json; charset=utf-8")}catch(t){}this.isWindowsPhone8?t.onreadystatechange=function(){4!==t.readyState||e.loadProject(JSON.parse(t.responseText))}:(t.onload=function(){a?e.loadProject(t.response):e.loadProject(JSON.parse(t.responseText))},t.onerror=function(t){cr.logerror("Error requesting "+n+":"),cr.logerror(t)}),t.send()}},e.prototype.initRendererAndLoader=function(){var e=this,n,a,r,o,p,d,c,g,m,_;this.isRetina=this.useHighDpi&&!this.isAndroidStockBrowser,0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1);var h=window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||window.msDevicePixelRatio||1;this.devicePixelRatio=this.isRetina?h:1,"object"==typeof window.StatusBar&&window.StatusBar.hide(),"object"==typeof window.AndroidFullScreen&&window.AndroidFullScreen.immersiveMode(),this.ClearDeathRow();var f;0<this.fullscreen_mode&&this.setSize(window.innerWidth,window.innerHeight,!0);try{this.enableWebGL&&(f={alpha:!0,depth:!1,antialias:!1,failIfMajorPerformanceCaveat:!0},!this.isAndroid&&(this.gl=this.canvas.getContext("webgl2",f)),!this.gl&&(this.gl=this.canvas.getContext("webgl",f)||this.canvas.getContext("experimental-webgl",f)))}catch(t){}if(this.gl){var x=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2"),b=this.gl.getExtension("WEBGL_debug_renderer_info");if(b){var v=this.gl.getParameter(b.UNMASKED_VENDOR_WEBGL),w=this.gl.getParameter(b.UNMASKED_RENDERER_WEBGL);this.glUnmaskedRenderer=w+" ["+v+"]"}this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]");for(this.overlay_canvas=document.createElement("canvas"),this.canvas.parentNode.appendChild(this.overlay_canvas),this.overlay_canvas.oncontextmenu=function(){return!1},this.overlay_canvas.onselectstart=function(){return!1},this.overlay_canvas.width=u(this.cssWidth*this.devicePixelRatio),this.overlay_canvas.height=u(this.cssHeight*this.devicePixelRatio),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px",this.overlay_canvas.style.position="absolute",this.overlay_ctx=this.overlay_canvas.getContext("2d"),this.glwrap=new cr.GLWrap(this.gl,this.isMobile,this.enableFrontToBack),this.glwrap.setSize(this.canvas.width,this.canvas.height),this.glwrap.enable_mipmaps=0!==this.downscalingQuality,this.ctx=null,this.canvas.addEventListener("webglcontextlost",function(t){t.preventDefault(),e.onContextLost(),cr.logexport("[Construct 2] WebGL context lost"),window.cr_setSuspended(!0)},!1),this.canvas.addEventListener("webglcontextrestored",function(){e.glwrap.initState(),e.glwrap.setSize(e.glwrap.width,e.glwrap.height,!0),e.layer_tex=null,e.layout_tex=null,e.fx_tex[0]=null,e.fx_tex[1]=null,e.onContextRestored(),e.redraw=!0,cr.logexport("[Construct 2] WebGL context restored"),window.cr_setSuspended(!1)},!1),this.glwrap.supportsGpuProfiling()||(this.gpuLastUtilisation=NaN),(n=0,a=this.types_by_index.length);n<a;n++)for(c=this.types_by_index[n],r=0,o=c.effect_types.length;r<o;r++)g=c.effect_types[r],g.shaderindex=this.glwrap.getShaderIndex(g.id),g.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(g.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(g.shaderindex);for(n=0,a=this.layouts_by_index.length;n<a;n++){for(m=this.layouts_by_index[n],r=0,o=m.effect_types.length;r<o;r++)g=m.effect_types[r],g.shaderindex=this.glwrap.getShaderIndex(g.id),g.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(g.shaderindex);for(m.updateActiveEffects(),r=0,o=m.layers.length;r<o;r++){for(_=m.layers[r],p=0,d=_.effect_types.length;p<d;p++)g=_.effect_types[p],g.shaderindex=this.glwrap.getShaderIndex(g.id),g.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(g.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(g.shaderindex);_.updateActiveEffects()}}}else f={alpha:!0},this.ctx=this.canvas.getContext("2d",f),this.ctx.imageSmoothingEnabled=this.linearSampling,this.overlay_canvas=null,this.overlay_ctx=null,this.gpuLastUtilisation=NaN,this.wantFullscreenScalingQuality=!0,this.fullscreenScalingQuality=!0;this.tickFunc=function(t){e.tick(!1,t)},window==window.top||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0)),this.isPreview&&(-1<window.location.search.indexOf("continuous")&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(window.addEventListener("focus",function(){e.setSuspended(!1)}),window.addEventListener("blur",function(){var t=window.parent;t&&t.document.hasFocus()||e.setSuspended(!0)}))),window.addEventListener("blur",function(){e.onWindowBlur()});var T=function(t){if("mousedown"===t.type&&1===t.button&&t.preventDefault(),cr.isCanvasInputEvent(t)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(t){}};"undefined"==typeof PointerEvent?window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",T):document.addEventListener("touchstart",T):document.addEventListener("pointerdown",T),document.addEventListener("mousedown",T),0===this.fullscreen_mode&&this.isRetina&&1<this.devicePixelRatio?this.setSize(this.original_width,this.original_height,!0):this.setSize(window.innerWidth,window.innerHeight,!0),this.tryLockOrientation(),this.getready(),this.go(),this.extra={},cr.seal(this)},e.prototype.setSize=function(e,t,n){var a=0,r=0,i=0,o=0,s=0;if(this.lastWindowWidth!==e||this.lastWindowHeight!==t||n){if(this.isiPhone&&this.isCordova&&window.screen){var l=document.documentElement.style,p=document.body.style,d=window.innerWidth<window.innerHeight,m=d?window.screen.height:window.screen.width,y=d?window.screen.width:window.screen.height;m&&y&&(p.height=l.height=m+"px",p.width=l.width=y+"px")}this.lastWindowWidth=e,this.lastWindowHeight=t;var _=this.fullscreen_mode,f=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen)&&!this.isCordova,x,b;if(f||0!==this.fullscreen_mode||n){f&&(_=this.fullscreen_scaling);var v=this.devicePixelRatio;4<=_?(5===_&&1!==v&&(e+=1,t+=1),x=this.original_width/this.original_height,b=e/t,b>x?(i=t*x,5===_?(s=i*v/this.original_width,1<s?s=g(s):1>s&&(s=1/c(1/s)),i=this.original_width*s/v,o=this.original_height*s/v,a=(e-i)/2,r=(t-o)/2,e=i,t=o):(a=(e-i)/2,e=i)):(o=e/x,5===_?(s=o*v/this.original_height,1<s?s=g(s):1>s&&(s=1/c(1/s)),i=this.original_width*s/v,o=this.original_height*s/v,a=(e-i)/2,r=(t-o)/2,e=i,t=o):(r=(t-o)/2,t=o))):f&&0===_&&(a=g((e-this.original_width)/2),r=g((t-this.original_height)/2),e=this.original_width,t=this.original_height),2>_&&(this.aspect_scale=v),this.cssWidth=u(e),this.cssHeight=u(t),this.width=u(e*v),this.height=u(t*v),this.redraw=!0,this.wantFullscreenScalingQuality?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):this.width<this.original_width&&this.height<this.original_height||1===_?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===_?(x=this.original_width/this.original_height,b=this.lastWindowWidth/this.lastWindowHeight,b<x?this.draw_width=this.draw_height*b:b>x&&(this.draw_height=this.draw_width/b)):3===_&&(x=this.original_width/this.original_height,b=this.lastWindowWidth/this.lastWindowHeight,b>x?this.draw_width=this.draw_height*b:b<x&&(this.draw_height=this.draw_width/b))),this.canvas&&(this.canvas.width=u(e*v),this.canvas.height=u(t*v),this.isRetina&&(this.canvas.style.width=u(e)+"px",this.canvas.style.height=u(t)+"px"),this.canvas.style.marginLeft=g(a)+"px",this.canvas.style.marginTop=g(r)+"px"),this.overlay_canvas&&(this.overlay_canvas.width=u(e*v),this.overlay_canvas.height=u(t*v),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px",this.overlay_canvas.style.left=g(a)+"px",this.overlay_canvas.style.top=g(r)+"px"),this.glwrap&&this.glwrap.setSize(u(e*v),u(t*v)),this.ctx&&(this.ctx.imageSmoothingEnabled=this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)}}},e.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var e="portrait";2===this.orientations&&(e="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(e).catch(function(){}):screen.lockOrientation?screen.lockOrientation(e):screen.webkitLockOrientation?screen.webkitLockOrientation(e):screen.mozLockOrientation?screen.mozLockOrientation(e):screen.msLockOrientation&&screen.msLockOrientation(e)}catch(t){console&&console.warn&&console.warn("Failed to lock orientation: ",t)}}},e.prototype.onContextLost=function(){this.glwrap.contextLost(),this.is_WebGL_context_lost=!0;var e,n,a;for(e=0,n=this.types_by_index.length;e<n;e++)a=this.types_by_index[e],a.onLostWebGLContext&&a.onLostWebGLContext()},e.prototype.onContextRestored=function(){this.is_WebGL_context_lost=!1;var e,n,a;for(e=0,n=this.types_by_index.length;e<n;e++)a=this.types_by_index[e],a.onRestoreWebGLContext&&a.onRestoreWebGLContext()};var b=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;e.prototype.setSuspended=function(e){var t=this,n,a;if(e&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,-1!==this.raf_id&&b(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),(n=0,a=this.suspend_events.length);n<a;n++)this.suspend_events[n](!0);else if(!e&&this.isSuspended){for(cr.logexport("[Construct 2] Resuming"),this.isSuspended=!1,this.last_tick_time=cr.performance_now(),this.last_fps_time=cr.performance_now(),this.framecount=0,this.logictime=0,(n=0,a=this.suspend_events.length);n<a;n++)this.suspend_events[n](!1);this.tick(!1)}},e.prototype.addSuspendCallback=function(e){this.suspend_events.push(e)},e.prototype.GetObjectReference=function(e){return this.objectRefTable[e]},e.prototype.loadProject=function(e){e&&e.project||cr.logerror("Project model unavailable");var n=e.project;if(this.name=n[0],this.first_layout=n[1],this.fullscreen_mode=n[12],this.fullscreen_mode_set=n[12],this.original_width=n[10],this.original_height=n[11],this.parallax_x_origin=this.original_width/2,this.parallax_y_origin=this.original_height/2,this.uses_loader_layout=n[18],this.loaderstyle=n[19],this.iconsFolder=n[28],this.webFontNames=n[29].map(function(e){return e[0]}),0===this.loaderstyle){var a=new Image;a.crossOrigin="anonymous",this.loaderlogos={logo:a};var r=this.loaderlogos;a.addEventListener("error",function(){r.logo=null});var o;o=this.isPreview?this.getProjectFileUrl("loading-logo.png"):this.iconsFolder+"loading-logo.png",this.setImageSrc(a,o)}else if(4===this.loaderstyle){var s=new Image;s.src="splash-images/splash-logo.svg";var l=new Image;l.src="splash-images/splash-poweredby-512.png";var c=new Image;c.src="splash-images/splash-poweredby-256.png";var u=new Image;u.src="splash-images/splash-poweredby-128.png";var g=new Image;g.src="splash-images/splash-website-512.png";var y=new Image;y.src="splash-images/splash-website-256.png";var _=new Image;_.src="splash-images/splash-website-128.png",this.loaderlogos={logo:s,powered:[l,c,u],website:[g,y,_]}}this.next_uid=n[21],this.objectRefTable=cr.getObjectRefTable(),this.system=new cr.system_object(this);var h,x,w,T,S,O,E,C,A,P,I,L,R,F;for(h=0,x=n[2].length;h<x;h++)E=n[2][h],I=this.GetObjectReference(E[0]),cr.add_common_aces(E,I.prototype),R=new I(this),R.singleglobal=E[1],R.is_world=E[2],R.is_rotatable=E[5],R.must_predraw=E[9],R.onCreate&&R.onCreate(),cr.seal(R),this.plugins.push(R);for(this.objectRefTable=cr.getObjectRefTable(),h=0,x=n[3].length;h<x;h++){for(E=n[3][h],F=this.GetObjectReference(E[1]),(R=null,w=0,T=this.plugins.length);w<T;w++)if(this.plugins[w]instanceof F){R=this.plugins[w];break}var B=new R.Type(R);for(B.name=E[0],B.is_family=E[2],B.instvar_sids=E[3].slice(0),B.vars_count=E[3].length,B.behs_count=E[4],B.fx_count=E[5],B.sid=E[11],B.is_family?(B.members=[],B.family_index=this.family_count++,B.families=null):(B.members=null,B.family_index=-1,B.families=[]),B.family_var_map=null,B.family_beh_map=null,B.family_fx_map=null,B.is_contained=!1,B.container=null,E[6]?(B.texture_file=E[6][0],B.texture_filesize=E[6][1],B.texture_pixelformat=E[6][2],B.texture_data=E[6]):(B.texture_file=null,B.texture_filesize=0,B.texture_pixelformat=0,B.texture_data=null),B.animations=E[7]?E[7]:null,B.index=h,B.instances=[],B.deadCache=[],B.solstack=[new cr.selection(B)],B.cur_sol=0,B.default_instance=null,B.default_layerindex=0,B.stale_iids=!0,B.updateIIDs=cr.type_updateIIDs,B.getFirstPicked=cr.type_getFirstPicked,B.getPairedInstance=cr.type_getPairedInstance,B.getCurrentSol=cr.type_getCurrentSol,B.pushCleanSol=cr.type_pushCleanSol,B.pushCopySol=cr.type_pushCopySol,B.popSol=cr.type_popSol,B.getBehaviorByName=cr.type_getBehaviorByName,B.getBehaviorIndexByName=cr.type_getBehaviorIndexByName,B.getEffectIndexByName=cr.type_getEffectIndexByName,B.applySolToContainer=cr.type_applySolToContainer,B.getInstanceByIID=cr.type_getInstanceByIID,B.collision_grid=new cr.SparseGrid(this.original_width,this.original_height),B.any_cell_changed=!0,B.any_instance_parallaxed=!1,B.extra={},B.toString=cr.type_toString,B.behaviors=[],(w=0,T=E[8].length);w<T;w++){C=E[8][w];var N=this.GetObjectReference(C[1]),D=null;for(S=0,O=this.behaviors.length;S<O;S++)if(this.behaviors[S]instanceof N){D=this.behaviors[S];break}D||(D=new N(this),D.my_types=[],D.my_instances=new cr.ObjectSet,D.onCreate&&D.onCreate(),cr.seal(D),this.behaviors.push(D),cr.behaviors.solid&&D instanceof cr.behaviors.solid&&(this.solidBehavior=D),cr.behaviors.jumpthru&&D instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=D),cr.behaviors.shadowcaster&&D instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=D)),-1===D.my_types.indexOf(B)&&D.my_types.push(B);var M=new D.Type(D,B);M.name=C[0],M.sid=C[2],M.onCreate(),cr.seal(M),B.behaviors.push(M)}for(B.global=E[9],B.isOnLoaderLayout=E[10],B.effect_types=[],(w=0,T=E[12].length);w<T;w++)B.effect_types.push({id:E[12][w][0],name:E[12][w][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:w});if(B.tile_poly_data=E[13],(!this.uses_loader_layout||B.is_family||B.isOnLoaderLayout||!R.is_world)&&(B.onCreate(),cr.seal(B)),B.name&&(this.types[B.name]=B,this.types_lowercase[B.name.toLowerCase()]=B),this.types_by_index.push(B),R.singleglobal){var V=new R.Instance(B);V.uid=this.next_uid++,V.puid=this.next_puid++,V.iid=0,V.get_iid=cr.inst_get_iid,V.toString=cr.inst_toString,V.properties=E[15],V.onCreate(),cr.seal(V),B.instances.push(V),this.objectsByUid[V.uid.toString()]=V}}for(h=0,x=n[4].length;h<x;h++){var U=n[4][h],G=this.types_by_index[U[0]],W;for(w=1,T=U.length;w<T;w++)W=this.types_by_index[U[w]],W.families.push(G),G.members.push(W)}for(h=0,x=n[27].length;h<x;h++){var X=n[27][h],z=[];for(w=0,T=X.length;w<T;w++)z.push(this.types_by_index[X[w]]);for(w=0,T=z.length;w<T;w++)z[w].is_contained=!0,z[w].container=z}if(0<this.family_count)for(h=0,x=this.types_by_index.length;h<x;h++)if(A=this.types_by_index[h],!A.is_family&&A.families.length){A.family_var_map=Array(this.family_count),A.family_beh_map=Array(this.family_count),A.family_fx_map=Array(this.family_count);var q=[],Y=0,J=0,H=0;for(w=0,T=A.families.length;w<T;w++)for(P=A.families[w],A.family_var_map[P.family_index]=Y,Y+=P.vars_count,A.family_beh_map[P.family_index]=J,J+=P.behs_count,A.family_fx_map[P.family_index]=H,H+=P.fx_count,(S=0,O=P.effect_types.length);S<O;S++)q.push(cr.shallowCopy({},P.effect_types[S]));for(A.effect_types=q.concat(A.effect_types),w=0,T=A.effect_types.length;w<T;w++)A.effect_types[w].index=w}for(h=0,x=n[5].length;h<x;h++){E=n[5][h];var K=new cr.layout(this,E);cr.seal(K),this.layouts[K.name]=K,this.layouts_by_index.push(K)}for(h=0,x=n[6].length;h<x;h++){E=n[6][h];var Z=new cr.eventsheet(this,E);cr.seal(Z),this.eventsheets[Z.name]=Z,this.eventsheets_by_index.push(Z)}for(h=0,x=this.eventsheets_by_index.length;h<x;h++)this.eventsheets_by_index[h].postInit();for(h=0,x=this.eventsheets_by_index.length;h<x;h++)this.eventsheets_by_index[h].updateDeepIncludes();for(h=0,x=this.triggers_to_postinit.length;h<x;h++)this.triggers_to_postinit[h].postInit();for(cr.clearArray(this.triggers_to_postinit),this.audio_files_info=n[7],this.audio_files_map={},(h=0,x=this.audio_files_info.length);h<x;++h)L=this.audio_files_info[h],this.audio_files_map[L[0]]=L[1];this.files_subfolder=n[8],this.pixel_rounding=n[9],this.aspect_scale=1,this.enableWebGL=n[13],this.linearSampling=n[14],this.clearBackground=n[15],this.versionstr=n[16],this.useHighDpi=n[17],this.orientations=n[20],this.autoLockOrientation=0<this.orientations,this.pauseOnBlur=n[22],this.wantFullscreenScalingQuality=n[23],this.fullscreenScalingQuality=this.wantFullscreenScalingQuality,this.downscalingQuality=n[24],this.preloadSounds=n[25],this.enableFrontToBack=n[26]&&!this.isIE,this.enhancedAccelerationPrecision=n[30],this.start_time=Date.now(),cr.clearArray(this.objectRefTable),this.preloadSounds||v["audio/webm; codecs=opus"]||!window.OpusDecoder||window.OpusDecoder.Initialise(),this.initRendererAndLoader()};var T=!1;e.prototype.waitForImageLoad=function(t,n){window.cr_remotePreviewImageFiles&&n&&"blob:"!==n.substr(0,5)&&(n=window.cr_remotePreviewImageFiles[n]);t.onerror=function(n){t.c2error=!0,T=!0,console&&console.error&&console.error("Error loading image '"+t.src+"': ",n)},t.src||("undefined"==typeof XAPKReader?(t.crossOrigin="anonymous",this.setImageSrc(t,n)):XAPKReader.get(n,function(e){t.src=e},function(a){t.c2error=!0,T=!0,console&&console.error&&console.error("Error extracting image '"+n+"' from expansion file: ",a)})),this.wait_for_textures.push(t)},e.prototype.findWaitingTexture=function(e){var t,n;for(t=0,n=this.wait_for_textures.length;t<n;t++)if(this.wait_for_textures[t].cr_src===e)return this.wait_for_textures[t];return null};var w=0,S=!1;e.prototype.getready=function(){if(this.audioInstance&&this.preloadSounds){var e=[],t,n,a,o,s,l;for(t=0,n=this.audio_files_info.length;t<n;++t)a=this.audio_files_info[t],o=a[0],l=a[2],s=this.getPreferredAudioFile(o),s&&!l&&e.push({filename:o+s[1],size:s[2],type:s[0]});w=this.audioInstance.setPreloadList(e)}},e.prototype.areAllTexturesAndSoundsLoaded=function(){var e=w,t=0,n=0,a=!0,r,o,s;for(r=0,o=this.wait_for_textures.length;r<o;r++){s=this.wait_for_textures[r];var l=s.cr_filesize;(!l||0>=l)&&(l=5e4),e+=l,s.src&&s.complete&&!s.c2error?t+=l:a=!1}return a&&this.preloadSounds&&this.audioInstance&&(!S&&(this.audioInstance.startPreloads(),S=!0),n=this.audioInstance.getPreloadedSize(),t+=n,n<w&&(a=!1)),this.progress=0==e?1:t/e,a};var O=!1;e.prototype.go=function(){if(this.ctx||this.glwrap){var e=this.ctx||this.overlay_ctx;if(0<this.fullscreen_mode){var t=window.innerWidth,n=window.innerHeight;(this.lastWindowWidth!==t||this.lastWindowHeight!==n)&&this.setSize(t,n)}this.progress=0,this.last_progress=-1;var a=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||O))this.useFbInstant?FBInstant.startGameAsync().then(function(){a.go_loading_finished()}):this.go_loading_finished();else{this.useFbInstant&&FBInstant.setLoadingProgress(100*this.progress);var r=Date.now()-this.start_time;if(e){var i=this.width,o=this.height,s=this.devicePixelRatio;if(3>this.loaderstyle&&500<=r&&this.last_progress!=this.progress){e.clearRect(0,0,i,o);var l=i/2,p=o/2,d=0===this.loaderstyle&&this.loaderlogos.logo&&this.loaderlogos.logo.complete,c=40*s,m=0,y=80*s,_;if(d){var h=this.loaderlogos.logo;y=h.width*s,_=h.height*s,c=y/2,m=_/2,e.drawImage(h,cr.floor(l-c),cr.floor(p-m),y,_)}if(1>=this.loaderstyle)p+=m+(d?12*s:0),l-=c,l=cr.floor(l)+.5,p=cr.floor(p)+.5,e.fillStyle=T?"red":"DodgerBlue",e.fillRect(l,p,g(y*this.progress),6*s),e.strokeStyle="black",e.strokeRect(l,p,y,6*s),e.strokeStyle="white",e.strokeRect(l-1*s,p-1*s,y+2*s,8*s);else if(2===this.loaderstyle){e.font="12pt Arial",e.fillStyle=T?"#f00":"#999",e.textBaseLine="middle";var x=u(100*this.progress)+"%",b=e.measureText?e.measureText(x):null,v=b?b.width:0;e.fillText(x,l-v/2,p)}this.last_progress=this.progress}else if(4===this.loaderstyle)return this.draw_c3_splash_loader(e),void(f?f(function(){a.go()}):setTimeout(function(){a.go()},16))}setTimeout(function(){a.go()},100)}}};var E=-1,C=!0,A=!1,P=0,I=0,L=null,R=null,k=0;e.prototype.draw_c3_splash_loader=function(e){if(!O){var a=this.isPreview||this.useFbInstant,r=a?0:200,o=a?0:3e3,s=c(this.width),l=c(this.height),p=this.devicePixelRatio,d=this.loaderlogos.logo,u=this.loaderlogos.powered,g=this.loaderlogos.website;if(d.complete){for(var _=0;3>_;++_)if(!u[_].complete||!g[_].complete)return;0==k&&(E=Date.now());var h=Date.now(),f=!1,x=e,b,v;C||A?(e.clearRect(0,0,s,l),t(s,l),x=R,f=!0,C&&1==k&&(E=Date.now())):e.globalAlpha=1,x.fillStyle="#3B4045",x.fillRect(0,0,s,l);try{256<this.cssHeight?(b=1.5*cr.clamp(.22*l,105,.6*s),v=b/8,x.drawImage(n(u,b),.5*s-b/2,.2*l-v/2,b,v),b=y(.395*l,.95*s),v=b,x.drawImage(d,.5*s-b/2,.485*l-v/2,b,v),b=1.5*cr.clamp(.22*l,105,.6*s),v=b/8,x.drawImage(n(g,b),.5*s-b/2,.868*l-v/2,b,v),x.fillStyle="#4D565D",b=s,v=m(.005*l,2),x.fillRect(0,.8*l-v/2,b,v),x.fillStyle=T?"red":"#29F3D0",b=s*this.progress,x.fillRect(.5*s-b/2,.8*l-v/2,b,v)):(b=.55*l,v=b,x.drawImage(d,.5*s-b/2,.45*l-v/2,b,v),x.fillStyle="#4D565D",b=s,v=m(.005*l,2),x.fillRect(0,.85*l-v/2,b,v),x.fillStyle=T?"red":"#29F3D0",b=s*this.progress,x.fillRect(.5*s-b/2,.85*l-v/2,b,v)),f&&(C?0==k?e.globalAlpha=0:e.globalAlpha=y((h-E)/300,1):A&&(e.globalAlpha=m(1-(h-I)/300,0)),e.drawImage(L,0,0,s,l))}catch(t){}C&&300<=h-E&&2<=k&&(C=!1,P=h),!C&&h-P>=o&&!A&&1<=this.progress&&(A=!0,I=h),(A&&h-I>=300+r||a&&1<=this.progress&&500>Date.now()-E)&&(O=!0,C=!1,A=!1,L=null,R=null,this.loaderlogos=null),++k}}},e.prototype.go_loading_finished=function(){if(this.webFontNames.length&&document.fonts&&document.fonts.load){var e=this;Promise.all(this.webFontNames.map(function(e){return document.fonts.load("1em '"+e+"'")})).then(function(){e.start_first_layout()})}else this.start_first_layout()},e.prototype.start_first_layout=function(){this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_ctx=null,this.overlay_canvas=null),this.start_time=Date.now(),this.last_fps_time=cr.performance_now();var e,n,a;if(this.uses_loader_layout)for(e=0,n=this.types_by_index.length;e<n;e++)a=this.types_by_index[e],a.is_family||a.isOnLoaderLayout||!a.plugin.is_world||(a.onCreate(),cr.seal(a));else this.isloading=!1;for(e=0,n=this.layouts_by_index.length;e<n;e++)this.layouts_by_index[e].createGlobalNonWorlds();if(2<=this.fullscreen_mode){var r=this.original_width/this.original_height,o=this.width/this.height;this.aspect_scale=2!==this.fullscreen_mode&&o>r||2===this.fullscreen_mode&&o<r?this.height/this.original_height:this.width/this.original_width}for(e=0,n=this.types_by_index.length;e<n;e++)a=this.types_by_index[e],a.onBeforeAppBegin&&a.onBeforeAppBegin();this.first_layout?this.layouts[this.first_layout].startRunning():this.layouts_by_index[0].startRunning();for(this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&window.C3_RegisterSW()),navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide(),(e=0,n=this.types_by_index.length);e<n;e++)a=this.types_by_index[e],a.onAppBegin&&a.onAppBegin();var s=function(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):window.cr_setSuspended(!1)};document.addEventListener("visibilitychange",s,!1),document.addEventListener("mozvisibilitychange",s,!1),document.addEventListener("webkitvisibilitychange",s,!1),document.addEventListener("msvisibilitychange",s,!1),this.isCordova&&(document.addEventListener("pause",function(){window.cr_setSuspended(!0)}),document.addEventListener("resume",function(){window.cr_setSuspended(!1)})),document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1)},e.prototype.tick=function(e,t,n){if(this.running_layout){var a=cr.performance_now();if(n||!this.isSuspended||e){e||(f?this.raf_id=f(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16));var r=this.fullscreen_mode,i=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if(i&&0<this.fullscreen_scaling&&(r=this.fullscreen_scaling),0<r){var o=window.innerWidth,s=window.innerHeight;(this.lastWindowWidth!==o||this.lastWindowHeight!==s)&&this.setSize(o,s)}if(i?!this.firstInFullscreen&&(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(u(this.oldWidth/this.devicePixelRatio),u(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height),this.isloading){var l=this.areAllTexturesAndSoundsLoaded();this.loadingprogress=this.progress,l&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&window.C3_RegisterSW())}this.logic(t||a),!this.redraw||this.is_WebGL_context_lost||this.suspendDrawing||e||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null)),this.hit_breakpoint||(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++),this.logictime+=cr.performance_now()-a}}},e.prototype.logic=function(e){var t,n,a,r,o,s,l,p,d;if(1e3<=e-this.last_fps_time&&(this.last_fps_time+=1e3,1e3<=e-this.last_fps_time&&(this.last_fps_time=e),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=y(this.logictime,1e3),this.logictime=0,this.glwrap&&0===this.gpuTimeEndFrame&&(this.gpuTimeEndFrame=this.glwrap.getFrameNumber(),this.gpuCurUtilisation=-1)),this.glwrap&&-1===this.gpuCurUtilisation&&this.glwrap.supportsGpuProfiling()&&(this.gpuCurUtilisation=this.glwrap.getFrameRangeTimerResults(this.gpuTimeStartFrame,this.gpuTimeEndFrame),-1!==this.gpuCurUtilisation&&(this.glwrap.deleteTimerResultsToFrame(this.gpuTimeEndFrame),this.gpuLastUtilisation=y(this.gpuCurUtilisation,1),this.gpuTimeStartFrame=this.gpuTimeEndFrame,this.gpuTimeEndFrame=0)),0!==this.last_tick_time){var c=e-this.last_tick_time;0>c&&(c=0),this.dt1=c/1e3,.5<this.dt1?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)}this.last_tick_time=e,this.dt=this.dt1*this.timescale,this.kahanTime.add(this.dt),this.wallTime.add(this.dt1);var u=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if(2<=this.fullscreen_mode||u&&0<this.fullscreen_scaling){var g=this.original_width/this.original_height,m=this.width/this.height,_=this.fullscreen_mode;u&&0<this.fullscreen_scaling&&(_=this.fullscreen_scaling),this.aspect_scale=2!==_&&m>g||2===_&&m<g?this.height/this.original_height:this.width/this.original_width,this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;this.ClearDeathRow(),this.isInOnDestroy++,this.system.runWaits(),this.isInOnDestroy--,this.ClearDeathRow(),this.isInOnDestroy++;var h=this.objects_to_pretick.valuesRef();for(t=0,n=h.length;t<n;t++)h[t].pretick();for(t=0,n=this.types_by_index.length;t<n;t++)if(l=this.types_by_index[t],!l.is_family&&(l.behaviors.length||l.families.length))for(a=0,r=l.instances.length;a<r;a++)for(p=l.instances[a],o=0,s=p.behavior_insts.length;o<s;o++)p.behavior_insts[o].tick();for(t=0,n=this.types_by_index.length;t<n;t++)if(l=this.types_by_index[t],!l.is_family&&(l.behaviors.length||l.families.length))for(a=0,r=l.instances.length;a<r;a++)for(p=l.instances[a],o=0,s=p.behavior_insts.length;o<s;o++)d=p.behavior_insts[o],d.posttick&&d.posttick();for(h=this.objects_to_tick.valuesRef(),t=0,n=h.length;t<n;t++)h[t].tick();for(this.isInOnDestroy--,this.handleSaveLoad(),t=0;this.changelayout&&10>t++;)this.doChangeLayout(this.changelayout);for(t=0,n=this.eventsheets_by_index.length;t<n;t++)this.eventsheets_by_index[t].hasRun=!1;for(this.running_layout.event_sheet&&this.running_layout.event_sheet.run(),cr.clearArray(this.registered_collisions),this.layout_first_tick=!1,this.isInOnDestroy++,(t=0,n=this.types_by_index.length);t<n;t++)if(l=this.types_by_index[t],!l.is_family&&(l.behaviors.length||l.families.length))for(a=0,r=l.instances.length;a<r;a++){var p=l.instances[a];for(o=0,s=p.behavior_insts.length;o<s;o++)d=p.behavior_insts[o],d.tick2&&d.tick2()}for(h=this.objects_to_tick2.valuesRef(),t=0,n=h.length;t<n;t++)h[t].tick2();this.isInOnDestroy--},e.prototype.onWindowBlur=function(){var e,t,n,a,r,o,s,l,p;for(e=0,t=this.types_by_index.length;e<t;e++)if(s=this.types_by_index[e],!s.is_family)for(n=0,a=s.instances.length;n<a;n++)if(l=s.instances[n],l.onWindowBlur&&l.onWindowBlur(),l.behavior_insts)for(r=0,o=l.behavior_insts.length;r<o;r++)p=l.behavior_insts[r],p.onWindowBlur&&p.onWindowBlur()},e.prototype.doChangeLayout=function(e){var t=this.running_layout;this.running_layout.stopRunning();var n,a,r;if(this.glwrap)for(n=0,a=this.types_by_index.length;n<a;n++)r=this.types_by_index[n],r.is_family||!r.unloadTextures||r.global&&0!==r.instances.length||-1!==e.initial_types.indexOf(r)||r.unloadTextures();t==e&&cr.clearArray(this.system.waits),cr.clearArray(this.registered_collisions),this.runLayoutChangeMethods(!0),e.startRunning(),this.runLayoutChangeMethods(!1),this.redraw=!0,this.layout_first_tick=!0,this.ClearDeathRow()},e.prototype.runLayoutChangeMethods=function(e){var t,n,a,r,o,s,l,p,d,c;for(t=0,n=this.behaviors.length;t<n;t++)a=this.behaviors[t],e?a.onBeforeLayoutChange&&a.onBeforeLayoutChange():a.onLayoutChange&&a.onLayoutChange();for(t=0,n=this.types_by_index.length;t<n;t++)if(r=this.types_by_index[t],r.global||r.plugin.singleglobal)for(o=0,s=r.instances.length;o<s;o++)if(l=r.instances[o],e?l.onBeforeLayoutChange&&l.onBeforeLayoutChange():l.onLayoutChange&&l.onLayoutChange(),l.behavior_insts)for(p=0,d=l.behavior_insts.length;p<d;p++)c=l.behavior_insts[p],e?c.onBeforeLayoutChange&&c.onBeforeLayoutChange():c.onLayoutChange&&c.onLayoutChange()},e.prototype.pretickMe=function(e){this.objects_to_pretick.add(e)},e.prototype.unpretickMe=function(e){this.objects_to_pretick.remove(e)},e.prototype.tickMe=function(e){this.objects_to_tick.add(e)},e.prototype.untickMe=function(e){this.objects_to_tick.remove(e)},e.prototype.tick2Me=function(e){this.objects_to_tick2.add(e)},e.prototype.untick2Me=function(e){this.objects_to_tick2.remove(e)},e.prototype.getDt=function(e){return e&&-1!==e.my_timescale?this.dt1*e.my_timescale:this.dt},e.prototype.draw=function(){this.running_layout.draw(this.ctx)},e.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap)),this.running_layout.drawGL(this.glwrap),this.glwrap.present()},e.prototype.addDestroyCallback=function(e){e&&this.destroycallbacks.push(e)},e.prototype.removeDestroyCallback=function(e){cr.arrayFindRemove(this.destroycallbacks,e)},e.prototype.getObjectByUID=function(e){var t=e.toString();return this.objectsByUid.hasOwnProperty(t)?this.objectsByUid[t]:null};var F=[];e.prototype.DestroyInstance=function(e){var t=e.type,n=t.name,r=this.deathRow.hasOwnProperty(n),o=null,s,l;if(!r)o=a(),this.deathRow[n]=o;else if(o=this.deathRow[n],o.contains(e))return;if(e.isDestroyed=!0,o.add(e),this.hasPendingInstances=!0,e.is_contained)for(s=0,l=e.siblings.length;s<l;s++)this.DestroyInstance(e.siblings[s]);this.isInClearDeathRow&&o.values_cache.push(e),this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(e.type.plugin).cnds.OnDestroyed,e),this.isInOnDestroy--)},e.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var e,t,n,a,r,o;for(this.isInClearDeathRow=!0,n=0,r=this.createRow.length;n<r;++n)for(e=this.createRow[n],t=e.type,t.instances.push(e),(a=0,o=t.families.length);a<o;++a)t.families[a].instances.push(e),t.families[a].stale_iids=!0;cr.clearArray(this.createRow),this.IterateDeathRow(),cr.wipe(this.deathRow),this.isInClearDeathRow=!1,this.hasPendingInstances=!1}},e.prototype.IterateDeathRow=function(){for(var e in this.deathRow)this.deathRow.hasOwnProperty(e)&&this.ClearDeathRowForType(this.deathRow[e])},e.prototype.ClearDeathRowForType=function(e){var t=e.valuesRef();var n=t[0].type;var a,o,s,l,p,d,c,u;for(cr.arrayRemoveAllFromObjectSet(n.instances,e),n.stale_iids=!0,0===n.instances.length&&(n.any_instance_parallaxed=!1),(a=0,o=n.families.length);a<o;++a)d=n.families[a],cr.arrayRemoveAllFromObjectSet(d.instances,e),d.stale_iids=!0;for(a=0,o=this.system.waits.length;a<o;++a)if(p=this.system.waits[a],p.sols.hasOwnProperty(n.index)&&cr.arrayRemoveAllFromObjectSet(p.sols[n.index].insts,e),!n.is_family)for(s=0,l=n.families.length;s<l;++s)d=n.families[s],p.sols.hasOwnProperty(d.index)&&cr.arrayRemoveAllFromObjectSet(p.sols[d.index].insts,e);var g=t[0].layer;if(g){if(g.useRenderCells)for(c=g.instances,a=0,o=c.length;a<o;++a)u=c[a],e.contains(u)&&(u.update_bbox(),g.render_grid.update(u,u.rendercells,null),u.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(g.instances,e),g.setZIndicesStaleFrom(0)}for(a=0;a<t.length;++a)this.ClearDeathRowForSingleInstance(t[a],n);r(e),this.redraw=!0},e.prototype.ClearDeathRowForSingleInstance=function(e,t){var n,a,r;for(n=0,a=this.destroycallbacks.length;n<a;++n)this.destroycallbacks[n](e);e.collcells&&t.collision_grid.update(e,e.collcells,null);var o=e.layer;if(o&&o.removeFromInstanceList(e,!0),e.behavior_insts)for(n=0,a=e.behavior_insts.length;n<a;++n)r=e.behavior_insts[n],r.onDestroy&&r.onDestroy(),r.behavior.my_instances.remove(e);this.objects_to_pretick.remove(e),this.objects_to_tick.remove(e),this.objects_to_tick2.remove(e),e.onDestroy&&e.onDestroy(),this.objectsByUid.hasOwnProperty(e.uid.toString())&&delete this.objectsByUid[e.uid.toString()],this.objectcount--,100>t.deadCache.length&&t.deadCache.push(e)},e.prototype.createInstance=function(e,t,n,a){if(e.is_family){var r=cr.floor(Math.random()*e.members.length);return this.createInstance(e.members[r],t,n,a)}return e.default_instance?this.createInstanceFromInit(e.default_instance,t,!1,n,a,!1):null};var B=[];e.prototype.createInstanceFromInit=function(e,t,n,a,r,o){var s,l,p,d,c;if(!e)return null;var u=this.types_by_index[e[1]],g=u.plugin.is_world;if(this.isloading&&g&&!u.isOnLoaderLayout)return null;if(g&&!this.glwrap&&11===e[0][11])return null;var m=t;g||(t=null);var y;for(u.deadCache.length?(y=u.deadCache.pop(),y.recycled=!0,u.plugin.Instance.call(y,u)):(y=new u.plugin.Instance(u),y.recycled=!1),y.uid=!n||o||this.objectsByUid.hasOwnProperty(e[2].toString())?this.next_uid++:e[2],this.objectsByUid[y.uid.toString()]=y,y.puid=this.next_puid++,y.iid=u.instances.length,(s=0,l=this.createRow.length);s<l;++s)this.createRow[s].type===u&&y.iid++;y.get_iid=cr.inst_get_iid,y.toString=cr.inst_toString,y.isDestroyed=!1;var _=e[3];if(y.recycled)cr.wipe(y.extra);else{if(y.extra={},this.isPreview)for(y.instance_var_names=[],y.instance_var_names.length=_.length,(s=0,l=_.length);s<l;s++)y.instance_var_names[s]=_[s][1];y.instance_vars=[],y.instance_vars.length=_.length}for(s=0,l=_.length;s<l;s++)y.instance_vars[s]=_[s][0];if(g){var h=e[0];if(y.x=cr.is_undefined(a)?h[0]:a,y.y=cr.is_undefined(r)?h[1]:r,y.z=h[2],y.width=h[3],y.height=h[4],y.depth=h[5],y.angle=h[6],y.opacity=h[7],y.hotspotX=h[8],y.hotspotY=h[9],y.blend_mode=h[10],c=h[11],!this.glwrap&&u.effect_types.length&&(y.blend_mode=c),y.compositeOp=cr.effectToCompositeOp(y.blend_mode),this.gl&&cr.setGLBlend(y,y.blend_mode,this.gl),y.recycled){for(s=0,l=h[12].length;s<l;s++)for(p=0,d=h[12][s].length;p<d;p++)y.effect_params[s][p]=h[12][s][p],Array.isArray(y.effect_params[s][p])&&(y.effect_params[s][p]=y.effect_params[s][p].slice(0));y.bbox.set(0,0,0,0),y.collcells.set(0,0,-1,-1),y.rendercells.set(0,0,-1,-1),y.bquad.set_from_rect(y.bbox),cr.clearArray(y.bbox_changed_callbacks)}else{for(y.effect_params=h[12].slice(0),s=0,l=y.effect_params.length;s<l;s++)for(y.effect_params[s]=h[12][s].slice(0),p=0,d=y.effect_params[s].length;p<d;++p)Array.isArray(y.effect_params[s][p])&&(y.effect_params[s][p]=y.effect_params[s][p].slice(0));y.active_effect_types=[],y.active_effect_flags=[],y.active_effect_flags.length=u.effect_types.length,y.bbox=new cr.rect(0,0,0,0),y.collcells=new cr.rect(0,0,-1,-1),y.rendercells=new cr.rect(0,0,-1,-1),y.bquad=new cr.quad,y.bbox_changed_callbacks=[],y.set_bbox_changed=cr.set_bbox_changed,y.add_bbox_changed_callback=cr.add_bbox_changed_callback,y.contains_pt=cr.inst_contains_pt,y.update_bbox=cr.update_bbox,y.update_render_cell=cr.update_render_cell,y.update_collision_cell=cr.update_collision_cell,y.get_zindex=cr.inst_get_zindex}for(y.tilemap_exists=!1,y.tilemap_width=0,y.tilemap_height=0,y.tilemap_data=null,14===h.length&&(y.tilemap_exists=!0,y.tilemap_width=h[13][0],y.tilemap_height=h[13][1],y.tilemap_data=h[13][2]),(s=0,l=u.effect_types.length);s<l;s++)y.active_effect_flags[s]=!0;y.shaders_preserve_opaqueness=!0,y.updateActiveEffects=cr.inst_updateActiveEffects,y.updateActiveEffects(),y.uses_shaders=!!y.active_effect_types.length,y.bbox_changed=!0,y.cell_changed=!0,u.any_cell_changed=!0,y.visible=!0,y.my_timescale=-1,y.layer=t,y.zindex=t.instances.length,y.earlyz_index=0,"undefined"==typeof y.collision_poly&&(y.collision_poly=null),y.collisionsEnabled=!0,this.redraw=!0}var f,x;for(cr.clearArray(B),s=0,l=u.families.length;s<l;s++)B.push.apply(B,u.families[s].behaviors);if(B.push.apply(B,u.behaviors),y.recycled)for(s=0,l=B.length;s<l;s++){var b=B[s];for(x=y.behavior_insts[s],x.recycled=!0,b.behavior.Instance.call(x,b,y),f=e[4][s],(p=0,d=f.length);p<d;p++)x.properties[p]=f[p];x.onCreate(),b.behavior.my_instances.add(y)}else for(y.behavior_insts=[],s=0,l=B.length;s<l;s++){var b=B[s],x=new b.behavior.Instance(b,y);x.recycled=!1,x.properties=e[4][s].slice(0),x.onCreate(),cr.seal(x),y.behavior_insts.push(x),b.behavior.my_instances.add(y)}if(f=e[5],y.recycled)for(s=0,l=f.length;s<l;s++)y.properties[s]=f[s];else y.properties=f.slice(0);if(this.createRow.push(y),this.hasPendingInstances=!0,(t&&(t.appendToInstanceList(y,!0),(1!==t.parallaxX||1!==t.parallaxY)&&(u.any_instance_parallaxed=!0)),this.objectcount++,!u.is_contained))y.is_contained=!1,y.siblings=null;else if(y.is_contained=!0,y.recycled?cr.clearArray(y.siblings):y.siblings=[],!n&&!o){for(s=0,l=u.container.length;s<l;s++)if(u.container[s]!==u){if(!u.container[s].default_instance)return null;y.siblings.push(this.createInstanceFromInit(u.container[s].default_instance,m,!1,g?y.x:a,g?y.y:r,!0))}for(s=0,l=y.siblings.length;s<l;s++)for(y.siblings[s].siblings.push(y),p=0;p<l;p++)s!==p&&y.siblings[s].siblings.push(y.siblings[p])}for(y.onCreate(),y.recycled||cr.seal(y),(s=0,l=y.behavior_insts.length);s<l;s++)y.behavior_insts[s].postCreate&&y.behavior_insts[s].postCreate();return y},e.prototype.getLayerByName=function(e){var t,n;for(t=0,n=this.running_layout.layers.length;t<n;t++){var a=this.running_layout.layers[t];if(cr.equals_nocase(a.name,e))return a}return null},e.prototype.getLayerByNumber=function(e){return e=cr.floor(e),0>e&&(e=0),e>=this.running_layout.layers.length&&(e=this.running_layout.layers.length-1),this.running_layout.layers[e]},e.prototype.getLayer=function(e){return cr.is_number(e)?this.getLayerByNumber(e):this.getLayerByName(e.toString())},e.prototype.clearSol=function(e){var t,n;for(t=0,n=e.length;t<n;t++)e[t].getCurrentSol().select_all=!0},e.prototype.pushCleanSol=function(e){var t,n;for(t=0,n=e.length;t<n;t++)e[t].pushCleanSol()},e.prototype.pushCopySol=function(e){var t,n;for(t=0,n=e.length;t<n;t++)e[t].pushCopySol()},e.prototype.popSol=function(e){var t,n;for(t=0,n=e.length;t<n;t++)e[t].popSol()},e.prototype.updateAllCells=function(e){if(e.any_cell_changed){var t=e.instances,n,a;for(n=0,a=t.length;n<a;++n)t[n].update_collision_cell();var r=this.createRow;for(n=0,a=r.length;n<a;++n)r[n].type===e&&r[n].update_collision_cell();e.any_cell_changed=!1}},e.prototype.getCollisionCandidates=function(e,n,a,r){var o=!!e&&(1!==e.parallaxX||1!==e.parallaxY),s,l,p;if(n.is_family)for(s=0,l=n.members.length;s<l;++s)p=n.members[s],o||p.any_instance_parallaxed?cr.appendArray(r,p.instances):(this.updateAllCells(p),p.collision_grid.queryRange(a,r));else o||n.any_instance_parallaxed?cr.appendArray(r,n.instances):(this.updateAllCells(n),n.collision_grid.queryRange(a,r))},e.prototype.getTypesCollisionCandidates=function(e,t,n,a){var r,o;for(r=0,o=t.length;r<o;++r)this.getCollisionCandidates(e,t[r],n,a)},e.prototype.getSolidCollisionCandidates=function(e,t,n){var a=this.getSolidBehavior();return a?void this.getTypesCollisionCandidates(e,a.my_types,t,n):null},e.prototype.getJumpthruCollisionCandidates=function(e,t,n){var a=this.getJumpthruBehavior();return a?void this.getTypesCollisionCandidates(e,a.my_types,t,n):null},e.prototype.testAndSelectCanvasPointOverlap=function(e,t,n,a){var r=e.getCurrentSol(),o=this.getCurrentEventStack().current_event.orblock,s,l,p,d,c,u,g;if(r.select_all){for(a||(r.select_all=!1,cr.clearArray(r.instances)),s=0,d=e.instances.length;s<d;s++)if(p=e.instances[s],p.update_bbox(),c=p.layer.canvasToLayer(t,n,!0),u=p.layer.canvasToLayer(t,n,!1),p.contains_pt(c,u)){if(a)return!1;r.instances.push(p)}else o&&r.else_instances.push(p);}else{for(l=0,g=o?r.else_instances:r.instances,(s=0,d=g.length);s<d;s++)if(p=g[s],p.update_bbox(),c=p.layer.canvasToLayer(t,n,!0),u=p.layer.canvasToLayer(t,n,!1),p.contains_pt(c,u)){if(a)return!1;o?r.instances.push(p):(r.instances[l]=r.instances[s],l++)}a||(g.length=l)}return e.applySolToContainer(),!!a||r.hasObjects()},e.prototype.testOverlap=function(e,t){if(!e||!t||e===t||!e.collisionsEnabled||!t.collisionsEnabled)return!1;e.update_bbox(),t.update_bbox();var n=e.layer,a=t.layer,r=n!==a&&(n.parallaxX!==a.parallaxX||a.parallaxY!==a.parallaxY||n.scale!==a.scale||n.angle!==a.angle||n.zoomRate!==a.zoomRate),o,s,l,p,d,c,u,g,m,_;if(!r)return!!e.bbox.intersects_rect(t.bbox)&&!!e.bquad.intersects_quad(t.bquad)&&!(e.tilemap_exists&&t.tilemap_exists)&&(e.tilemap_exists?this.testTilemapOverlap(e,t):t.tilemap_exists?this.testTilemapOverlap(t,e):(u=e.collision_poly&&!e.collision_poly.is_empty(),g=t.collision_poly&&!t.collision_poly.is_empty(),!(u||g))||(u?(e.collision_poly.cache_poly(e.width,e.height,e.angle),m=e.collision_poly):(this.temp_poly.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),m=this.temp_poly),g?(t.collision_poly.cache_poly(t.width,t.height,t.angle),_=t.collision_poly):(this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),_=this.temp_poly),m.intersects_poly(_,t.x-e.x,t.y-e.y)));for(u=e.collision_poly&&!e.collision_poly.is_empty(),g=t.collision_poly&&!t.collision_poly.is_empty(),u?(e.collision_poly.cache_poly(e.width,e.height,e.angle),this.temp_poly.set_from_poly(e.collision_poly)):this.temp_poly.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),m=this.temp_poly,g?(t.collision_poly.cache_poly(t.width,t.height,t.angle),this.temp_poly2.set_from_poly(t.collision_poly)):this.temp_poly2.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),_=this.temp_poly2,(o=0,s=m.pts_count);o<s;o++)l=2*o,p=l+1,d=m.pts_cache[l],c=m.pts_cache[p],m.pts_cache[l]=n.layerToCanvas(d+e.x,c+e.y,!0),m.pts_cache[p]=n.layerToCanvas(d+e.x,c+e.y,!1);for(m.update_bbox(),o=0,s=_.pts_count;o<s;o++)l=2*o,p=l+1,d=_.pts_cache[l],c=_.pts_cache[p],_.pts_cache[l]=a.layerToCanvas(d+t.x,c+t.y,!0),_.pts_cache[p]=a.layerToCanvas(d+t.x,c+t.y,!1);return _.update_bbox(),m.intersects_poly(_,0,0)};var j=new cr.quad,N=new cr.rect(0,0,0,0),D=[];e.prototype.testTilemapOverlap=function(e,t){var n=t.bbox,a=e.x,r=e.y,o,s,l,p;e.getCollisionRectCandidates(n,D);var d=D,u=t.collision_poly&&!t.collision_poly.is_empty();for(o=0,s=d.length;o<s;++o)if(l=d[o],p=l.rc,n.intersects_rect_off(p,a,r)&&(j.set_from_rect(p),j.offset(a,r),j.intersects_quad(t.bquad)))if(!u){if(!l.poly)return cr.clearArray(D),!0;if(this.temp_poly.set_from_quad(t.bquad,0,0,t.width,t.height),l.poly.intersects_poly(this.temp_poly,-(a+p.left),-(r+p.top)))return cr.clearArray(D),!0}else if(t.collision_poly.cache_poly(t.width,t.height,t.angle),l.poly){if(l.poly.intersects_poly(t.collision_poly,t.x-(a+p.left),t.y-(r+p.top)))return cr.clearArray(D),!0;}else if(this.temp_poly.set_from_quad(j,0,0,p.right-p.left,p.bottom-p.top),this.temp_poly.intersects_poly(t.collision_poly,t.x,t.y))return cr.clearArray(D),!0;return cr.clearArray(D),!1},e.prototype.testRectOverlap=function(e,t){if(!t||!t.collisionsEnabled)return!1;t.update_bbox();var n=t.layer,a;if(!t.bbox.intersects_rect(e))return!1;if(t.tilemap_exists){t.getCollisionRectCandidates(e,D);var r=D,o=t.x,s=t.y,l,p,d,u;for(l=0,p=r.length;l<p;++l)if(d=r[l],u=d.rc,e.intersects_rect_off(u,o,s)){if(!d.poly)return cr.clearArray(D),!0;if(this.temp_poly.set_from_rect(e,0,0),d.poly.intersects_poly(this.temp_poly,-(o+u.left),-(s+u.top)))return cr.clearArray(D),!0}return cr.clearArray(D),!1}return(j.set_from_rect(e),!!t.bquad.intersects_quad(j))&&((a=t.collision_poly&&!t.collision_poly.is_empty(),!!!a)||(t.collision_poly.cache_poly(t.width,t.height,t.angle),j.offset(-e.left,-e.top),this.temp_poly.set_from_quad(j,0,0,1,1),t.collision_poly.intersects_poly(this.temp_poly,e.left-t.x,e.top-t.y)))},e.prototype.testSegmentOverlap=function(e,t,n,a,r){if(!r||!r.collisionsEnabled)return!1;r.update_bbox();var o=r.layer,s;if(N.set(cr.min(e,n),cr.min(t,a),cr.max(e,n),cr.max(t,a)),!r.bbox.intersects_rect(N))return!1;if(r.tilemap_exists){r.getCollisionRectCandidates(N,D);var l=D,p=r.x,d=r.y,u,g,m,y;for(u=0,g=l.length;u<g;++u)if(m=l[u],y=m.rc,N.intersects_rect_off(y,p,d)&&(j.set_from_rect(y),j.offset(p,d),j.intersects_segment(e,t,n,a))){if(!m.poly)return cr.clearArray(D),!0;if(m.poly.intersects_segment(p+y.left,d+y.top,e,t,n,a))return cr.clearArray(D),!0}return cr.clearArray(D),!1}return!!r.bquad.intersects_segment(e,t,n,a)&&((s=r.collision_poly&&!r.collision_poly.is_empty(),!!!s)||(r.collision_poly.cache_poly(r.width,r.height,r.angle),r.collision_poly.intersects_segment(r.x,r.y,e,t,n,a)))},e.prototype.typeHasBehavior=function(e,t){if(!t)return!1;var n,a,r,o,s;for(n=0,a=e.behaviors.length;n<a;n++)if(e.behaviors[n].behavior instanceof t)return!0;if(!e.is_family)for(n=0,a=e.families.length;n<a;n++)for(s=e.families[n],r=0,o=s.behaviors.length;r<o;r++)if(s.behaviors[r].behavior instanceof t)return!0;return!1},e.prototype.typeHasNoSaveBehavior=function(e){return this.typeHasBehavior(e,cr.behaviors.NoSave)},e.prototype.typeHasPersistBehavior=function(e){return this.typeHasBehavior(e,cr.behaviors.Persist)},e.prototype.getSolidBehavior=function(){return this.solidBehavior},e.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var M=[];e.prototype.testOverlapSolid=function(e){var t,n,a;for(e.update_bbox(),this.getSolidCollisionCandidates(e.layer,e.bbox,M),(t=0,n=M.length);t<n;++t)if(a=M[t],a.extra.solidEnabled&&this.testOverlap(e,a))return cr.clearArray(M),a;return cr.clearArray(M),null},e.prototype.testRectOverlapSolid=function(e){var t,n,a;for(this.getSolidCollisionCandidates(null,e,M),t=0,n=M.length;t<n;++t)if(a=M[t],a.extra.solidEnabled&&this.testRectOverlap(e,a))return cr.clearArray(M),a;return cr.clearArray(M),null};var V=[];e.prototype.testOverlapJumpThru=function(e,t){var n=null;t&&(n=V,cr.clearArray(n)),e.update_bbox(),this.getJumpthruCollisionCandidates(e.layer,e.bbox,M);var a,r,o;for(a=0,r=M.length;a<r;++a)if(o=M[a],o.extra.jumpthruEnabled&&this.testOverlap(e,o))if(t)n.push(o);else return cr.clearArray(M),o;return cr.clearArray(M),n},e.prototype.pushOutSolid=function(e,t,n,a,r,o){var s=e.x,l=e.y,p=null,d=null,c;for(c=0;c<(a||50);c++)if(e.x=s+t*c,e.y=l+n*c,e.set_bbox_changed(),!this.testOverlap(e,p)&&(p=this.testOverlapSolid(e),p&&(d=p),!p&&(r&&(p=o?this.testOverlap(e,o)?o:null:this.testOverlapJumpThru(e),p&&(d=p)),!p)))return d&&this.pushInFractional(e,t,n,d,16),!0;return e.x=s,e.y=l,e.set_bbox_changed(),!1},e.prototype.pushOutSolidAxis=function(e,t,n,a){a=a||50;var r=e.x,o=e.y,s=null,l=null,p,d,c;for(p=0;p<a;++p)for(d=0;2>d;++d)if(c=2*d-1,e.x=r+t*p*c,e.y=o+n*p*c,e.set_bbox_changed(),!this.testOverlap(e,s))if(s=this.testOverlapSolid(e),s)l=s;else return l&&this.pushInFractional(e,t*c,n*c,l,16),!0;return e.x=r,e.y=o,e.set_bbox_changed(),!1},e.prototype.pushOut=function(e,t,n,a,r){var o=e.x,s=e.y,l;for(l=0;l<(a||50);l++)if(e.x=o+t*l,e.y=s+n*l,e.set_bbox_changed(),!this.testOverlap(e,r))return!0;return e.x=o,e.y=s,e.set_bbox_changed(),!1},e.prototype.pushInFractional=function(e,t,n,a,r){for(var i=2,o=!1,s=!1,l=e.x,p=e.y,d;i<=r;)d=1/i,i*=2,e.x+=t*d*(o?1:-1),e.y+=n*d*(o?1:-1),e.set_bbox_changed(),this.testOverlap(e,a)?(o=!0,s=!0):(o=!1,s=!1,l=e.x,p=e.y);s&&(e.x=l,e.y=p,e.set_bbox_changed())},e.prototype.pushOutSolidNearest=function(e,t){var n=cr.is_undefined(t)?100:t,a=0,r=e.x,i=e.y,o=0,s=0,l=0,p=this.testOverlapSolid(e);if(!p)return!0;for(;a<=n;)if(0==o?(s=0,l=-1,a++):1==o?(s=1,l=-1):2==o?(s=1,l=0):3==o?(s=1,l=1):4==o?(s=0,l=1):5==o?(s=-1,l=1):6==o?(s=-1,l=0):7==o?(s=-1,l=-1):void 0,o=(o+1)%8,e.x=cr.floor(r+s*a),e.y=cr.floor(i+l*a),e.set_bbox_changed(),!this.testOverlap(e,p)&&(p=this.testOverlapSolid(e),!p))return!0;return e.x=r,e.y=i,e.set_bbox_changed(),!1},e.prototype.registerCollision=function(e,t){e.collisionsEnabled&&t.collisionsEnabled&&this.registered_collisions.push([e,t])},e.prototype.addRegisteredCollisionCandidates=function(e,t,n){var a,o,s,l;for(a=0,o=this.registered_collisions.length;a<o;++a){if(s=this.registered_collisions[a],l=null,s[0]===e)l=s[1];else if(s[1]===e)l=s[0];else continue;if(t.is_family){if(-1===t.members.indexOf(t))continue;}else if(l.type!==t)continue;-1===n.indexOf(l)&&n.push(l)}},e.prototype.checkRegisteredCollision=function(e,t){var n,a,r;for(n=0,a=this.registered_collisions.length;n<a;n++)if(r=this.registered_collisions[n],r[0]===e&&r[1]===t||r[0]===t&&r[1]===e)return!0;return!1},e.prototype.calculateSolidBounceAngle=function(e,t,n,a){var r=e.x,o=e.y,s=cr.max(10,cr.distanceTo(t,n,r,o)),l=cr.angleTo(t,n,r,o),p=a||this.testOverlapSolid(e);if(!p)return cr.clamp_angle(l+cr.PI);var d=p,c=cr.to_radians(5),u,g,m,y;for(u=1;36>u;u++)if(g=l-u*c,e.x=t+_(g)*s,e.y=n+h(g)*s,e.set_bbox_changed(),!this.testOverlap(e,d)&&(d=a?null:this.testOverlapSolid(e),!d)){m=g;break}36===u&&(m=cr.clamp_angle(l+cr.PI));var d=p;for(u=1;36>u;u++)if(g=l+u*c,e.x=t+_(g)*s,e.y=n+h(g)*s,e.set_bbox_changed(),!this.testOverlap(e,d)&&(d=a?null:this.testOverlapSolid(e),!d)){y=g;break}if(36===u&&(y=cr.clamp_angle(l+cr.PI)),e.x=r,e.y=o,e.set_bbox_changed(),y===m)return y;var f=cr.angleDiff(y,m)/2,x;x=cr.angleClockwise(y,m)?cr.clamp_angle(m+f+cr.PI):cr.clamp_angle(y+f);var b=_(l),v=h(l),w=_(x),T=h(x),S=b*w+v*T;return cr.angleTo(0,0,b-2*S*w,v-2*S*T)};var U=-1;e.prototype.trigger=function(e,t,n){if(!this.running_layout)return!1;var a=this.running_layout.event_sheet;if(!a)return!1;var o=!1,s,l,p;U++;var d=a.deep_includes;for(l=0,p=d.length;l<p;++l)s=this.triggerOnSheet(e,t,d[l],n),o=o||s;return s=this.triggerOnSheet(e,t,a,n),o=o||s,U--,o},e.prototype.triggerOnSheet=function(e,t,n,a){var o=!1,s,l,p,d;if(!t)p=this.triggerOnSheetForTypeName(e,t,"system",n,a),o=o||p;else for(p=this.triggerOnSheetForTypeName(e,t,t.type.name,n,a),o=o||p,d=t.type.families,(s=0,l=d.length);s<l;++s)p=this.triggerOnSheetForTypeName(e,t,d[s].name,n,a),o=o||p;return o},e.prototype.triggerOnSheetForTypeName=function(e,t,n,a,r){var o=!1,s=!1,l="undefined"!=typeof r,p=l?a.fasttriggers:a.triggers,d=p[n],c,u,g,m;if(!d)return o;var y=null;for(c=0,u=d.length;c<u;++c)if(d[c].method==e){y=d[c].evs;break}if(!y)return o;var _;if(_=l?y[r]:y,!_)return null;for(c=0,u=_.length;c<u;c++)g=_[c][0],m=_[c][1],s=this.executeSingleTrigger(t,n,g,m),o=o||s;return o},e.prototype.executeSingleTrigger=function(e,t,n,a){var r=!1,o,s;this.trigger_depth++;var l=this.getCurrentEventStack().current_event;l&&this.pushCleanSol(l.solModifiersIncludingParents);var p=1<this.trigger_depth;this.pushCleanSol(n.solModifiersIncludingParents),p&&this.pushLocalVarStack();var d=this.pushEventStack(n);if(d.current_event=n,e){var c=this.types[t].getCurrentSol();c.select_all=!1,cr.clearArray(c.instances),c.instances[0]=e,this.types[t].applySolToContainer()}var u=!0;if(n.parent){for(var g=d.temp_parents_arr,m=n.parent;m;)g.push(m),m=m.parent;for(g.reverse(),o=0,s=g.length;o<s;o++)if(!g[o].run_pretrigger()){u=!1;break}}return u&&(this.execcount++,n.orblock?n.run_orblocktrigger(a):n.run(),r=r||d.last_event_true),this.popEventStack(),p&&this.popLocalVarStack(),this.popSol(n.solModifiersIncludingParents),l&&this.popSol(l.solModifiersIncludingParents),this.hasPendingInstances&&0===this.isInOnDestroy&&0==U&&!this.isRunningEvents&&this.ClearDeathRow(),this.trigger_depth--,r},e.prototype.getCurrentCondition=function(){var e=this.getCurrentEventStack();return e.current_event.conditions[e.cndindex]},e.prototype.getCurrentConditionObjectType=function(){var e=this.getCurrentCondition();return e.type},e.prototype.isCurrentConditionFirst=function(){var e=this.getCurrentEventStack();return 0===e.cndindex},e.prototype.getCurrentAction=function(){var e=this.getCurrentEventStack();return e.current_event.actions[e.actindex]},e.prototype.pushLocalVarStack=function(){this.localvar_stack_index++,this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])},e.prototype.popLocalVarStack=function(){this.localvar_stack_index--},e.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]},e.prototype.pushEventStack=function(e){this.event_stack_index++,this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var t=this.getCurrentEventStack();return t.reset(e),t},e.prototype.popEventStack=function(){this.event_stack_index--},e.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]},e.prototype.pushLoopStack=function(e){this.loop_stack_index++,this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:e,index:0,stopped:!1}));var t=this.getCurrentLoop();return t.name=e,t.index=0,t.stopped=!1,t},e.prototype.popLoopStack=function(){this.loop_stack_index--},e.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]},e.prototype.getEventVariableByName=function(t,n){for(var a,r,o,s,l,p;n;){for(a=0,r=n.subevents.length;a<r;a++)if(p=n.subevents[a],p instanceof cr.eventvariable&&cr.equals_nocase(t,p.name))return p;n=n.parent}for(a=0,r=this.eventsheets_by_index.length;a<r;a++)for(l=this.eventsheets_by_index[a],o=0,s=l.events.length;o<s;o++)if(p=l.events[o],p instanceof cr.eventvariable&&cr.equals_nocase(t,p.name))return p;return null},e.prototype.getLayoutBySid=function(e){var t,n;for(t=0,n=this.layouts_by_index.length;t<n;t++)if(this.layouts_by_index[t].sid===e)return this.layouts_by_index[t];return null},e.prototype.getObjectTypeBySid=function(e){var t,n;for(t=0,n=this.types_by_index.length;t<n;t++)if(this.types_by_index[t].sid===e)return this.types_by_index[t];return null},e.prototype.getGroupBySid=function(e){var t,n;for(t=0,n=this.allGroups.length;t<n;t++)if(this.allGroups[t].sid===e)return this.allGroups[t];return null},e.prototype.doCanvasSnapshot=function(e,t){this.snapshotCanvas=[e,t],this.redraw=!0};e.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0};e.prototype.handleSaveLoad=function(){var t=this,e=this.saveToSlot,n=this.lastSaveJson,a=this.loadFromSlot,r=!1;if(this.signalledContinuousPreview&&(r=!0,e="__c2_continuouspreview",this.signalledContinuousPreview=!1),e.length){if(this.ClearDeathRow(),n=this.saveToJSONString(),i())s(e,n,function(){cr.logexport("Saved state to IndexedDB storage ("+n.length+" bytes)"),t.lastSaveJson=n,t.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",r&&p()},function(a){try{localStorage.setItem("__c2save_"+e,n),cr.logexport("Saved state to WebStorage ("+n.length+" bytes)"),t.lastSaveJson=n,t.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",r&&p()}catch(e){cr.logexport("Failed to save game state: "+a+"; "+e),t.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+e,n),cr.logexport("Saved state to WebStorage ("+n.length+" bytes)"),t.lastSaveJson=n,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",r&&p()}catch(n){cr.logexport("Error saving to WebStorage: "+n),t.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null}if(a.length){if(i())l(a,function(e){e?(t.loadFromJson=e,cr.logexport("Loaded state from IndexedDB storage ("+t.loadFromJson.length+" bytes)")):(t.loadFromJson=localStorage.getItem("__c2save_"+a)||"",cr.logexport("Loaded state from WebStorage ("+t.loadFromJson.length+" bytes)")),t.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(){t.loadFromJson=localStorage.getItem("__c2save_"+a)||"",cr.logexport("Loaded state from WebStorage ("+t.loadFromJson.length+" bytes)"),t.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});else{try{this.loadFromJson=localStorage.getItem("__c2save_"+a)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(t){this.loadFromJson=null}this.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.loadFromSlot="",this.saveToSlot=""}if(null!==this.loadFromJson){this.ClearDeathRow();var o=this.loadFromJSONString(this.loadFromJson);o?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null),this.lastSaveJson=""):t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null}};e.prototype.saveToJSONString=function(){var e={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}},t,n,r,o,s,l,u,m,y,_,h,f;for(t=0,n=this.types_by_index.length;t<n;t++)if(s=this.types_by_index[t],!(s.is_family||this.typeHasNoSaveBehavior(s))){for(u={instances:[]},cr.hasAnyOwnProperty(s.extra)&&(u.ex=d(s.extra)),(r=0,o=s.instances.length);r<o;r++)u.instances.push(this.saveInstanceToJSON(s.instances[r]));e.types[s.sid.toString()]=u}for(t=0,n=this.layouts_by_index.length;t<n;t++)l=this.layouts_by_index[t],e.layouts[l.sid.toString()]=l.saveToJSON();var x=e.events.groups;for(t=0,n=this.allGroups.length;t<n;t++)m=this.allGroups[t],x[m.sid.toString()]=this.groups_by_name[m.group_name].group_active;var b=e.events.cnds;for(f in this.cndsBySid)this.cndsBySid.hasOwnProperty(f)&&(y=this.cndsBySid[f],cr.hasAnyOwnProperty(y.extra)&&(b[f]={ex:d(y.extra)}));var w=e.events.acts;for(f in this.actsBySid)this.actsBySid.hasOwnProperty(f)&&(_=this.actsBySid[f],cr.hasAnyOwnProperty(_.extra)&&(w[f]={ex:d(_.extra)}));var T=e.events.vars;for(f in this.varsBySid)this.varsBySid.hasOwnProperty(f)&&(h=this.varsBySid[f],h.is_constant||h.parent&&!h.is_static||(T[f]=h.data));return e.system=this.system.saveToJSON(),JSON.stringify(e)},e.prototype.refreshUidMap=function(){var e,t,n,a,r,o;for(this.objectsByUid={},e=0,t=this.types_by_index.length;e<t;e++)if(n=this.types_by_index[e],!n.is_family)for(a=0,r=n.instances.length;a<r;a++)o=n.instances[a],this.objectsByUid[o.uid.toString()]=o},e.prototype.loadFromJSONString=function(e){var n;try{n=JSON.parse(e)}catch(t){return!1}if(!n.c2save)return!1;if(1<n.version)return!1;this.isLoadingState=!0;var a=n.rt;this.kahanTime.reset(),this.kahanTime.sum=a.time,this.wallTime.reset(),this.wallTime.sum=a.walltime||0,this.timescale=a.timescale,this.tickcount=a.tickcount,this.execcount=a.execcount,this.start_time=Date.now()-a.start_time_offset;var r=a.running_layout;if(r!==this.running_layout.sid){var s=this.getLayoutBySid(r);if(s)this.doChangeLayout(s);else return}var l=n.types,d,c,u,m,y,_,h,f,x,b,v,w,T,S,O,E,C;for(h in l)if(l.hasOwnProperty(h)){if(f=this.getObjectTypeBySid(parseInt(h,10)),!f||f.is_family||this.typeHasNoSaveBehavior(f))continue;for(l[h].ex?f.extra=l[h].ex:cr.wipe(f.extra),x=f.instances,b=l[h].instances,(d=0,c=cr.min(x.length,b.length));d<c;d++)this.loadInstanceFromJSON(x[d],b[d]);for(d=b.length,c=x.length;d<c;d++)this.DestroyInstance(x[d]);for(d=x.length,c=b.length;d<c;d++)(S=null,!(f.plugin.is_world&&(S=this.running_layout.getLayerBySid(b[d].w.l),!S)))&&(v=this.createInstanceFromInit(f.default_instance,S,!1,0,0,!0),this.loadInstanceFromJSON(v,b[d]));f.stale_iids=!0}this.ClearDeathRow(),this.refreshUidMap();var A=n.layouts;for(h in A)if(A.hasOwnProperty(h)){if(T=this.getLayoutBySid(parseInt(h,10)),!T)continue;T.loadFromJSON(A[h])}var P=n.events.groups;for(h in P)P.hasOwnProperty(h)&&(O=this.getGroupBySid(parseInt(h,10)),O&&this.groups_by_name[O.group_name]&&this.groups_by_name[O.group_name].setGroupActive(P[h]));var I=n.events.cnds;for(h in this.cndsBySid)this.cndsBySid.hasOwnProperty(h)&&(this.cndsBySid[h].extra=I.hasOwnProperty(h)?I[h].ex:{});var L=n.events.acts;for(h in this.actsBySid)this.actsBySid.hasOwnProperty(h)&&(this.actsBySid[h].extra=L.hasOwnProperty(h)?L[h].ex:{});var R=n.events.vars;for(h in R)R.hasOwnProperty(h)&&this.varsBySid.hasOwnProperty(h)&&(this.varsBySid[h].data=R[h]);for(this.next_uid=a.next_uid,this.isLoadingState=!1,(d=0,c=this.fireOnCreateAfterLoad.length);d<c;++d)v=this.fireOnCreateAfterLoad[d],this.trigger(Object.getPrototypeOf(v.type.plugin).cnds.OnCreated,v);for(cr.clearArray(this.fireOnCreateAfterLoad),this.system.loadFromJSON(n.system),(d=0,c=this.types_by_index.length);d<c;d++)if(f=this.types_by_index[d],!(f.is_family||this.typeHasNoSaveBehavior(f)))for(u=0,m=f.instances.length;u<m;u++){if(v=f.instances[u],f.is_contained)for(E=v.get_iid(),cr.clearArray(v.siblings),(y=0,_=f.container.length);y<_;y++)C=f.container[y],f!==C&&v.siblings.push(C.instances[E]);if(v.afterLoad&&v.afterLoad(),v.behavior_insts)for(y=0,_=v.behavior_insts.length;y<_;y++)w=v.behavior_insts[y],w.afterLoad&&w.afterLoad()}return this.redraw=!0,!0},e.prototype.saveInstanceToJSON=function(e,t){var n=e.type,a=n.plugin,r={},o,s,l,p,c;if(t?r.c2=!0:r.uid=e.uid,cr.hasAnyOwnProperty(e.extra)&&(r.ex=d(e.extra)),e.instance_vars&&e.instance_vars.length)for(r.ivs={},o=0,s=e.instance_vars.length;o<s;o++)r.ivs[e.type.instvar_sids[o].toString()]=e.instance_vars[o];if(a.is_world){if(l={x:e.x,y:e.y,w:e.width,h:e.height,l:e.layer.sid,zi:e.get_zindex()},0!==e.angle&&(l.a=e.angle),1!==e.opacity&&(l.o=e.opacity),.5!==e.hotspotX&&(l.hX=e.hotspotX),.5!==e.hotspotY&&(l.hY=e.hotspotY),0!==e.blend_mode&&(l.bm=e.blend_mode),e.visible||(l.v=e.visible),e.collisionsEnabled||(l.ce=e.collisionsEnabled),-1!==e.my_timescale&&(l.mts=e.my_timescale),n.effect_types.length)for(l.fx=[],o=0,s=n.effect_types.length;o<s;o++)c=n.effect_types[o],l.fx.push({name:c.name,active:e.active_effect_flags[c.index],params:e.effect_params[c.index]});r.w=l}if(e.behavior_insts&&e.behavior_insts.length)for(r.behs={},o=0,s=e.behavior_insts.length;o<s;o++)p=e.behavior_insts[o],p.saveToJSON&&(r.behs[p.type.sid.toString()]=p.saveToJSON());return e.saveToJSON&&(r.data=e.saveToJSON()),r},e.prototype.getInstanceVarIndexBySid=function(e,t){var n,a;for(n=0,a=e.instvar_sids.length;n<a;n++)if(e.instvar_sids[n]===t)return n;return-1},e.prototype.getBehaviorIndexBySid=function(e,t){var n,a;for(n=0,a=e.behavior_insts.length;n<a;n++)if(e.behavior_insts[n].type.sid===t)return n;return-1},e.prototype.loadInstanceFromJSON=function(e,t,n){var a=e.type,r=a.plugin,o,s,l,d,c,u,g,m,y,_,h;if(!n)e.uid=t.uid;else if(!t.c2)return;if(t.ex?e.extra=t.ex:cr.wipe(e.extra),c=t.ivs,c)for(o in c)if(c.hasOwnProperty(o)){if(d=this.getInstanceVarIndexBySid(a,parseInt(o,10)),0>d||d>=e.instance_vars.length)continue;_=c[o],null===_&&(_=NaN),e.instance_vars[d]=_}if(r.is_world){if(u=t.w,e.layer.sid!==u.l&&(h=e.layer,e.layer=this.running_layout.getLayerBySid(u.l),e.layer?(h.removeFromInstanceList(e,!0),e.layer.appendToInstanceList(e,!0),e.set_bbox_changed(),e.layer.setZIndicesStaleFrom(0)):(e.layer=h,!n&&this.DestroyInstance(e))),e.x=u.x,e.y=u.y,e.width=u.w,e.height=u.h,e.zindex=u.zi,e.angle=u.hasOwnProperty("a")?u.a:0,e.opacity=u.hasOwnProperty("o")?u.o:1,e.hotspotX=u.hasOwnProperty("hX")?u.hX:.5,e.hotspotY=u.hasOwnProperty("hY")?u.hY:.5,e.visible=!u.hasOwnProperty("v")||u.v,e.collisionsEnabled=!u.hasOwnProperty("ce")||u.ce,e.my_timescale=u.hasOwnProperty("mts")?u.mts:-1,e.blend_mode=u.hasOwnProperty("bm")?u.bm:0,(e.compositeOp=cr.effectToCompositeOp(e.blend_mode),this.gl&&cr.setGLBlend(e,e.blend_mode,this.gl),e.set_bbox_changed(),u.hasOwnProperty("fx")))for(s=0,l=u.fx.length;s<l;s++)g=a.getEffectIndexByName(u.fx[s].name),0>g||(e.active_effect_flags[g]=u.fx[s].active,e.effect_params[g]=u.fx[s].params);e.updateActiveEffects()}if(m=t.behs,m)for(o in m)if(m.hasOwnProperty(o)){if(y=this.getBehaviorIndexBySid(e,parseInt(o,10)),0>y)continue;e.behavior_insts[y].loadFromJSON(m[o])}t.data&&e.loadFromJSON(t.data)},e.prototype.getProjectFileUrl=function(e){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(e.toLowerCase())?window.cr_previewProjectFiles[e.toLowerCase()]:e:this.files_subfolder+e},e.prototype.getProjectFileBlob=function(e){return this.isPreview?window.cr_previewProjectFileBlobs&&window.cr_previewProjectFiles.hasOwnProperty(e.toLowerCase())?window.cr_previewProjectFileBlobs[e.toLowerCase()]:null:null},e.prototype.getLocalFileUrl=function(e){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(e.toLowerCase())?window.cr_previewProjectFiles[e.toLowerCase()]:e:e},e.prototype.fetchLocalFileViaCordova=function(e,t,n){var a=window.cordova.file.applicationDirectory+"www/"+e;window.resolveLocalFileSystemURL(a,function(e){e.file(t,n)},n)},e.prototype.fetchLocalFileViaCordovaAsText=function(e,t,n){this.fetchLocalFileViaCordova(e,function(e){var a=new FileReader;a.onload=function(n){t(n.target.result)},a.onerror=n,a.readAsText(e)},n)};var G=[],W=0;e.prototype.maybeStartNextArrayBufferRead=function(){if(G.length&&!(8<=W)){W++;var e=G.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(e.filename,e.successCallback,e.errorCallback)}},e.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(e,t,n){var a=this;G.push({filename:e,successCallback:function(e){W--,a.maybeStartNextArrayBufferRead(),t(e)},errorCallback:function(e){W--,a.maybeStartNextArrayBufferRead(),n(e)}}),this.maybeStartNextArrayBufferRead()},e.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(e,t,n){this.fetchLocalFileViaCordova(e,function(e){var n=new FileReader;n.onload=function(n){t(n.target.result)},n.readAsArrayBuffer(e)},n)},e.prototype.fetchLocalFileViaCordovaAsURL=function(e,t,n){var a="",r=e.toLowerCase(),i=r.substr(r.length-4),o=r.substr(r.length-5);".mp4"===i?a="video/mp4":".webm"===o?a="video/webm":".m4a"===i?a="audio/mp4":".mp3"===i&&(a="audio/mpeg"),this.fetchLocalFileViaCordovaAsArrayBuffer(e,function(e){var n=new Blob([e],{type:a}),r=URL.createObjectURL(n);t(r)},n)},e.prototype.isAbsoluteUrl=function(e){return /^(?:[a-z]+:)?\/\//.test(e)||"data:"===e.substr(0,5)||"blob:"===e.substr(0,5)},e.prototype.setImageSrc=function(e,t){this.isWKWebView&&!this.isAbsoluteUrl(t)?this.fetchLocalFileViaCordovaAsURL(t,function(t){e.src=t},function(e){alert("Failed to load image: "+e)}):this.isPreview&&!this.isAbsoluteUrl(t)?e.src=this.getLocalFileUrl(t):(!this.isAbsoluteUrl(t)&&(t=t.toLowerCase()),e.src=t)},e.prototype.getPreferredAudioFile=function(e){var t=e.toLowerCase();if(!this.audio_files_map.hasOwnProperty(t))return null;var n=this.audio_files_map[t],a=null,o,s,l,p;for(o=0,s=n.length;o<s;++o)if(l=n[o],p=l[0],a||"audio/webm; codecs=opus"!==p||(a=l),v[p])return l;return a},e.prototype.getProjectAudioFileUrl=function(e){var t=e.toLowerCase(),n=this.getPreferredAudioFile(e);if(!n)return null;var a=t+n[1];return{url:this.getProjectFileUrl(a),type:n[0]}},e.prototype.getStatusInfo=function(){return{fps:this.fps,cpu:this.cpuutilisation/1e3,gpu:this.gpuLastUtilisation,layout:this.running_layout?this.running_layout.name:"",renderer:this.glUnmaskedRenderer}},e.prototype.accelerate=function(e,t,n,a,r){if(this.enhancedAccelerationPrecision){return cr.clamp(e*r+.5*a*r*r,t*r,n*r)}return e*r},cr.runtime=e,cr.createRuntime=function(t){return new e(t)},window.cr_createRuntime=cr.createRuntime})(),window.cr_getSnapshot=function(e,t){var n=window.c3runtime;n&&n.doCanvasSnapshot(e,t)},window.cr_sizeCanvas=function(e,t){if(0!==e&&0!==t){var n=window.c3runtime;n&&n.setSize(e,t)}},window.cr_setSuspended=function(e){var t=window.c3runtime;t&&t.setSuspended(e)},function(){function e(e,t){return e.zindex-t.zindex}function t(e,t){this.layout=e,this.runtime=e.runtime,this.instances=[],this.scale=1,this.angle=0,this.disableAngle=!1,this.tmprect=new cr.rect(0,0,0,0),this.tmpquad=new cr.quad,this.viewLeft=0,this.viewRight=0,this.viewTop=0,this.viewBottom=0,this.zindices_stale=!1,this.zindices_stale_from=-1,this.clear_earlyz_index=0,this.name=t[0],this.index=t[1],this.sid=t[2],this.visible=t[3],this.background_color=t[4],this.transparent=t[5],this.parallaxX=t[6],this.parallaxY=t[7],this.opacity=t[8],this.forceOwnTexture=t[9],this.useRenderCells=t[10],this.zoomRate=t[11],this.blend_mode=t[12],this.effect_fallback=t[13],this.compositeOp="source-over",this.srcBlend=0,this.destBlend=0,this.render_grid=null,this.last_render_list=n(),this.render_list_stale=!0,this.last_render_cells=new cr.rect(0,0,-1,-1),this.cur_render_cells=new cr.rect(0,0,-1,-1),this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height)),this.render_offscreen=!1;var a=t[14],r,o;for(this.startup_initial_instances=[],this.initial_instances=[],this.created_globals=[],(r=0,o=a.length);r<o;r++){var s=a[r],l=this.runtime.types_by_index[s[1]];l.default_instance||(l.default_instance=s,l.default_layerindex=this.index),this.initial_instances.push(s),-1===this.layout.initial_types.indexOf(l)&&this.layout.initial_types.push(l)}for(cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances),this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],(r=0,o=t[15].length);r<o;r++)this.effect_types.push({id:t[15][r][0],name:t[15][r][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:r}),this.effect_params.push(t[15][r][2].slice(0));this.updateActiveEffects(),this.rcTexBounce=new cr.rect(0,0,1,1),this.rcTexDest=new cr.rect(0,0,1,1),this.rcTexOrigin=new cr.rect(0,0,1,1)}function n(){return d.length?d.pop():[]}function a(e){cr.clearArray(e),d.push(e)}function r(e,t,n){var a=0,r=0,o=0,s=e.length,l=t.length,p,d;for(n.length=s+l;a<s&&r<l;++o)p=e[a],d=t[r],p.zindex<d.zindex?(n[o]=p,++a):(n[o]=d,++r);for(;a<s;++a,++o)n[o]=e[a];for(;r<l;++r,++o)n[o]=t[r]}function i(e,t){var o,s,l,p,d;for(o=0,s=e.length;o<s-1;o+=2)l=e[o],p=e[o+1],d=n(),r(l,p,d),t||(a(l),a(p)),c.push(d);1==s%2&&(t?(l=n(),cr.shallowAssignArray(l,e[s-1]),c.push(l)):c.push(e[s-1])),cr.shallowAssignArray(e,c),cr.clearArray(c)}function o(e){for(var t=!0;1<e.length;)i(e,t),t=!1;return e[0]}var s=Math.round,l=Math.cos,p=Math.sin;t.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0;var e,t,n;for(e=0,t=this.effect_types.length;e<t;e++)n=this.effect_types[e],n.active&&(this.active_effect_types.push(n),!n.preservesOpaqueness&&(this.shaders_preserve_opaqueness=!1))},t.prototype.getEffectByName=function(e){var t,n,a;for(t=0,n=this.effect_types.length;t<n;t++)if(a=this.effect_types[t],a.name===e)return a;return null},t.prototype.createInitialInstances=function(e){var t,n,a,r,o,s,l,p;for(t=0,n=0,a=this.initial_instances.length;t<a;t++){if(o=this.initial_instances[t],s=this.runtime.types_by_index[o[1]],(p=this.runtime.typeHasPersistBehavior(s),l=!0,!p||this.layout.first_visit)){if(r=this.runtime.createInstanceFromInit(o,this,!0),!r)continue;e.push(r),r.type.global&&(l=!1,this.created_globals.push(r.uid))}l&&(this.initial_instances[n]=this.initial_instances[t],n++)}this.initial_instances.length=n,this.runtime.ClearDeathRow(),!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback),this.compositeOp=cr.effectToCompositeOp(this.blend_mode),this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl),this.render_list_stale=!0},t.prototype.recreateInitialObjects=function(e,t){var n=this.runtime.types_by_index,a=e.is_family,r=e.members,o,l,p,d,c,u,g,m,_,h,f;for(o=0,l=this.initial_instances.length;o<l;++o)if(p=this.initial_instances[o],c=p[0],u=c[0],g=c[1],t.contains_pt(u,g)){if(d=n[p[1]],d!==e)if(!a)continue;else if(0>r.indexOf(d))continue;if(m=this.runtime.createInstanceFromInit(p,this,!1),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(d.plugin).cnds.OnCreated,m),m.is_contained)for(_=0,h=m.siblings.length;_<h;_++)f=m.siblings[o],this.runtime.trigger(Object.getPrototypeOf(f.type.plugin).cnds.OnCreated,f);this.runtime.isInOnDestroy--}},t.prototype.removeFromInstanceList=function(e,t){var n=cr.fastIndexOf(this.instances,e);0>n||(t&&this.useRenderCells&&e.rendercells&&e.rendercells.right>=e.rendercells.left&&(e.update_bbox(),this.render_grid.update(e,e.rendercells,null),e.rendercells.set(0,0,-1,-1)),n===this.instances.length-1?this.instances.pop():(cr.arrayRemove(this.instances,n),this.setZIndicesStaleFrom(n)),this.render_list_stale=!0)},t.prototype.appendToInstanceList=function(e,t){e.zindex=this.instances.length,this.instances.push(e),t&&this.useRenderCells&&e.rendercells&&e.set_bbox_changed(),this.render_list_stale=!0},t.prototype.prependToInstanceList=function(e,t){this.instances.unshift(e),this.setZIndicesStaleFrom(0),t&&this.useRenderCells&&e.rendercells&&e.set_bbox_changed()},t.prototype.moveInstanceAdjacent=function(e,t,n){var a=e.get_zindex(),r=t.get_zindex();cr.arrayRemove(this.instances,a),a<r&&r--,n&&r++,r===this.instances.length?this.instances.push(e):this.instances.splice(r,0,e),this.setZIndicesStaleFrom(a<r?a:r)},t.prototype.setZIndicesStaleFrom=function(e){-1===this.zindices_stale_from?this.zindices_stale_from=e:e<this.zindices_stale_from&&(this.zindices_stale_from=e),this.zindices_stale=!0,this.render_list_stale=!0},t.prototype.updateZIndices=function(){if(this.zindices_stale){-1===this.zindices_stale_from&&(this.zindices_stale_from=0);var e,t,n;if(this.useRenderCells)for(e=this.zindices_stale_from,t=this.instances.length;e<t;++e)n=this.instances[e],n.zindex=e,this.render_grid.markRangeChanged(n.rendercells);else for(e=this.zindices_stale_from,t=this.instances.length;e<t;++e)this.instances[e].zindex=e;this.zindices_stale=!1,this.zindices_stale_from=-1}},t.prototype.getScale=function(e){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||e?this.runtime.aspect_scale:1)},t.prototype.getNormalScale=function(){return(this.scale*this.layout.scale-1)*this.zoomRate+1},t.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var d=[];var c=[];var u=[];t.prototype.getRenderCellInstancesToDraw=function(){if(this.updateZIndices(),this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,u),!u.length)return n();if(1===u.length){var e=n();return cr.shallowAssignArray(e,u[0]),cr.clearArray(u),e}var t=o(u);return cr.clearArray(u),t},t.prototype.draw=function(e){this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0!==this.blend_mode;var t=this.runtime.canvas,n=e,r=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),t=this.runtime.layer_canvas,t.width=this.runtime.draw_width,t.height=this.runtime.draw_height,this.runtime.layer_ctx=t.getContext("2d"),r=!0),t=this.runtime.layer_canvas,n=this.runtime.layer_ctx,t.width!==this.runtime.draw_width&&(t.width=this.runtime.draw_width,r=!0),t.height!==this.runtime.draw_height&&(t.height=this.runtime.draw_height,r=!0),r&&(n.imageSmoothingEnabled=this.runtime.linearSampling),this.transparent&&n.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height));n.globalAlpha=1,n.globalCompositeOperation="source-over",this.transparent||(n.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",n.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),n.save(),this.disableAngle=!0;var o=this.canvasToLayer(0,0,!0,!0),l=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(o=s(o),l=s(l)),this.rotateViewport(o,l,n);var p=this.getScale();n.scale(p,p),n.translate(-o,-l);var d;this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(a(this.last_render_list),d=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):d=this.last_render_list):d=this.instances;var c=null,u,g,m;for(u=0,g=d.length;u<g;++u)m=d[u],m===c||(this.drawInstance(m,n),c=m);this.useRenderCells&&(this.last_render_list=d),n.restore(),this.render_offscreen&&(e.globalCompositeOperation=this.compositeOp,e.globalAlpha=this.opacity,e.drawImage(t,0,0))},t.prototype.drawInstance=function(e,t){if(e.visible&&0!==e.width&&0!==e.height){e.update_bbox();var n=e.bbox;n.right<this.viewLeft||n.bottom<this.viewTop||n.left>this.viewRight||n.top>this.viewBottom||(t.globalCompositeOperation=e.compositeOp,e.draw(t))}},t.prototype.updateViewport=function(e){this.disableAngle=!0;var t=this.canvasToLayer(0,0,!0,!0),n=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(t=s(t),n=s(n)),this.rotateViewport(t,n,e)},t.prototype.rotateViewport=function(e,t,n){var a=this.getScale();this.viewLeft=e,this.viewTop=t,this.viewRight=e+this.runtime.draw_width*(1/a),this.viewBottom=t+this.runtime.draw_height*(1/a);var r=this.getAngle();0!==r&&(n&&(n.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),n.rotate(-r),n.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,r),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)},t.prototype.drawGL_earlyZPass=function(e){var t=this.runtime.draw_width,n=this.runtime.draw_height;this.render_offscreen=this.forceOwnTexture,this.render_offscreen&&(!this.runtime.layer_tex&&(this.runtime.layer_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)&&(e.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),e.setRenderingToTexture(this.runtime.layer_tex)),this.disableAngle=!0;var r=this.canvasToLayer(0,0,!0,!0),o=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(r=s(r),o=s(o)),this.rotateViewport(r,o,null);var l=this.getScale();e.resetModelView(),e.scale(l,l),e.rotateZ(-this.getAngle()),e.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),e.updateModelView();var p;this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(a(this.last_render_list),p=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):p=this.last_render_list):p=this.instances;var d=null,c,u;for(c=p.length-1;0<=c;--c)u=p[c],u===d||(this.drawInstanceGL_earlyZPass(p[c],e),d=u);this.useRenderCells&&(this.last_render_list=p),this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,e.setEarlyZIndex(this.clear_earlyz_index),e.setColorFillMode(1,1,1,1),e.fullscreenQuad(),e.restoreEarlyZMode())},t.prototype.drawGL=function(e){var t=this.runtime.draw_width,n=this.runtime.draw_height,r=0,o=0;this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0<this.active_effect_types.length||0!==this.blend_mode,this.render_offscreen&&(!this.runtime.layer_tex&&(this.runtime.layer_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)&&(e.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),e.setRenderingToTexture(this.runtime.layer_tex),this.transparent&&e.clear(0,0,0,0)),this.transparent||(this.runtime.enableFrontToBack?(e.setEarlyZIndex(this.clear_earlyz_index),e.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),e.fullscreenQuad(),e.setTextureFillMode()):e.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1)),this.disableAngle=!0;var l=this.canvasToLayer(0,0,!0,!0),p=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(l=s(l),p=s(p)),this.rotateViewport(l,p,null);var d=this.getScale();e.resetModelView(),e.scale(d,d),e.rotateZ(-this.getAngle()),e.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),e.updateModelView();var c;this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(a(this.last_render_list),c=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):c=this.last_render_list):c=this.instances;var u=null,g,m,y;if(this.getNormalScale()>2220446049250313e-31)for(g=0,m=c.length;g<m;++g)y=c[g],y===u||(this.drawInstanceGL(c[g],e),u=y);if(this.useRenderCells&&(this.last_render_list=c),this.render_offscreen)if(r=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,o=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!e.programUsesCrossSampling(r)&&1===this.opacity){1===this.active_effect_types.length?(e.switchProgram(r),e.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,0,0,1,1,d,this.getAngle(),this.runtime.kahanTime.sum,this.effect_params[o]),e.programIsAnimated(r)&&(this.runtime.redraw=!0)):e.switchProgram(0),e.setRenderingToTexture(this.layout.getRenderTarget()),e.setOpacity(this.opacity),e.setTexture(this.runtime.layer_tex),e.setBlend(this.srcBlend,this.destBlend),e.resetModelView(),e.updateModelView();var _=this.runtime.draw_width/2,h=this.runtime.draw_height/2;e.quad(-_,h,_,h,_,-h,-_,-h),e.setTexture(null)}else this.layout.renderEffectChain(e,this,null,this.layout.getRenderTarget())},t.prototype.drawInstanceGL=function(e,t){if(e.visible&&0!==e.width&&0!==e.height){e.update_bbox();var n=e.bbox;n.right<this.viewLeft||n.bottom<this.viewTop||n.left>this.viewRight||n.top>this.viewBottom||(t.setEarlyZIndex(e.earlyz_index),e.uses_shaders?this.drawInstanceWithShadersGL(e,t):(t.switchProgram(0),t.setBlend(e.srcBlend,e.destBlend),e.drawGL(t)))}},t.prototype.drawInstanceGL_earlyZPass=function(e,t){if(e.visible&&0!==e.width&&0!==e.height){e.update_bbox();var n=e.bbox;n.right<this.viewLeft||n.bottom<this.viewTop||n.left>this.viewRight||n.top>this.viewBottom||(e.earlyz_index=this.runtime.earlyz_index++,0===e.blend_mode&&1===e.opacity&&e.shaders_preserve_opaqueness&&e.drawGL_earlyZPass&&(t.setEarlyZIndex(e.earlyz_index),e.drawGL_earlyZPass(t)))}},t.prototype.drawInstanceWithShadersGL=function(e,t){var n=e.active_effect_types[0].shaderindex,a=e.active_effect_types[0].index,r=this.getScale();if(1===e.active_effect_types.length&&!t.programUsesCrossSampling(n)&&!t.programExtendsBox(n)&&(!e.angle&&!e.layer.getAngle()||!t.programUsesDest(n))&&1===e.opacity&&!e.type.plugin.must_predraw){t.switchProgram(n),t.setBlend(e.srcBlend,e.destBlend),t.programIsAnimated(n)&&(this.runtime.redraw=!0);var i=0,o=0,s=0,l=0;if(t.programUsesDest(n)){var p=e.bbox,d=this.layerToCanvas(p.left,p.top,!0,!0),c=this.layerToCanvas(p.left,p.top,!1,!0),u=this.layerToCanvas(p.right,p.bottom,!0,!0),g=this.layerToCanvas(p.right,p.bottom,!1,!0);i=d/windowWidth,o=1-c/windowHeight,s=u/windowWidth,l=1-g/windowHeight}var m=0,y=0,_=1,h=1,f=1/e.width,x=1/e.height;e.curFrame&&e.curFrame.sheetTex&&(m=e.curFrame.sheetTex.left,y=e.curFrame.sheetTex.top,_=e.curFrame.sheetTex.right,h=e.curFrame.sheetTex.bottom,e.curFrame.texture_img&&(f=1/e.curFrame.texture_img.width,x=1/e.curFrame.texture_img.height)),t.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),f,x,m,y,_,h,m,y,_,h,e.bbox.left,e.bbox.top,e.bbox.right,e.bbox.bottom,i,o,s,l,r,this.getAngle(),this.runtime.kahanTime.sum,e.effect_params[a]),e.drawGL(t)}else this.layout.renderEffectChain(t,this,e,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),t.resetModelView(),t.scale(r,r),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView()},t.prototype.canvasToLayer=function(e,t,n,r){var i=this.runtime.devicePixelRatio;this.runtime.isRetina&&(e*=i,t*=i);var o=this.runtime.parallax_x_origin,s=this.runtime.parallax_y_origin,d=(this.layout.scrollX-o)*this.parallaxX+o,c=(this.layout.scrollY-s)*this.parallaxY+s,u=d,g=c,m=1/this.getScale(!r);r?(u-=this.runtime.draw_width*m/2,g-=this.runtime.draw_height*m/2):(u-=this.runtime.width*m/2,g-=this.runtime.height*m/2),u+=e*m,g+=t*m;var _=this.getAngle();if(0!==_){u-=d,g-=c;var a=l(_),h=p(_),f=u*a-g*h;g=g*a+u*h,u=f,u+=d,g+=c}return n?u:g},t.prototype.layerToCanvas=function(e,t,n,r){var i=this.runtime.parallax_x_origin,o=this.runtime.parallax_y_origin,s=(this.layout.scrollX-i)*this.parallaxX+i,d=(this.layout.scrollY-o)*this.parallaxY+o,c=s,u=d,g=this.getAngle();if(0!==g){e-=s,t-=d;var a=l(-g),m=p(-g),_=e*a-t*m;t=t*a+e*m,e=_,e+=s,t+=d}var h=1/this.getScale(!r);r?(c-=this.runtime.draw_width*h/2,u-=this.runtime.draw_height*h/2):(c-=this.runtime.width*h/2,u-=this.runtime.height*h/2),c=(e-c)/h,u=(t-u)/h;var f=this.runtime.devicePixelRatio;return this.runtime.isRetina&&!r&&(c/=f,u/=f),n?c:u},t.prototype.rotatePt=function(e,t,n){if(0===this.getAngle())return n?e:t;var a=this.layerToCanvas(e,t,!0),r=this.layerToCanvas(e,t,!1);this.disableAngle=!0;var i=this.canvasToLayer(a,r,!0),o=this.canvasToLayer(a,r,!0);return this.disableAngle=!1,n?i:o},t.prototype.saveToJSON=function(){var e={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]},t,n,a;for(t=0,n=this.effect_types.length;t<n;t++)a=this.effect_types[t],e.fx.push({name:a.name,active:a.active,params:this.effect_params[a.index]});return e},t.prototype.loadFromJSON=function(t){var n,a,r,o;this.scale=t.s,this.angle=t.a,this.viewLeft=t.vl,this.viewTop=t.vt,this.viewRight=t.vr,this.viewBottom=t.vb,this.visible=t.v,this.background_color=t.bc,this.transparent=t.t,this.parallaxX=t.px,this.parallaxY=t.py,this.opacity=t.o,this.zoomRate=t.zr,this.created_globals=t.cg||[],cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var s=new cr.ObjectSet;for(n=0,r=this.created_globals.length;n<r;++n)s.add(this.created_globals[n]);for(n=0,a=0,r=this.initial_instances.length;n<r;++n)s.contains(this.initial_instances[n][2])||(this.initial_instances[a]=this.initial_instances[n],++a);cr.truncateArray(this.initial_instances,a);var l=t.fx;for(n=0,r=l.length;n<r;n++)o=this.getEffectByName(l[n].name),o&&(o.active=l[n].active,this.effect_params[o.index]=l[n].params);this.updateActiveEffects(),this.instances.sort(e),this.zindices_stale=!0},cr.layer=t}();(function(){function e(e,t){this.runtime=e,this.event_sheet=null,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,this.scale=1,this.angle=0,this.first_visit=!0,this.name=t[0],this.originalWidth=t[1],this.originalHeight=t[2],this.width=t[1],this.height=t[2],this.unbounded_scrolling=t[3],this.sheetname=t[4],this.sid=t[5];var n=t[6],a,r;for(this.layers=[],this.initial_types=[],(a=0,r=n.length);a<r;a++){var o=new cr.layer(this,n[a]);o.number=a,cr.seal(o),this.layers.push(o)}var s=t[7];for(this.initial_nonworld=[],a=0,r=s.length;a<r;a++){var l=s[a],p=this.runtime.types_by_index[l[1]];p.default_instance||(p.default_instance=l),this.initial_nonworld.push(l),-1===this.initial_types.indexOf(p)&&this.initial_types.push(p)}for(this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],(a=0,r=t[8].length);a<r;a++)this.effect_types.push({id:t[8][a][0],name:t[8][a][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:a}),this.effect_params.push(t[8][a][2].slice(0));this.updateActiveEffects(),this.rcTexBounce=new cr.rect(0,0,1,1),this.rcTexDest=new cr.rect(0,0,1,1),this.rcTexOrigin=new cr.rect(0,0,1,1),this.viewRect=new cr.rect(0,0,0,0),this.persist_data={}}function t(e,t){return e.zindex-t.zindex}function n(e){return e.some(function(e){return e.plugin.is_world})}var a=Math.max,r=Math.min;e.prototype.saveObjectToPersist=function(e){var t=e.type.sid.toString();this.persist_data.hasOwnProperty(t)||(this.persist_data[t]=[]);var n=this.persist_data[t];n.push(this.runtime.saveInstanceToJSON(e))},e.prototype.hasOpaqueBottomLayer=function(){var e=this.layers[0];return!e.transparent&&1===e.opacity&&!e.forceOwnTexture&&e.visible},e.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0;var e,t,n;for(e=0,t=this.effect_types.length;e<t;e++)n=this.effect_types[e],n.active&&(this.active_effect_types.push(n),!n.preservesOpaqueness&&(this.shaders_preserve_opaqueness=!1))},e.prototype.getEffectByName=function(e){var t,n,a;for(t=0,n=this.effect_types.length;t<n;t++)if(a=this.effect_types[t],a.name===e)return a;return null};var o=[];var s=!0;e.prototype.startRunning=function(){this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes()),this.runtime.running_layout=this,this.width=this.originalWidth,this.height=this.originalHeight,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2;var e,n,a,r,l,d,c,u,g,m,y,_;for(e=0,a=this.runtime.types_by_index.length;e<a;e++)if(l=this.runtime.types_by_index[e],!l.is_family)for(d=l.instances,n=0,r=d.length;n<r;n++)if(u=d[n],u.layer){var h=u.layer.number;h>=this.layers.length&&(h=this.layers.length-1),u.layer=this.layers[h],-1===u.layer.instances.indexOf(u)&&u.layer.instances.push(u),u.layer.zindices_stale=!0}if(!s)for(e=0,a=this.layers.length;e<a;++e)this.layers[e].instances.sort(t);var _;for(cr.clearArray(o),this.boundScrolling(),(e=0,a=this.layers.length);e<a;e++)_=this.layers[e],_.createInitialInstances(o),_.updateViewport(null);var f=!1;if(!this.first_visit){for(m in this.persist_data)if(this.persist_data.hasOwnProperty(m)){if(l=this.runtime.getObjectTypeBySid(parseInt(m,10)),!l||l.is_family||!this.runtime.typeHasPersistBehavior(l))continue;for(y=this.persist_data[m],e=0,a=y.length;e<a;e++)(_=null,!(l.plugin.is_world&&(_=this.getLayerBySid(y[e].w.l),!_)))&&(u=this.runtime.createInstanceFromInit(l.default_instance,_,!1,0,0,!0),this.runtime.loadInstanceFromJSON(u,y[e]),f=!0,o.push(u));cr.clearArray(y)}for(e=0,a=this.layers.length;e<a;e++)this.layers[e].instances.sort(t),this.layers[e].zindices_stale=!0}for(f&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap()),this.createAndLinkContainerInstances(o),(e=0,a=this.initial_nonworld.length);e<a;e++)c=this.initial_nonworld[e],l=this.runtime.types_by_index[c[1]],l.is_contained||(u=this.runtime.createInstanceFromInit(this.initial_nonworld[e],null,!0));if(this.runtime.changelayout=null,this.runtime.ClearDeathRow(),this.runtime.ctx)for(e=0,a=this.runtime.types_by_index.length;e<a;e++)g=this.runtime.types_by_index[e],g.is_family||!g.instances.length||!g.preloadCanvas2D||g.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,o);else for(e=0,a=o.length;e<a;e++)u=o[e],this.runtime.trigger(Object.getPrototypeOf(u.type.plugin).cnds.OnCreated,u);cr.clearArray(o),this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null),this.first_visit=!1},e.prototype.createAndLinkContainerInstances=function(e){var n,a,r,o,l,p,d;for(n=0;n<e.length;n++)if(a=e[n],a.type.is_contained)for(r=a.get_iid(),o=0,l=a.type.container.length;o<l;o++)p=a.type.container[o],a.type===p||(p.instances.length>r?a.siblings.push(p.instances[r]):!p.default_instance||(d=this.runtime.createInstanceFromInit(p.default_instance,a.layer,!0,a.x,a.y,!0),this.runtime.ClearDeathRow(),p.updateIIDs(),a.siblings.push(d),e.push(d)))},e.prototype.createGlobalNonWorlds=function(){var e=[],t,a,r,o,s;for(t=0,a=0,r=this.initial_nonworld.length;t<r;t++)o=this.initial_nonworld[t],s=this.runtime.types_by_index[o[1]],s.global?(!s.is_contained||!n(s.container))&&e.push(this.runtime.createInstanceFromInit(o,null,!0)):(this.initial_nonworld[a]=o,a++);cr.truncateArray(this.initial_nonworld,a),this.runtime.ClearDeathRow(),this.createAndLinkContainerInstances(e)},e.prototype.stopRunning=function(){this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null),this.runtime.isEndingLayout=!0,cr.clearArray(this.runtime.system.waits);var e,t,n,a,r,o,l;if(!this.first_visit)for(e=0,t=this.layers.length;e<t;e++)for(this.layers[e].updateZIndices(),r=this.layers[e].instances,(n=0,a=r.length);n<a;n++)o=r[n],!o.type.global&&this.runtime.typeHasPersistBehavior(o.type)&&this.saveObjectToPersist(o);for(e=0,t=this.layers.length;e<t;e++){for(r=this.layers[e].instances,n=0,a=r.length;n<a;n++)o=r[n],o.type.global||this.runtime.DestroyInstance(o);this.runtime.ClearDeathRow(),cr.clearArray(r),this.layers[e].zindices_stale=!0}for(e=0,t=this.runtime.types_by_index.length;e<t;e++)if(l=this.runtime.types_by_index[e],!(l.global||l.plugin.is_world||l.plugin.singleglobal||l.is_family)){for(n=0,a=l.instances.length;n<a;n++)this.runtime.DestroyInstance(l.instances[n]);this.runtime.ClearDeathRow()}s=!1,this.runtime.isEndingLayout=!1};var l=new cr.rect(0,0,0,0);e.prototype.recreateInitialObjects=function(e,t,n,a,r){l.set(t,n,a,r);var o,s;for(o=0,s=this.layers.length;o<s;o++)this.layers[o].recreateInitialObjects(e,l)},e.prototype.draw=function(e){var t=e,n=!1,a=!this.runtime.fullscreenScalingQuality,r;a&&(!this.runtime.layout_canvas&&(this.runtime.layout_canvas=document.createElement("canvas"),r=this.runtime.layout_canvas,r.width=this.runtime.draw_width,r.height=this.runtime.draw_height,this.runtime.layout_ctx=r.getContext("2d"),n=!0),r=this.runtime.layout_canvas,t=this.runtime.layout_ctx,r.width!==this.runtime.draw_width&&(r.width=this.runtime.draw_width,n=!0),r.height!==this.runtime.draw_height&&(r.height=this.runtime.draw_height,n=!0),n&&(t.imageSmoothingEnabled=this.runtime.linearSampling)),t.globalAlpha=1,t.globalCompositeOperation="source-over",this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&t.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height);var o,s,p;for(o=0,s=this.layers.length;o<s;o++)p=this.layers[o],p.visible&&0<p.opacity&&11!==p.blend_mode&&(p.instances.length||!p.transparent)?p.draw(t):p.updateViewport(null);a&&e.drawImage(r,0,0,this.runtime.width,this.runtime.height)},e.prototype.drawGL_earlyZPass=function(e){e.setEarlyZPass(!0),this.runtime.layout_tex||(this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)&&(e.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),e.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||e.setSize(this.runtime.draw_width,this.runtime.draw_height);var t,n;for(t=this.layers.length-1;0<=t;--t)n=this.layers[t],n.visible&&1===n.opacity&&n.shaders_preserve_opaqueness&&0===n.blend_mode&&(n.instances.length||!n.transparent)?n.drawGL_earlyZPass(e):n.updateViewport(null);e.setEarlyZPass(!1)},e.prototype.drawGL=function(e){var t=0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;t?(!this.runtime.layout_tex&&(this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)&&(e.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),e.setRenderingToTexture(this.runtime.layout_tex),!this.runtime.fullscreenScalingQuality&&e.setSize(this.runtime.draw_width,this.runtime.draw_height)):this.runtime.layout_tex&&(e.setRenderingToTexture(null),e.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null),this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&e.clear(0,0,0,0);var n,a,r;for(n=0,a=this.layers.length;n<a;n++)r=this.layers[n],r.visible&&0<r.opacity&&(r.instances.length||!r.transparent)?r.drawGL(e):r.updateViewport(null);if(t)if(0===this.active_effect_types.length||1===this.active_effect_types.length&&this.runtime.fullscreenScalingQuality){if(1===this.active_effect_types.length){var o=this.active_effect_types[0].index,s=this.calculateViewRect();e.switchProgram(this.active_effect_types[0].shaderindex),e.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,s.left,s.top,s.right,s.bottom,0,0,1,1,this.scale,this.angle,this.runtime.kahanTime.sum,this.effect_params[o]),e.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)}else e.switchProgram(0);this.runtime.fullscreenScalingQuality||e.setSize(this.runtime.width,this.runtime.height),e.setRenderingToTexture(null),e.setDepthTestEnabled(!1),e.setOpacity(1),e.setTexture(this.runtime.layout_tex),e.setAlphaBlend(),e.resetModelView(),e.updateModelView();var p=this.runtime.width/2,d=this.runtime.height/2;e.quad(-p,d,p,d,p,-d,-p,-d),e.setTexture(null),e.setDepthTestEnabled(!0)}else this.renderEffectChain(e,null,null,null)},e.prototype.getRenderTarget=function(){return 0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null},e.prototype.getMinLayerScale=function(){var e=this.layers[0].getScale(),t,n,a;for(t=1,n=this.layers.length;t<n;t++)a=this.layers[t],(0!==a.parallaxX||0!==a.parallaxY)&&a.getScale()<e&&(e=a.getScale());return e},e.prototype.scrollToX=function(e){if(!this.unbounded_scrolling){var t=this.runtime.draw_width*(1/this.getMinLayerScale())/2;e>this.width-t&&(e=this.width-t),e<t&&(e=t)}this.scrollX!==e&&(this.scrollX=e,this.runtime.redraw=!0)},e.prototype.scrollToY=function(e){if(!this.unbounded_scrolling){var t=this.runtime.draw_height*(1/this.getMinLayerScale())/2;e>this.height-t&&(e=this.height-t),e<t&&(e=t)}this.scrollY!==e&&(this.scrollY=e,this.runtime.redraw=!0)},e.prototype.boundScrolling=function(){this.scrollToX(this.scrollX),this.scrollToY(this.scrollY)},e.prototype.calculateViewRect=function(){var e=this.scrollX,t=this.scrollY,n=1/(this.scale*this.runtime.aspect_scale);return e-=this.runtime.width*n/2,t-=this.runtime.height*n/2,this.viewRect.set(e,t,e+this.runtime.draw_width*n,t+this.runtime.draw_height*n),this.viewRect},e.prototype.renderEffectChain=function(e,t,n,o){var s=n?n.active_effect_types:t?t.active_effect_types:this.active_effect_types,l=1,p=0,d=0,c=0,u=this.runtime.draw_width,g=this.runtime.draw_height;if(n)l=n.layer.getScale(),p=n.layer.getAngle(),d=n.layer.viewLeft,c=n.layer.viewTop,u=n.layer.viewRight,g=n.layer.viewBottom;else if(t)l=t.getScale(),p=t.getAngle(),d=t.viewLeft,c=t.viewTop,u=t.viewRight,g=t.viewBottom;else{l=this.scale,p=this.angle;var m=this.calculateViewRect();d=m.left,c=m.top,u=m.right,g=m.bottom}var _=this.runtime.fx_tex,f=0,x=1,b=this.runtime.draw_width,v=this.runtime.draw_height,w=b/2,T=v/2,S=t?t.rcTexBounce:this.rcTexBounce,O=t?t.rcTexDest:this.rcTexDest,E=t?t.rcTexOrigin:this.rcTexOrigin,C=0,A=0,P=0,I=0,L=b,R=b,k=v,F=v,B=0,j=0,N=n?n.layer.getAngle():0,D,M,V,U,G,W;if(n){for(D=0,M=s.length;D<M;D++)B+=e.getProgramBoxExtendHorizontal(s[D].shaderindex),j+=e.getProgramBoxExtendVertical(s[D].shaderindex);var X=n.bbox;if(C=t.layerToCanvas(X.left,X.top,!0,!0),P=t.layerToCanvas(X.left,X.top,!1,!0),L=t.layerToCanvas(X.right,X.bottom,!0,!0),k=t.layerToCanvas(X.right,X.bottom,!1,!0),0!==N){var z=t.layerToCanvas(X.right,X.top,!0,!0),q=t.layerToCanvas(X.right,X.top,!1,!0),Y=t.layerToCanvas(X.left,X.bottom,!0,!0),J=t.layerToCanvas(X.left,X.bottom,!1,!0);U=r(C,L,z,Y),L=a(C,L,z,Y),C=U,U=r(P,k,q,J),k=a(P,k,q,J),P=U}E.left=C/b,E.top=1-P/v,E.right=L/b,E.bottom=1-k/v,C-=B,P-=j,L+=B,k+=j,O.left=C/b,O.top=1-P/v,O.right=L/b,O.bottom=1-k/v,A=C=cr.floor(C),I=P=cr.floor(P),R=L=cr.ceil(L),F=k=cr.ceil(k),A-=B,I-=j,R+=B,F+=j,0>C&&(C=0),0>P&&(P=0),L>b&&(L=b),k>v&&(k=v),0>A&&(A=0),0>I&&(I=0),R>b&&(R=b),F>v&&(F=v),S.left=C/b,S.top=1-P/v,S.right=L/b,S.bottom=1-k/v}else S.left=O.left=E.left=0,S.top=O.top=E.top=0,S.right=O.right=E.right=1,S.bottom=O.bottom=O.bottom=1;var H=n&&(e.programUsesDest(s[0].shaderindex)||0!==B||0!==j||1!==n.opacity||n.type.plugin.must_predraw)||t&&!n&&1!==t.opacity;e.setAlphaBlend(),H&&(!_[f]&&(_[f]=e.createEmptyTexture(b,v,this.runtime.linearSampling)),(_[f].c2width!==b||_[f].c2height!==v)&&(e.deleteTexture(_[f]),_[f]=e.createEmptyTexture(b,v,this.runtime.linearSampling)),e.switchProgram(0),e.setRenderingToTexture(_[f]),W=F-I,G=v-I-W,e.clearRect(A,G,R-A,W),n?n.drawGL(e):(e.setTexture(this.runtime.layer_tex),e.setOpacity(t.opacity),e.resetModelView(),e.translate(-w,-T),e.updateModelView(),e.quadTex(C,k,L,k,L,P,C,P,S)),O.left=O.top=0,O.right=O.bottom=1,n&&(U=S.top,S.top=S.bottom,S.bottom=U),f=1,x=0),e.setOpacity(1);var V=s.length-1,K=e.programUsesCrossSampling(s[V].shaderindex)||!t&&!n&&!this.runtime.fullscreenScalingQuality,Z=0;for(D=0,M=s.length;D<M;D++){if(_[f]||(_[f]=e.createEmptyTexture(b,v,this.runtime.linearSampling)),(_[f].c2width!==b||_[f].c2height!==v)&&(e.deleteTexture(_[f]),_[f]=e.createEmptyTexture(b,v,this.runtime.linearSampling)),e.switchProgram(s[D].shaderindex),Z=s[D].index,e.programIsAnimated(s[D].shaderindex)&&(this.runtime.redraw=!0),0==D&&!H){if(e.setRenderingToTexture(_[f]),W=F-I,G=v-I-W,e.clearRect(A,G,R-A,W),n){var Q=0,$=0,ee=1,te=1,ne=1/n.width,ae=1/n.height;n.curFrame&&n.curFrame.sheetTex&&(Q=n.curFrame.sheetTex.left,$=n.curFrame.sheetTex.top,ee=n.curFrame.sheetTex.right,te=n.curFrame.sheetTex.bottom,n.curFrame.texture_img&&(ne=1/n.curFrame.texture_img.width,ae=1/n.curFrame.texture_img.height)),e.setProgramParameters(o,ne,ae,Q,$,ee,te,Q,$,ee,te,n.bbox.left,n.bbox.top,n.bbox.right,n.bbox.bottom,O.left,O.top,O.right,O.bottom,l,p,this.runtime.kahanTime.sum,n.effect_params[Z]),n.drawGL(e)}else e.setProgramParameters(o,1/b,1/v,0,0,1,1,0,0,1,1,d,c,u,g,0,0,1,1,l,p,this.runtime.kahanTime.sum,t?t.effect_params[Z]:this.effect_params[Z]),e.setTexture(t?this.runtime.layer_tex:this.runtime.layout_tex),e.resetModelView(),e.translate(-w,-T),e.updateModelView(),e.quadTex(C,k,L,k,L,P,C,P,S);O.left=O.top=0,O.right=O.bottom=1,n&&!K&&(U=k,k=P,P=U)}else e.setProgramParameters(o,1/b,1/v,0,0,1,1,E.left,E.top,E.right,E.bottom,d,c,u,g,O.left,O.top,O.right,O.bottom,l,p,this.runtime.kahanTime.sum,n?n.effect_params[Z]:t?t.effect_params[Z]:this.effect_params[Z]),e.setTexture(null),D!==V||K?(e.setRenderingToTexture(_[f]),W=F-I,G=v-I-W,e.clearRect(A,G,R-A,W)):(n?e.setBlend(n.srcBlend,n.destBlend):t&&e.setBlend(t.srcBlend,t.destBlend),e.setRenderingToTexture(o)),e.setTexture(_[x]),e.resetModelView(),e.translate(-w,-T),e.updateModelView(),e.quadTex(C,k,L,k,L,P,C,P,S),D!==V||K||e.setTexture(null);f=0==f?1:0,x=0==f?1:0}K&&(e.switchProgram(0),n?e.setBlend(n.srcBlend,n.destBlend):t?e.setBlend(t.srcBlend,t.destBlend):!this.runtime.fullscreenScalingQuality&&(e.setSize(this.runtime.width,this.runtime.height),w=this.runtime.width/2,T=this.runtime.height/2,C=0,P=0,L=this.runtime.width,k=this.runtime.height),e.setRenderingToTexture(o),e.setTexture(_[x]),e.resetModelView(),e.translate(-w,-T),e.updateModelView(),n&&1===s.length&&!H?e.quadTex(C,P,L,P,L,k,C,k,S):e.quadTex(C,k,L,k,L,P,C,P,S),e.setTexture(null))},e.prototype.getLayerBySid=function(e){var t,n;for(t=0,n=this.layers.length;t<n;t++)if(this.layers[t].sid===e)return this.layers[t];return null},e.prototype.saveToJSON=function(){var e={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}},t,n,a,r;for(t=0,n=this.effect_types.length;t<n;t++)r=this.effect_types[t],e.fx.push({name:r.name,active:r.active,params:this.effect_params[r.index]});for(t=0,n=this.layers.length;t<n;t++)a=this.layers[t],e.layers[a.sid.toString()]=a.saveToJSON();return e},e.prototype.loadFromJSON=function(e){var t,n,a,r,o;this.scrollX=e.sx,this.scrollY=e.sy,this.scale=e.s,this.angle=e.a,this.width=e.w,this.height=e.h,this.persist_data=e.persist,"undefined"!=typeof e.fv&&(this.first_visit=e.fv);var s=e.fx;for(t=0,n=s.length;t<n;t++)a=this.getEffectByName(s[t].name),a&&(a.active=s[t].active,this.effect_params[a.index]=s[t].params);this.updateActiveEffects();var l=e.layers;for(r in l)if(l.hasOwnProperty(r)){if(o=this.getLayerBySid(parseInt(r,10)),!o)continue;o.loadFromJSON(l[r])}},cr.layout=e})();(function(){function e(e,t){var n=e.length,a;switch(n){case 0:return!0;case 1:return e[0]===t[0];case 2:return e[0]===t[0]&&e[1]===t[1];default:for(a=0;a<n;a++)if(e[a]!==t[a])return!1;return!0;}}function t(e,t){return e.index-t.index}function n(n){var a,r,o,s,l;for(2===n.length?n[0].index>n[1].index&&(s=n[0],n[0]=n[1],n[1]=s):2<n.length&&n.sort(t),n.length>=_.length&&(_.length=n.length+1),_[n.length]||(_[n.length]=[]),l=_[n.length],(a=0,r=l.length);a<r;a++)if(o=l[a],e(n,o))return o;return l.push(n),n}function a(e,t){this.runtime=e,this.triggers={},this.fasttriggers={},this.hasRun=!1,this.includes=new cr.ObjectSet,this.deep_includes=[],this.already_included_sheets=[],this.name=t[0];var n=t[1];this.events=[];var a,r;for(a=0,r=n.length;a<r;a++)this.init_event(n[a],null,this.events)}function r(e){return!!(cr.plugins_.Sprite&&e===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged)}function i(e){this.type=e,this.instances=[],this.else_instances=[],this.select_all=!0}function o(e,t,n){this.sheet=e,this.parent=t,this.runtime=e.runtime,this.solModifiers=[],this.solModifiersIncludingParents=[],this.solWriterAfterCnds=!1,this.group=!1,this.initially_activated=!1,this.toplevelevent=!1,this.toplevelgroup=!1,this.has_else_block=!1,this.conditions=[],this.actions=[],this.subevents=[],this.group_name="",this.group=!1,this.initially_activated=!1,this.group_active=!1,this.contained_includes=null,3===n[0]&&(this.group_name=n[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!n[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=this),this.orblock=n[2],this.sid=n[4],this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var a=n[6],r,o;for(r=0,o=a.length;r<o;r++){var s=new cr.condition(this,a[r]);s.index=r,cr.seal(s),this.conditions.push(s),this.addSolModifier(s.type)}var l=n[7];for(r=0,o=l.length;r<o;r++){var p=new cr.action(this,l[r]);p.index=r,cr.seal(p),this.actions.push(p)}if(9===n.length){var d=n[8];for(r=0,o=d.length;r<o;r++)this.sheet.init_event(d[r],this,this.subevents)}this.is_else_block=!1,this.conditions.length&&(this.is_else_block=null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function s(e,n){var a,r,o;if(e&&(-1===n.indexOf(e)&&n.push(e),e.is_contained))for(a=0,r=e.container.length;a<r;a++)o=e.container[a],e===o||-1!==n.indexOf(o)||n.push(o)}function l(e,t){if(this.block=e,this.sheet=e.sheet,this.runtime=e.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(t[1]),this.trigger=0<t[3],this.fasttrigger=2===t[3],this.looping=t[4],this.inverted=t[5],this.isstatic=t[6],this.sid=t[7],this.runtime.cndsBySid[this.sid.toString()]=this,-1===t[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[t[0]],this.run=this.isstatic?this.run_static:this.run_object,t[2]?(this.behaviortype=this.type.getBehaviorByName(t[2]),this.beh_index=this.type.getBehaviorIndexByName(t[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&this.block.parent.setSolWriterAfterCnds()),(this.fasttrigger&&(this.run=this.run_true),10===t.length)){var n=t[9],a,r;for(a=0,r=n.length;a<r;a++){var o=new cr.parameter(this,n[a]);cr.seal(o),this.parameters.push(o)}this.results.length=n.length}}function p(e,t){if(this.block=e,this.sheet=e.sheet,this.runtime=e.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(t[1]),-1===t[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[t[0]],this.run=this.run_object,t[2]?(this.behaviortype=this.type.getBehaviorByName(t[2]),this.beh_index=this.type.getBehaviorIndexByName(t[2])):(this.behaviortype=null,this.beh_index=-1)),(this.sid=t[3],this.runtime.actsBySid[this.sid.toString()]=this,7===t.length)){var n=t[6],a,r;for(a=0,r=n.length;a<r;a++){var o=new cr.parameter(this,n[a]);cr.seal(o),this.parameters.push(o)}this.results.length=n.length}}function d(){return f++,h.length===f&&h.push(new cr.expvalue),h[f]}function c(){f--}function u(e,t){this.owner=e,this.block=e.block,this.sheet=e.sheet,this.runtime=e.runtime,this.type=t[0],this.expression=null,this.solindex=0,this.get=null,this.combosel=0,this.layout=null,this.key=0,this.object=null,this.index=0,this.varname=null,this.eventvar=null,this.fileinfo=null,this.subparams=null,this.variadicret=null,this.subparams=null,this.variadicret=null,this.variesPerInstance=!1;var n,a,r;switch(this.type){case 0:case 7:this.expression=new cr.expNode(this,t[1]),this.solindex=0,this.get=this.get_exp;break;case 1:case 14:this.expression=new cr.expNode(this,t[1]),this.solindex=0,this.get=this.get_exp_str,14===this.type&&(this.block.setAllSolModifiers(),this.owner instanceof cr.action&&this.block.setSolWriterAfterCnds());break;case 5:this.expression=new cr.expNode(this,t[1]),this.solindex=0,this.get=this.get_layer;break;case 3:case 8:this.combosel=t[1],this.get=this.get_combosel;break;case 16:this.combosel=t[1]?1:0,this.get=this.get_boolean;break;case 6:this.layout=this.runtime.layouts[t[1]];;this.get=this.get_layout;break;case 9:this.key=t[1],this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[t[1]];;this.get=this.get_object,this.block.addSolModifier(this.object),this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=t[1],e.type&&e.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=t[1],this.eventvar=null,this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=t[1],this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],(n=1,a=t.length);n<a;n++)r=new cr.parameter(this.owner,t[n]),cr.seal(r),this.subparams.push(r),this.variadicret.push(0);break;default:;}}function g(e,t,n){this.sheet=e,this.parent=t,this.runtime=e.runtime,this.solModifiers=[],this.name=n[1],this.vartype=n[2],this.initial=n[3],this.is_static=!!n[4],this.is_constant=!!n[5],this.sid=n[6],this.runtime.varsBySid[this.sid.toString()]=this,this.data=this.initial,this.parent?(this.localIndex=this.is_static||this.is_constant?-1:this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function m(e,t,n){this.sheet=e,this.parent=t,this.runtime=e.runtime,this.solModifiers=[],this.include_sheet=null,this.include_sheet_name=n[1],this.active=!0}function y(){this.temp_parents_arr=[],this.reset(null),cr.seal(this)}var _=[];a.prototype.toString=function(){return this.name},a.prototype.init_event=function(e,t,n){switch(e[0]){case 0:case 3:{var a=new cr.eventblock(this,t,e);if(cr.seal(a),a.orblock){n.push(a);var r,o;for(r=0,o=a.conditions.length;r<o;r++)a.conditions[r].trigger&&this.init_trigger(a,r)}else a.is_trigger()?this.init_trigger(a,0):n.push(a);break}case 1:{var s=new cr.eventvariable(this,t,e);cr.seal(s),n.push(s);break}case 2:{var l=new cr.eventinclude(this,t,e);cr.seal(l),n.push(l);break}default:;}},a.prototype.postInit=function(){var e,t;for(e=0,t=this.events.length;e<t;e++)this.events[e].postInit(e<t-1&&this.events[e+1].is_else_block)},a.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes),cr.clearArray(this.already_included_sheets),this.addDeepIncludes(this),cr.clearArray(this.already_included_sheets)},a.prototype.addDeepIncludes=function(e){var t=e.deep_includes,n=e.already_included_sheets,a=this.includes.valuesRef(),r,o,s,l;for(r=0,o=a.length;r<o;++r)s=a[r],l=s.include_sheet,!s.isActive()||e===l||-1<n.indexOf(l)||(n.push(l),l.addDeepIncludes(e),t.push(l))},a.prototype.run=function(e){this.runtime.resuming_breakpoint||(this.hasRun=!0,!e&&(this.runtime.isRunningEvents=!0));var t,n;for(t=0,n=this.events.length;t<n;t++){var a=this.events[t];a.run(),this.runtime.clearSol(a.solModifiers),this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}e||(this.runtime.isRunningEvents=!1)};a.prototype.init_trigger=function(e,t){e.orblock||this.runtime.triggers_to_postinit.push(e);var n=e.conditions[t],a,o,s;s=n.type?n.type.name:"system";var l=n.fasttrigger,p=l?this.fasttriggers:this.triggers;p[s]||(p[s]=[]);var d=p[s],c=n.func;if(l){if(!n.parameters.length)return;var u=n.parameters[0];if(1!==u.type||2!==u.expression.type)return;var g=u.expression.value.toLowerCase(),m,a,o;for(a=0,o=d.length;a<o;a++)if(d[a].method==c)return m=d[a].evs,void(m[g]?m[g].push([e,t]):m[g]=[[e,t]]);m={},m[g]=[[e,t]],d.push({method:c,evs:m})}else{for(a=0,o=d.length;a<o;a++)if(d[a].method==c)return void d[a].evs.push([e,t]);r(c)?d.unshift({method:c,evs:[[e,t]]}):d.push({method:c,evs:[[e,t]]})}},cr.eventsheet=a;i.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length},i.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances},i.prototype.pick_one=function(e){if(e)if(e.runtime.getCurrentEventStack().current_event.orblock){this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,e.type.instances),this.select_all=!1);var t=this.else_instances.indexOf(e);-1!==t&&(this.instances.push(this.else_instances[t]),this.else_instances.splice(t,1))}else this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=e},cr.selection=i;o.prototype.postInit=function(e){var t=this.parent,a,r;if(this.group)for(this.toplevelgroup=!0;t;){if(!t.group){this.toplevelgroup=!1;break}t=t.parent}this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup),this.has_else_block=!!e;var o=this.runtime.types_by_index;if(this.solModifiers===o)this.solModifiersIncludingParents=o;else{for(this.solModifiersIncludingParents=this.solModifiers.slice(0),t=this.parent;t;){for(a=0,r=t.solModifiers.length;a<r;a++)this.addParentSolModifier(t.solModifiers[a]);t=t.parent}this.solModifiers=n(this.solModifiers),this.solModifiersIncludingParents=n(this.solModifiersIncludingParents)}var a,r;for(a=0,r=this.conditions.length;a<r;a++)this.conditions[a].postInit();for(a=0,r=this.actions.length;a<r;a++)this.actions[a].postInit();for(a=0,r=this.subevents.length;a<r;a++)this.subevents[a].postInit(a<r-1&&this.subevents[a+1].is_else_block)},o.prototype.setGroupActive=function(e){if(this.group_active!==!!e){this.group_active=!!e;var t,n;for(t=0,n=this.contained_includes.length;t<n;++t)this.contained_includes[t].updateActive();0<n&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}};o.prototype.addSolModifier=function(e){s(e,this.solModifiers)},o.prototype.addParentSolModifier=function(e){s(e,this.solModifiersIncludingParents)},o.prototype.setAllSolModifiers=function(){this.solModifiers=this.runtime.types_by_index},o.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0,this.parent&&this.parent.setSolWriterAfterCnds()},o.prototype.is_trigger=function(){return!!this.conditions.length&&this.conditions[0].trigger},o.prototype.run=function(){var e=!1,t=this.runtime,n=this.runtime.getCurrentEventStack(),a,r,i;n.current_event=this;var o=this.conditions;if(this.is_else_block||(n.else_branch_ran=!1),this.orblock){for(0===o.length&&(e=!0),n.cndindex=0,a=o.length;n.cndindex<a;n.cndindex++)r=o[n.cndindex],r.trigger||(i=r.run(),i&&(e=!0));n.last_event_true=e,e&&this.run_actions_and_subevents()}else{for(n.cndindex=0,a=o.length;n.cndindex<a;n.cndindex++)if(i=o[n.cndindex].run(),!i)return n.last_event_true=!1,void(this.toplevelevent&&t.hasPendingInstances&&t.ClearDeathRow());n.last_event_true=!0,this.run_actions_and_subevents()}this.end_run(n)},o.prototype.end_run=function(e){e.last_event_true&&this.has_else_block&&(e.else_branch_ran=!0),this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()},o.prototype.run_orblocktrigger=function(e){var t=this.runtime.getCurrentEventStack();t.current_event=this,this.conditions[e].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)},o.prototype.run_actions_and_subevents=function(){var e=this.runtime.getCurrentEventStack(),t;for(e.actindex=0,t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},o.prototype.resume_actions_and_subevents=function(){var e=this.runtime.getCurrentEventStack(),t;for(t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},o.prototype.run_subevents=function(){if(this.subevents.length){var e=this.subevents.length-1,t,n,a,r;if(this.runtime.pushEventStack(this),this.solWriterAfterCnds)for(t=0,n=this.subevents.length;t<n;t++)a=this.subevents[t],r=!this.toplevelgroup||!this.group&&t<e,r&&this.runtime.pushCopySol(a.solModifiers),a.run(),r?this.runtime.popSol(a.solModifiers):this.runtime.clearSol(a.solModifiers);else for(t=0,n=this.subevents.length;t<n;t++)this.subevents[t].run();this.runtime.popEventStack()}},o.prototype.run_pretrigger=function(){var e=this.runtime.getCurrentEventStack();e.current_event=this;var t=!1,n;for(e.cndindex=0,n=this.conditions.length;e.cndindex<n;e.cndindex++)if(this.conditions[e.cndindex].run())t=!0;else if(!this.orblock)return!1;return!this.orblock||t},o.prototype.retrigger=function(){this.runtime.execcount++;var e=this.runtime.getCurrentEventStack().cndindex,t=this.runtime.pushEventStack(this),n;if(!this.orblock)for(t.cndindex=e+1,n=this.conditions.length;t.cndindex<n;t.cndindex++)if(!this.conditions[t.cndindex].run())return this.runtime.popEventStack(),!1;return this.run_actions_and_subevents(),this.runtime.popEventStack(),!0},o.prototype.isFirstConditionOfType=function(e){var t=e.index;if(0===t)return!0;for(--t;0<=t;--t)if(this.conditions[t].type===e.type)return!1;return!0},cr.eventblock=o;l.prototype.postInit=function(){var e,t,n;for(e=0,t=this.parameters.length;e<t;e++)n=this.parameters[e],n.postInit(),n.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},l.prototype.run_true=function(){return!0},l.prototype.run_system=function(){var e,t;for(e=0,t=this.parameters.length;e<t;e++)this.results[e]=this.parameters[e].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)},l.prototype.run_static=function(){var e,t;for(e=0,t=this.parameters.length;e<t;e++)this.results[e]=this.parameters[e].get();var n=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);return this.type.applySolToContainer(),n},l.prototype.run_object=function(){var e=this.type,t=e.getCurrentSol(),n=this.block.orblock&&!this.trigger,a=0,r=e.is_contained,o=e.is_family,l=e.family_index,d=this.beh_index,c=-1<d,u=this.anyParamVariesPerInstance,g=this.parameters,m=this.results,y=this.inverted,_=this.func,h,f,x,b,v,w,T,S,O,E,C,A,P;if(u)for(f=0,v=g.length;f<v;++f)w=g[f],w.variesPerInstance||(m[f]=w.get(0));else for(f=0,v=g.length;f<v;++f)m[f]=g[f].get(0);if(t.select_all){for(cr.clearArray(t.instances),cr.clearArray(t.else_instances),A=e.instances,(h=0,b=A.length);h<b;++h){if(O=A[h],u)for(f=0,v=g.length;f<v;++f)w=g[f],w.variesPerInstance&&(m[f]=w.get(h));c?(a=0,o&&(a=O.type.family_beh_map[l]),T=_.apply(O.behavior_insts[d+a],m)):T=_.apply(O,m),S=cr.xor(T,y),S?t.instances.push(O):n&&t.else_instances.push(O)}return e.finish&&e.finish(!0),t.select_all=!1,e.applySolToContainer(),t.hasObjects()}x=0;var I=n&&!this.block.isFirstConditionOfType(this);A=I?t.else_instances:t.instances;var L=!1;for(h=0,b=A.length;h<b;++h){if(O=A[h],u)for(f=0,v=g.length;f<v;++f)w=g[f],w.variesPerInstance&&(m[f]=w.get(h));if(c?(a=0,o&&(a=O.type.family_beh_map[l]),T=_.apply(O.behavior_insts[d+a],m)):T=_.apply(O,m),cr.xor(T,y)){if(L=!0,!I){if(A[x]=O,r)for(f=0,v=O.siblings.length;f<v;f++)E=O.siblings[f],E.type.getCurrentSol().instances[x]=E;x++}else if(t.instances.push(O),r)for(f=0,v=O.siblings.length;f<v;f++)E=O.siblings[f],E.type.getCurrentSol().instances.push(E);}else if(I){if(A[x]=O,r)for(f=0,v=O.siblings.length;f<v;f++)E=O.siblings[f],E.type.getCurrentSol().else_instances[x]=E;x++}else if(n&&(t.else_instances.push(O),r))for(f=0,v=O.siblings.length;f<v;f++)E=O.siblings[f],E.type.getCurrentSol().else_instances.push(E)}if(cr.truncateArray(A,x),r)for(P=e.container,h=0,b=P.length;h<b;h++)C=P[h].getCurrentSol(),I?cr.truncateArray(C.else_instances,x):cr.truncateArray(C.instances,x);var R=L;if(I&&!L)for(h=0,b=t.instances.length;h<b;h++){if(O=t.instances[h],u)for(f=0,v=g.length;f<v;f++)w=g[f],w.variesPerInstance&&(m[f]=w.get(h));if(T=c?_.apply(O.behavior_insts[d],m):_.apply(O,m),cr.xor(T,y)){L=!0;break}}return e.finish&&e.finish(R||n),n?L:t.hasObjects()},cr.condition=l;p.prototype.postInit=function(){var e,t,n;for(e=0,t=this.parameters.length;e<t;e++)n=this.parameters[e],n.postInit(),n.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},p.prototype.run_system=function(){var e=this.runtime,t=this.parameters,n=this.results,a,r;for(a=0,r=t.length;a<r;++a)n[a]=t[a].get();return this.func.apply(e.system,n)},p.prototype.run_object=function(){var e=this.type,t=this.beh_index,n=e.family_index,a=this.anyParamVariesPerInstance,r=this.parameters,o=this.results,s=this.func,l=e.getCurrentSol().getObjects(),d=e.is_family,c,u,g,m,y,_,h;if(a)for(u=0,m=r.length;u<m;++u)y=r[u],y.variesPerInstance||(o[u]=y.get(0));else for(u=0,m=r.length;u<m;++u)o[u]=r[u].get(0);for(c=0,g=l.length;c<g;++c){if(_=l[c],a)for(u=0,m=r.length;u<m;++u)y=r[u],y.variesPerInstance&&(o[u]=y.get(c));-1<t?(h=0,d&&(h=_.type.family_beh_map[n]),s.apply(_.behavior_insts[t+h],o)):s.apply(_,o)}return!1},cr.action=p;var h=[],f=-1;u.prototype.postInit=function(){var e,t;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type)for(e=0,t=this.subparams.length;e<t;e++)this.subparams[e].postInit();this.expression&&this.expression.postInit()},u.prototype.maybeVaryForType=function(e){return this.variesPerInstance?void 0:e?e.plugin.singleglobal?void 0:void(this.variesPerInstance=!0):void 0},u.prototype.setVaries=function(){this.variesPerInstance=!0},u.prototype.get_exp=function(e){this.solindex=e||0;var t=d();return this.expression.get(t),c(),t.data},u.prototype.get_exp_str=function(e){this.solindex=e||0;var t=d();return this.expression.get(t),c(),cr.is_string(t.data)?t.data:""},u.prototype.get_object=function(){return this.object},u.prototype.get_combosel=function(){return this.combosel},u.prototype.get_boolean=function(){return!!this.combosel},u.prototype.get_layer=function(e){this.solindex=e||0;var t=d();return this.expression.get(t),c(),t.is_number()?this.runtime.getLayerByNumber(t.data):this.runtime.getLayerByName(t.data)},u.prototype.get_layout=function(){return this.layout},u.prototype.get_key=function(){return this.key},u.prototype.get_instvar=function(){return this.index},u.prototype.get_familyvar=function(e){var t=e||0,n=this.owner.type,a=null,r=n.getCurrentSol(),i=r.getObjects();if(i.length)a=i[t%i.length].type;else if(r.else_instances.length)a=r.else_instances[t%r.else_instances.length].type;else if(n.instances.length)a=n.instances[t%n.instances.length].type;else return 0;return this.index+a.family_var_map[n.family_index]},u.prototype.get_eventvar=function(){return this.eventvar},u.prototype.get_audiofile=function(){return this.fileinfo},u.prototype.get_variadic=function(){var e,t;for(e=0,t=this.subparams.length;e<t;e++)this.variadicret[e]=this.subparams[e].get();return this.variadicret},cr.parameter=u;g.prototype.postInit=function(){this.solModifiers=n(this.solModifiers)},g.prototype.setValue=function(e){var t=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&t?(this.localIndex>=t.length&&(t.length=this.localIndex+1),t[this.localIndex]=e):this.data=e},g.prototype.getValue=function(){var e=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!e||this.is_constant?this.data:this.localIndex>=e.length?this.initial:"undefined"==typeof e[this.localIndex]?this.initial:e[this.localIndex]},g.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)},cr.eventvariable=g;m.prototype.toString=function(){return"include:"+this.include_sheet.toString()},m.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name];this.sheet.includes.add(this),this.solModifiers=n(this.solModifiers);for(var e=this.parent;e;)e.group&&e.contained_includes.push(this),e=e.parent;this.updateActive()},m.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index),this.include_sheet.hasRun||this.include_sheet.run(!0),this.parent&&this.runtime.popSol(this.runtime.types_by_index)},m.prototype.updateActive=function(){for(var e=this.parent;e;){if(e.group&&!e.group_active)return void(this.active=!1);e=e.parent}this.active=!0},m.prototype.isActive=function(){return this.active},cr.eventinclude=m;y.prototype.reset=function(e){this.current_event=e,this.cndindex=0,this.actindex=0,cr.clearArray(this.temp_parents_arr),this.last_event_true=!1,this.else_branch_ran=!1,this.any_true_state=!1},y.prototype.isModifierAfterCnds=function(){return!!this.current_event.solWriterAfterCnds||!!(this.cndindex<this.current_event.conditions.length-1)&&!!this.current_event.solModifiers.length},cr.eventStackFrame=y})(),function(){function e(e,t){this.owner=e,this.runtime=e.runtime,this.type=t[0],this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,this.eval_eventvar_exp][this.type];var n=null;switch(this.value=null,this.first=null,this.second=null,this.third=null,this.func=null,this.results=null,this.parameters=null,this.object_type=null,this.beh_index=-1,this.instance_expr=null,this.varindex=-1,this.behavior_type=null,this.varname=null,this.eventvar=null,this.return_string=!1,this.type){case 0:case 1:case 2:this.value=t[1];break;case 3:this.first=new cr.expNode(e,t[1]);break;case 18:this.first=new cr.expNode(e,t[1]),this.second=new cr.expNode(e,t[2]),this.third=new cr.expNode(e,t[3]);break;case 19:this.func=this.runtime.GetObjectReference(t[1]);;(this.func===cr.system_object.prototype.exps.random||this.func===cr.system_object.prototype.exps.choose)&&this.owner.setVaries(),this.results=[],this.parameters=[],3===t.length?(n=t[2],this.results.length=n.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[t[1]];;this.beh_index=-1,this.func=this.runtime.GetObjectReference(t[2]),this.return_string=t[3],cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&this.owner.setVaries(),this.instance_expr=t[4]?new cr.expNode(e,t[4]):null,this.results=[],this.parameters=[],6===t.length?(n=t[5],this.results.length=n.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[t[1]];;this.return_string=t[2],this.instance_expr=t[3]?new cr.expNode(e,t[3]):null,this.varindex=t[4];break;case 22:this.object_type=this.runtime.types_by_index[t[1]];;this.behavior_type=this.object_type.getBehaviorByName(t[2]);;this.beh_index=this.object_type.getBehaviorIndexByName(t[2]),this.func=this.runtime.GetObjectReference(t[3]),this.return_string=t[4],this.instance_expr=t[5]?new cr.expNode(e,t[5]):null,this.results=[],this.parameters=[],7===t.length?(n=t[6],this.results.length=n.length+1):this.results.length=1;break;case 23:this.varname=t[1],this.eventvar=null;}if(this.owner.maybeVaryForType(this.object_type),4<=this.type&&17>=this.type&&(this.first=new cr.expNode(e,t[1]),this.second=new cr.expNode(e,t[2])),n){var a,r;for(a=0,r=n.length;a<r;a++)this.parameters.push(new cr.expNode(e,n[a]))}cr.seal(this)}function t(){return++s,o.length===s&&o.push(new cr.expvalue),o[s]}function n(){--s}function a(e,t,n){var a,r;for(a=0,r=e.length;a<r;++a)e[a].get(n),t[a+1]=n.data}function r(e,t){this.type=e||cr.exptype.Integer,this.data=t||0,this.object_class=null;this.type==cr.exptype.Integer&&(this.data=i(this.data)),cr.seal(this)}var i=Math.floor;e.prototype.postInit=function(){if(23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent)),this.first&&this.first.postInit(),this.second&&this.second.postInit(),this.third&&this.third.postInit(),this.instance_expr&&this.instance_expr.postInit(),this.parameters){var e,t;for(e=0,t=this.parameters.length;e<t;e++)this.parameters[e].postInit()}};var o=[],s=-1;e.prototype.eval_system_exp=function(e){var r=this.parameters,i=this.results;i[0]=e;var o=t();a(r,i,o),n(),this.func.apply(this.runtime.system,i)},e.prototype.eval_object_exp=function(e){var r=this.object_type,i=this.results,o=this.parameters,s=this.instance_expr,l=this.func,p=this.owner.solindex,d=r.getCurrentSol(),c=d.getObjects();if(!c.length)if(d.else_instances.length)c=d.else_instances;else return void(this.return_string?e.set_string(""):e.set_int(0));i[0]=e,e.object_class=r;var u=t();a(o,i,u),s&&(s.get(u),u.is_number()&&(p=u.data,c=r.instances)),n();var g=c.length;(p>=g||p<=-g)&&(p%=g),0>p&&(p+=g);l.apply(c[p],i)},e.prototype.eval_behavior_exp=function(e){var r=this.object_type,i=this.results,o=this.parameters,s=this.instance_expr,l=this.beh_index,p=this.func,d=this.owner.solindex,c=r.getCurrentSol(),u=c.getObjects();if(!u.length)if(c.else_instances.length)u=c.else_instances;else return void(this.return_string?e.set_string(""):e.set_int(0));i[0]=e,e.object_class=r;var g=t();a(o,i,g),s&&(s.get(g),g.is_number()&&(d=g.data,u=r.instances)),n();var m=u.length;(d>=m||d<=-m)&&(d%=m),0>d&&(d+=m);var y=u[d],_=0;r.is_family&&(_=y.type.family_beh_map[r.family_index]);p.apply(y.behavior_insts[l+_],i)},e.prototype.eval_instvar_exp=function(e){var a=this.instance_expr,r=this.object_type,i=this.varindex,o=this.owner.solindex,s=r.getCurrentSol(),l=s.getObjects(),p;if(!l.length)if(s.else_instances.length)l=s.else_instances;else return void(this.return_string?e.set_string(""):e.set_int(0));if(a){var d=t();if(a.get(d),d.is_number()){o=d.data;var c=r.instances;0!==c.length&&(o%=c.length,0>o&&(o+=c.length)),p=r.getInstanceByIID(o);var u=p.instance_vars[i];return cr.is_string(u)?e.set_string(u):e.set_float(u),void n()}n()}var g=l.length;(o>=g||o<=-g)&&(o%=g),0>o&&(o+=g),p=l[o];var m=0;r.is_family&&(m=p.type.family_var_map[r.family_index]);var u=p.instance_vars[i+m];cr.is_string(u)?e.set_string(u):e.set_float(u)},e.prototype.eval_int=function(e){e.type=cr.exptype.Integer,e.data=this.value},e.prototype.eval_float=function(e){e.type=cr.exptype.Float,e.data=this.value},e.prototype.eval_string=function(e){e.type=cr.exptype.String,e.data=this.value},e.prototype.eval_unaryminus=function(e){this.first.get(e),e.is_number()&&(e.data=-e.data)},e.prototype.eval_add=function(e){this.first.get(e);var a=t();this.second.get(a),e.is_number()&&a.is_number()&&(e.data+=a.data,a.is_float()&&e.make_float()),n()},e.prototype.eval_subtract=function(e){this.first.get(e);var a=t();this.second.get(a),e.is_number()&&a.is_number()&&(e.data-=a.data,a.is_float()&&e.make_float()),n()},e.prototype.eval_multiply=function(e){this.first.get(e);var a=t();this.second.get(a),e.is_number()&&a.is_number()&&(e.data*=a.data,a.is_float()&&e.make_float()),n()},e.prototype.eval_divide=function(e){this.first.get(e);var a=t();this.second.get(a),e.is_number()&&a.is_number()&&(e.data/=a.data,e.make_float()),n()},e.prototype.eval_mod=function(e){this.first.get(e);var a=t();this.second.get(a),e.is_number()&&a.is_number()&&(e.data%=a.data,a.is_float()&&e.make_float()),n()},e.prototype.eval_power=function(e){this.first.get(e);var a=t();this.second.get(a),e.is_number()&&a.is_number()&&(e.data=Math.pow(e.data,a.data),a.is_float()&&e.make_float()),n()},e.prototype.eval_and=function(e){this.first.get(e);var a=t();this.second.get(a),a.is_string()||e.is_string()?this.eval_and_stringconcat(e,a):this.eval_and_logical(e,a),n()},e.prototype.eval_and_stringconcat=function(e,t){e.is_string()&&t.is_string()?this.eval_and_stringconcat_str_str(e,t):this.eval_and_stringconcat_num(e,t)},e.prototype.eval_and_stringconcat_str_str=function(e,t){e.data+=t.data},e.prototype.eval_and_stringconcat_num=function(e,t){e.is_string()?e.data+=(Math.round(1e10*t.data)/1e10).toString():e.set_string(e.data.toString()+t.data)},e.prototype.eval_and_logical=function(e,t){e.set_int(e.data&&t.data?1:0)},e.prototype.eval_or=function(e){this.first.get(e);var a=t();this.second.get(a),e.is_number()&&a.is_number()&&(e.data||a.data?e.set_int(1):e.set_int(0)),n()},e.prototype.eval_conditional=function(e){this.first.get(e),e.data?this.second.get(e):this.third.get(e)},e.prototype.eval_equal=function(e){this.first.get(e);var a=t();this.second.get(a),e.set_int(e.data===a.data?1:0),n()},e.prototype.eval_notequal=function(e){this.first.get(e);var a=t();this.second.get(a),e.set_int(e.data===a.data?0:1),n()},e.prototype.eval_less=function(e){this.first.get(e);var a=t();this.second.get(a),e.set_int(e.data<a.data?1:0),n()},e.prototype.eval_lessequal=function(e){this.first.get(e);var a=t();this.second.get(a),e.set_int(e.data<=a.data?1:0),n()},e.prototype.eval_greater=function(e){this.first.get(e);var a=t();this.second.get(a),e.set_int(e.data>a.data?1:0),n()},e.prototype.eval_greaterequal=function(e){this.first.get(e);var a=t();this.second.get(a),e.set_int(e.data>=a.data?1:0),n()},e.prototype.eval_eventvar_exp=function(e){var t=this.eventvar.getValue();"number"==typeof t?e.set_float(t):"boolean"==typeof t?e.set_int(t?1:0):e.set_string(t)},cr.expNode=e;r.prototype.is_int=function(){return this.type===cr.exptype.Integer},r.prototype.is_float=function(){return this.type===cr.exptype.Float},r.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float},r.prototype.is_string=function(){return this.type===cr.exptype.String},r.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=i(this.data):this.is_string()&&(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)},r.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)},r.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)},r.prototype.set_int=function(e){this.type=cr.exptype.Integer,this.data=i(e)},r.prototype.set_float=function(e){this.type=cr.exptype.Float,this.data=e},r.prototype.set_string=function(e){this.type=cr.exptype.String,this.data=e},r.prototype.set_any=function(e){cr.is_number(e)?(this.type=cr.exptype.Float,this.data=e):cr.is_string(e)?(this.type=cr.exptype.String,this.data=e.toString()):(this.type=cr.exptype.Integer,this.data=0)},cr.expvalue=r,cr.exptype={Integer:0,Float:1,String:2}}();cr.system_object=function(e){this.runtime=e,this.waits=[]},cr.system_object.prototype.saveToJSON=function(){var e={},n,a,r,o,s,l,d,c;e.waits=[];var u=e.waits,g;for(n=0,a=this.waits.length;n<a;n++){for(l=this.waits[n],g={t:l.time,st:l.signaltag,s:l.signalled,ev:l.ev.sid,sm:[],sols:{}},l.ev.actions[l.actindex]&&(g.act=l.ev.actions[l.actindex].sid),(r=0,o=l.solModifiers.length);r<o;r++)g.sm.push(l.solModifiers[r].sid);for(s in l.sols)if(l.sols.hasOwnProperty(s)){d=this.runtime.types_by_index[parseInt(s,10)];for(c={sa:l.sols[s].sa,insts:[]},r=0,o=l.sols[s].insts.length;r<o;r++)c.insts.push(l.sols[s].insts[r].uid);g.sols[d.sid.toString()]=c}u.push(g)}return e},cr.system_object.prototype.loadFromJSON=function(n){var a=n.waits,r,o,s,l,d,c,u,g,m,y,_,h,f;for(cr.clearArray(this.waits),r=0,o=a.length;r<o;r++)if(c=a[r],g=this.runtime.blocksBySid[c.ev.toString()],g){for(m=-1,s=0,l=g.actions.length;s<l;s++)if(g.actions[s].sid===c.act){m=s;break}if(-1!==m){for(u={},u.sols={},u.solModifiers=[],u.deleteme=!1,u.time=c.t,u.signaltag=c.st||"",u.signalled=!!c.s,u.ev=g,u.actindex=m,(s=0,l=c.sm.length);s<l;s++)y=this.runtime.getObjectTypeBySid(c.sm[s]),y&&u.solModifiers.push(y);for(d in c.sols)if(c.sols.hasOwnProperty(d)){if(y=this.runtime.getObjectTypeBySid(parseInt(d,10)),!y)continue;for(_=c.sols[d],h={sa:_.sa,insts:[]},(s=0,l=_.insts.length);s<l;s++)f=this.runtime.getObjectByUID(_.insts[s]),f&&h.insts.push(f);u.sols[y.index.toString()]=h}this.waits.push(u)}}},function(){function e(){}function t(e,t){var n=e.extra.c2_feo_val,a=t.extra.c2_feo_val;return cr.is_number(n)&&cr.is_number(a)?n-a:(n=""+n,a=""+a,n<a?-1:n>a?1:0)}function n(e,t){return f&&e===x&&t===b||(f=new RegExp(e,t),x=e,b=t),f.lastIndex=0,f}function a(){}function r(){var e;return T.length?e=T.pop():(e={},e.sols={},e.solModifiers=[]),e.deleteme=!1,e}function o(e){cr.wipe(e.sols),cr.clearArray(e.solModifiers),T.push(e)}function l(){var e;return w.length?e=w.pop():(e={},e.insts=[]),e.sa=!1,e}function i(e){cr.clearArray(e.insts),w.push(e)}function s(e,t){var n=e[0],a=t[0],r=n-a;if(0!=r)return r;var i=e[1],o=t[1];return i-o}function p(e,t){return e[1]-t[1]}function d(){}function c(e,t,a){if(e!==O||t!==E||a!==C){var r=n(t,a);S=e.match(r),O=e,E=t,C=a}}var u=Math.log,g=Math.round,m=Math.floor,y=cr.system_object.prototype;e.prototype.EveryTick=function(){return!0},e.prototype.OnLayoutStart=function(){return!0},e.prototype.OnLayoutEnd=function(){return!0},e.prototype.Compare=function(e,t,n){return cr.do_cmp(e,t,n)},e.prototype.CompareTime=function(e,n){var t=this.runtime.kahanTime.sum;if(0===e){var a=this.runtime.getCurrentCondition();return!(a.extra.CompareTime_executed||!(t>=n))&&(a.extra.CompareTime_executed=!0,!0)}return cr.do_cmp(t,e,n)},e.prototype.LayerVisible=function(e){return!!e&&e.visible},e.prototype.LayerEmpty=function(e){return!!e&&!e.instances.length},e.prototype.LayerCmpOpacity=function(e,t,n){return!!e&&cr.do_cmp(100*e.opacity,t,n)},e.prototype.Repeat=function(e){var t=this.runtime.getCurrentEventStack(),n=t.current_event,a=t.isModifierAfterCnds(),r=this.runtime.pushLoopStack(),o;if(a)for(o=0;o<e&&!r.stopped;o++)this.runtime.pushCopySol(n.solModifiers),r.index=o,n.retrigger(),this.runtime.popSol(n.solModifiers);else for(o=0;o<e&&!r.stopped;o++)r.index=o,n.retrigger();return this.runtime.popLoopStack(),!1},e.prototype.While=function(){var e=this.runtime.getCurrentEventStack(),t=e.current_event,n=e.isModifierAfterCnds(),a=this.runtime.pushLoopStack(),r;if(n)for(r=0;!a.stopped;r++)this.runtime.pushCopySol(t.solModifiers),a.index=r,t.retrigger()||(a.stopped=!0),this.runtime.popSol(t.solModifiers);else for(r=0;!a.stopped;r++)a.index=r,t.retrigger()||(a.stopped=!0);return this.runtime.popLoopStack(),!1},e.prototype.For=function(e,t,n){var a=this.runtime.getCurrentEventStack(),r=a.current_event,o=a.isModifierAfterCnds(),s=this.runtime.pushLoopStack(e),l;if(n<t){if(o)for(l=t;l>=n&&!s.stopped;--l)this.runtime.pushCopySol(r.solModifiers),s.index=l,r.retrigger(),this.runtime.popSol(r.solModifiers);else for(l=t;l>=n&&!s.stopped;--l)s.index=l,r.retrigger();}else if(o)for(l=t;l<=n&&!s.stopped;++l)this.runtime.pushCopySol(r.solModifiers),s.index=l,r.retrigger(),this.runtime.popSol(r.solModifiers);else for(l=t;l<=n&&!s.stopped;++l)s.index=l,r.retrigger();return this.runtime.popLoopStack(),!1};var _=[],h=-1;e.prototype.ForEach=function(e){var t=e.getCurrentSol();h++,_.length===h&&_.push([]);var n=_[h];cr.shallowAssignArray(n,t.getObjects());var a=this.runtime.getCurrentEventStack(),r=a.current_event,o=a.isModifierAfterCnds(),l=this.runtime.pushLoopStack(),p=e.is_contained,d,c,u,g,m,y,f;if(o)for(d=0,c=n.length;d<c&&!l.stopped;d++){if(this.runtime.pushCopySol(r.solModifiers),m=n[d],t=e.getCurrentSol(),t.select_all=!1,cr.clearArray(t.instances),t.instances[0]=m,p)for(u=0,g=m.siblings.length;u<g;u++)y=m.siblings[u],f=y.type.getCurrentSol(),f.select_all=!1,cr.clearArray(f.instances),f.instances[0]=y;l.index=d,r.retrigger(),this.runtime.popSol(r.solModifiers)}else for(t.select_all=!1,cr.clearArray(t.instances),(d=0,c=n.length);d<c&&!l.stopped;d++){if(m=n[d],t.instances[0]=m,p)for(u=0,g=m.siblings.length;u<g;u++)y=m.siblings[u],f=y.type.getCurrentSol(),f.select_all=!1,cr.clearArray(f.instances),f.instances[0]=y;l.index=d,r.retrigger()}return cr.clearArray(n),this.runtime.popLoopStack(),h--,!1};e.prototype.ForEachOrdered=function(e,n,a){var r=e.getCurrentSol();h++,_.length===h&&_.push([]);var o=_[h];cr.shallowAssignArray(o,r.getObjects());var l=this.runtime.getCurrentEventStack(),p=l.current_event,d=this.runtime.getCurrentCondition(),c=l.isModifierAfterCnds(),u=this.runtime.pushLoopStack(),g,m,y,f,x,b,v;for(g=0,m=o.length;g<m;g++)o[g].extra.c2_feo_val=d.parameters[1].get(g);o.sort(t),1===a&&o.reverse();var w=e.is_contained;if(c)for(g=0,m=o.length;g<m&&!u.stopped;g++){if(this.runtime.pushCopySol(p.solModifiers),x=o[g],r=e.getCurrentSol(),r.select_all=!1,cr.clearArray(r.instances),r.instances[0]=x,w)for(y=0,f=x.siblings.length;y<f;y++)b=x.siblings[y],v=b.type.getCurrentSol(),v.select_all=!1,cr.clearArray(v.instances),v.instances[0]=b;u.index=g,p.retrigger(),this.runtime.popSol(p.solModifiers)}else for(r.select_all=!1,cr.clearArray(r.instances),(g=0,m=o.length);g<m&&!u.stopped;g++){if(x=o[g],r.instances[0]=x,w)for(y=0,f=x.siblings.length;y<f;y++)b=x.siblings[y],v=b.type.getCurrentSol(),v.select_all=!1,cr.clearArray(v.instances),v.instances[0]=b;u.index=g,p.retrigger()}return cr.clearArray(o),this.runtime.popLoopStack(),h--,!1},e.prototype.PickByComparison=function(e,t,n,a){var r,o,s,l;if(e){h++,_.length===h&&_.push([]);var p=_[h],d=e.getCurrentSol();cr.shallowAssignArray(p,d.getObjects()),d.select_all&&cr.clearArray(d.else_instances);var c=this.runtime.getCurrentCondition();for(r=0,s=0,o=p.length;r<o;r++)l=p[r],p[s]=l,t=c.parameters[1].get(r),a=c.parameters[3].get(r),cr.do_cmp(t,n,a)?s++:d.else_instances.push(l);return cr.truncateArray(p,s),d.select_all=!1,cr.shallowAssignArray(d.instances,p),cr.clearArray(p),h--,e.applySolToContainer(),!!d.instances.length}},e.prototype.PickByEvaluate=function(e,t){var n,a,r,o;if(e){h++,_.length===h&&_.push([]);var s=_[h],l=e.getCurrentSol();cr.shallowAssignArray(s,l.getObjects()),l.select_all&&cr.clearArray(l.else_instances);var p=this.runtime.getCurrentCondition();for(n=0,r=0,a=s.length;n<a;n++)o=s[n],s[r]=o,t=p.parameters[1].get(n),t?r++:l.else_instances.push(o);return cr.truncateArray(s,r),l.select_all=!1,cr.shallowAssignArray(l.instances,s),cr.clearArray(s),h--,e.applySolToContainer(),!!l.instances.length}},e.prototype.TriggerOnce=function(){var e=this.runtime.getCurrentCondition().extra;"undefined"==typeof e.TriggerOnce_lastTick&&(e.TriggerOnce_lastTick=-1);var t=e.TriggerOnce_lastTick,n=this.runtime.tickcount;return e.TriggerOnce_lastTick=n,this.runtime.layout_first_tick||t!==n-1},e.prototype.Every=function(e){var t=this.runtime.getCurrentCondition(),n=t.extra.Every_lastTime||0,a=this.runtime.kahanTime.sum;"undefined"==typeof t.extra.Every_seconds&&(t.extra.Every_seconds=e);var r=t.extra.Every_seconds;return a>=n+r?(t.extra.Every_lastTime=n+r,a>=t.extra.Every_lastTime+.04&&(t.extra.Every_lastTime=a),t.extra.Every_seconds=e,!0):(a<n-.1&&(t.extra.Every_lastTime=a),!1)},e.prototype.PickNth=function(e,t){if(!e)return!1;var n=e.getCurrentSol(),a=n.getObjects();if(t=cr.floor(t),0>t||t>=a.length)return!1;var r=a[t];return n.pick_one(r),e.applySolToContainer(),!0},e.prototype.PickRandom=function(e){if(!e)return!1;var t=e.getCurrentSol(),n=t.getObjects(),a=cr.floor(Math.random()*n.length);if(a>=n.length)return!1;var r=n[a];return t.pick_one(r),e.applySolToContainer(),!0},e.prototype.CompareVar=function(e,t,n){return cr.do_cmp(e.getValue(),t,n)},e.prototype.CompareBoolVar=function(e){return e.getValue()},e.prototype.IsGroupActive=function(e){var t=this.runtime.groups_by_name[e.toLowerCase()];return t&&t.group_active},e.prototype.IsPreview=function(){return this.runtime.isPreview},e.prototype.PickAll=function(e){if(!e)return!1;if(!e.instances.length)return!1;var t=e.getCurrentSol();return t.select_all=!0,e.applySolToContainer(),!0},e.prototype.IsMobile=function(){return this.runtime.isMobile},e.prototype.CompareBetween=function(e,t,n){return e>=t&&e<=n},e.prototype.Else=function(){var e=this.runtime.getCurrentEventStack();return!e.else_branch_ran&&!e.last_event_true},e.prototype.OnLoadFinished=function(){return!0},e.prototype.OnCanvasSnapshot=function(){return!0},e.prototype.EffectsSupported=function(){return!!this.runtime.glwrap},e.prototype.OnSaveComplete=function(){return!0},e.prototype.OnSaveFailed=function(){return!0},e.prototype.OnLoadComplete=function(){return!0},e.prototype.OnLoadFailed=function(){return!0},e.prototype.ObjectUIDExists=function(e){return!!this.runtime.getObjectByUID(e)},e.prototype.IsOnPlatform=function(e){var t=this.runtime;return 0===e?!t.isNodeWebkit&&!t.isCordova&&!t.isWinJS&&!t.isWindowsPhone8&&!t.isBlackberry10&&!t.isAmazonWebApp:1===e?t.isiOS:2===e?t.isAndroid:3===e?t.isWindows8App:4===e?t.isWindowsPhone8:5===e?t.isBlackberry10:6===e?t.isTizen:7!=e&&(8===e?t.isCordova:9===e?t.isArcade:10===e?t.isNodeWebkit:11===e?t.isCrosswalk:12===e?t.isAmazonWebApp:!(13!=e)&&t.isWindows10)};var f=null,x="",b="";e.prototype.RegexTest=function(e,t,a){var r=n(t,a);return r.test(e)};var v=[];e.prototype.PickOverlappingPoint=function(e,t,n){if(!e)return!1;var a=e.getCurrentSol(),r=a.getObjects(),o=this.runtime.getCurrentEventStack().current_event,s=o.orblock,l=this.runtime.getCurrentCondition(),p,d,c,u;for(a.select_all?(cr.shallowAssignArray(v,r),cr.clearArray(a.else_instances),a.select_all=!1,cr.clearArray(a.instances)):s?(cr.shallowAssignArray(v,a.else_instances),cr.clearArray(a.else_instances)):(cr.shallowAssignArray(v,r),cr.clearArray(a.instances)),p=0,d=v.length;p<d;++p)c=v[p],c.update_bbox(),u=cr.xor(c.contains_pt(t,n),l.inverted),u?a.instances.push(c):a.else_instances.push(c);return e.applySolToContainer(),cr.xor(!!a.instances.length,l.inverted)},e.prototype.PickLastCreated=function(e){if(!e)return!1;var t=this.runtime.createRow,n=null,a=e.is_family,r,o;for(r=t.length-1;0<=r;--r)if(o=t[r],a){if(0<=o.type.families.indexOf(e)){n=o;break}}else if(o.type===e){n=o;break}if(!n&&e.instances.length&&(n=e.instances[e.instances.length-1]),!n)return!1;var s=e.getCurrentSol();return s.pick_one(n),e.applySolToContainer(),!0},e.prototype.IsNaN=function(e){return!!isNaN(e)},e.prototype.AngleWithin=function(e,t,n){return cr.angleDiff(cr.to_radians(e),cr.to_radians(n))<=cr.to_radians(t)},e.prototype.IsClockwiseFrom=function(e,t){return cr.angleClockwise(cr.to_radians(e),cr.to_radians(t))},e.prototype.IsBetweenAngles=function(e,t,n){var a=cr.to_clamped_radians(e),r=cr.to_clamped_radians(t),i=cr.to_clamped_radians(n),o=!cr.angleClockwise(i,r);return o?cr.angleClockwise(a,r)||!cr.angleClockwise(a,i):cr.angleClockwise(a,r)&&!cr.angleClockwise(a,i)},e.prototype.IsValueType=function(e,n){return"number"==typeof e?0===n:1===n},y.cnds=new e;a.prototype.GoToLayout=function(e){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=e)},a.prototype.NextPrevLayout=function(e){if(!this.runtime.isloading&&!this.runtime.changelayout){var t=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if(!(e&&0===t)&&(e||t!==this.runtime.layouts_by_index.length-1)){var n=this.runtime.layouts_by_index[t+(e?-1:1)];this.runtime.changelayout=n}}},a.prototype.CreateObject=function(e,t,n,a){if(t&&e){var r=this.runtime.createInstance(e,t,n,a);if(r){this.runtime.isInOnDestroy++;var o,l,p;if(this.runtime.trigger(Object.getPrototypeOf(e.plugin).cnds.OnCreated,r),r.is_contained)for(o=0,l=r.siblings.length;o<l;o++)p=r.siblings[o],this.runtime.trigger(Object.getPrototypeOf(p.type.plugin).cnds.OnCreated,p);this.runtime.isInOnDestroy--;var d=e.getCurrentSol();if(d.select_all=!1,cr.clearArray(d.instances),d.instances[0]=r,r.is_contained)for(o=0,l=r.siblings.length;o<l;o++)p=r.siblings[o],d=p.type.getCurrentSol(),d.select_all=!1,cr.clearArray(d.instances),d.instances[0]=p}}},a.prototype.CreateObjectByName=function(e,t,n,r){if(t&&e){var i=this.runtime.types_lowercase[e.toLowerCase()];i&&a.prototype.CreateObject.call(this,i,t,n,r)}},a.prototype.SetLayerVisible=function(e,t){e&&(e.visible===t||(e.visible=t,this.runtime.redraw=!0))},a.prototype.SetLayerOpacity=function(e,t){e&&(t=cr.clamp(t/100,0,1),e.opacity!==t&&(e.opacity=t,this.runtime.redraw=!0))},a.prototype.SetLayerScaleRate=function(e,t){e&&(e.zoomRate===t||(e.zoomRate=t,this.runtime.redraw=!0))},a.prototype.SetLayerForceOwnTexture=function(e,t){e&&(t=!!t,e.forceOwnTexture!==t&&(e.forceOwnTexture=t,this.runtime.redraw=!0))},a.prototype.SetLayoutScale=function(e){this.runtime.running_layout&&(this.runtime.running_layout.scale===e||(this.runtime.running_layout.scale=e,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0))},a.prototype.ScrollX=function(e){this.runtime.running_layout.scrollToX(e)},a.prototype.ScrollY=function(e){this.runtime.running_layout.scrollToY(e)},a.prototype.Scroll=function(e,t){this.runtime.running_layout.scrollToX(e),this.runtime.running_layout.scrollToY(t)},a.prototype.ScrollToObject=function(e){var t=e.getFirstPicked();t&&(this.runtime.running_layout.scrollToX(t.x),this.runtime.running_layout.scrollToY(t.y))},a.prototype.SetVar=function(e,t){0===e.vartype?cr.is_number(t)?e.setValue(t):e.setValue(parseFloat(t)):1===e.vartype&&e.setValue(t.toString())},a.prototype.AddVar=function(e,t){0===e.vartype?cr.is_number(t)?e.setValue(e.getValue()+t):e.setValue(e.getValue()+parseFloat(t)):1===e.vartype&&e.setValue(e.getValue()+t.toString())},a.prototype.SubVar=function(e,t){0===e.vartype&&(cr.is_number(t)?e.setValue(e.getValue()-t):e.setValue(e.getValue()-parseFloat(t)))},a.prototype.SetBoolVar=function(e,t){e.setValue(0!==t)},a.prototype.ToggleBoolVar=function(e){e.setValue(!e.getValue())},a.prototype.SetGroupActive=function(e,t){var n=this.runtime.groups_by_name[e.toLowerCase()];n&&(0===t?n.setGroupActive(!1):1===t?n.setGroupActive(!0):2===t?n.setGroupActive(!n.group_active):void 0)},a.prototype.SetTimescale=function(e){var t=e;0>t&&(t=0),this.runtime.timescale=t},a.prototype.SetObjectTimescale=function(e,t){var n=t;if(0>n&&(n=0),!!e){var a=e.getCurrentSol(),r=a.getObjects(),o,s;for(o=0,s=r.length;o<s;o++)r[o].my_timescale=n}},a.prototype.RestoreObjectTimescale=function(e){if(!e)return!1;var t=e.getCurrentSol(),n=t.getObjects(),a,r;for(a=0,r=n.length;a<r;a++)n[a].my_timescale=-1};var T=[];var w=[];a.prototype.Wait=function(e){if(!(0>e)){var n=this.runtime.getCurrentEventStack(),a=r(),o,p,d,c,u;for(a.time=this.runtime.kahanTime.sum+e,a.signaltag="",a.signalled=!1,a.ev=n.current_event,a.actindex=n.actindex+1,(o=0,p=this.runtime.types_by_index.length);o<p;o++)c=this.runtime.types_by_index[o],d=c.getCurrentSol(),d.select_all&&-1===n.current_event.solModifiers.indexOf(c)||(a.solModifiers.push(c),u=l(),u.sa=d.select_all,cr.shallowAssignArray(u.insts,d.instances),a.sols[o.toString()]=u);return this.waits.push(a),!0}},a.prototype.WaitForSignal=function(e){var n=this.runtime.getCurrentEventStack(),a=r(),o,p,d,c,u;for(a.time=-1,a.signaltag=e.toLowerCase(),a.signalled=!1,a.ev=n.current_event,a.actindex=n.actindex+1,(o=0,p=this.runtime.types_by_index.length);o<p;o++)c=this.runtime.types_by_index[o],d=c.getCurrentSol(),d.select_all&&-1===n.current_event.solModifiers.indexOf(c)||(a.solModifiers.push(c),u=l(),u.sa=d.select_all,cr.shallowAssignArray(u.insts,d.instances),a.sols[o.toString()]=u);return this.waits.push(a),!0},a.prototype.Signal=function(e){var t=e.toLowerCase(),n,a,r;for(n=0,a=this.waits.length;n<a;++n)r=this.waits[n],-1===r.time&&r.signaltag===t&&(r.signalled=!0)},a.prototype.SetLayerScale=function(e,t){e&&e.scale!==t&&(e.scale=t,this.runtime.redraw=!0)},a.prototype.ResetGlobals=function(){var e,t,n;for(e=0,t=this.runtime.all_global_vars.length;e<t;e++)n=this.runtime.all_global_vars[e],n.data=n.initial},a.prototype.SetLayoutAngle=function(e){e=cr.to_radians(e),e=cr.clamp_angle(e),this.runtime.running_layout&&this.runtime.running_layout.angle!==e&&(this.runtime.running_layout.angle=e,this.runtime.redraw=!0)},a.prototype.SetLayerAngle=function(e,t){e&&(t=cr.to_radians(t),t=cr.clamp_angle(t),e.angle===t||(e.angle=t,this.runtime.redraw=!0))},a.prototype.SetLayerParallax=function(e,t,n){if(e&&(e.parallaxX!==t/100||e.parallaxY!==n/100)){if(e.parallaxX=t/100,e.parallaxY=n/100,1!==e.parallaxX||1!==e.parallaxY){var a=e.instances,r,o;for(r=0,o=a.length;r<o;++r)a[r].type.any_instance_parallaxed=!0}this.runtime.redraw=!0}},a.prototype.SetLayerBackground=function(e,t){if(e){var n=cr.clamp(m(255*cr.GetRValue(t)),0,255),a=cr.clamp(m(255*cr.GetGValue(t)),0,255),r=cr.clamp(m(255*cr.GetBValue(t)),0,255);e.background_color[0]===n&&e.background_color[1]===a&&e.background_color[2]===r||(e.background_color[0]=n,e.background_color[1]=a,e.background_color[2]=r,this.runtime.redraw=!0)}},a.prototype.SetLayerTransparent=function(e,n){e&&!!n!=!!e.transparent&&(e.transparent=!!n,this.runtime.redraw=!0)},a.prototype.SetLayerBlendMode=function(e,t){e&&e.blend_mode!==t&&(e.blend_mode=t,e.compositeOp=cr.effectToCompositeOp(e.blend_mode),this.runtime.gl&&cr.setGLBlend(e,e.blend_mode,this.runtime.gl),this.runtime.redraw=!0)},a.prototype.StopLoop=function(){0>this.runtime.loop_stack_index||(this.runtime.getCurrentLoop().stopped=!0)},a.prototype.GoToLayoutByName=function(e){if(!this.runtime.isloading&&!this.runtime.changelayout){for(var t in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(t)&&cr.equals_nocase(t,e))return void(this.runtime.changelayout=this.runtime.layouts[t])}},a.prototype.RestartLayout=function(){if(!this.runtime.isloading&&!this.runtime.changelayout&&this.runtime.running_layout){this.runtime.changelayout=this.runtime.running_layout;var e,t,n;for(e=0,t=this.runtime.allGroups.length;e<t;e++)n=this.runtime.allGroups[e],n.setGroupActive(n.initially_activated)}},a.prototype.SnapshotCanvas=function(e,t){this.runtime.doCanvasSnapshot(0===e?"image/png":"image/jpeg",t/100)},a.prototype.SetCanvasSize=function(e,t){if(!(0>=e||0>=t)){var n=this.runtime.fullscreen_mode,a=document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen;a&&0<this.runtime.fullscreen_scaling&&(n=this.runtime.fullscreen_scaling),0===n?this.runtime.setSize(e,t,!0):(this.runtime.original_width=e,this.runtime.original_height=t,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}},a.prototype.SetLayoutEffectEnabled=function(e,t){if(this.runtime.running_layout&&this.runtime.glwrap){var n=this.runtime.running_layout.getEffectByName(t);if(n){var a=1===e;n.active==a||(n.active=a,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0)}}},a.prototype.SetLayerEffectEnabled=function(e,t,n){if(e&&this.runtime.glwrap){var a=e.getEffectByName(n);if(a){var r=1===t;a.active==r||(a.active=r,e.updateActiveEffects(),this.runtime.redraw=!0)}}},a.prototype.SetLayoutEffectParam=function(e,t,n){if(this.runtime.running_layout&&this.runtime.glwrap){var a=this.runtime.running_layout.getEffectByName(e);if(a){var r=this.runtime.running_layout.effect_params[a.index];if(t=m(t),!(0>t||t>=r.length)){var i=this.runtime.glwrap.getProgramParameterType(a.shaderindex,t);1===i?n/=100:2===i&&(n=[cr.GetRValue(n),cr.GetGValue(n),cr.GetBValue(n)]),r[t]===n||(r[t]=n,a.active&&(this.runtime.redraw=!0))}}}},a.prototype.SetLayerEffectParam=function(e,t,n,a){if(e&&this.runtime.glwrap){var r=e.getEffectByName(t);if(r){var i=e.effect_params[r.index];if(n=m(n),!(0>n||n>=i.length)){var o=this.runtime.glwrap.getProgramParameterType(r.shaderindex,n);1===o?a/=100:2===o&&(a=[cr.GetRValue(a),cr.GetGValue(a),cr.GetBValue(a)]),i[n]===a||(i[n]=a,r.active&&(this.runtime.redraw=!0))}}}},a.prototype.SaveState=function(e){this.runtime.saveToSlot=e},a.prototype.LoadState=function(e){this.runtime.loadFromSlot=e},a.prototype.LoadStateJSON=function(e){this.runtime.loadFromJson=e},a.prototype.SetHalfFramerateMode=function(e){this.runtime.halfFramerateMode=0!==e},a.prototype.SetFullscreenQuality=function(e){var t=document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen;(t||0!==this.runtime.fullscreen_mode)&&(this.runtime.wantFullscreenScalingQuality=0!==e,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))},a.prototype.ResetPersisted=function(){var e,t;for(e=0,t=this.runtime.layouts_by_index.length;e<t;++e)this.runtime.layouts_by_index[e].persist_data={},this.runtime.layouts_by_index[e].first_visit=!0},a.prototype.RecreateInitialObjects=function(e,t,n,a,r){e&&this.runtime.running_layout.recreateInitialObjects(e,t,n,a,r)},a.prototype.SetPixelRounding=function(e){this.runtime.pixel_rounding=0!==e,this.runtime.redraw=!0},a.prototype.SetMinimumFramerate=function(e){1>e&&(e=1),120<e&&(e=120),this.runtime.minimumFramerate=e};a.prototype.SortZOrderByInstVar=function(e,t){if(e){var n=e.getCurrentSol(),a=n.getObjects(),r=[],o=[],l=this.runtime.running_layout,d=e.is_family,c=e.family_index,u=!1,g,m,y,_,h,f;for(g=0,m=a.length;g<m;++g)y=a[g],y.layer&&(_=d?y.instance_vars[t+y.type.family_var_map[c]]:y.instance_vars[t],r.push([y.layer.index,y.get_zindex()]),o.push([y,_]));if(r.length){for(r.sort(s),o.sort(p),(g=0,m=r.length);g<m;++g)y=o[g][0],h=l.layers[r[g][0]],f=r[g][1],h.instances[f]!==y&&(h.instances[f]=y,y.layer=h,h.setZIndicesStaleFrom(f),u=!0);u&&(this.runtime.redraw=!0)}}},y.acts=new a;d.prototype.int=function(e,t){cr.is_string(t)?(e.set_int(parseInt(t,10)),isNaN(e.data)&&(e.data=0)):e.set_int(t)},d.prototype.float=function(e,t){cr.is_string(t)?(e.set_float(parseFloat(t)),isNaN(e.data)&&(e.data=0)):e.set_float(t)},d.prototype.str=function(e,t){cr.is_string(t)?e.set_string(t):e.set_string(t.toString())},d.prototype.len=function(e,t){e.set_int(t.length||0)},d.prototype.random=function(e,t,n){n===void 0?e.set_float(Math.random()*t):e.set_float(Math.random()*(n-t)+t)},d.prototype.sqrt=function(e,t){e.set_float(Math.sqrt(t))},d.prototype.abs=function(e,t){e.set_float(Math.abs(t))},d.prototype.round=function(e,t){e.set_int(g(t))},d.prototype.floor=function(e,t){e.set_int(m(t))},d.prototype.ceil=function(e,t){e.set_int(Math.ceil(t))},d.prototype.sign=function(e,t){e.set_float(Math.sign(t))},d.prototype.sin=function(e,t){e.set_float(Math.sin(cr.to_radians(t)))},d.prototype.cos=function(e,t){e.set_float(Math.cos(cr.to_radians(t)))},d.prototype.tan=function(e,t){e.set_float(Math.tan(cr.to_radians(t)))},d.prototype.asin=function(e,t){e.set_float(cr.to_degrees(Math.asin(t)))},d.prototype.acos=function(e,t){e.set_float(cr.to_degrees(Math.acos(t)))},d.prototype.atan=function(e,t){e.set_float(cr.to_degrees(Math.atan(t)))},d.prototype.exp=function(e,t){e.set_float(Math.exp(t))},d.prototype.ln=function(e,t){e.set_float(u(t))},d.prototype.log10=function(e,t){e.set_float(u(t)/Math.LN10)},d.prototype.max=function(e){var t=arguments[1];"number"!=typeof t&&(t=0);var n,r,o;for(n=2,r=arguments.length;n<r;n++)o=arguments[n],"number"==typeof o&&t<o&&(t=o);e.set_float(t)},d.prototype.min=function(e){var t=arguments[1];"number"!=typeof t&&(t=0);var n,r,o;for(n=2,r=arguments.length;n<r;n++)o=arguments[n],"number"==typeof o&&t>o&&(t=o);e.set_float(t)},d.prototype.dt=function(e){e.set_float(this.runtime.dt)},d.prototype.timescale=function(e){e.set_float(this.runtime.timescale)},d.prototype.wallclocktime=function(e){e.set_float((Date.now()-this.runtime.start_time)/1e3)},d.prototype.unixtime=function(e){e.set_float(Date.now())},d.prototype.time=function(e){e.set_float(this.runtime.kahanTime.sum)},d.prototype.tickcount=function(e){e.set_int(this.runtime.tickcount)},d.prototype.objectcount=function(e){e.set_int(this.runtime.objectcount)},d.prototype.fps=function(e){e.set_int(this.runtime.fps)},d.prototype.loopindex=function(e,t){var n,a;if(!this.runtime.loop_stack.length)return void e.set_int(0);if(t){for(a=this.runtime.loop_stack_index;0<=a;--a)if(n=this.runtime.loop_stack[a],n.name===t)return void e.set_int(n.index);e.set_int(0)}else n=this.runtime.getCurrentLoop(),e.set_int(n?n.index:-1)},d.prototype.distance=function(e,t,n,a,r){e.set_float(cr.distanceTo(t,n,a,r))},d.prototype.angle=function(e,t,n,a,r){e.set_float(cr.to_degrees(cr.angleTo(t,n,a,r)))},d.prototype.scrollx=function(e){e.set_float(this.runtime.running_layout.scrollX)},d.prototype.scrolly=function(e){e.set_float(this.runtime.running_layout.scrollY)},d.prototype.newline=function(e){e.set_string("\n")},d.prototype.lerp=function(e,t,n,a){e.set_float(cr.lerp(t,n,a))},d.prototype.qarp=function(e,t,n,a,r){e.set_float(cr.qarp(t,n,a,r))},d.prototype.cubic=function(e,t,n,a,r,i){e.set_float(cr.cubic(t,n,a,r,i))},d.prototype.cosp=function(e,t,n,a){e.set_float(cr.cosp(t,n,a))},d.prototype.windowwidth=function(e){e.set_int(this.runtime.width)},d.prototype.windowheight=function(e){e.set_int(this.runtime.height)},d.prototype.uppercase=function(e,t){e.set_string(cr.is_string(t)?t.toUpperCase():"")},d.prototype.lowercase=function(e,t){e.set_string(cr.is_string(t)?t.toLowerCase():"")},d.prototype.clamp=function(e,t,n,a){t<n?e.set_float(n):t>a?e.set_float(a):e.set_float(t)},d.prototype.layerscale=function(e,t){var n=this.runtime.getLayer(t);n?e.set_float(n.scale):e.set_float(0)},d.prototype.layeropacity=function(e,t){var n=this.runtime.getLayer(t);n?e.set_float(100*n.opacity):e.set_float(0)},d.prototype.layerscalerate=function(e,t){var n=this.runtime.getLayer(t);n?e.set_float(n.zoomRate):e.set_float(0)},d.prototype.layerparallaxx=function(e,t){var n=this.runtime.getLayer(t);n?e.set_float(100*n.parallaxX):e.set_float(0)},d.prototype.layerparallaxy=function(e,t){var n=this.runtime.getLayer(t);n?e.set_float(100*n.parallaxY):e.set_float(0)},d.prototype.layerindex=function(e,t){var n=this.runtime.getLayer(t);n?e.set_int(n.index):e.set_int(-1)},d.prototype.layoutscale=function(e){this.runtime.running_layout?e.set_float(this.runtime.running_layout.scale):e.set_float(0)},d.prototype.layoutangle=function(e){e.set_float(cr.to_degrees(this.runtime.running_layout.angle))},d.prototype.layerangle=function(e,t){var n=this.runtime.getLayer(t);n?e.set_float(cr.to_degrees(n.angle)):e.set_float(0)},d.prototype.layoutwidth=function(e){e.set_int(this.runtime.running_layout.width)},d.prototype.layoutheight=function(e){e.set_int(this.runtime.running_layout.height)},d.prototype.find=function(e,t,n){cr.is_string(t)&&cr.is_string(n)?e.set_int(t.search(new RegExp(cr.regexp_escape(n),"i"))):e.set_int(-1)},d.prototype.findcase=function(e,t,n){cr.is_string(t)&&cr.is_string(n)?e.set_int(t.search(new RegExp(cr.regexp_escape(n),""))):e.set_int(-1)},d.prototype.left=function(e,t,a){e.set_string(cr.is_string(t)?t.substr(0,a):"")},d.prototype.right=function(e,t,a){e.set_string(cr.is_string(t)?t.substr(t.length-a):"")},d.prototype.mid=function(e,t,n,a){e.set_string(cr.is_string(t)?t.substr(n,a):"")},d.prototype.tokenat=function(e,t,n,a){if(cr.is_string(t)&&cr.is_string(a)){var r=t.split(a),o=cr.floor(n);0>o||o>=r.length?e.set_string(""):e.set_string(r[o])}else e.set_string("")},d.prototype.tokencount=function(e,t,n){cr.is_string(t)&&t.length?e.set_int(t.split(n).length):e.set_int(0)},d.prototype.replace=function(e,t,n,a){cr.is_string(t)&&cr.is_string(n)&&cr.is_string(a)?e.set_string(t.replace(new RegExp(cr.regexp_escape(n),"gi"),a)):e.set_string(cr.is_string(t)?t:"")},d.prototype.trim=function(e,t){e.set_string(cr.is_string(t)?t.trim():"")},d.prototype.pi=function(e){e.set_float(cr.PI)},d.prototype.layoutname=function(e){this.runtime.running_layout?e.set_string(this.runtime.running_layout.name):e.set_string("")},d.prototype.renderer=function(e){e.set_string(this.runtime.gl?"webgl":"canvas2d")},d.prototype.rendererdetail=function(e){e.set_string(this.runtime.glUnmaskedRenderer)},d.prototype.anglediff=function(e,t,n){e.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(t),cr.to_radians(n))))},d.prototype.choose=function(e){var t=cr.floor(Math.random()*(arguments.length-1));e.set_any(arguments[t+1])},d.prototype.rgb=function(e,t,n,a){e.set_int(cr.RGB(t,n,a))},d.prototype.rgbex=function(e,t,n,a){e.set_float(cr.RGBEx(t/100,n/100,a/100))},d.prototype.projectversion=function(e){e.set_string(this.runtime.versionstr)},d.prototype.projectname=function(e){e.set_string(this.runtime.name)},d.prototype.anglelerp=function(e,t,n,r){t=cr.to_radians(t),n=cr.to_radians(n);var i=cr.angleDiff(t,n);cr.angleClockwise(n,t)?e.set_float(cr.to_clamped_degrees(t+i*r)):e.set_float(cr.to_clamped_degrees(t-i*r))},d.prototype.anglerotate=function(e,t,n,r){t=cr.to_radians(t),n=cr.to_radians(n),r=cr.to_radians(r),e.set_float(cr.to_clamped_degrees(cr.angleRotate(t,n,r)))},d.prototype.zeropad=function(e,t,a){var r=0>t?"-":"";0>t&&(t=-t);for(var o=a-t.toString().length,l=0;l<o;l++)r+="0";e.set_string(r+t.toString())},d.prototype.cpuutilisation=function(e){e.set_float(this.runtime.cpuutilisation/1e3)},d.prototype.gpuutilisation=function(e){e.set_float(this.runtime.gpuLastUtilisation)},d.prototype.viewportleft=function(e,t){var n=this.runtime.getLayer(t);e.set_float(n?n.viewLeft:0)},d.prototype.viewporttop=function(e,t){var n=this.runtime.getLayer(t);e.set_float(n?n.viewTop:0)},d.prototype.viewportright=function(e,t){var n=this.runtime.getLayer(t);e.set_float(n?n.viewRight:0)},d.prototype.viewportbottom=function(e,t){var n=this.runtime.getLayer(t);e.set_float(n?n.viewBottom:0)},d.prototype.loadingprogress=function(e){e.set_float(this.runtime.loadingprogress)},d.prototype.unlerp=function(e,t,n,a){e.set_float(cr.unlerp(t,n,a))},d.prototype.canvassnapshot=function(e){e.set_string(this.runtime.snapshotData)},d.prototype.urlencode=function(e,t){e.set_string(encodeURIComponent(t))},d.prototype.urldecode=function(e,t){e.set_string(decodeURIComponent(t))},d.prototype.canvastolayerx=function(e,t,n,a){var r=this.runtime.getLayer(t);e.set_float(r?r.canvasToLayer(n,a,!0):0)},d.prototype.canvastolayery=function(e,t,n,a){var r=this.runtime.getLayer(t);e.set_float(r?r.canvasToLayer(n,a,!1):0)},d.prototype.layertocanvasx=function(e,t,n,a){var r=this.runtime.getLayer(t);e.set_float(r?r.layerToCanvas(n,a,!0):0)},d.prototype.layertocanvasy=function(e,t,n,a){var r=this.runtime.getLayer(t);e.set_float(r?r.layerToCanvas(n,a,!1):0)},d.prototype.savestatejson=function(e){e.set_string(this.runtime.lastSaveJson)},d.prototype.imagememoryusage=function(e){this.runtime.glwrap?e.set_float(g(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):e.set_float(0)},d.prototype.regexsearch=function(e,t,a,r){var i=n(a,r);e.set_int(t?t.search(i):-1)},d.prototype.regexreplace=function(e,t,a,r,i){var o=n(a,r);e.set_string(t?t.replace(o,i):"")};var S=[],O="",E="",C="";d.prototype.regexmatchcount=function(e,t,a,r){n(a,r);c(t.toString(),a,r),e.set_int(S?S.length:0)},d.prototype.regexmatchat=function(e,t,a,r,i){i=m(i);n(a,r);c(t.toString(),a,r),!S||0>i||i>=S.length?e.set_string(""):e.set_string(S[i])},d.prototype.infinity=function(e){e.set_float(1/0)},d.prototype.setbit=function(e,t,a,r){t|=0,a|=0,r=0===r?0:1,e.set_int(t&~(1<<a)|r<<a)},d.prototype.togglebit=function(e,t,a){t|=0,a|=0,e.set_int(t^1<<a)},d.prototype.getbit=function(e,t,a){t|=0,a|=0,e.set_int(t&1<<a?1:0)},d.prototype.originalwindowwidth=function(e){e.set_int(this.runtime.original_width)},d.prototype.originalwindowheight=function(e){e.set_int(this.runtime.original_height)},d.prototype.originalviewportwidth=function(e){e.set_int(this.runtime.original_width)},d.prototype.originalviewportheight=function(e){e.set_int(this.runtime.original_height)},y.exps=new d,y.runWaits=function(){var e=this.runtime.getCurrentEventStack(),t,n,a,r,l,p,d;for(t=0,a=this.waits.length;t<a;t++){if(r=this.waits[t],-1===r.time){if(!r.signalled)continue;}else if(r.time>this.runtime.kahanTime.sum)continue;for(l in e.current_event=r.ev,e.actindex=r.actindex,e.cndindex=0,r.sols)r.sols.hasOwnProperty(l)&&(p=this.runtime.types_by_index[parseInt(l,10)].getCurrentSol(),d=r.sols[l],p.select_all=d.sa,cr.shallowAssignArray(p.instances,d.insts),i(d));r.ev.resume_actions_and_subevents(),this.runtime.clearSol(r.solModifiers),r.deleteme=!0}for(t=0,n=0,a=this.waits.length;t<a;t++)r=this.waits[t],this.waits[n]=r,r.deleteme?o(r):n++;cr.truncateArray(this.waits,n)}}();(function(){var e=Math.atan2,t=Math.cos,n=Math.sin;cr.add_common_aces=function(a,r){var i=a[1],o=a[3],s=a[4],l=a[5],p=a[6],d=a[7],c=a[8];r.cnds||(r.cnds={}),r.acts||(r.acts={}),r.exps||(r.exps={});var u=r.cnds,g=r.acts,m=r.exps;o&&(u.CompareX=function(e,t){return cr.do_cmp(this.x,e,t)},u.CompareY=function(e,t){return cr.do_cmp(this.y,e,t)},u.IsOnScreen=function(){var e=this.layer;this.update_bbox();var t=this.bbox;return!(t.right<e.viewLeft||t.bottom<e.viewTop||t.left>e.viewRight||t.top>e.viewBottom)},u.IsOutsideLayout=function(){this.update_bbox();var e=this.bbox,t=this.runtime.running_layout;return 0>e.right||0>e.bottom||e.left>t.width||e.top>t.height},u.PickDistance=function(e,t,n){var a=this.getCurrentSol(),r=a.getObjects();if(!r.length)return!1;var o=r[0],s=o,l=cr.distanceTo(o.x,o.y,t,n),p,c,u;for(p=1,c=r.length;p<c;p++)o=r[p],u=cr.distanceTo(o.x,o.y,t,n),(0===e&&u<l||1===e&&u>l)&&(l=u,s=o);return a.pick_one(s),!0},g.SetX=function(e){this.x!==e&&(this.x=e,this.set_bbox_changed())},g.SetY=function(e){this.y!==e&&(this.y=e,this.set_bbox_changed())},g.SetPos=function(e,t){(this.x!==e||this.y!==t)&&(this.x=e,this.y=t,this.set_bbox_changed())},g.SetPosToObject=function(e,t){var n=e.getPairedInstance(this);if(n){var a,r;n.getImagePoint?(a=n.getImagePoint(t,!0),r=n.getImagePoint(t,!1)):(a=n.x,r=n.y),(this.x!==a||this.y!==r)&&(this.x=a,this.y=r,this.set_bbox_changed())}},g.MoveForward=function(e){0!==e&&(this.x+=t(this.angle)*e,this.y+=n(this.angle)*e,this.set_bbox_changed())},g.MoveAtAngle=function(e,a){0!==a&&(this.x+=t(cr.to_radians(e))*a,this.y+=n(cr.to_radians(e))*a,this.set_bbox_changed())},m.X=function(e){e.set_float(this.x)},m.Y=function(e){e.set_float(this.y)},m.dt=function(e){e.set_float(this.runtime.getDt(this))}),s&&(u.CompareWidth=function(e,t){return cr.do_cmp(this.width,e,t)},u.CompareHeight=function(e,t){return cr.do_cmp(this.height,e,t)},g.SetWidth=function(e){this.width!==e&&(this.width=e,this.set_bbox_changed())},g.SetHeight=function(e){this.height!==e&&(this.height=e,this.set_bbox_changed())},g.SetSize=function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.set_bbox_changed())},m.Width=function(e){e.set_float(this.width)},m.Height=function(e){e.set_float(this.height)},m.BBoxLeft=function(e){this.update_bbox(),e.set_float(this.bbox.left)},m.BBoxTop=function(e){this.update_bbox(),e.set_float(this.bbox.top)},m.BBoxRight=function(e){this.update_bbox(),e.set_float(this.bbox.right)},m.BBoxBottom=function(e){this.update_bbox(),e.set_float(this.bbox.bottom)}),l&&(u.AngleWithin=function(e,t){return cr.angleDiff(this.angle,cr.to_radians(t))<=cr.to_radians(e)},u.IsClockwiseFrom=function(e){return cr.angleClockwise(this.angle,cr.to_radians(e))},u.IsBetweenAngles=function(e,t){var n=cr.to_clamped_radians(e),a=cr.to_clamped_radians(t),r=cr.clamp_angle(this.angle),i=!cr.angleClockwise(a,n);return i?cr.angleClockwise(r,n)||!cr.angleClockwise(r,a):cr.angleClockwise(r,n)&&!cr.angleClockwise(r,a)},g.SetAngle=function(e){var t=cr.to_radians(cr.clamp_angle_degrees(e));isNaN(t)||this.angle!==t&&(this.angle=t,this.set_bbox_changed())},g.RotateClockwise=function(e){0===e||isNaN(e)||(this.angle+=cr.to_radians(e),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},g.RotateCounterclockwise=function(e){0===e||isNaN(e)||(this.angle-=cr.to_radians(e),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},g.RotateTowardAngle=function(e,t){var n=cr.angleRotate(this.angle,cr.to_radians(t),cr.to_radians(e));isNaN(n)||this.angle!==n&&(this.angle=n,this.set_bbox_changed())},g.RotateTowardPosition=function(t,n,a){var r=n-this.x,i=a-this.y,o=e(i,r),s=cr.angleRotate(this.angle,o,cr.to_radians(t));isNaN(s)||this.angle!==s&&(this.angle=s,this.set_bbox_changed())},g.SetTowardPosition=function(t,n){var a=t-this.x,r=n-this.y,i=e(r,a);isNaN(i)||this.angle!==i&&(this.angle=i,this.set_bbox_changed())},m.Angle=function(e){e.set_float(cr.to_clamped_degrees(this.angle))}),i||(u.CompareInstanceVar=function(e,t,n){return cr.do_cmp(this.instance_vars[e],t,n)},u.IsBoolInstanceVarSet=function(e){return this.instance_vars[e]},u.PickInstVarHiLow=function(e,t){var n=this.getCurrentSol(),a=n.getObjects();if(!a.length)return!1;var r=a[0],o=r,s=r.instance_vars[t],l,p,d;for(l=1,p=a.length;l<p;l++)r=a[l],d=r.instance_vars[t],(0===e&&d<s||1===e&&d>s)&&(s=d,o=r);return n.pick_one(o),!0},u.PickByUID=function(e){var t=this.runtime.getCurrentCondition(),n,a,r,o,s,l,p;if(t.inverted){if(p=this.getCurrentSol(),p.select_all){for(p.select_all=!1,cr.clearArray(p.instances),cr.clearArray(p.else_instances),l=this.instances,(n=0,a=l.length);n<a;n++)o=l[n],o.uid===e?p.else_instances.push(o):p.instances.push(o);return this.applySolToContainer(),!!p.instances.length}for(n=0,r=0,a=p.instances.length;n<a;n++)o=p.instances[n],p.instances[r]=o,o.uid===e?p.else_instances.push(o):r++;return cr.truncateArray(p.instances,r),this.applySolToContainer(),!!p.instances.length}if(o=this.runtime.getObjectByUID(e),!o)return!1;if(p=this.getCurrentSol(),!p.select_all&&-1===p.instances.indexOf(o))return!1;if(this.is_family){for(s=o.type.families,n=0,a=s.length;n<a;n++)if(s[n]===this)return p.pick_one(o),this.applySolToContainer(),!0;}else if(o.type===this)return p.pick_one(o),this.applySolToContainer(),!0;return!1},u.OnCreated=function(){return!0},u.OnDestroyed=function(){return!0},g.SetInstanceVar=function(e,t){var n=this.instance_vars;if(cr.is_number(n[e]))n[e]=cr.is_number(t)?t:parseFloat(t);else if(cr.is_string(n[e]))n[e]=cr.is_string(t)?t:t.toString();else;},g.AddInstanceVar=function(e,t){var n=this.instance_vars;if(cr.is_number(n[e]))n[e]+=cr.is_number(t)?t:parseFloat(t);else if(cr.is_string(n[e]))n[e]+=cr.is_string(t)?t:t.toString();else;},g.SubInstanceVar=function(e,t){var n=this.instance_vars;if(cr.is_number(n[e]))n[e]-=cr.is_number(t)?t:parseFloat(t);else;},g.SetBoolInstanceVar=function(e,t){this.instance_vars[e]=t?1:0},g.ToggleBoolInstanceVar=function(e){this.instance_vars[e]=1-this.instance_vars[e]},g.Destroy=function(){this.runtime.DestroyInstance(this)},!g.LoadFromJsonString&&(g.LoadFromJsonString=function(e){var t,n,a,r;try{t=JSON.parse(e)}catch(t){return}if(this.runtime.loadInstanceFromJSON(this,t,!0),this.afterLoad&&this.afterLoad(),this.behavior_insts)for(n=0,a=this.behavior_insts.length;n<a;++n)r=this.behavior_insts[n],r.afterLoad&&r.afterLoad()}),m.Count=function(e){var t=e.object_class.instances.length,n,a,r;for(n=0,a=this.runtime.createRow.length;n<a;n++)r=this.runtime.createRow[n],e.object_class.is_family?0<=r.type.families.indexOf(e.object_class)&&t++:r.type===e.object_class&&t++;e.set_int(t)},m.PickedCount=function(e){e.set_int(e.object_class.getCurrentSol().getObjects().length)},m.UID=function(e){e.set_int(this.uid)},m.IID=function(e){e.set_int(this.get_iid())},!m.AsJSON&&(m.AsJSON=function(e){e.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))})),p&&(u.IsVisible=function(){return this.visible},g.SetVisible=function(e){e=2===e?!this.visible:0!=e,e!==this.visible&&(this.visible=e,this.runtime.redraw=!0)},u.CompareOpacity=function(e,t){return cr.do_cmp(cr.round6dp(100*this.opacity),e,t)},g.SetOpacity=function(e){var t=e/100;0>t?t=0:1<t&&(t=1),t!==this.opacity&&(this.opacity=t,this.runtime.redraw=!0)},m.Opacity=function(e){e.set_float(cr.round6dp(100*this.opacity))}),d&&(u.IsOnLayer=function(e){return!!e&&this.layer===e},u.PickTopBottom=function(e){var t=this.getCurrentSol(),n=t.getObjects();if(!n.length)return!1;var a=n[0],r=a,o,s;for(o=1,s=n.length;o<s;o++)a=n[o],0===e?(a.layer.index>r.layer.index||a.layer.index===r.layer.index&&a.get_zindex()>r.get_zindex())&&(r=a):(a.layer.index<r.layer.index||a.layer.index===r.layer.index&&a.get_zindex()<r.get_zindex())&&(r=a);return t.pick_one(r),!0},g.MoveToTop=function(){var e=this.layer,t=e.instances;t.length&&t[t.length-1]===this||(e.removeFromInstanceList(this,!1),e.appendToInstanceList(this,!1),this.runtime.redraw=!0)},g.MoveToBottom=function(){var e=this.layer,t=e.instances;t.length&&t[0]===this||(e.removeFromInstanceList(this,!1),e.prependToInstanceList(this,!1),this.runtime.redraw=!0)},g.MoveToLayer=function(e){e&&e!=this.layer&&(this.layer.removeFromInstanceList(this,!0),this.layer=e,e.appendToInstanceList(this,!0),this.runtime.redraw=!0)},g.ZMoveToObject=function(e,t){if(t){var n=t.getFirstPicked(this);n&&n.uid!==this.uid&&(this.layer.index!==n.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=n.layer,n.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,n,0===e),this.runtime.redraw=!0)}},m.LayerNumber=function(e){e.set_int(this.layer.number)},m.LayerName=function(e){e.set_string(this.layer.name)},m.ZIndex=function(e){e.set_int(this.get_zindex())}),c&&(g.SetEffectEnabled=function(e,t){if(this.runtime.glwrap){var n=this.type.getEffectIndexByName(t);if(!(0>n)){var a=1===e;this.active_effect_flags[n]===a||(this.active_effect_flags[n]=a,this.updateActiveEffects(),this.runtime.redraw=!0)}}},g.SetEffectParam=function(e,t,n){if(this.runtime.glwrap){var a=this.type.getEffectIndexByName(e);if(!(0>a)){var i=this.type.effect_types[a],o=this.effect_params[a],s,l,p;if(t=Math.floor(t),!(0>t||t>=o.length)){var d=this.runtime.glwrap.getProgramParameterType(i.shaderindex,t);if(1===d&&(n/=100),2===d){s=cr.GetRValue(n),l=cr.GetGValue(n),p=cr.GetBValue(n);var c=o[t];if(c[0]===s&&c[1]===l&&c[2]===p)return;c[0]=s,c[1]=l,c[2]=p,i.active&&(this.runtime.redraw=!0)}else{if(o[t]===n)return;o[t]=n,i.active&&(this.runtime.redraw=!0)}}}}})},cr.set_bbox_changed=function(){this.bbox_changed=!0,this.cell_changed=!0,this.type.any_cell_changed=!0,this.runtime.redraw=!0;var e=this.bbox_changed_callbacks,t,n;for(t=0,n=e.length;t<n;++t)e[t](this);this.layer.useRenderCells&&this.update_bbox()},cr.add_bbox_changed_callback=function(e){e&&this.bbox_changed_callbacks.push(e)},cr.update_bbox=function(){if(this.bbox_changed){var e=this.bbox,t=this.bquad;e.set(this.x,this.y,this.x+this.width,this.y+this.height),e.offset(-this.hotspotX*this.width,-this.hotspotY*this.height),this.angle?(e.offset(-this.x,-this.y),t.set_from_rotated_rect(e,this.angle),t.offset(this.x,this.y),t.bounding_box(e)):t.set_from_rect(e),e.normalize(),this.bbox_changed=!1,this.update_render_cell()}};var a=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var e=this.layer.render_grid,t=this.bbox;a.set(e.XToCell(t.left),e.YToCell(t.top),e.XToCell(t.right),e.YToCell(t.bottom)),this.rendercells.equals(a)||(this.rendercells.right<this.rendercells.left?e.update(this,null,a):e.update(this,this.rendercells,a),this.rendercells.copy(a),this.layer.render_list_stale=!0)}},cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var e=this.type.collision_grid,t=this.bbox;a.set(e.XToCell(t.left),e.YToCell(t.top),e.XToCell(t.right),e.YToCell(t.bottom)),this.collcells.equals(a)||(this.collcells.right<this.collcells.left?e.update(this,null,a):e.update(this,this.collcells,a),this.collcells.copy(a),this.cell_changed=!1)}},cr.inst_contains_pt=function(e,t){return!!this.bbox.contains_pt(e,t)&&!!this.bquad.contains_pt(e,t)&&(this.tilemap_exists?this.testPointOverlapTile(e,t):!this.collision_poly||this.collision_poly.is_empty()||(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(e-this.x,t-this.y)))},cr.inst_get_iid=function(){return this.type.updateIIDs(),this.iid},cr.inst_get_zindex=function(){return this.layer.updateZIndices(),this.zindex},cr.inst_updateActiveEffects=function(){cr.clearArray(this.active_effect_types);var e=!0,t,n,a;for(t=0,n=this.active_effect_flags.length;t<n;t++)this.active_effect_flags[t]&&(a=this.type.effect_types[t],this.active_effect_types.push(a),a.preservesOpaqueness||(e=!1));this.uses_shaders=!!this.active_effect_types.length,this.shaders_preserve_opaqueness=e},cr.inst_toString=function(){return"Inst"+this.puid},cr.type_getFirstPicked=function(e){if(e&&e.is_contained&&e.type!=this){var t,n,a;for(t=0,n=e.siblings.length;t<n;t++)if(a=e.siblings[t],a.type==this)return a}var r=this.getCurrentSol().getObjects();return r.length?r[0]:null},cr.type_getPairedInstance=function(e){var t=this.getCurrentSol().getObjects();return t.length?t[e.get_iid()%t.length]:null},cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var e,t;for(e=0,t=this.instances.length;e<t;e++)this.instances[e].iid=e;var n=e,a=this.runtime.createRow;for(e=0,t=a.length;e<t;++e)a[e].type===this&&(a[e].iid=n++);this.stale_iids=!1}},cr.type_getInstanceByIID=function(e){if(e<this.instances.length)return this.instances[e];e-=this.instances.length;var t=this.runtime.createRow,n,a;for(n=0,a=t.length;n<a;++n)if(t[n].type===this){if(0===e)return t[n];--e}return null},cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]},cr.type_pushCleanSol=function(){this.cur_sol++,this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))},cr.type_pushCopySol=function(){this.cur_sol++,this.cur_sol===this.solstack.length&&this.solstack.push(new cr.selection(this));var e=this.solstack[this.cur_sol],t=this.solstack[this.cur_sol-1];t.select_all?e.select_all=!0:(e.select_all=!1,cr.shallowAssignArray(e.instances,t.instances)),cr.clearArray(e.else_instances)},cr.type_popSol=function(){this.cur_sol--},cr.type_getBehaviorByName=function(e){var t=0,n,a,r,o,s;if(!this.is_family)for(n=0,a=this.families.length;n<a;n++)for(s=this.families[n],r=0,o=s.behaviors.length;r<o;r++){if(e===s.behaviors[r].name)return this.extra.lastBehIndex=t,s.behaviors[r];t++}for(n=0,a=this.behaviors.length;n<a;n++){if(e===this.behaviors[n].name)return this.extra.lastBehIndex=t,this.behaviors[n];t++}return null},cr.type_getBehaviorIndexByName=function(e){var t=this.getBehaviorByName(e);return t?this.extra.lastBehIndex:-1},cr.type_getEffectIndexByName=function(e){var t,n;for(t=0,n=this.effect_types.length;t<n;t++)if(this.effect_types[t].name===e)return t;return-1},cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var e,n,a,r,o,s,l;this.updateIIDs(),s=this.getCurrentSol();var p=s.select_all,d=this.runtime.getCurrentEventStack(),c=d&&d.current_event&&d.current_event.orblock;for(e=0,n=this.container.length;e<n;e++)if(o=this.container[e],o!==this&&(o.updateIIDs(),l=o.getCurrentSol(),l.select_all=p,!p)){for(cr.clearArray(l.instances),a=0,r=s.instances.length;a<r;++a)l.instances[a]=o.getInstanceByIID(s.instances[a].iid);if(c)for(cr.clearArray(l.else_instances),a=0,r=s.else_instances.length;a<r;++a)l.else_instances[a]=o.getInstanceByIID(s.else_instances[a].iid)}}},cr.type_toString=function(){return"Type"+this.sid},cr.do_cmp=function(e,t,n){if("undefined"==typeof e||"undefined"==typeof n)return!1;switch(t){case 0:return e===n;case 1:return e!==n;case 2:return e<n;case 3:return e<=n;case 4:return e>n;case 5:return e>=n;default:;return!1;}}})(),cr.shaders={};cr.plugins_.Sprite=function(e){this.runtime=e},function(){function e(){if(0===this.datauri.length){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;var t=e.getContext("2d");this.spritesheeted?t.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):t.drawImage(this.texture_img,0,0,this.width,this.height),this.datauri=e.toDataURL("image/png")}return this.datauri}function t(){}function n(){return f.length?f.pop():[0,0,0]}function r(e){e[0]=0,e[1]=0,e[2]=0,f.push(e)}function i(e,t){return e<t?""+e+","+t:""+t+","+e}function a(e,t,a,r){var o=t.uid,s=a.uid,l=i(o,s);if(e.hasOwnProperty(l))return void(e[l][2]=r);var p=n();p[0]=o,p[1]=s,p[2]=r,e[l]=p}function o(e,t,n){var a=i(t.uid,n.uid);e.hasOwnProperty(a)&&(r(e[a]),delete e[a])}function s(e,t){var n=t.uid,a,i;for(a in e)e.hasOwnProperty(a)&&(i=e[a],(i[0]===n||i[1]===n)&&(r(e[a]),delete e[a]))}function p(e,t,n){var a=i(t.uid,n.uid);return e.hasOwnProperty(a)?(x=e[a][2],!0):(x=-2,!1)}function l(e,t,n){if(!e)return!1;var a=0!==t||0!==n,i=!1,o=this.runtime.getCurrentCondition(),s=o.type,l=o.inverted,p=e.getCurrentSol(),d=this.runtime.getCurrentEventStack().current_event.orblock,c,u,g,m,y,_;for(p.select_all?(this.update_bbox(),O.copy(this.bbox),O.offset(t,n),this.runtime.getCollisionCandidates(this.layer,e,O,S),_=S):d?this.runtime.isCurrentConditionFirst()&&!p.else_instances.length&&p.instances.length?_=p.instances:_=p.else_instances:_=p.instances,v=e,T=s!==e&&!l,a&&(c=this.x,u=this.y,this.x+=t,this.y+=n,this.set_bbox_changed()),(g=0,m=_.length);g<m;g++)if(y=_[g],this.runtime.testOverlap(this,y)){if(i=!0,l)break;s!==e&&w.add(y)}return a&&(this.x=c,this.y=u,this.set_bbox_changed()),cr.clearArray(S),i}function d(){}function c(){}var u=Math.abs,g=Math.round,m=cr.plugins_.Sprite.prototype;m.Type=function(e){this.plugin=e,this.runtime=e.runtime};var y=m.Type.prototype;y.onCreate=function(){if(!this.is_family){var t,n,a,r,o,s,l,p,d,c;for(this.all_frames=[],this.has_loaded_textures=!1,(t=0,n=this.animations.length);t<n;t++){for(o=this.animations[t],l={},l.name=o[0],l.speed=o[1],l.loop=o[2],l.repeatcount=o[3],l.repeatto=o[4],l.pingpong=o[5],l.sid=o[6],l.frames=[],(a=0,r=o[7].length);a<r;a++)s=o[7][a],p={},p.texture_file=s[0],p.texture_filesize=s[1],p.offx=s[2],p.offy=s[3],p.width=s[4],p.height=s[5],p.duration=s[6],p.hotspotX=s[7],p.hotspotY=s[8],p.image_points=s[9],p.poly_pts=s[10],p.pixelformat=s[11],p.spritesheeted=0!==p.width,p.datauri="",p.getDataUri=e,c={},c.left=0,c.top=0,c.right=1,c.bottom=1,p.sheetTex=c,p.webGL_texture=null,d=this.runtime.findWaitingTexture(s[0]),d?p.texture_img=d:(p.texture_img=new Image,p.texture_img.cr_src=s[0],p.texture_img.cr_filesize=s[1],p.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(p.texture_img,s[0])),cr.seal(p),l.frames.push(p),this.all_frames.push(p);cr.seal(l),this.animations[t]=l}}},y.updateAllCurrentTexture=function(){var e,t,n;for(e=0,t=this.instances.length;e<t;e++)n=this.instances[e],n.curWebGLTexture=n.curFrame.webGL_texture},y.onLostWebGLContext=function(){if(!this.is_family){var e,t,n;for(e=0,t=this.all_frames.length;e<t;++e)n=this.all_frames[e],n.texture_img.c2webGL_texture=null,n.webGL_texture=null;this.has_loaded_textures=!1,this.updateAllCurrentTexture()}},y.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){var e,t,n;for(e=0,t=this.all_frames.length;e<t;++e)n=this.all_frames[e],n.webGL_texture=this.runtime.glwrap.loadTexture(n.texture_img,!1,this.runtime.linearSampling,n.pixelformat);this.updateAllCurrentTexture()}},y.loadTextures=function(){if(!(this.is_family||this.has_loaded_textures||!this.runtime.glwrap)){var e,t,n;for(e=0,t=this.all_frames.length;e<t;++e)n=this.all_frames[e],n.webGL_texture=this.runtime.glwrap.loadTexture(n.texture_img,!1,this.runtime.linearSampling,n.pixelformat);this.has_loaded_textures=!0}},y.unloadTextures=function(){if(!(this.is_family||this.instances.length||!this.has_loaded_textures)){var e,t,n;for(e=0,t=this.all_frames.length;e<t;++e)n=this.all_frames[e],this.runtime.glwrap.deleteTexture(n.webGL_texture),n.webGL_texture=null;this.has_loaded_textures=!1}};var _=[];y.preloadCanvas2D=function(e){var t,n,a;for(cr.clearArray(_),t=0,n=this.all_frames.length;t<n;++t)a=this.all_frames[t].texture_img,-1===_.indexOf(a)&&(e.drawImage(a,0,0),_.push(a))},m.Instance=function(e){this.type=e,this.runtime=e.runtime;var t=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(t):this.collision_poly=new cr.CollisionPoly(t)};var h=m.Instance.prototype;h.onCreate=function(){this.visible=this.properties[0],this.isTicking=!1,this.inAnimTrigger=!1,this.collisionsEnabled=this.properties[3],this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0],this.cur_frame=this.properties[2],0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var e=this.cur_animation.frames[this.cur_frame];this.collision_poly.set_pts(e.poly_pts),this.hotspotX=e.hotspotX,this.hotspotY=e.hotspotY,this.animForwards=0<=this.cur_animation.speed,this.cur_anim_speed=u(this.cur_animation.speed),this.cur_anim_repeatto=this.cur_animation.repeatto,1===this.type.animations.length&&1===this.type.animations[0].frames.length||0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0),this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder,this.frameStart=this.getNowTime(),this.animPlaying=!0,this.animRepeats=0,this.animTriggerName="",this.changeAnimName="",this.changeAnimFrom=0,this.changeAnimFrame=-1,this.type.loadTextures();var t,n,a,r,o,s,l,p;for(t=0,n=this.type.animations.length;t<n;t++)for(o=this.type.animations[t],a=0,r=o.frames.length;a<r;a++)s=o.frames[a],0===s.width&&(s.width=s.texture_img.width,s.height=s.texture_img.height),s.spritesheeted&&(p=s.texture_img,l=s.sheetTex,l.left=s.offx/p.width,l.top=s.offy/p.height,l.right=(s.offx+s.width)/p.width,l.bottom=(s.offy+s.height)/p.height,0===s.offx&&0===s.offy&&s.width===p.width&&s.height===p.height&&(s.spritesheeted=!1));this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture},h.saveToJSON=function(){var e={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};return this.animPlaying||(e.ap=this.animPlaying),this.animForwards||(e.af=this.animForwards),e},h.loadFromJSON=function(e){var t=this.getAnimationBySid(e.a);t&&(this.cur_animation=t),this.cur_frame=e.f,0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),this.cur_anim_speed=e.cas,this.frameStart=e.fs,this.animRepeats=e.ar,this.animTimer.reset(),this.animTimer.sum=e.at,this.animPlaying=!e.hasOwnProperty("ap")||e.ap,this.animForwards=!e.hasOwnProperty("af")||e.af,this.cur_anim_repeatto=e.hasOwnProperty("rt")?e.rt:this.cur_animation.repeatto,this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture,this.collision_poly.set_pts(this.curFrame.poly_pts),this.hotspotX=this.curFrame.hotspotX,this.hotspotY=this.curFrame.hotspotY},h.animationFinish=function(e){this.cur_frame=e?0:this.cur_animation.frames.length-1,this.animPlaying=!1,this.animTriggerName=this.cur_animation.name,this.inAnimTrigger=!0,this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this),this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this),this.inAnimTrigger=!1,this.animRepeats=0},h.getNowTime=function(){return this.animTimer.sum},h.tick=function(){this.animTimer.add(this.runtime.getDt(this)),this.changeAnimName.length&&this.doChangeAnim(),0<=this.changeAnimFrame&&this.doChangeAnimFrame();var e=this.getNowTime(),t=this.cur_animation,n=t.frames[this.cur_frame],a=n.duration/this.cur_anim_speed,r;this.animPlaying&&e>=this.frameStart+a&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=a,this.cur_frame>=t.frames.length&&(t.pingpong?(this.animForwards=!1,this.cur_frame=t.frames.length-2):t.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=t.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),0>this.cur_frame&&(t.pingpong?(this.cur_frame=1,this.animForwards=!0,!t.loop&&(this.animRepeats++,this.animRepeats>=t.repeatcount&&this.animationFinish(!0))):t.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=t.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),0>this.cur_frame?this.cur_frame=0:this.cur_frame>=t.frames.length&&(this.cur_frame=t.frames.length-1),e>this.frameStart+t.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=e),r=t.frames[this.cur_frame],this.OnFrameChanged(n,r),this.runtime.redraw=!0)},h.getAnimationByName=function(e){var t,n,r;for(t=0,n=this.type.animations.length;t<n;t++)if(r=this.type.animations[t],cr.equals_nocase(r.name,e))return r;return null},h.getAnimationBySid=function(e){var t,n,r;for(t=0,n=this.type.animations.length;t<n;t++)if(r=this.type.animations[t],r.sid===e)return r;return null},h.doChangeAnim=function(){var e=this.cur_animation.frames[this.cur_frame],t=this.getAnimationByName(this.changeAnimName);this.changeAnimName="";!t||cr.equals_nocase(t.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=t,this.animForwards=0<=t.speed,this.cur_anim_speed=u(t.speed),this.cur_anim_repeatto=t.repeatto,0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.OnFrameChanged(e,this.cur_animation.frames[this.cur_frame]),this.runtime.redraw=!0)},h.doChangeAnimFrame=function(){var e=this.cur_animation.frames[this.cur_frame],t=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame),0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),t!==this.cur_frame&&(this.OnFrameChanged(e,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0),this.changeAnimFrame=-1},h.OnFrameChanged=function(e,t){var n=e.width,a=e.height,r=t.width,o=t.height;n!=r&&(this.width*=r/n),a!=o&&(this.height*=o/a),this.hotspotX=t.hotspotX,this.hotspotY=t.hotspotY,this.collision_poly.set_pts(t.poly_pts),this.set_bbox_changed(),this.curFrame=t,this.curWebGLTexture=t.webGL_texture;var s,l,p;for(s=0,l=this.behavior_insts.length;s<l;s++)p=this.behavior_insts[s],p.onSpriteFrameChanged&&p.onSpriteFrameChanged(e,t);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)},h.draw=function(e){e.globalAlpha=this.opacity;var t=this.curFrame,n=t.spritesheeted,a=t.texture_img,r=this.x,i=this.y,o=this.width,s=this.height;if(0===this.angle&&0<=o&&0<=s)r-=this.hotspotX*o,i-=this.hotspotY*s,this.runtime.pixel_rounding&&(r=g(r),i=g(i)),n?e.drawImage(a,t.offx,t.offy,t.width,t.height,r,i,o,s):e.drawImage(a,r,i,o,s);else{this.runtime.pixel_rounding&&(r=g(r),i=g(i)),e.save();var l=0<o?1:-1,p=0<s?1:-1;e.translate(r,i),(1!=l||1!=p)&&e.scale(l,p),e.rotate(this.angle*l*p);var d=0-this.hotspotX*cr.abs(o),c=0-this.hotspotY*cr.abs(s);n?e.drawImage(a,t.offx,t.offy,t.width,t.height,d,c,cr.abs(o),cr.abs(s)):e.drawImage(a,d,c,cr.abs(o),cr.abs(s)),e.restore()}},h.drawGL_earlyZPass=function(e){this.drawGL(e)},h.drawGL=function(e){e.setTexture(this.curWebGLTexture),e.setOpacity(this.opacity);var t=this.curFrame,n=this.bquad;if(this.runtime.pixel_rounding){var a=g(this.x)-this.x,r=g(this.y)-this.y;t.spritesheeted?e.quadTex(n.tlx+a,n.tly+r,n.trx+a,n.try_+r,n.brx+a,n.bry+r,n.blx+a,n.bly+r,t.sheetTex):e.quad(n.tlx+a,n.tly+r,n.trx+a,n.try_+r,n.brx+a,n.bry+r,n.blx+a,n.bly+r)}else t.spritesheeted?e.quadTex(n.tlx,n.tly,n.trx,n.try_,n.brx,n.bry,n.blx,n.bly,t.sheetTex):e.quad(n.tlx,n.tly,n.trx,n.try_,n.brx,n.bry,n.blx,n.bly)},h.getImagePointIndexByName=function(e){var t=this.curFrame,n,a;for(n=0,a=t.image_points.length;n<a;n++)if(cr.equals_nocase(e,t.image_points[n][0]))return n;return-1},h.getImagePoint=function(e,t){var n=this.curFrame,a=n.image_points,r;if(r=cr.is_string(e)?this.getImagePointIndexByName(e):e-1,r=cr.floor(r),0>r||r>=a.length)return t?this.x:this.y;var i=(a[r][1]-n.hotspotX)*this.width,o=a[r][2];o=(o-n.hotspotY)*this.height;var s=Math.cos(this.angle),l=Math.sin(this.angle),p=i*s-o*l;return o=o*s+i*l,i=p,i+=this.x,o+=this.y,t?i:o};var f=[];var x=-2;var b=[];t.prototype.OnCollision=function(e){if(!e)return!1;var t=this.runtime,n=t.getCurrentCondition(),i=n.type,d=null;n.extra.collmemory?d=n.extra.collmemory:(d={},n.extra.collmemory=d),n.extra.spriteCreatedDestroyCallback||(n.extra.spriteCreatedDestroyCallback=!0,t.addDestroyCallback(function(e){s(n.extra.collmemory,e)}));var c=i.getCurrentSol(),u=e.getCurrentSol(),g=c.getObjects(),m=this.runtime.tickcount,y=t.getCurrentEventStack().current_event,_=y.orblock,h,f,v,w,T,S,O,E,C;for(f=0;f<g.length;f++){for(v=g[f],u.select_all?(v.update_bbox(),this.runtime.getCollisionCandidates(v.layer,e,v.bbox,b),h=b,this.runtime.addRegisteredCollisionCandidates(v,e,h)):h=u.getObjects(),w=0;w<h.length;w++)T=h[w],t.testOverlap(v,T)||t.checkRegisteredCollision(v,T)?(E=p(d,v,T),C=!E||x<m-1,a(d,v,T,m),C&&(t.pushCopySol(y.solModifiers),S=i.getCurrentSol(),O=e.getCurrentSol(),S.select_all=!1,O.select_all=!1,i===e?(S.instances.length=2,S.instances[0]=v,S.instances[1]=T,i.applySolToContainer()):(S.instances.length=1,O.instances.length=1,S.instances[0]=v,O.instances[0]=T,i.applySolToContainer(),e.applySolToContainer()),y.retrigger(),t.popSol(y.solModifiers))):o(d,v,T);cr.clearArray(b)}return!1};var v=null,w=new cr.ObjectSet,T=!1,S=[],O=new cr.rect(0,0,0,0);y.finish=function(e){if(T){if(e){var t=this.runtime.getCurrentEventStack().current_event.orblock,n=v.getCurrentSol(),a=w.valuesRef(),r,o,s;if(n.select_all){for(n.select_all=!1,cr.clearArray(n.instances),(r=0,o=a.length);r<o;++r)n.instances[r]=a[r];if(t)for(cr.clearArray(n.else_instances),r=0,o=v.instances.length;r<o;++r)s=v.instances[r],w.contains(s)||n.else_instances.push(s)}else if(t){var l=n.instances.length;for(r=0,o=a.length;r<o;++r)n.instances[l+r]=a[r],cr.arrayFindRemove(n.else_instances,a[r])}else cr.shallowAssignArray(n.instances,a);v.applySolToContainer()}w.clear(),T=!1}},t.prototype.IsOverlapping=function(e){return l.call(this,e,0,0)},t.prototype.IsOverlappingOffset=function(e,t,n){return l.call(this,e,t,n)},t.prototype.IsAnimPlaying=function(e){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,e):cr.equals_nocase(this.cur_animation.name,e)},t.prototype.CompareFrame=function(e,t){return cr.do_cmp(this.cur_frame,e,t)},t.prototype.CompareAnimSpeed=function(e,t){var n=this.animForwards?this.cur_anim_speed:-this.cur_anim_speed;return cr.do_cmp(n,e,t)},t.prototype.OnAnimFinished=function(e){return cr.equals_nocase(this.animTriggerName,e)},t.prototype.OnAnyAnimFinished=function(){return!0},t.prototype.OnFrameChanged=function(){return!0},t.prototype.IsMirrored=function(){return 0>this.width},t.prototype.IsFlipped=function(){return 0>this.height},t.prototype.OnURLLoaded=function(){return!0},t.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled},m.cnds=new t;d.prototype.Spawn=function(e,t,n){if(e&&t){var a=this.runtime.createInstance(e,t,this.getImagePoint(n,!0),this.getImagePoint(n,!1));if(a){"undefined"!=typeof a.angle&&(a.angle=this.angle,a.set_bbox_changed()),this.runtime.isInOnDestroy++;var r,o,l;if(this.runtime.trigger(Object.getPrototypeOf(e.plugin).cnds.OnCreated,a),a.is_contained)for(r=0,o=a.siblings.length;r<o;r++)l=a.siblings[r],this.runtime.trigger(Object.getPrototypeOf(l.type.plugin).cnds.OnCreated,l);this.runtime.isInOnDestroy--;var p=this.runtime.getCurrentAction(),d=!1;(cr.is_undefined(p.extra.Spawn_LastExec)||p.extra.Spawn_LastExec<this.runtime.execcount)&&(d=!0,p.extra.Spawn_LastExec=this.runtime.execcount);var c;if(e!=this.type&&(c=e.getCurrentSol(),c.select_all=!1,d?(cr.clearArray(c.instances),c.instances[0]=a):c.instances.push(a),a.is_contained))for(r=0,o=a.siblings.length;r<o;r++)l=a.siblings[r],c=l.type.getCurrentSol(),c.select_all=!1,d?(cr.clearArray(c.instances),c.instances[0]=l):c.instances.push(l)}}},d.prototype.SetEffect=function(e){this.blend_mode=e,this.compositeOp=cr.effectToCompositeOp(e),cr.setGLBlend(this,e,this.runtime.gl),this.runtime.redraw=!0},d.prototype.StopAnim=function(){this.animPlaying=!1},d.prototype.StartAnim=function(e){this.animPlaying=!0,this.frameStart=this.getNowTime(),1===e&&0!==this.cur_frame&&(this.changeAnimFrame=0,!this.inAnimTrigger&&this.doChangeAnimFrame()),this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},d.prototype.SetAnim=function(e,t){this.changeAnimName=e,this.changeAnimFrom=t,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnim()},d.prototype.SetAnimFrame=function(e){this.changeAnimFrame=e,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnimFrame()},d.prototype.SetAnimSpeed=function(e){this.cur_anim_speed=cr.abs(e),this.animForwards=0<=e,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},d.prototype.SetAnimRepeatToFrame=function(e){e=Math.floor(e),0>e&&(e=0),e>=this.cur_animation.frames.length&&(e=this.cur_animation.frames.length-1),this.cur_anim_repeatto=e},d.prototype.SetMirrored=function(e){var t=cr.abs(this.width)*(0===e?-1:1);this.width===t||(this.width=t,this.set_bbox_changed())},d.prototype.SetFlipped=function(e){var t=cr.abs(this.height)*(0===e?-1:1);this.height===t||(this.height=t,this.set_bbox_changed())},d.prototype.SetScale=function(e){var t=this.curFrame,n=0>this.width?-1:1,a=0>this.height?-1:1,r=t.width*e*n,i=t.height*e*a;(this.width!==r||this.height!==i)&&(this.width=r,this.height=i,this.set_bbox_changed())},d.prototype.LoadURL=function(e,t,n){var a=new Image,r=this,i=this.curFrame;a.onload=function(){return i.texture_img.src===a.src?(r.runtime.glwrap&&r.curFrame===i&&(r.curWebGLTexture=i.webGL_texture),0===t&&(r.width=a.width,r.height=a.height,r.set_bbox_changed()),r.runtime.redraw=!0,void r.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,r)):void(i.texture_img=a,i.offx=0,i.offy=0,i.width=a.width,i.height=a.height,i.spritesheeted=!1,i.datauri="",i.pixelformat=0,r.runtime.glwrap&&(i.webGL_texture&&r.runtime.glwrap.deleteTexture(i.webGL_texture),i.webGL_texture=r.runtime.glwrap.loadTexture(a,!1,r.runtime.linearSampling),r.curFrame===i&&(r.curWebGLTexture=i.webGL_texture),r.type.updateAllCurrentTexture()),0===t&&(r.width=a.width,r.height=a.height,r.set_bbox_changed()),r.runtime.redraw=!0,r.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,r))},"data:"!==e.substr(0,5)&&0===n&&(a.crossOrigin="anonymous"),this.runtime.setImageSrc(a,e)},d.prototype.SetCollisions=function(e){this.collisionsEnabled===(0!==e)||(this.collisionsEnabled=0!==e,this.collisionsEnabled?this.set_bbox_changed():(this.collcells.right>=this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))},m.acts=new d;c.prototype.AnimationFrame=function(e){e.set_int(this.cur_frame)},c.prototype.AnimationFrameCount=function(e){e.set_int(this.cur_animation.frames.length)},c.prototype.AnimationName=function(e){e.set_string(this.cur_animation.name)},c.prototype.AnimationSpeed=function(e){e.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)},c.prototype.ImagePointX=function(e,t){e.set_float(this.getImagePoint(t,!0))},c.prototype.ImagePointY=function(e,t){e.set_float(this.getImagePoint(t,!1))},c.prototype.ImagePointCount=function(e){e.set_int(this.curFrame.image_points.length)},c.prototype.ImageWidth=function(e){e.set_float(this.curFrame.width)},c.prototype.ImageHeight=function(e){e.set_float(this.curFrame.height)},m.exps=new c}();cr.plugins_.Text=function(e){this.runtime=e},function(){function e(){return _.length?_.pop():{}}function t(e){_.push(e)}function n(e){var n,a;for(n=0,a=e.length;n<a;n++)t(e[n]);cr.clearArray(e)}function a(e){return e.length&&" "===e.charAt(e.length-1)?e.substring(0,e.length-1):e}function r(){}function i(){}function o(){}var s=Math.ceil,l=Math.round,p=Math.floor,d=Math.max,c=cr.plugins_.Text.prototype;c.onCreate=function(){c.acts.SetWidth=function(e){this.width!==e&&(this.width=e,this.text_changed=!0,this.set_bbox_changed())}},c.Type=function(e){this.plugin=e,this.runtime=e.runtime};var u=c.Type.prototype;u.onCreate=function(){},u.onLostWebGLContext=function(){if(!this.is_family){var e,t,n;for(e=0,t=this.instances.length;e<t;e++)n=this.instances[e],n.mycanvas=null,n.myctx=null,n.mytex=null}},c.Instance=function(e){this.type=e,this.runtime=e.runtime,this.recycled?cr.clearArray(this.lines):this.lines=[],this.text_changed=!0};var g=c.Instance.prototype,m={};g.onCreate=function(){this.text=this.properties[0],this.facename=this.properties[2],this.ptSize=this.properties[3],this.line_height_offset=this.properties[4],this.isBold=this.properties[5],this.isItalic=this.properties[6];var e=this.properties[7];this.color="rgb("+p(255*e[0])+","+p(255*e[1])+","+p(255*e[2])+")",this.halign=this.properties[8],this.valign=this.properties[9],this.wrapbyword=0===this.properties[10],this.visible=this.properties[11],this.lastwidth=this.width,this.lastwrapwidth=this.width,this.lastheight=this.height,this.font="",this.fontstyle="",this.pxHeight=0,this.textWidth=0,this.textHeight=0,this.updateFont(),this.mycanvas=null,this.myctx=null,this.mytex=null,this.need_text_redraw=!1,this.last_render_tick=this.runtime.tickcount,this.recycled?this.rcTex.set(0,0,1,1):this.rcTex=new cr.rect(0,0,1,1),this.runtime.glwrap&&this.runtime.tickMe(this)},g.saveToJSON=function(){return{t:this.text,f:this.font,c:this.color,ha:this.halign,va:this.valign,wr:this.wrapbyword,lho:this.line_height_offset,fn:this.facename,fs:this.fontstyle,ps:this.ptSize,pxh:this.pxHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick}},g.loadFromJSON=function(e){this.text=e.t,this.font=e.f,this.color=e.c,this.halign=e.ha,this.valign=e.va,this.wrapbyword=e.wr,this.line_height_offset=e.lho,this.facename=e.fn,this.fontstyle=e.fs,this.ptSize=e.ps,this.pxHeight=e.pxh,this.textWidth=e.tw,this.textHeight=e.th,this.last_render_tick=e.lrt,this.isBold=0!==this.fontstyle.indexOf("bold"),this.isItalic=0!==this.fontstyle.indexOf("italic"),this.text_changed=!0,this.lastwidth=this.width,this.lastwrapwidth=this.width,this.lastheight=this.height},g.tick=function(){if(this.runtime.glwrap&&this.mytex&&300<=this.runtime.tickcount-this.last_render_tick){var e=this.layer;this.update_bbox();var t=this.bbox;(t.right<e.viewLeft||t.bottom<e.viewTop||t.left>e.viewRight||t.top>e.viewBottom)&&(this.runtime.glwrap.deleteTexture(this.mytex),this.mytex=null,this.myctx=null,this.mycanvas=null)}},g.onDestroy=function(){this.myctx=null,this.mycanvas=null,this.runtime.glwrap&&this.mytex&&this.runtime.glwrap.deleteTexture(this.mytex),this.mytex=null},g.updateFont=function(){this.pxHeight=s(96*(this.ptSize/72))+4;var e=[];this.isBold&&e.push("bold"),this.isItalic&&e.push("italic"),this.fontstyle=e.join(" "),this.font=this.fontstyle+" "+this.ptSize.toString()+"pt '"+this.facename+"'",this.text_changed=!0,this.runtime.redraw=!0},g.draw=function(e,t){e.font=this.font,e.textBaseline="top",e.fillStyle=this.color,e.globalAlpha=t?1:this.opacity;var n=1;t&&(n=this.layer.getScale(),e.save(),e.scale(n,n)),(this.text_changed||this.width!==this.lastwrapwidth)&&(this.type.plugin.WordWrap(this.text,this.lines,e,this.width,this.wrapbyword),this.text_changed=!1,this.lastwrapwidth=this.width),this.update_bbox();var a=t?0:this.bquad.tlx,r=t?0:this.bquad.tly;this.runtime.pixel_rounding&&(a=0|a+.5,r=0|r+.5),0===this.angle||t||(e.save(),e.translate(a,r),e.rotate(this.angle),a=0,r=0);var o=r+this.height,s=this.pxHeight;s+=this.line_height_offset;var l,p;for(1===this.valign?r+=d(this.height/2-this.lines.length*s/2,0):2===this.valign&&(r+=d(this.height-this.lines.length*s-2,0)),p=0;p<this.lines.length&&(l=a,1===this.halign?l=a+(this.width-this.lines[p].width)/2:2===this.halign&&(l=a+(this.width-this.lines[p].width)),e.fillText(this.lines[p].text,l,r),r+=s,!(r>=o-s));p++);(0!==this.angle||t)&&e.restore(),this.last_render_tick=this.runtime.tickcount},g.drawGL=function(e){if(!(1>this.width||1>this.height)){var t=this.text_changed||this.need_text_redraw;this.need_text_redraw=!1;var n=this.layer.getScale(),a=this.layer.getAngle(),r=this.rcTex,i=n*this.width,o=n*this.height,l=s(i),p=s(o),d=this.runtime.draw_width/2,c=this.runtime.draw_height/2;this.myctx||(this.mycanvas=document.createElement("canvas"),this.mycanvas.width=l,this.mycanvas.height=p,this.lastwidth=l,this.lastheight=p,t=!0,this.myctx=this.mycanvas.getContext("2d")),(l!==this.lastwidth||p!==this.lastheight)&&(this.mycanvas.width=l,this.mycanvas.height=p,this.mytex&&(e.deleteTexture(this.mytex),this.mytex=null),t=!0),t&&(this.myctx.clearRect(0,0,l,p),this.draw(this.myctx,!0),!this.mytex&&(this.mytex=e.createEmptyTexture(l,p,this.runtime.linearSampling,this.runtime.isMobile)),e.videoToTexture(this.mycanvas,this.mytex,this.runtime.isMobile)),this.lastwidth=l,this.lastheight=p,e.setTexture(this.mytex),e.setOpacity(this.opacity),e.resetModelView(),e.translate(-d,-c),e.updateModelView();var u=this.bquad,g=this.layer.layerToCanvas(u.tlx,u.tly,!0,!0),m=this.layer.layerToCanvas(u.tlx,u.tly,!1,!0),y=this.layer.layerToCanvas(u.trx,u.try_,!0,!0),_=this.layer.layerToCanvas(u.trx,u.try_,!1,!0),h=this.layer.layerToCanvas(u.brx,u.bry,!0,!0),f=this.layer.layerToCanvas(u.brx,u.bry,!1,!0),x=this.layer.layerToCanvas(u.blx,u.bly,!0,!0),b=this.layer.layerToCanvas(u.blx,u.bly,!1,!0);if(this.runtime.pixel_rounding||0===this.angle&&0===a){var v=(0|g+.5)-g,w=(0|m+.5)-m;g+=v,m+=w,y+=v,_+=w,h+=v,f+=w,x+=v,b+=w}0===this.angle&&0===a?(y=g+l,_=m,h=y,f=m+p,x=g,b=f,r.right=1,r.bottom=1):(r.right=i/l,r.bottom=o/p),e.quadTex(g,m,y,_,h,f,x,b,r),e.resetModelView(),e.scale(n,n),e.rotateZ(-this.layer.getAngle()),e.translate((this.layer.viewLeft+this.layer.viewRight)/-2,(this.layer.viewTop+this.layer.viewBottom)/-2),e.updateModelView(),this.last_render_tick=this.runtime.tickcount}};var y=[];c.TokeniseWords=function(e){cr.clearArray(y);for(var t="",n=0,a;n<e.length;)if(a=e.charAt(n),"\n"===a)t.length&&(y.push(t),t=""),y.push("\n"),++n;else if(" "===a||"\t"===a||"-"===a){do t+=e.charAt(n),n++;while(n<e.length&&(" "===e.charAt(n)||"\t"===e.charAt(n)));y.push(t),t=""}else n<e.length&&(t+=a,n++);t.length&&y.push(t)};var _=[];c.WordWrap=function(t,a,r,i,o){if(!t||!t.length)return void n(a);if(2>=i)return void n(a);if(100>=t.length&&-1===t.indexOf("\n")){var s=r.measureText(t).width;if(s<=i)return n(a),a.push(e()),a[0].text=t,void(a[0].width=s)}this.WrapText(t,a,r,i,o)};c.WrapText=function(n,r,o,s,l){var p;l?(this.TokeniseWords(n),p=y):p=n;var d="",c=0,u,g,m,_;for(m=0;m<p.length;m++){if("\n"===p[m]){c>=r.length&&r.push(e()),d=a(d),_=r[c],_.text=d,_.width=o.measureText(d).width,c++,d="";continue}u=d,d+=p[m],g=o.measureText(a(d)).width,g>=s&&(c>=r.length&&r.push(e()),u=a(u),_=r[c],_.text=u,_.width=o.measureText(u).width,c++,d=p[m],!l&&" "===d&&(d=""))}for(d.length&&(c>=r.length&&r.push(e()),d=a(d),_=r[c],_.text=d,_.width=o.measureText(d).width,c++),m=c;m<r.length;m++)t(r[m]);r.length=c};r.prototype.CompareText=function(e,t){return t?this.text==e:cr.equals_nocase(this.text,e)},c.cnds=new r;i.prototype.SetText=function(e){cr.is_number(e)&&1e9>e&&(e=l(1e10*e)/1e10);var t=e.toString();this.text!==t&&(this.text=t,this.text_changed=!0,this.runtime.redraw=!0)},i.prototype.AppendText=function(e){cr.is_number(e)&&(e=l(1e10*e)/1e10);var t=e.toString();t&&(this.text+=t,this.text_changed=!0,this.runtime.redraw=!0)},i.prototype.SetFontFace=function(e,t){var n=!1,a=!1;1===t?n=!0:2===t?a=!0:3===t?(n=!0,a=!0):void 0;e===this.facename&&this.isBold===n&&this.isItalic===a||(this.facename=e,this.isBold=n,this.isItalic=a,this.updateFont())},i.prototype.SetFontSize=function(e){this.ptSize===e||(this.ptSize=e,this.updateFont())},i.prototype.SetFontColor=function(e){var t=cr.clamp(p(255*cr.GetRValue(e)),0,255),n=cr.clamp(p(255*cr.GetGValue(e)),0,255),a=cr.clamp(p(255*cr.GetBValue(e)),0,255),r="rgb("+t+","+n+","+a+")";r===this.color||(this.color=r,this.need_text_redraw=!0,this.runtime.redraw=!0)},i.prototype.SetWebFont=function(e,t){var n=this,a=function(){n.runtime.redraw=!0,n.text_changed=!0};if(m.hasOwnProperty(t)){var r="'"+e+"'";if(this.facename===r)return;this.facename=r,this.updateFont();for(var o=1;10>o;o++)setTimeout(a,100*o),setTimeout(a,1e3*o);return}var s=document.createElement("link");s.href=t,s.rel="stylesheet",s.type="text/css",s.onload=a,document.getElementsByTagName("head")[0].appendChild(s),m[t]=!0,this.facename="'"+e+"'",this.updateFont();for(var o=1;10>o;o++)setTimeout(a,100*o),setTimeout(a,1e3*o)},i.prototype.SetEffect=function(e){this.blend_mode=e,this.compositeOp=cr.effectToCompositeOp(e),cr.setGLBlend(this,e,this.runtime.gl),this.runtime.redraw=!0},c.acts=new i;o.prototype.Text=function(e){e.set_string(this.text)},o.prototype.FaceName=function(e){e.set_string(this.facename)},o.prototype.FaceSize=function(e){e.set_int(this.ptSize)},o.prototype.TextWidth=function(e){var t=0,n,a,r;for(n=0,a=this.lines.length;n<a;n++)r=this.lines[n].width,t<r&&(t=r);e.set_int(t)},o.prototype.TextHeight=function(e){e.set_int(this.lines.length*(this.pxHeight+this.line_height_offset)-this.line_height_offset)},c.exps=new o}();cr.plugins_.Touch=function(e){this.runtime=e},function(){function e(e){g=e.x,m=e.y,y=e.z}function n(e,n,a,r){var i;return i=h.length?h.pop():new t,i.init(e,n,a,r),i}function a(e){100>h.length&&h.push(e)}function t(){this.starttime=0,this.time=0,this.lasttime=0,this.startx=0,this.starty=0,this.x=0,this.y=0,this.lastx=0,this.lasty=0,this.id=0,this.startindex=0,this.triggeredHold=!1,this.tooFarForHold=!1}function r(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents||t.originalEvent&&t.originalEvent.sourceCapabilities&&t.originalEvent.sourceCapabilities.firesTouchEvents}function i(){}function o(){}function s(){}var l=Math.floor,p=Math.max,d=cr.plugins_.Touch.prototype;d.Type=function(e){this.plugin=e,this.runtime=e.runtime};var c=d.Type.prototype;c.onCreate=function(){},d.Instance=function(e){this.type=e,this.runtime=e.runtime,this.touches=[],this.mouseDown=!1};var u=d.Instance.prototype;u.findTouch=function(e){var t,n;for(t=0,n=this.touches.length;t<n;t++)if(this.touches[t].id===e)return t;return-1};var g=0,m=0,y=0;var _=null,h=[];t.prototype.init=function(e,t,n,a){var r=cr.performance_now();this.time=r,this.lasttime=r,this.starttime=r,this.startx=e,this.starty=t,this.x=e,this.y=t,this.lastx=e,this.lasty=t,this.width=0,this.height=0,this.pressure=0,this.id=n,this.startindex=a,this.triggeredHold=!1,this.tooFarForHold=!1},t.prototype.update=function(e,t,n,a,r,i){this.lasttime=this.time,this.time=e,this.lastx=this.x,this.lasty=this.y,this.x=t,this.y=n,this.width=a,this.height=r,this.pressure=i,!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)>=15&&(this.tooFarForHold=!0)},t.prototype.maybeTriggerHold=function(e,t){if(!this.triggeredHold){var n=cr.performance_now();500<=n-this.starttime&&!this.tooFarForHold&&15>cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.triggeredHold=!0,e.trigger_index=this.startindex,e.trigger_id=this.id,e.getTouchIndex=t,e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,e),e.curTouchX=this.x,e.curTouchY=this.y,e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,e),e.getTouchIndex=0)}};var f=-1e3,x=-1e3,b=-1e4;t.prototype.maybeTriggerTap=function(e,t){if(!this.triggeredHold){var n=cr.performance_now();333>=n-this.starttime&&!this.tooFarForHold&&15>cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(e.trigger_index=this.startindex,e.trigger_id=this.id,e.getTouchIndex=t,666>=n-b&&25>cr.distanceTo(f,x,this.x,this.y)?(e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,e),e.curTouchX=this.x,e.curTouchY=this.y,e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,e),f=-1e3,x=-1e3,b=-1e4):(e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,e),e.curTouchX=this.x,e.curTouchY=this.y,e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,e),f=this.x,x=this.y,b=n),e.getTouchIndex=0)}},u.onCreate=function(){_=this,this.isWindows8=!!("undefined"!=typeof window.c2isWindows8&&window.c2isWindows8),this.orient_alpha=0,this.orient_beta=0,this.orient_gamma=0,this.acc_g_x=0,this.acc_g_y=0,this.acc_g_z=0,this.acc_x=0,this.acc_y=0,this.acc_z=0,this.curTouchX=0,this.curTouchY=0,this.trigger_index=0,this.trigger_id=0,this.trigger_permission=0,this.getTouchIndex=0,this.useMouseInput=this.properties[0];var t=0<this.runtime.fullscreen_mode?document:this.runtime.canvas,n=document,a=this;if("undefined"==typeof PointerEvent?window.navigator.msPointerEnabled?(t.addEventListener("MSPointerDown",function(e){a.onPointerStart(e)},!1),t.addEventListener("MSPointerMove",function(e){a.onPointerMove(e)},!1),n.addEventListener("MSPointerUp",function(e){a.onPointerEnd(e,!1)},!1),n.addEventListener("MSPointerCancel",function(e){a.onPointerEnd(e,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1))):(t.addEventListener("touchstart",function(e){a.onTouchStart(e)},!1),t.addEventListener("touchmove",function(e){a.onTouchMove(e)},!1),n.addEventListener("touchend",function(e){a.onTouchEnd(e,!1)},!1),n.addEventListener("touchcancel",function(e){a.onTouchEnd(e,!0)},!1)):(t.addEventListener("pointerdown",function(e){a.onPointerStart(e)},!1),t.addEventListener("pointermove",function(e){a.onPointerMove(e)},!1),n.addEventListener("pointerup",function(e){a.onPointerEnd(e,!1)},!1),n.addEventListener("pointercancel",function(e){a.onPointerEnd(e,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),this.runtime.canvas.addEventListener("gesturehold",function(t){t.preventDefault()},!1),document.addEventListener("gesturehold",function(t){t.preventDefault()},!1))),this.isWindows8){var r=function(t){var e=t.reading;a.acc_x=e.accelerationX,a.acc_y=e.accelerationY,a.acc_z=e.accelerationZ},i=function(t){var e=t.reading;a.orient_alpha=e.yawDegrees,a.orient_beta=e.pitchDegrees,a.orient_gamma=e.rollDegrees},o=Windows.Devices.Sensors.Accelerometer.getDefault();o&&(o.reportInterval=p(o.minimumReportInterval,16),o.addEventListener("readingchanged",r));var s=Windows.Devices.Sensors.Inclinometer.getDefault();s&&(s.reportInterval=p(s.minimumReportInterval,16),s.addEventListener("readingchanged",i)),document.addEventListener("visibilitychange",function(){document.hidden||document.msHidden?(o&&o.removeEventListener("readingchanged",r),s&&s.removeEventListener("readingchanged",i)):(o&&o.addEventListener("readingchanged",r),s&&s.addEventListener("readingchanged",i))},!1)}else window.addEventListener("deviceorientation",function(e){a.orient_alpha=e.alpha||0,a.orient_beta=e.beta||0,a.orient_gamma=e.gamma||0},!1),window.addEventListener("devicemotion",function(e){e.accelerationIncludingGravity&&(a.acc_g_x=e.accelerationIncludingGravity.x||0,a.acc_g_y=e.accelerationIncludingGravity.y||0,a.acc_g_z=e.accelerationIncludingGravity.z||0),e.acceleration&&(a.acc_x=e.acceleration.x||0,a.acc_y=e.acceleration.y||0,a.acc_z=e.acceleration.z||0)},!1);this.useMouseInput&&(document.addEventListener("mousemove",function(e){a.onMouseMove(e)}),document.addEventListener("mousedown",function(e){a.onMouseDown(e)}),document.addEventListener("mouseup",function(e){a.onMouseUp(e)})),!this.runtime.isiOS&&this.runtime.isCordova&&navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(e,null,{frequency:40}),this.runtime.tick2Me(this)},u.onPointerMove=function(e){if(e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType){e.preventDefault&&e.preventDefault();var n=this.findTouch(e.pointerId),a=cr.performance_now();if(0<=n){var r=this.runtime.canvas.offsetLeft,i=this.runtime.canvas.offsetTop,o=this.touches[n];if(2>a-o.time)return;o.update(a,e.pageX-r,e.pageY-i,e.width||0,e.height||0,e.pressure||0)}}},u.onPointerStart=function(e){if(e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType){var t=this.findTouch(e.pointerId);if(-1===t){e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault();var a=this.runtime.canvas.offsetLeft,r=this.runtime.canvas.offsetTop,i=e.pageX-a,o=e.pageY-r,s=cr.performance_now();this.trigger_index=this.touches.length,this.trigger_id=e.pointerId,this.touches.push(n(i,o,e.pointerId,this.trigger_index)),this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=i,this.curTouchY=o,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this),this.runtime.isInUserInputEvent=!1}}},u.onPointerEnd=function(e,t){if(e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType){e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault();var n=this.findTouch(e.pointerId);this.trigger_index=0<=n?this.touches[n].startindex:-1,this.trigger_id=0<=n?this.touches[n].id:-1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),0<=n&&(!t&&this.touches[n].maybeTriggerTap(this,n),a(this.touches[n]),this.touches.splice(n,1)),this.runtime.isInUserInputEvent=!1}},u.onTouchMove=function(e){e.preventDefault&&e.preventDefault();var n=cr.performance_now(),a,r,o,s;for(a=0,r=e.changedTouches.length;a<r;a++){o=e.changedTouches[a];var l=this.findTouch(o.identifier);if(0<=l){var p=this.runtime.canvas.offsetLeft,d=this.runtime.canvas.offsetTop;if(s=this.touches[l],2>n-s.time)continue;var c=2*(o.radiusX||o.webkitRadiusX||o.mozRadiusX||o.msRadiusX||0),g=2*(o.radiusY||o.webkitRadiusY||o.mozRadiusY||o.msRadiusY||0),m=o.force||o.webkitForce||o.mozForce||o.msForce||0;s.update(n,o.pageX-p,o.pageY-d,c,g,m)}}},u.onTouchStart=function(e){e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault();var a=this.runtime.canvas.offsetLeft,r=this.runtime.canvas.offsetTop,o=cr.performance_now();this.runtime.isInUserInputEvent=!0;var s,l,p,d;for(s=0,l=e.changedTouches.length;s<l;s++)if(p=e.changedTouches[s],d=this.findTouch(p.identifier),-1===d){var c=p.pageX-a,u=p.pageY-r;this.trigger_index=this.touches.length,this.trigger_id=p.identifier,this.touches.push(n(c,u,p.identifier,this.trigger_index)),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=c,this.curTouchY=u,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this)}this.runtime.isInUserInputEvent=!1},u.onTouchEnd=function(e,n){e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault(),this.runtime.isInUserInputEvent=!0;var r,o,s,l;for(r=0,o=e.changedTouches.length;r<o;r++)s=e.changedTouches[r],l=this.findTouch(s.identifier),0<=l&&(this.trigger_index=this.touches[l].startindex,this.trigger_id=this.touches[l].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),!n&&this.touches[l].maybeTriggerTap(this,l),a(this.touches[l]),this.touches.splice(l,1));this.runtime.isInUserInputEvent=!1},u.getAlpha=function(){return this.runtime.isCordova&&0===this.orient_alpha&&0!==y?90*y:this.orient_alpha},u.getBeta=function(){return this.runtime.isCordova&&0===this.orient_beta&&0!==m?90*m:this.orient_beta},u.getGamma=function(){return this.runtime.isCordova&&0===this.orient_gamma&&0!==g?90*g:this.orient_gamma};u.onMouseDown=function(e){if(!r(e)){var n={pageX:e.pageX,pageY:e.pageY,identifier:0};this.onTouchStart({changedTouches:[n]}),this.mouseDown=!0}},u.onMouseMove=function(e){if(this.mouseDown&&!r(e)){var n={pageX:e.pageX,pageY:e.pageY,identifier:0};this.onTouchMove({changedTouches:[n]})}},u.onMouseUp=function(e){if(e.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&e.preventDefault(),this.runtime.had_a_click=!0,!r(e)){var n={pageX:e.pageX,pageY:e.pageY,identifier:0};this.onTouchEnd({changedTouches:[n]}),this.mouseDown=!1}},u.isClientPosOverCanvas=function(e,t){return 0<=e&&0<=t&&e<this.runtime.width&&t<this.runtime.height},u.tick2=function(){var e=cr.performance_now(),n,a,r;for(n=0,a=this.touches.length;n<a;++n)r=this.touches[n],r.time<=e-50&&(r.lasttime=e),r.maybeTriggerHold(this,n)};i.prototype.OnTouchStart=function(){return!0},i.prototype.OnTouchEnd=function(){return!0},i.prototype.IsInTouch=function(){return this.touches.length},i.prototype.OnTouchObject=function(e){return!!e&&!!this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)&&this.runtime.testAndSelectCanvasPointOverlap(e,this.curTouchX,this.curTouchY,!1)};var v=[];i.prototype.IsTouchingObject=function(e){if(!e)return!1;var t=e.getCurrentSol(),n=t.getObjects(),a,r,o,s,l,p;for(o=0,s=n.length;o<s;o++){var d=n[o];for(d.update_bbox(),l=0,p=this.touches.length;l<p;l++){var c=this.touches[l];if(this.isClientPosOverCanvas(c.x,c.y)&&(a=d.layer.canvasToLayer(c.x,c.y,!0),r=d.layer.canvasToLayer(c.x,c.y,!1),d.contains_pt(a,r))){v.push(d);break}}}return!!v.length&&(t.select_all=!1,cr.shallowAssignArray(t.instances,v),e.applySolToContainer(),cr.clearArray(v),!0)},i.prototype.CompareTouchSpeed=function(e,n,a){if(e=l(e),0>e||e>=this.touches.length)return!1;var r=this.touches[e],t=cr.distanceTo(r.x,r.y,r.lastx,r.lasty),i=(r.time-r.lasttime)/1e3,o=0;return 0<i&&(o=t/i),cr.do_cmp(o,n,a)},i.prototype.OrientationSupported=function(){return"undefined"!=typeof window.DeviceOrientationEvent},i.prototype.MotionSupported=function(){return"undefined"!=typeof window.DeviceMotionEvent},i.prototype.CompareOrientation=function(e,t,n){var a=0;return a=0===e?this.getAlpha():1===e?this.getBeta():this.getGamma(),cr.do_cmp(a,t,n)},i.prototype.CompareAcceleration=function(e,t,n){var a=0;return 0===e?a=this.acc_g_x:1===e?a=this.acc_g_y:2===e?a=this.acc_g_z:3===e?a=this.acc_x:4===e?a=this.acc_y:5==e&&(a=this.acc_z),cr.do_cmp(a,t,n)},i.prototype.OnNthTouchStart=function(e){return e=l(e),e===this.trigger_index},i.prototype.OnNthTouchEnd=function(e){return e=l(e),e===this.trigger_index},i.prototype.HasNthTouch=function(e){return e=l(e),this.touches.length>=e+1},i.prototype.OnHoldGesture=function(){return!0},i.prototype.OnTapGesture=function(){return!0},i.prototype.OnDoubleTapGesture=function(){return!0},i.prototype.OnHoldGestureObject=function(e){return!!e&&!!this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)&&this.runtime.testAndSelectCanvasPointOverlap(e,this.curTouchX,this.curTouchY,!1)},i.prototype.OnTapGestureObject=function(e){return!!e&&!!this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)&&this.runtime.testAndSelectCanvasPointOverlap(e,this.curTouchX,this.curTouchY,!1)},i.prototype.OnDoubleTapGestureObject=function(e){return!!e&&!!this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)&&this.runtime.testAndSelectCanvasPointOverlap(e,this.curTouchX,this.curTouchY,!1)},i.prototype.OnPermissionGranted=function(e){return this.trigger_permission===e},i.prototype.OnPermissionDenied=function(e){return this.trigger_permission===e},d.cnds=new i;o.prototype.RequestPermission=function(e){var t=this,n=Promise.resolve(!0);0===e?window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission&&(n=window.DeviceOrientationEvent.requestPermission().then(function(e){return"granted"===e})):window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission&&(n=window.DeviceMotionEvent.requestPermission().then(function(e){return"granted"===e})),n.then(function(n){t.trigger_permission=e,n?t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionGranted,t):t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionDenied,t)})},d.acts=new o;s.prototype.TouchCount=function(e){e.set_int(this.touches.length)},s.prototype.X=function(e,t){var n=this.getTouchIndex;if(0>n||n>=this.touches.length)return void e.set_float(0);var a,r,i,o,s;cr.is_undefined(t)?(a=this.runtime.getLayerByNumber(0),r=a.scale,i=a.zoomRate,o=a.parallaxX,s=a.angle,a.scale=1,a.zoomRate=1,a.parallaxX=1,a.angle=0,e.set_float(a.canvasToLayer(this.touches[n].x,this.touches[n].y,!0)),a.scale=r,a.zoomRate=i,a.parallaxX=o,a.angle=s):(a=cr.is_number(t)?this.runtime.getLayerByNumber(t):this.runtime.getLayerByName(t),a?e.set_float(a.canvasToLayer(this.touches[n].x,this.touches[n].y,!0)):e.set_float(0))},s.prototype.XAt=function(e,t,n){if(t=l(t),0>t||t>=this.touches.length)return void e.set_float(0);var a,r,i,o,s;cr.is_undefined(n)?(a=this.runtime.getLayerByNumber(0),r=a.scale,i=a.zoomRate,o=a.parallaxX,s=a.angle,a.scale=1,a.zoomRate=1,a.parallaxX=1,a.angle=0,e.set_float(a.canvasToLayer(this.touches[t].x,this.touches[t].y,!0)),a.scale=r,a.zoomRate=i,a.parallaxX=o,a.angle=s):(a=cr.is_number(n)?this.runtime.getLayerByNumber(n):this.runtime.getLayerByName(n),a?e.set_float(a.canvasToLayer(this.touches[t].x,this.touches[t].y,!0)):e.set_float(0))},s.prototype.XForID=function(e,t,n){var a=this.findTouch(t);if(0>a)return void e.set_float(0);var r=this.touches[a],i,o,s,l,p;cr.is_undefined(n)?(i=this.runtime.getLayerByNumber(0),o=i.scale,s=i.zoomRate,l=i.parallaxX,p=i.angle,i.scale=1,i.zoomRate=1,i.parallaxX=1,i.angle=0,e.set_float(i.canvasToLayer(r.x,r.y,!0)),i.scale=o,i.zoomRate=s,i.parallaxX=l,i.angle=p):(i=cr.is_number(n)?this.runtime.getLayerByNumber(n):this.runtime.getLayerByName(n),i?e.set_float(i.canvasToLayer(r.x,r.y,!0)):e.set_float(0))},s.prototype.Y=function(e,t){var n=this.getTouchIndex;if(0>n||n>=this.touches.length)return void e.set_float(0);var a,r,i,o,s;cr.is_undefined(t)?(a=this.runtime.getLayerByNumber(0),r=a.scale,i=a.zoomRate,o=a.parallaxY,s=a.angle,a.scale=1,a.zoomRate=1,a.parallaxY=1,a.angle=0,e.set_float(a.canvasToLayer(this.touches[n].x,this.touches[n].y,!1)),a.scale=r,a.zoomRate=i,a.parallaxY=o,a.angle=s):(a=cr.is_number(t)?this.runtime.getLayerByNumber(t):this.runtime.getLayerByName(t),a?e.set_float(a.canvasToLayer(this.touches[n].x,this.touches[n].y,!1)):e.set_float(0))},s.prototype.YAt=function(e,t,n){if(t=l(t),0>t||t>=this.touches.length)return void e.set_float(0);var a,r,i,o,s;cr.is_undefined(n)?(a=this.runtime.getLayerByNumber(0),r=a.scale,i=a.zoomRate,o=a.parallaxY,s=a.angle,a.scale=1,a.zoomRate=1,a.parallaxY=1,a.angle=0,e.set_float(a.canvasToLayer(this.touches[t].x,this.touches[t].y,!1)),a.scale=r,a.zoomRate=i,a.parallaxY=o,a.angle=s):(a=cr.is_number(n)?this.runtime.getLayerByNumber(n):this.runtime.getLayerByName(n),a?e.set_float(a.canvasToLayer(this.touches[t].x,this.touches[t].y,!1)):e.set_float(0))},s.prototype.YForID=function(e,t,n){var a=this.findTouch(t);if(0>a)return void e.set_float(0);var r=this.touches[a],i,o,s,l,p;cr.is_undefined(n)?(i=this.runtime.getLayerByNumber(0),o=i.scale,s=i.zoomRate,l=i.parallaxY,p=i.angle,i.scale=1,i.zoomRate=1,i.parallaxY=1,i.angle=0,e.set_float(i.canvasToLayer(r.x,r.y,!1)),i.scale=o,i.zoomRate=s,i.parallaxY=l,i.angle=p):(i=cr.is_number(n)?this.runtime.getLayerByNumber(n):this.runtime.getLayerByName(n),i?e.set_float(i.canvasToLayer(r.x,r.y,!1)):e.set_float(0))},s.prototype.AbsoluteX=function(e){this.touches.length?e.set_float(this.touches[0].x):e.set_float(0)},s.prototype.AbsoluteXAt=function(e,t){return t=l(t),0>t||t>=this.touches.length?void e.set_float(0):void e.set_float(this.touches[t].x)},s.prototype.AbsoluteXForID=function(e,t){var n=this.findTouch(t);if(0>n)return void e.set_float(0);var a=this.touches[n];e.set_float(a.x)},s.prototype.AbsoluteY=function(e){this.touches.length?e.set_float(this.touches[0].y):e.set_float(0)},s.prototype.AbsoluteYAt=function(e,t){return t=l(t),0>t||t>=this.touches.length?void e.set_float(0):void e.set_float(this.touches[t].y)},s.prototype.AbsoluteYForID=function(e,t){var n=this.findTouch(t);if(0>n)return void e.set_float(0);var a=this.touches[n];e.set_float(a.y)},s.prototype.SpeedAt=function(e,n){if(n=l(n),0>n||n>=this.touches.length)return void e.set_float(0);var a=this.touches[n],t=cr.distanceTo(a.x,a.y,a.lastx,a.lasty),r=(a.time-a.lasttime)/1e3;0>=r?e.set_float(0):e.set_float(t/r)},s.prototype.SpeedForID=function(e,t){var n=this.findTouch(t);if(0>n)return void e.set_float(0);var a=this.touches[n],r=cr.distanceTo(a.x,a.y,a.lastx,a.lasty),i=(a.time-a.lasttime)/1e3;0>=i?e.set_float(0):e.set_float(r/i)},s.prototype.AngleAt=function(e,n){if(n=l(n),0>n||n>=this.touches.length)return void e.set_float(0);var a=this.touches[n];e.set_float(cr.to_degrees(cr.angleTo(a.lastx,a.lasty,a.x,a.y)))},s.prototype.AngleForID=function(e,t){var n=this.findTouch(t);if(0>n)return void e.set_float(0);var a=this.touches[n];e.set_float(cr.to_degrees(cr.angleTo(a.lastx,a.lasty,a.x,a.y)))},s.prototype.Alpha=function(e){e.set_float(this.getAlpha())},s.prototype.Beta=function(e){e.set_float(this.getBeta())},s.prototype.Gamma=function(e){e.set_float(this.getGamma())},s.prototype.AccelerationXWithG=function(e){e.set_float(this.acc_g_x)},s.prototype.AccelerationYWithG=function(e){e.set_float(this.acc_g_y)},s.prototype.AccelerationZWithG=function(e){e.set_float(this.acc_g_z)},s.prototype.AccelerationX=function(e){e.set_float(this.acc_x)},s.prototype.AccelerationY=function(e){e.set_float(this.acc_y)},s.prototype.AccelerationZ=function(e){e.set_float(this.acc_z)},s.prototype.TouchIndex=function(e){e.set_int(this.trigger_index)},s.prototype.TouchID=function(e){e.set_float(this.trigger_id)},s.prototype.WidthForID=function(e,t){var n=this.findTouch(t);if(0>n)return void e.set_float(0);var a=this.touches[n];e.set_float(a.width)},s.prototype.HeightForID=function(e,t){var n=this.findTouch(t);if(0>n)return void e.set_float(0);var a=this.touches[n];e.set_float(a.height)},s.prototype.PressureForID=function(e,t){var n=this.findTouch(t);if(0>n)return void e.set_float(0);var a=this.touches[n];e.set_float(a.pressure)},d.exps=new s}();cr.plugins_.WebStorage=function(e){this.runtime=e},function(){function e(){}function t(){}function n(){}var a=cr.plugins_.WebStorage.prototype;a.Type=function(e){this.plugin=e,this.runtime=e.runtime};var r=a.Type.prototype;r.onCreate=function(){},a.Instance=function(e){this.type=e,this.runtime=e.runtime};var i=a.Instance.prototype,s="",l="undefined"!=typeof window.is_scirra_arcade;l&&(s="arcade"+window.scirra_arcade_id);var c=!1;try{localStorage.getItem("test"),c=!0}catch(t){c=!1}i.onCreate=function(){c||cr.logexport("[Construct 2] Webstorage plugin: local storage is not supported on this platform.")};e.prototype.LocalStorageEnabled=function(){return c},e.prototype.SessionStorageEnabled=function(){return c},e.prototype.LocalStorageExists=function(e){return!!c&&null!=localStorage.getItem(s+e)},e.prototype.SessionStorageExists=function(e){return!!c&&null!=sessionStorage.getItem(s+e)},e.prototype.OnQuotaExceeded=function(){return!0},e.prototype.CompareKeyText=function(e,t,n){if(!c)return!1;var a=localStorage.getItem(s+e)||"";return n?a==t:cr.equals_nocase(a,t)},e.prototype.CompareKeyNumber=function(e,t,n){if(!c)return!1;var a=localStorage.getItem(s+e)||"";return cr.do_cmp(parseFloat(a),t,n)},a.cnds=new e;t.prototype.StoreLocal=function(e,t){if(c)try{localStorage.setItem(s+e,t)}catch(t){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}},t.prototype.StoreSession=function(e,t){if(c)try{sessionStorage.setItem(s+e,t)}catch(t){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}},t.prototype.RemoveLocal=function(e){c&&localStorage.removeItem(s+e)},t.prototype.RemoveSession=function(e){c&&sessionStorage.removeItem(s+e)},t.prototype.ClearLocal=function(){c&&(l||localStorage.clear())},t.prototype.ClearSession=function(){c&&(l||sessionStorage.clear())},t.prototype.JSONLoad=function(e,t){if(c){var n;try{n=JSON.parse(e)}catch(t){return}if(n.c2dictionary){var a=n.data;0!==t||l||localStorage.clear();for(var r in a)if(a.hasOwnProperty(r))try{localStorage.setItem(s+r,a[r])}catch(t){return void this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}}}},a.acts=new t;n.prototype.LocalValue=function(e,t){return c?void e.set_string(localStorage.getItem(s+t)||""):void e.set_string("")},n.prototype.SessionValue=function(e,t){return c?void e.set_string(sessionStorage.getItem(s+t)||""):void e.set_string("")},n.prototype.LocalCount=function(e){return c?void e.set_int(l?0:localStorage.length):void e.set_int(0)},n.prototype.SessionCount=function(e){return c?void e.set_int(l?0:sessionStorage.length):void e.set_int(0)},n.prototype.LocalAt=function(e,t){l||!c?e.set_string(""):e.set_string(localStorage.getItem(localStorage.key(t))||"")},n.prototype.SessionAt=function(e,t){l||!c?e.set_string(""):e.set_string(sessionStorage.getItem(sessionStorage.key(t))||"")},n.prototype.LocalKeyAt=function(e,t){l||!c?e.set_string(""):e.set_string(localStorage.key(t)||"")},n.prototype.SessionKeyAt=function(e,t){l||!c?e.set_string(""):e.set_string(sessionStorage.key(t)||"")},n.prototype.AsJSON=function(e){if(!c)return void e.set_string("");var t={},n,a,r;for(n=0,a=localStorage.length;n<a;n++)r=localStorage.key(n),l?r.substr(0,s.length)===s&&(t[r.substr(s.length)]=localStorage.getItem(r)):t[r]=localStorage.getItem(r);e.set_string(JSON.stringify({c2dictionary:!0,data:t}))},a.exps=new n}();cr.plugins_.Button=function(e){this.runtime=e},function(){function e(){}function t(){}function n(){}var a=Math.round,r=cr.plugins_.Button.prototype;r.Type=function(e){this.plugin=e,this.runtime=e.runtime};var i=r.Type.prototype;i.onCreate=function(){},r.Instance=function(e){this.type=e,this.runtime=e.runtime};var o=r.Instance.prototype;o.onCreate=function(){this.isCheckbox=1===this.properties[0],this.inputElem=document.createElement("input"),this.elem=this.isCheckbox?document.createElement("label"):this.inputElem,this.labelText=null,this.inputElem.type=this.isCheckbox?"checkbox":"button",this.inputElem.id=this.properties[7],document.body.appendChild(this.elem),this.isCheckbox?(this.elem.appendChild(this.inputElem),this.labelText=document.createTextNode(this.properties[1]),this.elem.appendChild(this.labelText),this.inputElem.checked=this.properties[6],this.elem.style.fontFamily="sans-serif",this.elem.style.display="inline-block",this.elem.style.color="black"):this.inputElem.value=this.properties[1],this.elem.title=this.properties[2],this.inputElem.disabled=!this.properties[4],this.autoFontSize=this.properties[5],this.element_hidden=!1,this.properties[3]||(this.elem.style.display="none",this.visible=!1,this.element_hidden=!0),this.inputElem.onclick=function(t){return function(n){n.stopPropagation(),t.runtime.isInUserInputEvent=!0,t.runtime.trigger(cr.plugins_.Button.prototype.cnds.OnClicked,t),t.runtime.isInUserInputEvent=!1}}(this),this.elem.addEventListener("touchstart",function(t){t.stopPropagation()},!1),this.elem.addEventListener("touchmove",function(t){t.stopPropagation()},!1),this.elem.addEventListener("touchend",function(t){t.stopPropagation()},!1),this.elem.addEventListener("mousedown",function(t){t.stopPropagation()}),this.elem.addEventListener("mouseup",function(t){t.stopPropagation()}),this.elem.addEventListener("keydown",function(t){t.stopPropagation()}),this.elem.addEventListener("keyup",function(t){t.stopPropagation()}),this.lastLeft=0,this.lastTop=0,this.lastRight=0,this.lastBottom=0,this.lastWinWidth=0,this.lastWinHeight=0,this.updatePosition(!0),this.runtime.tickMe(this)},o.saveToJSON=function(){var e={tooltip:this.elem.title,disabled:!!this.inputElem.disabled};return this.isCheckbox?(e.checked=!!this.inputElem.checked,e.text=this.labelText.nodeValue):e.text=this.elem.value,e},o.loadFromJSON=function(e){this.elem.title=e.tooltip,this.inputElem.disabled=e.disabled,this.isCheckbox?(this.inputElem.checked=e.checked,this.labelText.nodeValue=e.text):this.elem.value=e.text},o.onDestroy=function(){this.elem.parentElement.removeChild(this.elem),this.elem=null},o.tick=function(){this.updatePosition()};o.updatePosition=function(e){var t=this.layer.layerToCanvas(this.x,this.y,!0),n=this.layer.layerToCanvas(this.x,this.y,!1),r=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!0),i=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!1),o=this.runtime.width/this.runtime.devicePixelRatio,s=this.runtime.height/this.runtime.devicePixelRatio;if(!this.visible||!this.layer.visible||0>=r||0>=i||t>=o||n>=s)return this.element_hidden||(this.elem.style.display="none"),void(this.element_hidden=!0);1>t&&(t=1),1>n&&(n=1),r>=o&&(r=o-1),i>=s&&(i=s-1);var l=window.innerWidth,p=window.innerHeight;if(!e&&this.lastLeft===t&&this.lastTop===n&&this.lastRight===r&&this.lastBottom===i&&this.lastWinWidth===l&&this.lastWinHeight===p)return void(this.element_hidden&&(this.elem.style.display="",this.element_hidden=!1));this.lastLeft=t,this.lastTop=n,this.lastRight=r,this.lastBottom=i,this.lastWinWidth=l,this.lastWinHeight=p,this.element_hidden&&(this.elem.style.display="",this.element_hidden=!1);var d=a(t)+this.runtime.canvas.offsetLeft,c=a(n)+this.runtime.canvas.offsetTop;this.elem.style.position="absolute",this.elem.style.left=d+"px",this.elem.style.top=c+"px",this.elem.style.width=a(r-t)+"px",this.elem.style.height=a(i-n)+"px",this.autoFontSize&&(this.elem.style.fontSize=this.layer.getScale(!0)/this.runtime.devicePixelRatio-.2+"em")},o.draw=function(){},o.drawGL=function(){};e.prototype.OnClicked=function(){return!0},e.prototype.IsChecked=function(){return this.isCheckbox&&this.inputElem.checked},e.prototype.CompareText=function(e,t){var n;return n=this.isCheckbox?this.labelText.nodeValue:this.elem.value,t?n==e:cr.equals_nocase(n,e)},r.cnds=new e;t.prototype.SetText=function(e){this.isCheckbox?this.labelText.nodeValue=e:this.elem.value=e},t.prototype.SetTooltip=function(e){this.elem.title=e},t.prototype.SetVisible=function(e){this.visible=0!==e},t.prototype.SetEnabled=function(e){this.inputElem.disabled=0===e},t.prototype.SetFocus=function(){this.inputElem.focus()},t.prototype.SetBlur=function(){this.inputElem.blur()},t.prototype.SetCSSStyle=function(e,t){this.elem.style[cr.cssToCamelCase(e)]=t},t.prototype.SetChecked=function(e){this.isCheckbox&&(this.inputElem.checked=1===e)},t.prototype.ToggleChecked=function(){this.isCheckbox&&(this.inputElem.checked=!this.inputElem.checked)},r.acts=new t;n.prototype.Text=function(e){this.isCheckbox?e.set_string(this.labelText.nodeValue):e.set_string(this.elem.value)},r.exps=new n}();cr.plugins_.AJAX=function(e){this.runtime=e},function(){function e(){}function t(){}function n(){}var a=!1,r=null,i=null,o="",s=cr.plugins_.AJAX.prototype;s.Type=function(e){this.plugin=e,this.runtime=e.runtime};var l=s.Type.prototype;l.onCreate=function(){},s.Instance=function(e){if(this.type=e,this.runtime=e.runtime,this.lastData="",this.curTag="",this.progress=0,this.timeout=-1,a=this.runtime.isNWjs,a){r=require("path"),i=require("fs");var t=window.process||nw.process;o=r.dirname(t.execPath)+"\\"}};var p=s.Instance.prototype;p.onCreate=function(){},p.saveToJSON=function(){return{lastData:this.lastData}},p.loadFromJSON=function(e){this.lastData=e.lastData,this.curTag="",this.progress=0};var d={},c="";p.doRequest=function(t,e,n,r){var s=this,l=null,u=function(){s.curTag=t,s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,s),s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,s)},g=function(){if(a){var n=o+e;i.existsSync(n)?i.readFile(n,{encoding:"utf8"},function(e,n){return e?void u():void(s.curTag=t,s.lastData=n.replace(/\r\n/g,"\n"),s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,s),s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,s))}):u()}else u()},m=function(n){n.lengthComputable&&(s.progress=n.loaded/n.total,s.curTag=t,s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnProgress,s))};try{if(l=this.runtime.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,l.onreadystatechange=function(){4===l.readyState&&(s.curTag=t,s.lastData=l.responseText?l.responseText.replace(/\r\n/g,"\n"):"",400<=l.status?(s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,s),s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,s)):(!a||s.lastData.length)&&(a||0!==l.status||s.lastData.length)&&(s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,s),s.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,s)))},this.runtime.isWindowsPhone8||(l.onerror=g,l.ontimeout=g,l.onabort=g,l.onprogress=m),l.open(n,e),!this.runtime.isWindowsPhone8&&0<=this.timeout&&"undefined"!=typeof l.timeout&&(l.timeout=this.timeout),l.responseType="text",r&&l.setRequestHeader&&!d.hasOwnProperty("Content-Type")&&l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.setRequestHeader){for(var y in d)if(d.hasOwnProperty(y))try{l.setRequestHeader(y,d[y])}catch(t){}d={}}if(c&&l.overrideMimeType){try{l.overrideMimeType(c)}catch(t){}c=""}r?l.send(r):l.send()}catch(t){g()}};e.prototype.OnComplete=function(e){return cr.equals_nocase(e,this.curTag)},e.prototype.OnAnyComplete=function(){return!0},e.prototype.OnError=function(e){return cr.equals_nocase(e,this.curTag)},e.prototype.OnAnyError=function(){return!0},e.prototype.OnProgress=function(e){return cr.equals_nocase(e,this.curTag)},s.cnds=new e;t.prototype.Request=function(e,t){var n=this;this.runtime.isWKWebView&&!this.runtime.isAbsoluteUrl(t)?this.runtime.fetchLocalFileViaCordovaAsText(t,function(t){n.curTag=e,n.lastData=t.replace(/\r\n/g,"\n"),n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,n),n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,n)},function(){n.curTag=e,n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,n),n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,n)}):this.runtime.isPreview&&!this.runtime.isAbsoluteUrl(t)?this.doRequest(e,this.runtime.getLocalFileUrl(t),"GET"):this.doRequest(e,t,"GET")},t.prototype.RequestFile=function(e,t){var n=this;this.runtime.isWKWebView?this.runtime.fetchLocalFileViaCordovaAsText(t,function(t){n.curTag=e,n.lastData=t.replace(/\r\n/g,"\n"),n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,n),n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,n)},function(){n.curTag=e,n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,n),n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,n)}):this.doRequest(e,this.runtime.getLocalFileUrl(t),"GET")},t.prototype.Post=function(e,t,n,a){this.doRequest(e,t,a,n)},t.prototype.SetTimeout=function(e){this.timeout=1e3*e},t.prototype.SetHeader=function(e,t){d[e]=t},t.prototype.OverrideMIMEType=function(e){c=e},s.acts=new t;n.prototype.LastData=function(e){e.set_string(this.lastData)},n.prototype.Progress=function(e){e.set_float(this.progress)},n.prototype.Tag=function(e){e.set_string(this.curTag)},s.exps=new n}();cr.plugins_.Audio=function(e){this.runtime=e},function(){function e(e){var t=me.indexOf(e);-1===t&&me.push(e)}function t(t){var n=t.instanceObject,a;try{a=n.play()}catch(n){return void e(t)}a?a.catch(function(){e(t)}):ge&&!X.isInUserInputEvent&&e(t)}function n(){var t,n,r,o;he||re||!H||(a(),"running"===H.state&&(he=!0));var s=me.slice(0);if(cr.clearArray(me),!ee)for(t=0,n=s.length;t<n;++t)r=s[t],r.stopped||r.is_paused||(o=r.instanceObject.play(),o&&o.catch(function(){e(r)}))}function a(){if("suspended"===H.state&&H.resume&&H.resume(),!!H.createBuffer){var e=H.createBuffer(1,220,22050),t=H.createBufferSource();t.buffer=e,t.connect(H.destination),c(t)}}function r(e){var t=s(e);return isFinite(t)||(t=0),0>t&&(t=0),1<t&&(t=1),t}function o(e){return 0>e&&(e=0),1<e&&(e=1),i(e)}function s(e){return D(10,e/20)}function i(e){return 20*(Math.log(e)/2.302585092994046)}function l(e){return e=e.toLowerCase(),fe.hasOwnProperty(e)&&fe[e].length?fe[e][0].getInputNode():H.destination}function p(){return H.createGain?H.createGain():H.createGainNode()}function d(e){return H.createDelay?H.createDelay(e):H.createDelayNode(e)}function c(e,t){e.start?e.start(t||0):e.noteOn(t||0)}function u(e,t,n,a){e.start?e.start(a||0,t):e.noteGrainOn(a||0,t,n-t)}function g(e){try{e.stop?e.stop(0):e.noteOff(0)}catch(t){}}function m(e,t,n,a){if(e){if(e.cancelScheduledValues(0),0===a)return void(e.value=t);var r=H.currentTime;a+=r,0===n?e.setValueAtTime(t,a):1===n?(e.setValueAtTime(e.value,r),e.linearRampToValueAtTime(t,a)):2===n?(e.setValueAtTime(e.value,r),e.exponentialRampToValueAtTime(t,a)):void 0}}function y(e,t,n,a,r,i){this.type="filter",this.params=[e,t,n,a,r,i],this.inputNode=p(),this.wetNode=p(),this.wetNode.gain.value=i,this.dryNode=p(),this.dryNode.gain.value=1-i,this.filterNode=H.createBiquadFilter(),this.filterNode.type="number"==typeof this.filterNode.type?e:xe[e],this.filterNode.frequency.value=t,this.filterNode.detune&&(this.filterNode.detune.value=n),this.filterNode.Q.value=a,this.filterNode.gain.value=r,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode)}function _(e,t,n){this.type="delay",this.params=[e,t,n],this.inputNode=p(),this.wetNode=p(),this.wetNode.gain.value=n,this.dryNode=p(),this.dryNode.gain.value=1-n,this.mainNode=p(),this.delayNode=d(e),this.delayNode.delayTime.value=e,this.delayGainNode=p(),this.delayGainNode.gain.value=t,this.inputNode.connect(this.mainNode),this.inputNode.connect(this.dryNode),this.mainNode.connect(this.wetNode),this.mainNode.connect(this.delayNode),this.delayNode.connect(this.delayGainNode),this.delayGainNode.connect(this.mainNode)}function h(e,t,n,a){this.type="convolve",this.params=[t,n,a],this.inputNode=p(),this.wetNode=p(),this.wetNode.gain.value=n,this.dryNode=p(),this.dryNode.gain.value=1-n,this.convolveNode=H.createConvolver(),e&&(this.convolveNode.normalize=t,this.convolveNode.buffer=e),this.inputNode.connect(this.convolveNode),this.inputNode.connect(this.dryNode),this.convolveNode.connect(this.wetNode)}function f(e,t,n,a,r){this.type="flanger",this.params=[e,t,n,a,r],this.inputNode=p(),this.dryNode=p(),this.dryNode.gain.value=1-r/2,this.wetNode=p(),this.wetNode.gain.value=r/2,this.feedbackNode=p(),this.feedbackNode.gain.value=a,this.delayNode=d(e+t),this.delayNode.delayTime.value=e,this.oscNode=H.createOscillator(),this.oscNode.frequency.value=n,this.oscGainNode=p(),this.oscGainNode.gain.value=t,this.inputNode.connect(this.delayNode),this.inputNode.connect(this.dryNode),this.delayNode.connect(this.wetNode),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.delayNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.delayNode.delayTime),c(this.oscNode)}function x(e,t,n,a,r,i){this.type="phaser",this.params=[e,t,n,a,r,i],this.inputNode=p(),this.dryNode=p(),this.dryNode.gain.value=1-i/2,this.wetNode=p(),this.wetNode.gain.value=i/2,this.filterNode=H.createBiquadFilter(),this.filterNode.type="number"==typeof this.filterNode.type?7:"allpass",this.filterNode.frequency.value=e,this.filterNode.detune&&(this.filterNode.detune.value=t),this.filterNode.Q.value=n,this.oscNode=H.createOscillator(),this.oscNode.frequency.value=r,this.oscGainNode=p(),this.oscGainNode.gain.value=a,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.filterNode.frequency),c(this.oscNode)}function v(e){this.type="gain",this.params=[e],this.node=p(),this.node.gain.value=e}function w(e,t){this.type="tremolo",this.params=[e,t],this.node=p(),this.node.gain.value=1-t/2,this.oscNode=H.createOscillator(),this.oscNode.frequency.value=e,this.oscGainNode=p(),this.oscGainNode.gain.value=t/2,this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.node.gain),c(this.oscNode)}function T(e,t){this.type="ringmod",this.params=[e,t],this.inputNode=p(),this.wetNode=p(),this.wetNode.gain.value=t,this.dryNode=p(),this.dryNode.gain.value=1-t,this.ringNode=p(),this.ringNode.gain.value=0,this.oscNode=H.createOscillator(),this.oscNode.frequency.value=e,this.oscNode.connect(this.ringNode.gain),c(this.oscNode),this.inputNode.connect(this.ringNode),this.inputNode.connect(this.dryNode),this.ringNode.connect(this.wetNode)}function S(e,t,n,a,r){this.type="distortion",this.params=[e,t,n,a,r],this.inputNode=p(),this.preGain=p(),this.postGain=p(),this.setDrive(n,s(a)),this.wetNode=p(),this.wetNode.gain.value=r,this.dryNode=p(),this.dryNode.gain.value=1-r,this.waveShaper=H.createWaveShaper(),this.curve=new Float32Array(65536),this.generateColortouchCurve(e,t),this.waveShaper.curve=this.curve,this.inputNode.connect(this.preGain),this.inputNode.connect(this.dryNode),this.preGain.connect(this.waveShaper),this.waveShaper.connect(this.postGain),this.postGain.connect(this.wetNode)}function b(e,t){return 1-Math.exp(-t*e)}function O(e,t,n,a,r){this.type="compressor",this.params=[e,t,n,a,r],this.node=H.createDynamicsCompressor();try{this.node.threshold.value=e,this.node.knee.value=t,this.node.ratio.value=n,this.node.attack.value=a,this.node.release.value=r}catch(t){}}function E(e,t){this.type="analyser",this.params=[e,t],this.node=H.createAnalyser(),this.node.fftSize=e,this.node.smoothingTimeConstant=t,this.freqBins=new Float32Array(this.node.frequencyBinCount),this.signal=new Uint8Array(e),this.peak=0,this.rms=0}function C(){this.obj=null,this.loadUid=0}function A(e,t,n){this.src=e,this.type=t,this.myapi=J,this.is_music=n,this.added_end_listener=!1;var a=this;this.outNode=null,this.mediaSourceNode=null,this.panWhenReady=[],this.seekWhenReady=0,this.pauseWhenReady=!1,this.supportWebAudioAPI=!1,this.failedToLoad=!1,this.needsSoftwareDecode="audio/webm; codecs=opus"===this.type&&!ie,this.wasEverReady=!1,this.is_music&&this.needsSoftwareDecode&&(_e=!0),J!==1||!n||ye||this.needsSoftwareDecode||(this.myapi=0,this.outNode=p()),this.bufferObject=null,this.audioData=null;var r;switch(this.myapi){case 0:this.bufferObject=new Audio,this.bufferObject.crossOrigin="anonymous",this.bufferObject.addEventListener("canplaythrough",function(){a.wasEverReady=!0}),J===1&&H.createMediaElementSource&&!/wiiu/i.test(navigator.userAgent)&&(this.supportWebAudioAPI=!0,this.bufferObject.addEventListener("canplay",function(){!a.mediaSourceNode&&a.bufferObject&&(a.mediaSourceNode=H.createMediaElementSource(a.bufferObject),a.mediaSourceNode.connect(a.outNode))})),this.bufferObject.autoplay=!1,this.bufferObject.preload="auto",this.bufferObject.src=e;break;case 1:X.isWKWebView?X.fetchLocalFileViaCordovaAsArrayBuffer(e,function(e){a.audioData=e,a.decodeAudioBuffer()},function(){a.failedToLoad=!0}):(r=new XMLHttpRequest,r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){a.audioData=r.response,a.decodeAudioBuffer()},r.onerror=function(){a.failedToLoad=!0},r.send());break;case 2:this.bufferObject=!0;}}function P(e,t){var n=this;this.tag=t,this.fresh=!0,this.stopped=!0,this.src=e.src,this.buffer=e,this.myapi=J,this.is_music=e.is_music,this.playbackRate=1,this.hasPlaybackEnded=!0,this.resume_me=!1,this.is_paused=!1,this.resume_position=0,this.looping=!1,this.is_muted=!1,this.is_silent=!1,this.volume=1,this.onended_handler=function(t){if(!(n.is_paused||n.resume_me)){var e=this;e||(e=t.target),e!==n.active_buffer||(n.hasPlaybackEnded=!0,n.stopped=!0,q=n.tag,X.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,z))}},this.active_buffer=null,this.isTimescaled=1===$&&!this.is_music||2===$,this.mutevol=1,this.startTime=this.isTimescaled?X.kahanTime.sum:X.wallTime.sum,this.gainNode=null,this.pannerNode=null,this.pannerEnabled=!1,this.objectTracker=null,this.panX=0,this.panY=0,this.panAngle=0,this.panConeInner=0,this.panConeOuter=0,this.panConeOuterGain=0,this.instanceObject=null;var a=!1;switch(1!==this.myapi||0!==this.buffer.myapi||this.buffer.supportWebAudioAPI||(this.myapi=0),this.myapi){case 0:this.is_music?(this.instanceObject=e.bufferObject,a=!e.added_end_listener,e.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.crossOrigin="anonymous",this.instanceObject.autoplay=!1,this.instanceObject.src=e.bufferObject.src,a=!0),a&&this.instanceObject.addEventListener("ended",function(){q=n.tag,n.stopped=!0,X.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,z)});break;case 1:this.gainNode=p(),this.gainNode.connect(l(t)),1===this.buffer.myapi?e.bufferObject&&(this.instanceObject=H.createBufferSource(),this.instanceObject.buffer=e.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode),!this.buffer.added_end_listener&&(this.buffer.added_end_listener=!0,this.buffer.bufferObject.addEventListener("ended",function(){q=n.tag,n.stopped=!0,X.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,z)})));break;case 2:this.instanceObject=new window.Media(Y+this.src,null,null,function(e){e===window.Media.MEDIA_STOPPED&&(n.hasPlaybackEnded=!0,n.stopped=!0,q=n.tag,X.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,z))});}}function I(e,t){var n=e.isPlaying()?1:0,a=t.isPlaying()?1:0;return n==a?0:n<a?1:-1}function L(e,t){if(cr.clearArray(Te),!e.length)return!Q||Q.hasEnded()?void 0:(cr.clearArray(Te),void(Te[0]=Q));var n,r,o;for(n=0,r=Z.length;n<r;n++)o=Z[n],cr.equals_nocase(e,o.tag)&&Te.push(o);t&&Te.sort(I)}function R(e){var t=H.destination,a,r,o,s;if(fe.hasOwnProperty(e)&&(o=fe[e],o.length))for(t=o[0].getInputNode(),a=0,r=o.length;a<r;a++)s=o[a],a+1===r?s.connectTo(H.destination):s.connectTo(o[a+1].getInputNode());for(L(e),a=0,r=Te.length;a<r;a++)Te[a].reconnect(t);ce&&ue===e&&(ce.disconnect(),ce.connect(t))}function k(e,t){fe.hasOwnProperty(e)?fe[e].push(t):fe[e]=[t],R(e)}function F(){}function B(){}function j(){}function N(e,t){var n=null;return fe.hasOwnProperty(e)&&(n=fe[e]),n&&0<=t&&t<n.length&&n[t].freqBins?n[t]:null}var D=Math.pow,M=Math.floor,V=Math.cos,U=Math.sin,G=cr.plugins_.Audio.prototype;G.Type=function(e){this.plugin=e,this.runtime=e.runtime};var W=G.Type.prototype;W.onCreate=function(){};var X=null,z=null,q="",Y="",J=0,H=null,K=[],Z=[],Q=null,$=0,ee=!1,te=1,ne=0,ae=0,re=!1,ie=!!new Audio().canPlayType("audio/webm; codecs=opus"),oe=1,se=1,le=10,pe=1e4,de=1,ce=null,ue="",ge=!1,me=[],ye=!1,_e=!1,he=!1;document.addEventListener("pointerup",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("click",n,!0),document.addEventListener("keydown",n,!0),document.addEventListener("gamepadconnected",n,!0);var fe={};var xe=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];y.prototype.connectTo=function(e){this.wetNode.disconnect(),this.wetNode.connect(e),this.dryNode.disconnect(),this.dryNode.connect(e)},y.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},y.prototype.getInputNode=function(){return this.inputNode},y.prototype.setParam=function(e,t,n,a){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[5]=t,m(this.wetNode.gain,t,n,a),m(this.dryNode.gain,1-t,n,a)):1===e?(this.params[1]=t,m(this.filterNode.frequency,t,n,a)):2===e?(this.params[2]=t,m(this.filterNode.detune,t,n,a)):3===e?(this.params[3]=t,m(this.filterNode.Q,t,n,a)):4===e?(this.params[4]=t,m(this.filterNode.gain,t,n,a)):void 0};_.prototype.connectTo=function(e){this.wetNode.disconnect(),this.wetNode.connect(e),this.dryNode.disconnect(),this.dryNode.connect(e)},_.prototype.remove=function(){this.inputNode.disconnect(),this.mainNode.disconnect(),this.delayNode.disconnect(),this.delayGainNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},_.prototype.getInputNode=function(){return this.inputNode},_.prototype.setParam=function(e,t,n,a){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[2]=t,m(this.wetNode.gain,t,n,a),m(this.dryNode.gain,1-t,n,a)):4===e?(this.params[1]=r(t),m(this.delayGainNode.gain,r(t),n,a)):5===e?(this.params[0]=t,m(this.delayNode.delayTime,t,n,a)):void 0};h.prototype.connectTo=function(e){this.wetNode.disconnect(),this.wetNode.connect(e),this.dryNode.disconnect(),this.dryNode.connect(e)},h.prototype.remove=function(){this.inputNode.disconnect(),this.convolveNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},h.prototype.getInputNode=function(){return this.inputNode},h.prototype.setParam=function(e,t,n,a){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[1]=t,m(this.wetNode.gain,t,n,a),m(this.dryNode.gain,1-t,n,a)):void 0};f.prototype.connectTo=function(e){this.dryNode.disconnect(),this.dryNode.connect(e),this.wetNode.disconnect(),this.wetNode.connect(e)},f.prototype.remove=function(){this.inputNode.disconnect(),this.delayNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect(),this.feedbackNode.disconnect()},f.prototype.getInputNode=function(){return this.inputNode},f.prototype.setParam=function(e,t,n,a){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[4]=t,m(this.wetNode.gain,t/2,n,a),m(this.dryNode.gain,1-t/2,n,a)):6===e?(this.params[1]=t/1e3,m(this.oscGainNode.gain,t/1e3,n,a)):7===e?(this.params[2]=t,m(this.oscNode.frequency,t,n,a)):8===e?(this.params[3]=t/100,m(this.feedbackNode.gain,t/100,n,a)):void 0};x.prototype.connectTo=function(e){this.dryNode.disconnect(),this.dryNode.connect(e),this.wetNode.disconnect(),this.wetNode.connect(e)},x.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect()},x.prototype.getInputNode=function(){return this.inputNode},x.prototype.setParam=function(e,t,n,a){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[5]=t,m(this.wetNode.gain,t/2,n,a),m(this.dryNode.gain,1-t/2,n,a)):1===e?(this.params[0]=t,m(this.filterNode.frequency,t,n,a)):2===e?(this.params[1]=t,m(this.filterNode.detune,t,n,a)):3===e?(this.params[2]=t,m(this.filterNode.Q,t,n,a)):6===e?(this.params[3]=t,m(this.oscGainNode.gain,t,n,a)):7===e?(this.params[4]=t,m(this.oscNode.frequency,t,n,a)):void 0};v.prototype.connectTo=function(e){this.node.disconnect(),this.node.connect(e)},v.prototype.remove=function(){this.node.disconnect()},v.prototype.getInputNode=function(){return this.node},v.prototype.setParam=function(e,t,n,a){4===e?(this.params[0]=r(t),m(this.node.gain,r(t),n,a)):void 0};w.prototype.connectTo=function(e){this.node.disconnect(),this.node.connect(e)},w.prototype.remove=function(){this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.node.disconnect()},w.prototype.getInputNode=function(){return this.node},w.prototype.setParam=function(e,t,n,a){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[1]=t,m(this.node.gain.value,1-t/2,n,a),m(this.oscGainNode.gain.value,t/2,n,a)):7===e?(this.params[0]=t,m(this.oscNode.frequency,t,n,a)):void 0};T.prototype.connectTo=function(e){this.wetNode.disconnect(),this.wetNode.connect(e),this.dryNode.disconnect(),this.dryNode.connect(e)},T.prototype.remove=function(){this.oscNode.disconnect(),this.ringNode.disconnect(),this.inputNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},T.prototype.getInputNode=function(){return this.inputNode},T.prototype.setParam=function(e,t,n,a){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[1]=t,m(this.wetNode.gain,t,n,a),m(this.dryNode.gain,1-t,n,a)):7===e?(this.params[0]=t,m(this.oscNode.frequency,t,n,a)):void 0};S.prototype.setDrive=function(e,t){.01>e&&(e=.01),this.preGain.gain.value=e,this.postGain.gain.value=D(1/e,.6)*t},S.prototype.shape=function(e,t,n){var a=1.05*n*t-t,r=0>e?-1:1,i=0>e?-e:e,o=i<t?i:t+a*b(i-t,1/a);return o*=r,o},S.prototype.generateColortouchCurve=function(e,t){for(var n=s(e),a=s(t),r=0,o=0;o<32768;++o)r=o/32768,r=this.shape(r,n,a),this.curve[32768+o]=r,this.curve[32768-o-1]=-r},S.prototype.connectTo=function(e){this.wetNode.disconnect(),this.wetNode.connect(e),this.dryNode.disconnect(),this.dryNode.connect(e)},S.prototype.remove=function(){this.inputNode.disconnect(),this.preGain.disconnect(),this.waveShaper.disconnect(),this.postGain.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},S.prototype.getInputNode=function(){return this.inputNode},S.prototype.setParam=function(e,t,n,a){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[4]=t,m(this.wetNode.gain,t,n,a),m(this.dryNode.gain,1-t,n,a)):void 0};O.prototype.connectTo=function(e){this.node.disconnect(),this.node.connect(e)},O.prototype.remove=function(){this.node.disconnect()},O.prototype.getInputNode=function(){return this.node},O.prototype.setParam=function(){};E.prototype.tick=function(){this.node.getFloatFrequencyData(this.freqBins),this.node.getByteTimeDomainData(this.signal);var e=this.node.fftSize,t=0;this.peak=0;for(var n=0,a=0;t<e;t++)a=(this.signal[t]-128)/128,0>a&&(a=-a),this.peak<a&&(this.peak=a),n+=a*a;this.peak=o(this.peak),this.rms=o(Math.sqrt(n/e))},E.prototype.connectTo=function(e){this.node.disconnect(),this.node.connect(e)},E.prototype.remove=function(){this.node.disconnect()},E.prototype.getInputNode=function(){return this.node},E.prototype.setParam=function(){};C.prototype.setObject=function(e){this.obj=e},C.prototype.hasObject=function(){return!!this.obj},C.prototype.tick=function(){};A.prototype.release=function(){var e,t,n,r;for(e=0,n=0,t=Z.length;e<t;++e)r=Z[e],Z[n]=r,r.buffer===this?r.stop():++n;Z.length=n,this.mediaSourceNode&&(this.mediaSourceNode.disconnect(),this.mediaSourceNode=null),this.outNode&&(this.outNode.disconnect(),this.outNode=null),this.bufferObject=null,this.audioData=null},A.prototype.decodeAudioBuffer=function(){if(!this.bufferObject&&this.audioData){var t=this;if(this.needsSoftwareDecode){var e=this.audioData;this.audioData=null,window.OpusDecoder(e,function(e,n){if(e)return void t.onDecodeError(e);var a=H.createBuffer(1,n.length,48e3),r=a.getChannelData(0);r.set(n),t.onDecodeComplete(a)})}else H.decodeAudioData(this.audioData,function(e){t.onDecodeComplete(e)},function(n){t.onDecodeError(n)})}},A.prototype.onDecodeComplete=function(e){this.bufferObject=e,this.audioData=null;var t,n,r,o;if(!cr.is_undefined(this.playTagWhenReady)&&!ee){if(this.panWhenReady.length){for(n=0,r=this.panWhenReady.length;n<r;n++)if(t=this.panWhenReady[n],o=new P(this,t.thistag),o.setPannerEnabled(!0),!("undefined"!=typeof t.objUid&&(t.obj=X.getObjectByUID(t.objUid),!t.obj))){if(t.obj){var s=cr.rotatePtAround(t.obj.x,t.obj.y,-t.obj.layer.getAngle(),ne,ae,!0),l=cr.rotatePtAround(t.obj.x,t.obj.y,-t.obj.layer.getAngle(),ne,ae,!1);o.setPan(s,l,cr.to_degrees(t.obj.angle-t.obj.layer.getAngle()),t.ia,t.oa,t.og),o.setObject(t.obj)}else o.setPan(t.x,t.y,t.a,t.ia,t.oa,t.og);o.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&o.pause(),Z.push(o)}cr.clearArray(this.panWhenReady)}else o=new P(this,this.playTagWhenReady||""),o.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&o.pause(),Z.push(o);}else if(!cr.is_undefined(this.convolveWhenReady)){var d=this.convolveWhenReady.convolveNode;d.normalize=this.normalizeWhenReady,d.buffer=e}},A.prototype.onDecodeError=function(e){self.failedToLoad=!0,console.error("Failed to decode audio '"+this.src+"': "+e)},A.prototype.isLoaded=function(){switch(this.myapi){case 0:var e=4<=this.bufferObject.readyState;return e&&(this.wasEverReady=!0),e||this.wasEverReady;case 1:return!!this.audioData||!!this.bufferObject;case 2:return!0;}return!1},A.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case 0:return this.isLoaded();case 1:return!!this.bufferObject;case 2:return!0;}return!1},A.prototype.hasFailedToLoad=function(){switch(this.myapi){case 0:return!!this.bufferObject.error;case 1:return this.failedToLoad;}return!1};P.prototype.hasEnded=function(){switch(this.myapi){case 0:return this.instanceObject.ended;case 1:return 1===this.buffer.myapi?!!(this.fresh||this.stopped||!this.instanceObject.loop)&&!this.is_paused&&this.hasPlaybackEnded:this.instanceObject.ended;case 2:return this.hasPlaybackEnded;}return!0},P.prototype.canBeRecycled=function(){return!!(this.fresh||this.stopped)||this.hasEnded()},P.prototype.setPannerEnabled=function(e){if(1===J)if(!this.pannerEnabled&&e){if(!this.gainNode)return;this.pannerNode||(this.pannerNode=H.createPanner(),this.pannerNode.panningModel="number"==typeof this.pannerNode.panningModel?oe:["equalpower","HRTF","soundfield"][oe],this.pannerNode.distanceModel="number"==typeof this.pannerNode.distanceModel?se:["linear","inverse","exponential"][se],this.pannerNode.refDistance=le,this.pannerNode.maxDistance=pe,this.pannerNode.rolloffFactor=de),this.gainNode.disconnect(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(l(this.tag)),this.pannerEnabled=!0}else if(this.pannerEnabled&&!e){if(!this.gainNode)return;this.pannerNode.disconnect(),this.gainNode.disconnect(),this.gainNode.connect(l(this.tag)),this.pannerEnabled=!1}},P.prototype.setPan=function(e,t,n,a,r,i){this.pannerEnabled&&1===J&&(this.pannerNode.setPosition(e,t,0),this.pannerNode.setOrientation(V(cr.to_radians(n)),U(cr.to_radians(n)),0),this.pannerNode.coneInnerAngle=a,this.pannerNode.coneOuterAngle=r,this.pannerNode.coneOuterGain=i,this.panX=e,this.panY=t,this.panAngle=n,this.panConeInner=a,this.panConeOuter=r,this.panConeOuterGain=i)},P.prototype.setObject=function(e){this.pannerEnabled&&1===J&&(!this.objectTracker&&(this.objectTracker=new C),this.objectTracker.setObject(e))},P.prototype.tick=function(e){if(this.pannerEnabled&&1===J&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()){this.objectTracker.tick(e);var t=this.objectTracker.obj,n=cr.rotatePtAround(t.x,t.y,-t.layer.getAngle(),ne,ae,!0),r=cr.rotatePtAround(t.x,t.y,-t.layer.getAngle(),ne,ae,!1);this.pannerNode.setPosition(n,r,0);var i=0;"undefined"!=typeof this.objectTracker.obj.angle&&(i=t.angle-t.layer.getAngle(),this.pannerNode.setOrientation(V(i),U(i),0))}},P.prototype.play=function(e,n,a,r){var i=this.instanceObject;this.looping=e,this.volume=n;var o=a||0;switch(r=r||0,this.myapi){case 0:if(1!==i.playbackRate&&(i.playbackRate=1),i.volume!==n*te&&(i.volume=n*te),i.loop!==e&&(i.loop=e),i.muted&&(i.muted=!1),i.currentTime!==o)try{i.currentTime=o}catch(e){}t(this);break;case 1:if(this.muted=!1,this.mutevol=1,1===this.buffer.myapi)this.gainNode.gain.value=n*te,this.fresh||(this.instanceObject=H.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=e,this.hasPlaybackEnded=!1,0===o?c(this.instanceObject,r):u(this.instanceObject,o,this.getDuration(),r);else{if(1!==i.playbackRate&&(i.playbackRate=1),i.loop!==e&&(i.loop=e),i.volume=n*te,i.currentTime!==o)try{i.currentTime=o}catch(e){}t(this)}break;case 2:(!this.fresh&&this.stopped||0!==o)&&i.seekTo(o),i.play(),this.hasPlaybackEnded=!1;}this.playbackRate=1,this.startTime=(this.isTimescaled?X.kahanTime.sum:X.wallTime.sum)-o,this.fresh=!1,this.stopped=!1,this.is_paused=!1},P.prototype.stop=function(){switch(this.myapi){case 0:this.instanceObject.paused||this.instanceObject.pause();break;case 1:this.buffer.myapi===1?g(this.instanceObject):!this.instanceObject.paused&&this.instanceObject.pause();break;case 2:this.instanceObject.stop();}this.stopped=!0,this.is_paused=!1},P.prototype.pause=function(){if(!(this.fresh||this.stopped||this.hasEnded()||this.is_paused)){switch(this.myapi){case 0:this.instanceObject.paused||this.instanceObject.pause();break;case 1:1===this.buffer.myapi?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position%=this.getDuration()),this.is_paused=!0,g(this.instanceObject)):!this.instanceObject.paused&&this.instanceObject.pause();break;case 2:this.instanceObject.pause();}this.is_paused=!0}},P.prototype.resume=function(){if(!(this.fresh||this.stopped||this.hasEnded()||!this.is_paused)){switch(this.myapi){case 0:t(this);break;case 1:1===this.buffer.myapi?(this.instanceObject=H.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=te*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?X.kahanTime.sum:X.wallTime.sum)-this.resume_position/(this.playbackRate||.001),u(this.instanceObject,this.resume_position,this.getDuration())):t(this);break;case 2:this.instanceObject.play();}this.is_paused=!1}},P.prototype.seek=function(e){if(!(this.fresh||this.stopped||this.hasEnded()))switch(this.myapi){case 0:try{this.instanceObject.currentTime=e}catch(t){}break;case 1:if(1===this.buffer.myapi)this.is_paused?this.resume_position=e:(this.pause(),this.resume_position=e,this.resume());else try{this.instanceObject.currentTime=e}catch(t){}break;case 2:}},P.prototype.reconnect=function(e){1!==this.myapi||(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(e)):(this.gainNode.disconnect(),this.gainNode.connect(e)))},P.prototype.getDuration=function(e){var t=0;switch(this.myapi){case 0:"undefined"!=typeof this.instanceObject.duration&&(t=this.instanceObject.duration);break;case 1:t=this.buffer.bufferObject.duration;break;case 2:t=this.instanceObject.getDuration();}return e&&(t/=this.playbackRate||.001),t},P.prototype.getPlaybackTime=function(e){var t=this.getDuration(),n=0;switch(this.myapi){case 0:"undefined"!=typeof this.instanceObject.currentTime&&(n=this.instanceObject.currentTime);break;case 1:if(1===this.buffer.myapi){if(this.is_paused)return this.resume_position;n=(this.isTimescaled?X.kahanTime.sum:X.wallTime.sum)-this.startTime}else"undefined"!=typeof this.instanceObject.currentTime&&(n=this.instanceObject.currentTime);break;case 2:}return e&&(n*=this.playbackRate),!this.looping&&n>t&&(n=t),n},P.prototype.isPlaying=function(){return!this.is_paused&&!this.fresh&&!this.stopped&&!this.hasEnded()},P.prototype.shouldSave=function(){return!this.fresh&&!this.stopped&&!this.hasEnded()},P.prototype.setVolume=function(e){this.volume=e,this.updateVolume()},P.prototype.updateVolume=function(){var e=this.volume*te;switch(isFinite(e)||(e=0),this.myapi){case 0:"undefined"!=typeof this.instanceObject.volume&&this.instanceObject.volume!==e&&(this.instanceObject.volume=e);break;case 1:1===this.buffer.myapi?this.gainNode.gain.value=e*this.mutevol:"undefined"!=typeof this.instanceObject.volume&&this.instanceObject.volume!==e&&(this.instanceObject.volume=e);break;case 2:}},P.prototype.getVolume=function(){return this.volume},P.prototype.doSetMuted=function(e){switch(this.myapi){case 0:this.instanceObject.muted!==!!e&&(this.instanceObject.muted=!!e);break;case 1:this.buffer.myapi===1?(this.mutevol=e?0:1,this.gainNode.gain.value=te*this.volume*this.mutevol):this.instanceObject.muted!==!!e&&(this.instanceObject.muted=!!e);break;case 2:}},P.prototype.setMuted=function(e){this.is_muted=!!e,this.doSetMuted(this.is_muted||this.is_silent)},P.prototype.setSilent=function(e){this.is_silent=!!e,this.doSetMuted(this.is_muted||this.is_silent)},P.prototype.setLooping=function(e){switch(this.looping=e,this.myapi){case 0:this.instanceObject.loop!==!!e&&(this.instanceObject.loop=!!e);break;case 1:this.instanceObject.loop!==!!e&&(this.instanceObject.loop=!!e);break;case 2:}},P.prototype.setPlaybackRate=function(e){this.playbackRate=e,this.updatePlaybackRate()},P.prototype.getPlaybackRate=function(){return this.playbackRate},P.prototype.updatePlaybackRate=function(){var e=this.playbackRate;switch(this.isTimescaled&&(e*=X.timescale),this.myapi){case 0:this.instanceObject.playbackRate!==e&&(this.instanceObject.playbackRate=e);break;case 1:1===this.buffer.myapi?this.instanceObject.playbackRate.value!==e&&(this.instanceObject.playbackRate.value=e):this.instanceObject.playbackRate!==e&&(this.instanceObject.playbackRate=e);break;case 2:}},P.prototype.setSuspended=function(e){switch(this.myapi){case 0:e?this.isPlaying()?(this.resume_me=!0,this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.instanceObject.play(),this.resume_me=!1);break;case 1:e?this.isPlaying()?(this.resume_me=!0,this.buffer.myapi===1?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position%=this.getDuration()),g(this.instanceObject)):this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.buffer.myapi===1?(this.instanceObject=H.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=te*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?X.kahanTime.sum:X.wallTime.sum)-this.resume_position/(this.playbackRate||.001),u(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play(),this.resume_me=!1);break;case 2:e?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.resume_me=!1,this.instanceObject.play());}},G.Instance=function(e){if(this.type=e,this.runtime=e.runtime,X=this.runtime,z=this,this.listenerTracker=null,this.listenerZ=-600,this.runtime.isWKWebView&&(ye=!0),(this.runtime.isiOS||this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser))&&!this.runtime.isCrosswalk&&!this.runtime.isAmazonWebApp&&!ye&&(ge=!0),H=null,"undefined"==typeof AudioContext?"undefined"!=typeof webkitAudioContext&&(J=1,H=new webkitAudioContext):(J=1,H=new AudioContext),this.runtime.isiOS&&H&&(H.close&&H.close(),"undefined"==typeof AudioContext?"undefined"!=typeof webkitAudioContext&&(H=new webkitAudioContext):H=new AudioContext),1!==J&&this.runtime.isCordova&&"undefined"!=typeof window.Media&&(J=2),2===J){Y=location.href;var t=Y.lastIndexOf("/");-1<t&&(Y=Y.substr(0,t+1)),Y=Y.replace("file://","")}this.runtime.tickMe(this)};var be=G.Instance.prototype;be.onCreate=function(){this.runtime.audioInstance=this,$=this.properties[0],this.saveload=this.properties[1],this.playinbackground=this.properties[2],this.nextPlayTime=0,oe=this.properties[4],se=this.properties[5],this.listenerZ=-this.properties[6],le=this.properties[7],pe=this.properties[8],de=this.properties[9],this.listenerTracker=new C;var e=this.runtime.draw_width||this.runtime.width,t=this.runtime.draw_height||this.runtime.height;J===1&&(H.listener.setPosition(e/2,t/2,this.listenerZ),H.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(e,t){ce&&ce.disconnect(),ue=t.toLowerCase(),ce=H.createMediaStreamSource(e),ce.connect(l(ue))}),this.runtime.addSuspendCallback(function(e){z.onSuspend(e)});var n=this;this.runtime.addDestroyCallback(function(e){n.onInstanceDestroyed(e)})},be.onInstanceDestroyed=function(e){var t,n,r;for(t=0,n=Z.length;t<n;t++)r=Z[t],r.objectTracker&&r.objectTracker.obj===e&&(r.objectTracker.obj=null,r.pannerEnabled&&r.isPlaying()&&r.looping&&r.stop());this.listenerTracker.obj===e&&(this.listenerTracker.obj=null)},be.saveToJSON=function(){var e={silent:ee,masterVolume:te,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},t=e.playing,n,r,o,s,l,c,u;for(n=0,r=Z.length;n<r;n++)o=Z[n],!o.shouldSave()||3===this.saveload||o.is_music&&1===this.saveload||!o.is_music&&2===this.saveload||(u=o.getPlaybackTime(),o.looping&&(u%=o.getDuration()),s={tag:o.tag,buffersrc:o.buffer.src,buffertype:o.buffer.type,is_music:o.is_music,playbackTime:u,volume:o.volume,looping:o.looping,muted:o.is_muted,playbackRate:o.playbackRate,paused:o.is_paused,resume_position:o.resume_position},o.pannerEnabled&&(s.pan={},c=s.pan,o.objectTracker&&o.objectTracker.hasObject()?c.objUid=o.objectTracker.obj.uid:(c.x=o.panX,c.y=o.panY,c.a=o.panAngle),c.ia=o.panConeInner,c.oa=o.panConeOuter,c.og=o.panConeOuterGain),t.push(s));var g=e.effects,m;for(l in fe)if(fe.hasOwnProperty(l)){for(m=[],n=0,r=fe[l].length;n<r;n++)m.push({type:fe[l][n].type,params:fe[l][n].params});g[l]=m}return e};var ve=[];be.loadFromJSON=function(e){var t=e.silent;te=e.masterVolume,this.listenerZ=e.listenerZ,this.listenerTracker.setObject(null);var n=e.listenerUid;-1!==n&&(this.listenerTracker.loadUid=n,ve.push(this.listenerTracker));var r=e.playing,o,s,l,c,u,g,m,A,P,I,L,R,F,B,j;if(3!==this.saveload)for(o=0,s=Z.length;o<s;o++)R=Z[o],R.is_music&&1===this.saveload||!R.is_music&&2===this.saveload||R.stop();var N,D,M,V;for(F in fe)if(fe.hasOwnProperty(F))for(o=0,s=fe[F].length;o<s;o++)fe[F][o].remove();for(F in cr.wipe(fe),e.effects)if(e.effects.hasOwnProperty(F))for(N=e.effects[F],o=0,s=N.length;o<s;o++)D=N[o].type,M=N[o].params,"filter"===D?k(F,new y(M[0],M[1],M[2],M[3],M[4],M[5])):"delay"===D?k(F,new _(M[0],M[1],M[2])):"convolve"===D?(c=M[2],L=this.getAudioBuffer(c,!1),L.bufferObject?V=new h(L.bufferObject,M[0],M[1],c):(V=new h(null,M[0],M[1],c),L.normalizeWhenReady=M[0],L.convolveWhenReady=V),k(F,V)):"flanger"===D?k(F,new f(M[0],M[1],M[2],M[3],M[4])):"phaser"===D?k(F,new x(M[0],M[1],M[2],M[3],M[4],M[5])):"gain"===D?k(F,new v(M[0])):"tremolo"===D?k(F,new w(M[0],M[1])):"ringmod"===D?k(F,new T(M[0],M[1])):"distortion"===D?k(F,new S(M[0],M[1],M[2],M[3],M[4])):"compressor"===D?k(F,new O(M[0],M[1],M[2],M[3],M[4])):"analyser"===D?k(F,new E(M[0],M[1])):void 0;for(o=0,s=r.length;o<s;o++)if(3!==this.saveload&&(l=r[o],c=l.buffersrc,u=l.buffertype||"",g=l.is_music,m=l.tag,A=l.playbackTime,P=l.looping,I=l.volume,B=l.pan,j=B&&B.hasOwnProperty("objUid")?B.objUid:-1,!(g&&1===this.saveload)&&(g||2!==this.saveload))){if(R=this.getAudioInstance({url:c,type:u},m,g,P,I),!R){L=this.getAudioBuffer({url:c,type:""},g),L.seekWhenReady=A,L.pauseWhenReady=l.paused,B&&(-1===j?L.panWhenReady.push({x:B.x,y:B.y,a:B.a,ia:B.ia,oa:B.oa,og:B.og,thistag:m}):L.panWhenReady.push({objUid:j,ia:B.ia,oa:B.oa,og:B.og,thistag:m}));continue}R.resume_position=l.resume_position,R.setPannerEnabled(!!B),R.play(P,I,A),R.updatePlaybackRate(),R.updateVolume(),R.doSetMuted(R.is_muted||R.is_silent),l.paused&&R.pause(),l.muted&&R.setMuted(!0),R.doSetMuted(R.is_muted||R.is_silent),B&&(-1===j?R.setPan(B.x,B.y,B.a,B.ia,B.oa,B.og):(R.objectTracker=R.objectTracker||new C,R.objectTracker.loadUid=j,ve.push(R.objectTracker)))}if(t&&!ee){for(o=0,s=Z.length;o<s;o++)Z[o].setSilent(!0);ee=!0}else if(!t&&ee){for(o=0,s=Z.length;o<s;o++)Z[o].setSilent(!1);ee=!1}},be.afterLoad=function(){var e,t,n,a;for(e=0,t=ve.length;e<t;e++)n=ve[e],a=this.runtime.getObjectByUID(n.loadUid),n.setObject(a),n.loadUid=-1,a&&(ne=a.x,ae=a.y);cr.clearArray(ve)},be.onSuspend=function(e){if(!this.playinbackground){!e&&H&&H.resume&&(H.resume(),re=!1);var t,n;for(t=0,n=Z.length;t<n;t++)Z[t].setSuspended(e);e&&H&&H.suspend&&(H.suspend(),re=!0)}},be.tick=function(){var e=this.runtime.dt,t,n,r;for(t=0,n=Z.length;t<n;t++)r=Z[t],r.tick(e),0!==$&&r.updatePlaybackRate();var o,s,l;for(o in fe)if(fe.hasOwnProperty(o))for(s=fe[o],t=0,n=s.length;t<n;t++)l=s[t],l.tick&&l.tick();J===1&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(e),ne=this.listenerTracker.obj.x,ae=this.listenerTracker.obj.y,H.listener.setPosition(this.listenerTracker.obj.x,this.listenerTracker.obj.y,this.listenerZ))};var we=[];be.setPreloadList=function(e){var t=0,n,a,r,o;for(n=0,a=e.length;n<a;++n)r=e[n],o=2*r.size,we.push({filename:r.filename,size:o,type:r.type,obj:null}),t+=o;return t},be.startPreloads=function(){var e,t,n,a;for(e=0,t=we.length;e<t;++e)n=we[e],a=this.runtime.getProjectFileUrl(n.filename),n.obj=this.getAudioBuffer({url:a,type:n.type},!1)},be.getPreloadedSize=function(){var e=0,t,n,a;for(t=0,n=we.length;t<n;++t)a=we[t],a.obj.isLoadedAndDecoded()||a.obj.hasFailedToLoad()||this.runtime.isAndroidStockBrowser?e+=a.size:a.obj.isLoaded()&&(e+=M(a.size/2));return e},be.releaseAllMusicBuffers=function(){var e,t,n,a;for(e=0,n=0,t=K.length;e<t;++e)a=K[e],K[n]=a,a.is_music?a.release():++n;K.length=n},be.getAudioBuffer=function(e,t,n){var r=null,o=e.url,s,l,p;for(s=0,l=K.length;s<l;s++)if(p=K[s],p.src===o){r=p;break}return r||n||((ye||_e)&&t&&this.releaseAllMusicBuffers(),r=new A(o,e.type,t),K.push(r)),r},be.getAudioInstance=function(e,t,n,r,o){var s=e.url,l,p,d;for(l=0,p=Z.length;l<p;l++)if(d=Z[l],d.src===s&&(d.canBeRecycled()||n))return d.tag=t,d;var c=this.getAudioBuffer(e,n);return c.bufferObject?(d=new P(c,t),Z.push(d),d):("<preload>"!==t&&(c.playTagWhenReady=t,c.loopWhenReady=r,c.volumeWhenReady=o),null)};var Te=[];F.prototype.OnEnded=function(e){return cr.equals_nocase(q,e)},F.prototype.PreloadsComplete=function(){var e,t;for(e=0,t=K.length;e<t;e++)if(!K[e].isLoadedAndDecoded()&&!K[e].hasFailedToLoad())return!1;return!0},F.prototype.AdvancedAudioSupported=function(){return J===1},F.prototype.IsSilent=function(){return ee},F.prototype.IsAnyPlaying=function(){var e,t;for(e=0,t=Z.length;e<t;e++)if(Z[e].isPlaying())return!0;return!1},F.prototype.IsTagPlaying=function(e){L(e);var t,n;for(t=0,n=Te.length;t<n;t++)if(Te[t].isPlaying())return!0;return!1},G.cnds=new F;B.prototype.Play=function(e,t,n,a){if(!ee){var i=r(n),o=e[1],s=this.runtime.getProjectAudioFileUrl(e[0]);s&&(Q=this.getAudioInstance(s,a,o,0!==t,i),Q&&(Q.setPannerEnabled(!1),Q.play(0!==t,i,0,this.nextPlayTime),this.nextPlayTime=0))}},B.prototype.PlayAtPosition=function(e,t,n,a,i,o,s,l,p,d){if(!ee){var c=r(n),u=e[1],g=this.runtime.getProjectAudioFileUrl(e[0]);if(g){if(Q=this.getAudioInstance(g,d,u,0!==t,c),!Q){var m=this.getAudioBuffer(g,u);return void m.panWhenReady.push({x:a,y:i,a:o,ia:s,oa:l,og:r(p),thistag:d})}Q.setPannerEnabled(!0),Q.setPan(a,i,o,s,l,r(p)),Q.play(0!==t,c,0,this.nextPlayTime),this.nextPlayTime=0}}},B.prototype.PlayAtObject=function(e,t,n,a,i,o,s,l){if(!ee&&a){var p=a.getFirstPicked();if(p){var d=r(n),c=e[1],u=this.runtime.getProjectAudioFileUrl(e[0]);if(u){if(Q=this.getAudioInstance(u,l,c,0!==t,d),!Q){var g=this.getAudioBuffer(u,c);return void g.panWhenReady.push({obj:p,ia:i,oa:o,og:r(s),thistag:l})}Q.setPannerEnabled(!0);var m=cr.rotatePtAround(p.x,p.y,-p.layer.getAngle(),ne,ae,!0),y=cr.rotatePtAround(p.x,p.y,-p.layer.getAngle(),ne,ae,!1);Q.setPan(m,y,cr.to_degrees(p.angle-p.layer.getAngle()),i,o,r(s)),Q.setObject(p),Q.play(0!==t,d,0,this.nextPlayTime),this.nextPlayTime=0}}}},B.prototype.PlayByName=function(e,t,n,a,i){if(!ee){var o=r(a),s=this.runtime.getProjectAudioFileUrl(t);s&&(Q=this.getAudioInstance(s,i,1===e,0!==n,o),Q&&(Q.setPannerEnabled(!1),Q.play(0!==n,o,0,this.nextPlayTime),this.nextPlayTime=0))}},B.prototype.PlayAtPositionByName=function(e,t,n,a,i,o,s,l,p,d,c){if(!ee){var u=r(a),g=1===e,m=this.runtime.getProjectAudioFileUrl(t);if(m){if(Q=this.getAudioInstance(m,c,g,0!==n,u),!Q){var y=this.getAudioBuffer(m,g);return void y.panWhenReady.push({x:i,y:o,a:s,ia:l,oa:p,og:r(d),thistag:c})}Q.setPannerEnabled(!0),Q.setPan(i,o,s,l,p,r(d)),Q.play(0!==n,u,0,this.nextPlayTime),this.nextPlayTime=0}}},B.prototype.PlayAtObjectByName=function(e,t,n,a,i,o,s,l,p){if(!ee&&i){var d=i.getFirstPicked();if(d){var c=r(a),u=1===e,g=this.runtime.getProjectAudioFileUrl(t);if(g){if(Q=this.getAudioInstance(g,p,u,0!==n,c),!Q){var m=this.getAudioBuffer(g,u);return void m.panWhenReady.push({obj:d,ia:o,oa:s,og:r(l),thistag:p})}Q.setPannerEnabled(!0);var y=cr.rotatePtAround(d.x,d.y,-d.layer.getAngle(),ne,ae,!0),_=cr.rotatePtAround(d.x,d.y,-d.layer.getAngle(),ne,ae,!1);Q.setPan(y,_,cr.to_degrees(d.angle-d.layer.getAngle()),o,s,r(l)),Q.setObject(d),Q.play(0!==n,c,0,this.nextPlayTime),this.nextPlayTime=0}}}},B.prototype.SetLooping=function(e,t){L(e);var n,a;for(n=0,a=Te.length;n<a;n++)Te[n].setLooping(0===t)},B.prototype.SetMuted=function(e,t){L(e);var n,a;for(n=0,a=Te.length;n<a;n++)Te[n].setMuted(0===t)},B.prototype.SetVolume=function(e,t){L(e);var n=r(t),a,o;for(a=0,o=Te.length;a<o;a++)Te[a].setVolume(n)},B.prototype.Preload=function(e){if(!ee){var t=e[1],n=this.runtime.getProjectAudioFileUrl(e[0]);n&&2!==J&&this.getAudioInstance(n,"<preload>",t,!1)}},B.prototype.PreloadByName=function(e,t){if(!ee){var n=this.runtime.getProjectAudioFileUrl(t);n&&2!==J&&this.getAudioInstance(n,"<preload>",1===e,!1)}},B.prototype.SetPlaybackRate=function(e,t){L(e),0>t&&(t=0);var n,a;for(n=0,a=Te.length;n<a;n++)Te[n].setPlaybackRate(t)},B.prototype.Stop=function(e){L(e);var t,n;for(t=0,n=Te.length;t<n;t++)Te[t].stop()},B.prototype.StopAll=function(){var e,t;for(e=0,t=Z.length;e<t;e++)Z[e].stop()},B.prototype.SetPaused=function(e,t){L(e);var n,a;for(n=0,a=Te.length;n<a;n++)0===t?Te[n].pause():Te[n].resume()},B.prototype.Seek=function(e,t){L(e);var n,a;for(n=0,a=Te.length;n<a;n++)Te[n].seek(t)},B.prototype.SetSilent=function(e){var t,n;if(2===e&&(e=ee?1:0),0===e&&!ee){for(t=0,n=Z.length;t<n;t++)Z[t].setSilent(!0);ee=!0}else if(1===e&&ee){for(t=0,n=Z.length;t<n;t++)Z[t].setSilent(!1);ee=!1}},B.prototype.SetMasterVolume=function(e){te=r(e);var t,n;for(t=0,n=Z.length;t<n;t++)Z[t].updateVolume()},B.prototype.AddFilterEffect=function(e,t,n,a,r,i,o){1!==J||0>t||t>=xe.length||!H.createBiquadFilter||(e=e.toLowerCase(),o/=100,0>o&&(o=0),1<o&&(o=1),k(e,new y(t,n,a,r,i,o)))},B.prototype.AddDelayEffect=function(e,t,n,a){1!==J||(e=e.toLowerCase(),a/=100,0>a&&(a=0),1<a&&(a=1),k(e,new _(t,r(n),a)))},B.prototype.AddFlangerEffect=function(e,t,n,a,r,i){1===J&&H.createOscillator&&(e=e.toLowerCase(),i/=100,0>i&&(i=0),1<i&&(i=1),k(e,new f(t/1e3,n/1e3,a,r/100,i)))},B.prototype.AddPhaserEffect=function(e,t,n,a,r,i,o){1===J&&H.createOscillator&&(e=e.toLowerCase(),o/=100,0>o&&(o=0),1<o&&(o=1),k(e,new x(t,n,a,r,i,o)))},B.prototype.AddConvolutionEffect=function(e,t,n,a){if(1===J&&H.createConvolver){var r=0===n,i=this.runtime.getProjectAudioFileUrl(t[0]);if(i){var o=this.getAudioBuffer(i,!1);e=e.toLowerCase(),a/=100,0>a&&(a=0),1<a&&(a=1);var s;o.bufferObject?s=new h(o.bufferObject,r,a,i.url):(s=new h(null,r,a,i.url),o.normalizeWhenReady=r,o.convolveWhenReady=s),k(e,s)}}},B.prototype.AddGainEffect=function(e,t){1!==J||(e=e.toLowerCase(),k(e,new v(r(t))))},B.prototype.AddMuteEffect=function(e){1!==J||(e=e.toLowerCase(),k(e,new v(0)))},B.prototype.AddTremoloEffect=function(e,t,n){1===J&&H.createOscillator&&(e=e.toLowerCase(),n/=100,0>n&&(n=0),1<n&&(n=1),k(e,new w(t,n)))},B.prototype.AddRingModEffect=function(e,t,n){1===J&&H.createOscillator&&(e=e.toLowerCase(),n/=100,0>n&&(n=0),1<n&&(n=1),k(e,new T(t,n)))},B.prototype.AddDistortionEffect=function(e,t,n,a,r,i){1===J&&H.createWaveShaper&&(e=e.toLowerCase(),i/=100,0>i&&(i=0),1<i&&(i=1),k(e,new S(t,n,a,r,i)))},B.prototype.AddCompressorEffect=function(e,t,n,a,r,i){1===J&&H.createDynamicsCompressor&&(e=e.toLowerCase(),k(e,new O(t,n,a,r/1e3,i/1e3)))},B.prototype.AddAnalyserEffect=function(e,t,n){1!==J||(e=e.toLowerCase(),k(e,new E(t,n)))},B.prototype.RemoveEffects=function(e){if(1===J){e=e.toLowerCase();var t,n,a;if(fe.hasOwnProperty(e)&&(a=fe[e],a.length)){for(t=0,n=a.length;t<n;t++)a[t].remove();cr.clearArray(a),R(e)}}},B.prototype.SetEffectParameter=function(e,t,n,a,r,i){if(1===J){e=e.toLowerCase(),t=M(t);var o;fe.hasOwnProperty(e)&&(o=fe[e],0>t||t>=o.length||o[t].setParam(n,a,r,i))}},B.prototype.SetListenerObject=function(e){if(e&&1===J){var t=e.getFirstPicked();t&&(this.listenerTracker.setObject(t),ne=t.x,ae=t.y)}},B.prototype.SetListenerZ=function(e){this.listenerZ=e},B.prototype.ScheduleNextPlay=function(e){H&&(this.nextPlayTime=e)},B.prototype.UnloadAudio=function(e){var t=e[1],n=this.runtime.getProjectAudioFileUrl(e[0]);if(n){var a=this.getAudioBuffer(n,t,!0);a&&(a.release(),cr.arrayFindRemove(K,a))}},B.prototype.UnloadAudioByName=function(e,t){var n=this.runtime.getProjectAudioFileUrl(t);if(n){var a=this.getAudioBuffer(n,1===e,!0);a&&(a.release(),cr.arrayFindRemove(K,a))}},B.prototype.UnloadAll=function(){var e,t;for(e=0,t=K.length;e<t;++e)K[e].release();cr.clearArray(K)},G.acts=new B;j.prototype.Duration=function(e,t){L(t,!0),Te.length?e.set_float(Te[0].getDuration()):e.set_float(0)},j.prototype.PlaybackTime=function(e,t){L(t,!0),Te.length?e.set_float(Te[0].getPlaybackTime(!0)):e.set_float(0)},j.prototype.PlaybackRate=function(e,t){L(t,!0),Te.length?e.set_float(Te[0].getPlaybackRate()):e.set_float(0)},j.prototype.Volume=function(e,t){if(L(t,!0),Te.length){var n=Te[0].getVolume();e.set_float(o(n))}else e.set_float(0)},j.prototype.MasterVolume=function(e){e.set_float(o(te))},j.prototype.EffectCount=function(e,t){t=t.toLowerCase();var n=null;fe.hasOwnProperty(t)&&(n=fe[t]),e.set_int(n?n.length:0)};j.prototype.AnalyserFreqBinCount=function(e,t,n){t=t.toLowerCase(),n=M(n);var a=N(t,n);e.set_int(a?a.node.frequencyBinCount:0)},j.prototype.AnalyserFreqBinAt=function(e,t,n,a){t=t.toLowerCase(),n=M(n),a=M(a);var r=N(t,n);r?0>a||a>=r.node.frequencyBinCount?e.set_float(0):e.set_float(r.freqBins[a]):e.set_float(0)},j.prototype.AnalyserPeakLevel=function(e,t,n){t=t.toLowerCase(),n=M(n);var a=N(t,n);a?e.set_float(a.peak):e.set_float(0)},j.prototype.AnalyserRMSLevel=function(e,t,n){t=t.toLowerCase(),n=M(n);var a=N(t,n);a?e.set_float(a.rms):e.set_float(0)},j.prototype.SampleRate=function(e){e.set_int(H?H.sampleRate:0)},j.prototype.CurrentTime=function(e){e.set_float(H?H.currentTime:cr.performance_now())},G.exps=new j}();cr.plugins_.TextBox=function(e){this.runtime=e},function(){function e(){}function t(){}function n(){}var a=Math.round,r=cr.plugins_.TextBox.prototype;r.Type=function(e){this.plugin=e,this.runtime=e.runtime};var i=r.Type.prototype;i.onCreate=function(){},r.Instance=function(e){this.type=e,this.runtime=e.runtime};var o=r.Instance.prototype,s=["text","password","email","number","tel","url","textarea","search"];-1<navigator.userAgent.indexOf("MSIE 9")&&(s[2]="text",s[3]="text",s[4]="text",s[5]="text",s[7]="text"),o.onCreate=function(){6===this.properties[7]?(this.elem=document.createElement("textarea"),this.elem.style.resize="none"):(this.elem=document.createElement("input"),this.elem.type=s[this.properties[7]]),this.elem.id=this.properties[9],document.body.appendChild(this.elem),this.elem.autocomplete="off",this.elem.value=this.properties[0],this.elem.placeholder=this.properties[1],this.elem.title=this.properties[2],this.elem.disabled=!this.properties[4],this.elem.readOnly=this.properties[5],this.elem.spellcheck=this.properties[6],this.autoFontSize=this.properties[8],this.element_hidden=!1,this.properties[3]||(this.elem.style.display="none",this.visible=!1,this.element_hidden=!0);var e=function(e){return function(){e.runtime.trigger(cr.plugins_.TextBox.prototype.cnds.OnTextChanged,e)}}(this);this.elem.oninput=e,-1!==navigator.userAgent.indexOf("MSIE")&&(this.elem.oncut=e),this.elem.onclick=function(t){return function(n){n.stopPropagation(),t.runtime.isInUserInputEvent=!0,t.runtime.trigger(cr.plugins_.TextBox.prototype.cnds.OnClicked,t),t.runtime.isInUserInputEvent=!1}}(this),this.elem.ondblclick=function(t){return function(n){n.stopPropagation(),t.runtime.isInUserInputEvent=!0,t.runtime.trigger(cr.plugins_.TextBox.prototype.cnds.OnDoubleClicked,t),t.runtime.isInUserInputEvent=!1}}(this),this.elem.addEventListener("touchstart",function(t){t.stopPropagation()},!1),this.elem.addEventListener("touchmove",function(t){t.stopPropagation()},!1),this.elem.addEventListener("touchend",function(t){t.stopPropagation()},!1),this.elem.addEventListener("mousedown",function(t){t.stopPropagation()}),this.elem.addEventListener("mouseup",function(t){t.stopPropagation()}),this.elem.addEventListener("keydown",function(t){13!==t.which&&27!=t.which&&t.stopPropagation()}),this.elem.addEventListener("keyup",function(t){13!==t.which&&27!=t.which&&t.stopPropagation()}),this.lastLeft=0,this.lastTop=0,this.lastRight=0,this.lastBottom=0,this.lastWinWidth=0,this.lastWinHeight=0,this.updatePosition(!0),this.runtime.tickMe(this)},o.saveToJSON=function(){return{text:this.elem.value,placeholder:this.elem.placeholder,tooltip:this.elem.title,disabled:!!this.elem.disabled,readonly:!!this.elem.readOnly,spellcheck:!!this.elem.spellcheck}},o.loadFromJSON=function(e){this.elem.value=e.text,this.elem.placeholder=e.placeholder,this.elem.title=e.tooltip,this.elem.disabled=e.disabled,this.elem.readOnly=e.readonly,this.elem.spellcheck=e.spellcheck},o.onDestroy=function(){this.elem.parentElement.removeChild(this.elem),this.elem=null},o.tick=function(){this.updatePosition()},o.updatePosition=function(e){var t=this.layer.layerToCanvas(this.x,this.y,!0),n=this.layer.layerToCanvas(this.x,this.y,!1),r=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!0),i=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!1),o=this.runtime.width/this.runtime.devicePixelRatio,s=this.runtime.height/this.runtime.devicePixelRatio;if(!this.visible||!this.layer.visible||0>=r||0>=i||t>=o||n>=s)return this.element_hidden||(this.elem.style.display="none"),void(this.element_hidden=!0);1>t&&(t=1),1>n&&(n=1),r>=o&&(r=o-1),i>=s&&(i=s-1);var l=window.innerWidth,p=window.innerHeight;if(!e&&this.lastLeft===t&&this.lastTop===n&&this.lastRight===r&&this.lastBottom===i&&this.lastWinWidth===l&&this.lastWinHeight===p)return void(this.element_hidden&&(this.elem.style.display="",this.element_hidden=!1));this.lastLeft=t,this.lastTop=n,this.lastRight=r,this.lastBottom=i,this.lastWinWidth=l,this.lastWinHeight=p,this.element_hidden&&(this.elem.style.display="",this.element_hidden=!1);var d=a(t)+this.runtime.canvas.offsetLeft,c=a(n)+this.runtime.canvas.offsetTop;this.elem.style.position="absolute",this.elem.style.left=d+"px",this.elem.style.top=c+"px",this.elem.style.width=a(r-t)+"px",this.elem.style.height=a(i-n)+"px",this.autoFontSize&&(this.elem.style.fontSize=this.layer.getScale(!0)/this.runtime.devicePixelRatio-.2+"em")},o.draw=function(){},o.drawGL=function(){};e.prototype.CompareText=function(e,t){return 0===t?cr.equals_nocase(this.elem.value,e):this.elem.value===e},e.prototype.OnTextChanged=function(){return!0},e.prototype.OnClicked=function(){return!0},e.prototype.OnDoubleClicked=function(){return!0},r.cnds=new e;t.prototype.SetText=function(e){this.elem.value=e},t.prototype.SetPlaceholder=function(e){this.elem.placeholder=e},t.prototype.SetTooltip=function(e){this.elem.title=e},t.prototype.SetVisible=function(e){this.visible=0!==e},t.prototype.SetEnabled=function(e){this.elem.disabled=0===e},t.prototype.SetReadOnly=function(e){this.elem.readOnly=0===e},t.prototype.SetFocus=function(){this.elem.focus()},t.prototype.SetBlur=function(){this.elem.blur()},t.prototype.SetCSSStyle=function(e,t){this.elem.style[cr.cssToCamelCase(e)]=t},t.prototype.ScrollToBottom=function(){this.elem.scrollTop=this.elem.scrollHeight},r.acts=new t;n.prototype.Text=function(e){e.set_string(this.elem.value)},r.exps=new n}();cr.plugins_.TiledBg=function(e){this.runtime=e},function(){function e(){}function t(){}function n(){}var a=Math.round,r=cr.plugins_.TiledBg.prototype;r.Type=function(e){this.plugin=e,this.runtime=e.runtime};var i=r.Type.prototype;i.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),!this.texture_img&&(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.pattern=null,this.webGL_texture=null)},i.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},i.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat));var e,t;for(e=0,t=this.instances.length;e<t;e++)this.instances[e].webGL_texture=this.webGL_texture}},i.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))},i.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},i.preloadCanvas2D=function(e){e.drawImage(this.texture_img,0,0)},r.Instance=function(e){this.type=e,this.runtime=e.runtime};var o=r.Instance.prototype;o.onCreate=function(){this.visible=this.properties[0],this.rcTex=new cr.rect(0,0,0,0),this.has_own_texture=!1,this.texture_img=this.type.texture_img,this.runtime.glwrap?(this.type.loadTextures(),this.webGL_texture=this.type.webGL_texture):(!this.type.pattern&&(this.type.pattern=this.runtime.ctx.createPattern(this.type.texture_img,"repeat")),this.pattern=this.type.pattern)},o.afterLoad=function(){this.has_own_texture=!1,this.texture_img=this.type.texture_img},o.onDestroy=function(){this.runtime.glwrap&&this.has_own_texture&&this.webGL_texture&&(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},o.draw=function(e){e.globalAlpha=this.opacity,e.save(),e.fillStyle=this.pattern;var t=this.x,n=this.y;this.runtime.pixel_rounding&&(t=a(t),n=a(n));var r=-(this.hotspotX*this.width),i=-(this.hotspotY*this.height),o=r%this.texture_img.width,s=i%this.texture_img.height;0>o&&(o+=this.texture_img.width),0>s&&(s+=this.texture_img.height),e.translate(t,n),e.rotate(this.angle),e.translate(o,s),e.fillRect(r-o,i-s,this.width,this.height),e.restore()},o.drawGL_earlyZPass=function(e){this.drawGL(e)},o.drawGL=function(e){e.setTexture(this.webGL_texture),e.setOpacity(this.opacity);var t=this.rcTex;t.right=this.width/this.texture_img.width,t.bottom=this.height/this.texture_img.height;var n=this.bquad;if(this.runtime.pixel_rounding){var r=a(this.x)-this.x,i=a(this.y)-this.y;e.quadTex(n.tlx+r,n.tly+i,n.trx+r,n.try_+i,n.brx+r,n.bry+i,n.blx+r,n.bly+i,t)}else e.quadTex(n.tlx,n.tly,n.trx,n.try_,n.brx,n.bry,n.blx,n.bly,t)};e.prototype.OnURLLoaded=function(){return!0},r.cnds=new e;t.prototype.SetEffect=function(e){this.blend_mode=e,this.compositeOp=cr.effectToCompositeOp(e),cr.setGLBlend(this,e,this.runtime.gl),this.runtime.redraw=!0},t.prototype.LoadURL=function(e,t){var n=new Image,a=this;n.onload=function(){a.texture_img=n,a.runtime.glwrap?(a.has_own_texture&&a.webGL_texture&&a.runtime.glwrap.deleteTexture(a.webGL_texture),a.webGL_texture=a.runtime.glwrap.loadTexture(n,!0,a.runtime.linearSampling)):a.pattern=a.runtime.ctx.createPattern(n,"repeat"),a.has_own_texture=!0,a.runtime.redraw=!0,a.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded,a)},"data:"!==e.substr(0,5)&&0===t&&(n.crossOrigin="anonymous"),this.runtime.setImageSrc(n,e)},r.acts=new t;n.prototype.ImageWidth=function(e){e.set_float(this.texture_img.width)},n.prototype.ImageHeight=function(e){e.set_float(this.texture_img.height)},r.exps=new n}();cr.behaviors.Platform=function(e){this.runtime=e},function(){function e(){}function t(){}function n(){}var a=Math.abs,r=Math.sqrt,i=Math.max,o=Math.cos,s=Math.sin,l=Math.PI,p=cr.behaviors.Platform.prototype;p.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var d=p.Type.prototype;d.onCreate=function(){};p.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime,this.leftkey=!1,this.rightkey=!1,this.jumpkey=!1,this.jumped=!1,this.doubleJumped=!1,this.canDoubleJump=!1,this.ignoreInput=!1,this.simleft=!1,this.simright=!1,this.simjump=!1,this.lastFloorObject=null,this.loadFloorObject=-1,this.lastFloorX=0,this.lastFloorY=0,this.floorIsJumpthru=!1,this.ceilingCollisionMode=0,this.animMode=0,this.fallthrough=0,this.firstTick=!0,this.dx=0,this.dy=0};var c=p.Instance.prototype;c.updateGravity=function(){this.downx=o(this.ga),this.downy=s(this.ga),this.rightx=o(this.ga-l/2),this.righty=s(this.ga-l/2),this.downx=cr.round6dp(this.downx),this.downy=cr.round6dp(this.downy),this.rightx=cr.round6dp(this.rightx),this.righty=cr.round6dp(this.righty),this.g1=this.g,0>this.g&&(this.downx*=-1,this.downy*=-1,this.g=a(this.g))},c.onCreate=function(){this.maxspeed=this.properties[0],this.acc=this.properties[1],this.dec=this.properties[2],this.jumpStrength=this.properties[3],this.g=this.properties[4],this.g1=this.g,this.maxFall=this.properties[5],this.enableDoubleJump=this.properties[6],this.jumpSustain=this.properties[7]/1e3,this.defaultControls=this.properties[8],this.enabled=this.properties[9],this.wasOnFloor=!1,this.wasOverJumpthru=this.runtime.testOverlapJumpThru(this.inst),this.loadOverJumpthru=-1,this.sustainTime=0,this.ga=cr.to_radians(90),this.updateGravity();var e=this;this.defaultControls&&(document.addEventListener("keydown",function(t){e.onKeyDown(t)}),document.addEventListener("keyup",function(t){e.onKeyUp(t)})),this.recycled||(this.myDestroyCallback=function(t){e.onInstanceDestroyed(t)}),this.runtime.addDestroyCallback(this.myDestroyCallback),this.inst.extra.isPlatformBehavior=!0},c.saveToJSON=function(){return{ii:this.ignoreInput,lfx:this.lastFloorX,lfy:this.lastFloorY,lfo:this.lastFloorObject?this.lastFloorObject.uid:-1,am:this.animMode,en:this.enabled,fall:this.fallthrough,ft:this.firstTick,dx:this.dx,dy:this.dy,ms:this.maxspeed,acc:this.acc,dec:this.dec,js:this.jumpStrength,g:this.g,g1:this.g1,mf:this.maxFall,wof:this.wasOnFloor,woj:this.wasOverJumpthru?this.wasOverJumpthru.uid:-1,ga:this.ga,edj:this.enableDoubleJump,cdj:this.canDoubleJump,dj:this.doubleJumped,sus:this.jumpSustain,cc:this.ceilingCollisionMode}},c.loadFromJSON=function(e){this.ignoreInput=e.ii,this.lastFloorX=e.lfx,this.lastFloorY=e.lfy,this.loadFloorObject=e.lfo,this.animMode=e.am,this.enabled=e.en,this.fallthrough=e.fall,this.firstTick=e.ft,this.dx=e.dx,this.dy=e.dy,this.maxspeed=e.ms,this.acc=e.acc,this.dec=e.dec,this.jumpStrength=e.js,this.g=e.g,this.g1=e.g1,this.maxFall=e.mf,this.wasOnFloor=e.wof,this.loadOverJumpthru=e.woj,this.ga=e.ga,this.enableDoubleJump=e.edj,this.canDoubleJump=e.cdj,this.doubleJumped=e.dj,this.jumpSustain=e.sus,this.ceilingCollisionMode=e.cc||0,this.leftkey=!1,this.rightkey=!1,this.jumpkey=!1,this.jumped=!1,this.simleft=!1,this.simright=!1,this.simjump=!1,this.sustainTime=0,this.updateGravity()},c.afterLoad=function(){this.lastFloorObject=-1===this.loadFloorObject?null:this.runtime.getObjectByUID(this.loadFloorObject),this.wasOverJumpthru=-1===this.loadOverJumpthru?null:this.runtime.getObjectByUID(this.loadOverJumpthru)},c.onInstanceDestroyed=function(e){this.lastFloorObject==e&&(this.lastFloorObject=null)},c.onDestroy=function(){this.lastFloorObject=null,this.runtime.removeDestroyCallback(this.myDestroyCallback)},c.onKeyDown=function(e){switch(e.which){case 38:e.preventDefault(),this.jumpkey=!0;break;case 37:e.preventDefault(),this.leftkey=!0;break;case 39:e.preventDefault(),this.rightkey=!0;}},c.onKeyUp=function(e){switch(e.which){case 38:e.preventDefault(),this.jumpkey=!1,this.jumped=!1;break;case 37:e.preventDefault(),this.leftkey=!1;break;case 39:e.preventDefault(),this.rightkey=!1;}},c.onWindowBlur=function(){this.leftkey=!1,this.rightkey=!1,this.jumpkey=!1},c.getGDir=function(){return 0>this.g?-1:1},c.isOnFloor=function(){var e=null,t=null,n=this.inst.x,a=this.inst.y,r,o,s;if(this.inst.x+=this.downx,this.inst.y+=this.downy,this.inst.set_bbox_changed(),this.lastFloorObject&&this.runtime.testOverlap(this.inst,this.lastFloorObject)&&(!this.runtime.typeHasBehavior(this.lastFloorObject.type,cr.behaviors.solid)||this.lastFloorObject.extra.solidEnabled))return this.inst.x=n,this.inst.y=a,this.inst.set_bbox_changed(),this.lastFloorObject;if(e=this.runtime.testOverlapSolid(this.inst),e||0!==this.fallthrough||(t=this.runtime.testOverlapJumpThru(this.inst,!0)),this.inst.x=n,this.inst.y=a,this.inst.set_bbox_changed(),e)return this.runtime.testOverlap(this.inst,e)?null:(this.floorIsJumpthru=!1,e);if(t&&t.length){for(r=0,s=0,o=t.length;r<o;r++)t[s]=t[r],this.runtime.testOverlap(this.inst,t[r])||s++;if(1<=s)return this.floorIsJumpthru=!0,t[0]}return null},c.tick=function(){},c.posttick=function(){var e=this.runtime.getDt(this.inst),t,n,o,s,l,p,d,c,u,g;this.jumpkey||this.simjump||(this.jumped=!1);var m=this.leftkey||this.simleft,y=this.rightkey||this.simright,_=this.jumpkey||this.simjump,h=_&&!this.jumped;if(this.simleft=!1,this.simright=!1,this.simjump=!1,!!this.enabled){this.ignoreInput&&(m=!1,y=!1,_=!1,h=!1),_||(this.sustainTime=0);var f=this.lastFloorObject,x=!1;this.firstTick&&((this.runtime.testOverlapSolid(this.inst)||this.runtime.testOverlapJumpThru(this.inst))&&this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,4,!0),this.firstTick=!1),f&&0===this.dy&&(f.y!==this.lastFloorY||f.x!==this.lastFloorX)&&(t=f.x-this.lastFloorX,n=f.y-this.lastFloorY,this.inst.x+=t,this.inst.y+=n,this.inst.set_bbox_changed(),this.lastFloorX=f.x,this.lastFloorY=f.y,x=!0,this.runtime.testOverlapSolid(this.inst)&&this.runtime.pushOutSolid(this.inst,-t,-n,2.5*r(t*t+n*n)));var b=this.isOnFloor(),v=this.runtime.testOverlapSolid(this.inst);if(v){var w=a(this.inst.width),T=a(this.inst.height);if(this.inst.extra.inputPredicted)this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,10,!1);else if(this.runtime.pushOutSolidAxis(this.inst,-this.downx,-this.downy,T/8))this.runtime.registerCollision(this.inst,v);else if(this.runtime.pushOutSolidAxis(this.inst,this.rightx,this.righty,w/2))this.runtime.registerCollision(this.inst,v);else if(this.runtime.pushOutSolidAxis(this.inst,this.downx,this.downy,T/2))this.runtime.registerCollision(this.inst,v);else if(this.runtime.pushOutSolidNearest(this.inst,i(w,T)/2))this.runtime.registerCollision(this.inst,v);else return}b?(this.doubleJumped=!1,this.canDoubleJump=!1,0<this.dy&&(!this.wasOnFloor&&(this.runtime.pushInFractional(this.inst,-this.downx,-this.downy,b,16),this.wasOnFloor=!0),this.dy=0),f==b?x&&(v=this.runtime.testOverlapSolid(this.inst),v&&(this.runtime.registerCollision(this.inst,v),0!==t&&(0<t?this.runtime.pushOutSolid(this.inst,-this.rightx,-this.righty):this.runtime.pushOutSolid(this.inst,this.rightx,this.righty)),this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy))):(this.lastFloorObject=b,this.lastFloorX=b.x,this.lastFloorY=b.y,this.runtime.registerCollision(this.inst,b))):!_&&(this.canDoubleJump=!0),(b&&h||!b&&this.enableDoubleJump&&_&&this.canDoubleJump&&!this.doubleJumped)&&(u=this.inst.x,g=this.inst.y,this.inst.x-=this.downx,this.inst.y-=this.downy,this.inst.set_bbox_changed(),this.runtime.testOverlapSolid(this.inst)?h=!1:(this.sustainTime=this.jumpSustain,this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnJump,this.inst),this.animMode=2,this.dy=-this.jumpStrength,h=!0,b?this.jumped=!0:this.doubleJumped=!0),this.inst.x=u,this.inst.y=g,this.inst.set_bbox_changed()),b||(_&&0<this.sustainTime?(this.dy=-this.jumpStrength,this.sustainTime-=e):(this.lastFloorObject=null,this.dy+=this.g*e,this.dy>this.maxFall&&(this.dy=this.maxFall)),h&&(this.jumped=!0)),this.wasOnFloor=!!b,m==y&&(0>this.dx?(this.dx+=this.dec*e,0<this.dx&&(this.dx=0)):0<this.dx&&(this.dx-=this.dec*e,0>this.dx&&(this.dx=0)));var S=0;m&&!y&&(0<this.dx?S=-(this.acc+this.dec):S=-this.acc),y&&!m&&(0>this.dx?S=this.acc+this.dec:S=this.acc),this.dx+=S*e,this.dx>this.maxspeed?this.dx=this.maxspeed:this.dx<-this.maxspeed&&(this.dx=-this.maxspeed);var O=!1;if(0!==this.dx){u=this.inst.x,g=this.inst.y,t=this.runtime.accelerate(this.dx,-this.maxspeed,this.maxspeed,S,e)*this.rightx,n=this.runtime.accelerate(this.dx,-this.maxspeed,this.maxspeed,S,e)*this.righty,this.inst.x+=this.rightx*(1<this.dx?1:-1)-this.downx,this.inst.y+=this.righty*(1<this.dx?1:-1)-this.downy,this.inst.set_bbox_changed();var E=!1,C=this.runtime.testOverlapSolid(this.inst);if(this.inst.x=u+t,this.inst.y=g+n,this.inst.set_bbox_changed(),o=this.runtime.testOverlapSolid(this.inst),!o&&b&&(o=this.runtime.testOverlapJumpThru(this.inst),o&&(this.inst.x=u,this.inst.y=g,this.inst.set_bbox_changed(),this.runtime.testOverlap(this.inst,o)?(o=null,E=!1):E=!0,this.inst.x=u+t,this.inst.y=g+n,this.inst.set_bbox_changed())),o){var A=a(this.dx*e)+2;C||!this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,A,E,o)?(this.runtime.registerCollision(this.inst,o),A=i(a(2.5*(this.dx*e)),30),this.runtime.pushOutSolid(this.inst,this.rightx*(0>this.dx?1:-1),this.righty*(0>this.dx?1:-1),A,!1)?b&&!E&&!this.floorIsJumpthru&&(u=this.inst.x,g=this.inst.y,this.inst.x+=this.downx,this.inst.y+=this.downy,this.runtime.testOverlapSolid(this.inst)?!this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,3,!1)&&(this.inst.x=u,this.inst.y=g,this.inst.set_bbox_changed()):(this.inst.x=u,this.inst.y=g,this.inst.set_bbox_changed())):(this.inst.x=u,this.inst.y=g,this.inst.set_bbox_changed()),!E&&(this.dx=0)):!C&&!h&&a(this.dy)<a(this.jumpStrength/4)&&(this.dy=0,!b&&(O=!0))}else{var P=this.isOnFloor();b&&!P?(s=Math.ceil(a(this.dx*e))+2,u=this.inst.x,g=this.inst.y,this.inst.x+=this.downx*s,this.inst.y+=this.downy*s,this.inst.set_bbox_changed(),this.runtime.testOverlapSolid(this.inst)||this.runtime.testOverlapJumpThru(this.inst)?this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,s+2,!0):(this.inst.x=u,this.inst.y=g,this.inst.set_bbox_changed())):P&&(!b&&this.floorIsJumpthru&&(this.lastFloorObject=P,this.lastFloorX=P.x,this.lastFloorY=P.y,this.dy=0,O=!0),0===this.dy&&this.runtime.pushInFractional(this.inst,-this.downx,-this.downy,P,16))}}if(0!==this.dy){u=this.inst.x,g=this.inst.y,this.inst.x+=this.runtime.accelerate(this.dy,-Infinity,this.maxFall,this.g,e)*this.downx,this.inst.y+=this.runtime.accelerate(this.dy,-Infinity,this.maxFall,this.g,e)*this.downy;var I=this.inst.x,L=this.inst.y;this.inst.set_bbox_changed(),v=this.runtime.testOverlapSolid(this.inst);var R=!1;if(!v&&0<this.dy&&!b){if(l=0<this.fallthrough?null:this.runtime.testOverlapJumpThru(this.inst,!0),l&&l.length){if(this.wasOverJumpthru){for(this.inst.x=u,this.inst.y=g,this.inst.set_bbox_changed(),(p=0,c=0,d=l.length);p<d;p++)l[c]=l[p],this.runtime.testOverlap(this.inst,l[p])||c++;l.length=c,this.inst.x=I,this.inst.y=L,this.inst.set_bbox_changed()}1<=l.length&&(v=l[0])}R=!!v}if(v){this.runtime.registerCollision(this.inst,v),this.sustainTime=0;var A=R?a(2.5*(this.dy*e)+10):i(a(2.5*(this.dy*e)+10),30);this.runtime.pushOutSolid(this.inst,this.downx*(0>this.dy?1:-1),this.downy*(0>this.dy?1:-1),A,R,v)?(this.lastFloorObject=v,this.lastFloorX=v.x,this.lastFloorY=v.y,this.floorIsJumpthru=R,R&&(O=!0),(0<this.dy||0===this.ceilingCollisionMode)&&(this.dy=0),0>this.dy&&1===this.ceilingCollisionMode&&this.runtime.pushInFractional(this.inst,this.downx,this.downy,v,32)):(this.inst.x=u,this.inst.y=g,this.inst.set_bbox_changed(),this.wasOnFloor=!0,!R&&(this.dy=0))}}3!==this.animMode&&0<this.dy&&!b&&(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnFall,this.inst),this.animMode=3),(b||O)&&0<=this.dy&&(3===this.animMode||O||h&&0===this.dy?(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnLand,this.inst),this.animMode=0===this.dx&&0===this.dy?0:1):(0!==this.animMode&&0===this.dx&&0===this.dy&&(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnStop,this.inst),this.animMode=0),1!==this.animMode&&(0!==this.dx||0!==this.dy)&&!h&&(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnMove,this.inst),this.animMode=1))),0<this.fallthrough&&this.fallthrough--,this.wasOverJumpthru=this.runtime.testOverlapJumpThru(this.inst)}};e.prototype.IsMoving=function(){return 0!==this.dx||0!==this.dy},e.prototype.CompareSpeed=function(e,t){var n=r(this.dx*this.dx+this.dy*this.dy);return cr.do_cmp(n,e,t)},e.prototype.IsOnFloor=function(){if(0!==this.dy)return!1;var e=null,t=null,n=this.inst.x,a=this.inst.y,r,o,s;if(this.inst.x+=this.downx,this.inst.y+=this.downy,this.inst.set_bbox_changed(),e=this.runtime.testOverlapSolid(this.inst),e||0!==this.fallthrough||(t=this.runtime.testOverlapJumpThru(this.inst,!0)),this.inst.x=n,this.inst.y=a,this.inst.set_bbox_changed(),e)return!this.runtime.testOverlap(this.inst,e);if(t&&t.length){for(r=0,s=0,o=t.length;r<o;r++)t[s]=t[r],this.runtime.testOverlap(this.inst,t[r])||s++;if(1<=s)return!0}return!1},e.prototype.IsByWall=function(e){var t=!1,n=this.inst.x,a=this.inst.y;return(0===e?(this.inst.x-=2*this.rightx,this.inst.y-=2*this.righty):(this.inst.x+=2*this.rightx,this.inst.y+=2*this.righty),this.inst.set_bbox_changed(),!this.runtime.testOverlapSolid(this.inst))?(this.inst.x=n,this.inst.y=a,this.inst.set_bbox_changed(),!1):(this.inst.x-=3*this.downx,this.inst.y-=3*this.downy,this.inst.set_bbox_changed(),t=this.runtime.testOverlapSolid(this.inst),this.inst.x=n,this.inst.y=a,this.inst.set_bbox_changed(),t)},e.prototype.IsJumping=function(){return 0>this.dy},e.prototype.IsFalling=function(){return 0<this.dy},e.prototype.OnJump=function(){return!0},e.prototype.OnFall=function(){return!0},e.prototype.OnStop=function(){return!0},e.prototype.OnMove=function(){return!0},e.prototype.OnLand=function(){return!0},e.prototype.IsDoubleJumpEnabled=function(){return this.enableDoubleJump},e.prototype.IsEnabled=function(){return this.enabled},p.cnds=new e;t.prototype.SetIgnoreInput=function(e){this.ignoreInput=e},t.prototype.SetMaxSpeed=function(e){this.maxspeed=e,0>this.maxspeed&&(this.maxspeed=0)},t.prototype.SetAcceleration=function(e){this.acc=e,0>this.acc&&(this.acc=0)},t.prototype.SetDeceleration=function(e){this.dec=e,0>this.dec&&(this.dec=0)},t.prototype.SetJumpStrength=function(e){this.jumpStrength=e,0>this.jumpStrength&&(this.jumpStrength=0)},t.prototype.SetGravity=function(e){this.g1===e||(this.g=e,this.updateGravity(),this.runtime.testOverlapSolid(this.inst)&&(this.runtime.pushOutSolid(this.inst,this.downx,this.downy,10),this.inst.x+=2*this.downx,this.inst.y+=2*this.downy,this.inst.set_bbox_changed()),this.lastFloorObject=null)},t.prototype.SetMaxFallSpeed=function(e){this.maxFall=e,0>this.maxFall&&(this.maxFall=0)},t.prototype.SimulateControl=function(e){0===e?this.simleft=!0:1===e?this.simright=!0:2===e?this.simjump=!0:void 0},t.prototype.SetVectorX=function(e){this.dx=e},t.prototype.SetVectorY=function(e){this.dy=e},t.prototype.SetGravityAngle=function(e){e=cr.to_radians(e),e=cr.clamp_angle(e);this.ga===e||(this.ga=e,this.updateGravity(),this.lastFloorObject=null)},t.prototype.SetEnabled=function(e){this.enabled!==(1===e)&&(this.enabled=1===e,!this.enabled&&(this.lastFloorObject=null))},t.prototype.FallThrough=function(){var e=this.inst.x,t=this.inst.y;this.inst.x+=this.downx,this.inst.y+=this.downy,this.inst.set_bbox_changed();var n=this.runtime.testOverlapJumpThru(this.inst,!1);this.inst.x=e,this.inst.y=t,this.inst.set_bbox_changed();n&&(this.fallthrough=3,this.lastFloorObject=null)},t.prototype.SetDoubleJumpEnabled=function(t){this.enableDoubleJump=0!==t},t.prototype.SetJumpSustain=function(e){this.jumpSustain=e/1e3},t.prototype.SetCeilingCollision=function(e){this.ceilingCollisionMode=e},p.acts=new t;n.prototype.Speed=function(e){e.set_float(r(this.dx*this.dx+this.dy*this.dy))},n.prototype.MaxSpeed=function(e){e.set_float(this.maxspeed)},n.prototype.Acceleration=function(e){e.set_float(this.acc)},n.prototype.Deceleration=function(e){e.set_float(this.dec)},n.prototype.JumpStrength=function(e){e.set_float(this.jumpStrength)},n.prototype.Gravity=function(e){e.set_float(this.g)},n.prototype.GravityAngle=function(e){e.set_float(cr.to_degrees(this.ga))},n.prototype.MaxFallSpeed=function(e){e.set_float(this.maxFall)},n.prototype.MovingAngle=function(e){e.set_float(cr.to_degrees(Math.atan2(this.dy,this.dx)))},n.prototype.VectorX=function(e){e.set_float(this.dx)},n.prototype.VectorY=function(e){e.set_float(this.dy)},n.prototype.JumpSustain=function(e){e.set_float(1e3*this.jumpSustain)},p.exps=new n}();cr.behaviors.wrap=function(e){this.runtime=e},function(){var e=cr.behaviors.wrap.prototype;e.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var t=e.Type.prototype;t.onCreate=function(){},e.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime};var n=e.Instance.prototype;n.onCreate=function(){this.mode=this.properties[0]},n.tick=function(){var e=this.inst;e.update_bbox();var t=e.bbox,n=e.layer,a=n.layout,r=0,i=0,o=0,s=0;0===this.mode?(i=a.width,s=a.height):(r=n.viewLeft,i=n.viewRight,o=n.viewTop,s=n.viewBottom),t.right<r?(e.x=i-1+(e.x-t.left),e.set_bbox_changed()):t.left>i?(e.x=r+1-(t.right-e.x),e.set_bbox_changed()):t.bottom<o?(e.y=s-1+(e.y-t.top),e.set_bbox_changed()):t.top>s&&(e.y=o+1-(t.bottom-e.y),e.set_bbox_changed())}}();cr.behaviors.solid=function(e){this.runtime=e},function(){function e(){}function t(){}var n=cr.behaviors.solid.prototype;n.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var a=n.Type.prototype;a.onCreate=function(){},n.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime};var r=n.Instance.prototype;r.onCreate=function(){this.inst.extra.solidEnabled=this.properties[0]},r.tick=function(){};e.prototype.IsEnabled=function(){return this.inst.extra.solidEnabled},n.cnds=new e;t.prototype.SetEnabled=function(t){this.inst.extra.solidEnabled=!!t},n.acts=new t}();cr.behaviors.Bullet=function(e){this.runtime=e},function(){function e(){}function t(){}function n(){}var a=Math.max,r=Math.cos,o=Math.sin,i=cr.behaviors.Bullet.prototype;i.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var s=i.Type.prototype;s.onCreate=function(){},i.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime};var l=i.Instance.prototype;l.onCreate=function(){var e=this.properties[0];this.acc=this.properties[1],this.g=this.properties[2],this.bounceOffSolid=this.properties[3],this.setAngle=this.properties[4],this.step=this.properties[5],this.stepSize=Math.abs(Math.min(this.inst.width,this.inst.height)/2),this.stopStepping=!1,this.dx=r(this.inst.angle)*e,this.dy=o(this.inst.angle)*e,this.lastx=this.inst.x,this.lasty=this.inst.y,this.lastKnownAngle=this.inst.angle,this.travelled=0,this.enabled=this.properties[6]},l.saveToJSON=function(){return{acc:this.acc,g:this.g,dx:this.dx,dy:this.dy,lx:this.lastx,ly:this.lasty,lka:this.lastKnownAngle,t:this.travelled,st:this.step,e:this.enabled}},l.loadFromJSON=function(e){this.acc=e.acc,this.g=e.g,this.dx=e.dx,this.dy=e.dy,this.lastx=e.lx,this.lasty=e.ly,this.lastKnownAngle=e.lka,this.travelled=e.t,this.step=!!e.st,this.enabled=e.e},l.tick=function(){if(this.enabled){var e=this.runtime.getDt(this.inst),t,n,i,l;this.inst.angle!==this.lastKnownAngle&&(this.setAngle&&(t=cr.distanceTo(0,0,this.dx,this.dy),this.dx=r(this.inst.angle)*t,this.dy=o(this.inst.angle)*t),this.lastKnownAngle=this.inst.angle);var p=0,d=0;if(0!==this.acc&&(t=cr.distanceTo(0,0,this.dx,this.dy),n=0===this.dx&&0===this.dy?this.inst.angle:cr.angleTo(0,0,this.dx,this.dy),t+=this.acc*e,p=r(n)*this.acc,d=o(n)*this.acc,0>t&&(t=0,p=0,d=0),this.dx=r(n)*t,this.dy=o(n)*t),0!==this.g&&(this.dy+=this.g*e,d+=this.g),this.lastx=this.inst.x,this.lasty=this.inst.y,0!==this.dx||0!==this.dy){var c=this.runtime.accelerate(this.dx,-Infinity,1/0,p,e),u=this.runtime.accelerate(this.dy,-Infinity,1/0,d,e);this.moveBy(c,u),this.travelled+=cr.distanceTo(this.lastx,this.lasty,this.inst.x,this.inst.y),this.setAngle&&(0!==c||0!==u)&&(this.inst.angle=cr.angleTo(0,0,c,u),this.inst.set_bbox_changed(),this.lastKnownAngle=this.inst.angle),this.bounceOffSolid&&(i=this.runtime.testOverlapSolid(this.inst),i&&(this.runtime.registerCollision(this.inst,i),t=cr.distanceTo(0,0,this.dx,this.dy),l=this.runtime.calculateSolidBounceAngle(this.inst,this.lastx,this.lasty),this.dx=r(l)*t,this.dy=o(l)*t,this.inst.x+=this.dx*e,this.inst.y+=this.dy*e,this.inst.set_bbox_changed(),this.setAngle&&(this.inst.angle=l,this.lastKnownAngle=l,this.inst.set_bbox_changed()),!this.runtime.pushOutSolid(this.inst,this.dx/t,this.dy/t,a(2.5*t*e,30))&&this.runtime.pushOutSolidNearest(this.inst,100)))}}},l.moveBy=function(e,t){var n=cr.distanceTo(0,0,e,t);if(!this.step||n<=this.stepSize)return this.inst.x+=e,this.inst.y+=t,this.inst.set_bbox_changed(),void(this.step&&this.runtime.trigger(cr.behaviors.Bullet.prototype.cnds.OnStep,this.inst));this.stopStepping=!1;for(var s=this.inst.x,l=this.inst.y,p=s+e,d=l+t,c=cr.angleTo(0,0,e,t),a=r(c)*this.stepSize,u=o(c)*this.stepSize,g=Math.floor(n/this.stepSize),m=1;m<=g;++m)if(this.inst.x=s+a*m,this.inst.y=l+u*m,this.inst.set_bbox_changed(),this.runtime.trigger(cr.behaviors.Bullet.prototype.cnds.OnStep,this.inst),this.inst.isDestroyed||this.stopStepping)return;this.inst.x=p,this.inst.y=d,this.inst.set_bbox_changed(),this.runtime.trigger(cr.behaviors.Bullet.prototype.cnds.OnStep,this.inst)};e.prototype.CompareSpeed=function(e,t){return cr.do_cmp(cr.distanceTo(0,0,this.dx,this.dy),e,t)},e.prototype.CompareTravelled=function(e,t){return cr.do_cmp(this.travelled,e,t)},e.prototype.OnStep=function(){return!0},e.prototype.IsEnabled=function(){return this.enabled},i.cnds=new e;t.prototype.SetSpeed=function(e){var t=cr.angleTo(0,0,this.dx,this.dy);this.dx=r(t)*e,this.dy=o(t)*e},t.prototype.SetAcceleration=function(e){this.acc=e},t.prototype.SetGravity=function(e){this.g=e},t.prototype.SetAngleOfMotion=function(e){e=cr.to_radians(e);var t=cr.distanceTo(0,0,this.dx,this.dy);this.dx=r(e)*t,this.dy=o(e)*t},t.prototype.Bounce=function(e){if(e){var t=e.getFirstPicked(this.inst);if(t){var n=this.runtime.getDt(this.inst),i=cr.distanceTo(0,0,this.dx,this.dy),s=this.runtime.calculateSolidBounceAngle(this.inst,this.lastx,this.lasty,t);this.dx=r(s)*i,this.dy=o(s)*i,this.inst.x+=this.dx*n,this.inst.y+=this.dy*n,this.inst.set_bbox_changed(),this.setAngle&&(this.inst.angle=s,this.lastKnownAngle=s,this.inst.set_bbox_changed()),0!==i&&(this.bounceOffSolid?!this.runtime.pushOutSolid(this.inst,this.dx/i,this.dy/i,a(2.5*i*n,30))&&this.runtime.pushOutSolidNearest(this.inst,100):this.runtime.pushOut(this.inst,this.dx/i,this.dy/i,a(2.5*i*n,30),t))}}},t.prototype.SetBounceOffSolids=function(e){this.bounceOffSolid=e},t.prototype.SetDistanceTravelled=function(e){this.travelled=e},t.prototype.SetEnabled=function(e){this.enabled=1===e},t.prototype.StopStepping=function(){this.stopStepping=!0},i.acts=new t;n.prototype.Speed=function(e){var t=cr.distanceTo(0,0,this.dx,this.dy);t=cr.round6dp(t),e.set_float(t)},n.prototype.Acceleration=function(e){e.set_float(this.acc)},n.prototype.AngleOfMotion=function(e){e.set_float(cr.to_degrees(cr.angleTo(0,0,this.dx,this.dy)))},n.prototype.DistanceTravelled=function(e){e.set_float(this.travelled)},n.prototype.Gravity=function(e){e.set_float(this.g)},i.exps=new n}();var easeOutBounceArray=[],easeInElasticArray=[],easeOutElasticArray=[],easeInOutElasticArray=[],easeInCircle=[],easeOutCircle=[],easeInOutCircle=[],easeInBack=[],easeOutBack=[],easeInOutBack=[],litetween_precision=1e4,updateLimit=0;function easeOutBouncefunc(e){return result=(e/=1)<1/2.75?1*(7.5625*e*e)+0:e<2/2.75?1*(7.5625*(e-=1.5/2.75)*e+.75)+0:e<2.5/2.75?1*(7.5625*(e-=2.25/2.75)*e+.9375)+0:1*(7.5625*(e-=2.625/2.75)*e+.984375)+0,result}function integerize(e,t){return Math.round(e/t*litetween_precision)}function easeFunc(e,n,r,i,o,l,d){var c=Math.asin,u=Math.pow,g=Math.abs,m=Math.sqrt,y=Math.sin,_=Math.PI,h=0;switch(e){case 0:h=i*n/o+r;break;case 1:h=i*(n/=o)*n+r;break;case 2:h=-i*(n/=o)*(n-2)+r;break;case 3:h=1>(n/=o/2)?i/2*n*n+r:-i/2*(--n*(n-2)-1)+r;break;case 4:h=i*(n/=o)*n*n+r;break;case 5:h=i*((n=n/o-1)*n*n+1)+r;break;case 6:h=1>(n/=o/2)?i/2*n*n*n+r:i/2*((n-=2)*n*n+2)+r;break;case 7:h=i*(n/=o)*n*n*n+r;break;case 8:h=-i*((n=n/o-1)*n*n*n-1)+r;break;case 9:h=1>(n/=o/2)?i/2*n*n*n*n+r:-i/2*((n-=2)*n*n*n-2)+r;break;case 10:h=i*(n/=o)*n*n*n*n+r;break;case 11:h=i*((n=n/o-1)*n*n*n*n+1)+r;break;case 12:h=1>(n/=o/2)?i/2*n*n*n*n*n+r:i/2*((n-=2)*n*n*n*n+2)+r;break;case 13:h=d.optimized?easeInCircle[integerize(n,o)]:-(m(1-n*n)-1);break;case 14:h=d.optimized?easeOutCircle[integerize(n,o)]:m(1-(n-1)*(n-1));break;case 15:h=d.optimized?easeInOutCircle[integerize(n,o)]:1>(n/=o/2)?-i/2*(m(1-n*n)-1)+r:i/2*(m(1-(n-=2)*n)+1)+r;break;case 16:if(d.optimized)h=easeInBack[integerize(n,o)];else{var f=d.s;h=i*(n/=o)*n*((f+1)*n-f)+r}break;case 17:if(d.optimized)h=easeOutBack[integerize(n,o)];else{var f=d.s;h=i*((n=n/o-1)*n*((f+1)*n+f)+1)+r}break;case 18:if(d.optimized)h=easeInOutBack[integerize(n,o)];else{var f=d.s;h=1>(n/=o/2)?i/2*(n*n*(((f*=1.525)+1)*n-f))+r:i/2*((n-=2)*n*(((f*=1.525)+1)*n+f)+2)+r}break;case 19:if(d.optimized)h=easeInElasticArray[integerize(n,o)];else{var x=d.a,b=d.p,f=0;if(0==n&&(h=r),1==(n/=o)&&(h=r+i),0==b&&(b=.3*o),0==x||x<g(i))x=i,f=b/4;else var f=b/(2*_)*c(i/x);h=-(x*u(2,10*(n-=1))*y((n*o-f)*(2*_)/b))+r}break;case 20:if(d.optimized)h=easeOutElasticArray[integerize(n,o)];else{var x=d.a,b=d.p,f=0;if(0==n&&(h=r),1==(n/=o)&&(h=r+i),0==b&&(b=.3*o),0==x||x<g(i)){x=i;var f=b/4}else var f=b/(2*_)*c(i/x);h=x*u(2,-10*n)*y((n*o-f)*(2*_)/b)+i+r}break;case 21:if(d.optimized)h=easeInOutElasticArray[integerize(n,o)];else{var x=d.a,b=d.p,f=0;if(0==n&&(h=r),2==(n/=o/2)&&(h=r+i),0==b&&(b=o*(.3*1.5)),0==x||x<g(i)){x=i;var f=b/4}else var f=b/(2*_)*c(i/x);h=1>n?-.5*(x*u(2,10*(n-=1))*y((n*o-f)*(2*_)/b))+r:.5*(x*u(2,-10*(n-=1))*y((n*o-f)*(2*_)/b))+i+r}break;case 22:h=d.optimized?i-easeOutBounceArray[integerize(o-n,o)]+r:i-easeOutBouncefunc(o-n/o)+r;break;case 23:h=d.optimized?easeOutBounceArray[integerize(n,o)]:easeOutBouncefunc(n/o);break;case 24:h=d.optimized?n<o/2?.5*(i-easeOutBounceArray[integerize(o-2*n,o)]+r)+r:.5*easeOutBounceArray[integerize(2*n-o,o)]+.5*i+r:n<o/2?.5*(i-easeOutBouncefunc(o-2*n)+r)+r:.5*easeOutBouncefunc((2*n-o)/o)+.5*i+r;break;case 25:var v=n/o/2;h=2*(v*v*(3-2*v));break;case 26:var v=(n/o+1)/2;h=2*(v*v*(3-2*v))-1;break;case 27:var v=n/o;h=v*v*(3-2*v);}return l?i-r-h:h}(function(){for(var e=Math.asin,n=Math.pow,r=Math.sqrt,i=Math.sin,o=Math.PI,l=0,d=0,c=0,u=0,g=0,m=0;m<=litetween_precision;m++){if(u=m/litetween_precision,l=(u/=1)<1/2.75?1*(7.5625*u*u)+0:u<2/2.75?1*(7.5625*(u-=1.5/2.75)*u+.75)+0:u<2.5/2.75?1*(7.5625*(u-=2.25/2.75)*u+.9375)+0:1*(7.5625*(u-=2.625/2.75)*u+.984375)+0,easeOutBounceArray[m]=l,u=m/litetween_precision,d=0,c=0,0==u&&(l=0),1==(u/=1)&&(l=1),0==c&&(c=1*.3),0==d||1>d){d=1;var g=c/4}else var g=c/(2*o)*e(1/d);if(l=-(d*n(2,10*(u-=1))*i((1*u-g)*(2*o)/c))+0,easeInElasticArray[m]=l,u=m/litetween_precision,d=0,c=0,0==u&&(l=0),1==(u/=1)&&(l=1),0==c&&(c=.3*1),0==d||1>d){d=1;var g=c/4}else var g=c/(2*o)*e(1/d);if(l=d*n(2,-10*u)*i((1*u-g)*(2*o)/c)+1+0,easeOutElasticArray[m]=l,u=m/litetween_precision,d=0,c=0,0==u&&(l=0),2==(u/=1/2)&&(l=1),0==c&&(c=1*(.3*1.5)),0==d||1>d){d=1;var g=c/4}else var g=c/(2*o)*e(1/d);l=1>u?-.5*(d*n(2,10*(u-=1))*i((1*u-g)*(2*o)/c))+0:.5*(d*n(2,-10*(u-=1))*i((1*u-g)*(2*o)/c))+1+0,easeInOutElasticArray[m]=l,u=m/litetween_precision,easeInCircle[m]=-(r(1-u*u)-1),u=m/litetween_precision,easeOutCircle[m]=r(1-(u-1)*(u-1)),u=m/litetween_precision,l=1>(u/=1/2)?-1/2*(r(1-u*u)-1)+0:1/2*(r(1-(u-=2)*u)+1)+0,easeInOutCircle[m]=l,u=m/litetween_precision,g=0,0==g&&(g=1.70158),l=1*(u/=1)*u*((g+1)*u-g)+0,easeInBack[m]=l,u=m/litetween_precision,g=0,0==g&&(g=1.70158),l=1*((u=u/1-1)*u*((g+1)*u+g)+1)+0,easeOutBack[m]=l,u=m/litetween_precision,g=0,0==g&&(g=1.70158),l=1>(u/=1/2)?1/2*(u*u*(((g*=1.525)+1)*u-g))+0:1/2*((u-=2)*u*(((g*=1.525)+1)*u+g)+2)+0,easeInOutBack[m]=l}})();var TweenObject=function(){return function(e,t,n,a,r,o,s){this.name=e,this.value=0,this.setInitial(a),this.setTarget(r),this.easefunc=n,this.tweened=t,this.duration=o,this.progress=0,this.state=0,this.onStart=!1,this.onEnd=!1,this.onReverseStart=!1,this.onReverseEnd=!1,this.lastKnownValue=0,this.lastKnownValue2=0,this.enforce=s,this.pingpong=1,this.flipEase=!1,this.easingparam=[],this.lastState=1;for(var l=0;28>l;l++)this.easingparam[l]={},this.easingparam[l].a=0,this.easingparam[l].p=0,this.easingparam[l].t=0,this.easingparam[l].s=0,this.easingparam[l].optimized=!0}}();(function(){TweenObject.prototype={},TweenObject.prototype.flipTarget=function(){var e=this.initialparam1,t=this.initialparam2;this.initialparam1=this.targetparam1,this.initialparam2=this.targetparam2,this.targetparam1=e,this.targetparam2=t,this.lastKnownValue=0,this.lastKnownValue2=0},TweenObject.prototype.setInitial=function(e){this.initialparam1=parseFloat(e.split(",")[0]),this.initialparam2=parseFloat(e.split(",")[1]),this.lastKnownValue=0,this.lastKnownValue2=0},TweenObject.prototype.setTarget=function(e){this.targetparam1=parseFloat(e.split(",")[0]),this.targetparam2=parseFloat(e.split(",")[1]),isNaN(this.targetparam2)&&(this.targetparam2=this.targetparam1)},TweenObject.prototype.OnTick=function(e){if(0===this.state)return-1;if(1===this.state&&(this.progress+=e),2===this.state&&(this.progress-=e),3===this.state&&(this.state=0),(4===this.state||6===this.state)&&(this.progress+=e*this.pingpong),5===this.state&&(this.progress+=e*this.pingpong),0>this.progress)return this.progress=0,4===this.state?this.pingpong=1:6===this.state?(this.pingpong=1,this.flipEase=!1):this.state=0,this.onReverseEnd=!0,0;if(this.progress>this.duration)return this.progress=this.duration,4===this.state?this.pingpong=-1:6===this.state?(this.pingpong=-1,this.flipEase=!0):5===this.state?this.progress=0:this.state=0,this.onEnd=!0,1;if(this.flipEase)var t=easeFunc(this.easefunc,this.duration-this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc]);else var t=easeFunc(this.easefunc,this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc]);return t}})();function trim(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}cr.behaviors.lunarray_LiteTween=function(e){this.runtime=e},function(){var e=cr.behaviors.lunarray_LiteTween.prototype;e.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var t=e.Type.prototype;t.onCreate=function(){},e.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime,this.i=0};var n=e.Instance.prototype;n.onCreate=function(){this.playmode=this.properties[0],this.active=1==this.playmode||2==this.playmode||3==this.playmode||4==this.playmode,this.tweened=this.properties[1],this.easing=this.properties[2],this.target=this.properties[3],this.targetmode=this.properties[4],this.useCurrent=!1,1===this.targetmode&&(this.target="relative("+this.target+")"),this.duration=this.properties[5],this.enforce=1===this.properties[6],this.value=0,this.tween_list={},this.addToTweenList("default",this.tweened,this.easing,"current",this.target,this.duration,this.enforce),1===this.properties[0]&&this.startTween(0),2===this.properties[0]&&this.startTween(2),3===this.properties[0]&&this.startTween(3),4===this.properties[0]&&this.startTween(4)},n.parseCurrent=function(e,t){t===void 0&&(t="current");var n=trim(t);t=trim(t);var a=this.value;if("current"===t)switch(e){case 0:n=this.inst.x+","+this.inst.y;break;case 1:n=this.inst.width+","+this.inst.height;break;case 2:n=this.inst.width+","+this.inst.height;break;case 3:n=this.inst.width+","+this.inst.height;break;case 4:n=cr.to_degrees(this.inst.angle)+","+cr.to_degrees(this.inst.angle);break;case 5:n=100*this.inst.opacity+","+100*this.inst.opacity;break;case 6:n=a+","+a;break;case 7:n=this.inst.x+","+this.inst.y;break;case 8:n=this.inst.x+","+this.inst.y;break;case 9:n=void 0===this.inst.curFrame?"1,1":this.inst.width/this.inst.curFrame.width+","+this.inst.height/this.inst.curFrame.height;break;default:}if("relative"===t.substring(0,8)){var r=t.match(/\((.*?)\)/);if(r)var i=parseFloat(r[1].split(",")[0]),o=parseFloat(r[1].split(",")[1]);switch(isNaN(i)&&(i=0),isNaN(o)&&(o=0),e){case 0:n=this.inst.x+i+","+(this.inst.y+o);break;case 1:n=this.inst.width+i+","+(this.inst.height+o);break;case 2:n=this.inst.width+i+","+(this.inst.height+o);break;case 3:n=this.inst.width+i+","+(this.inst.height+o);break;case 4:n=cr.to_degrees(this.inst.angle)+i+","+(cr.to_degrees(this.inst.angle)+o);break;case 5:n=100*this.inst.opacity+i+","+(100*this.inst.opacity+o);break;case 6:n=a+i+","+a+i;break;case 7:n=this.inst.x+i+","+this.inst.y;break;case 8:n=this.inst.x+","+(this.inst.y+i);break;case 9:n=i+","+o;break;default:}}return n},n.addToTweenList=function(e,t,n,a,r,i,o){a=this.parseCurrent(t,a),r=this.parseCurrent(t,r),this.tween_list[e]!==void 0&&delete this.tween_list[e],this.tween_list[e]=new TweenObject(e,t,n,a,r,i,o),this.tween_list[e].dt=0},n.saveToJSON=function(){JSON.stringify(this.tween_list["default"]);return{playmode:this.playmode,active:this.active,tweened:this.tweened,easing:this.easing,target:this.target,targetmode:this.targetmode,useCurrent:this.useCurrent,duration:this.duration,enforce:this.enforce,value:this.value,tweenlist:JSON.stringify(this.tween_list["default"])}},TweenObject.Load=function(e,t,n,a,r,o,s,l){var p=new TweenObject(t,n,a,r,o,s,l);for(var d in e)p[d]=e[d];return p},n.loadFromJSON=function(e){var t=JSON.parse(e.tweenlist),n=TweenObject.Load(t,t.name,t.tweened,t.easefunc,t.initialparam1+","+t.initialparam2,t.targetparam1+","+t.targetparam2,t.duration,t.enforce);this.tween_list["default"]=n,this.playmode=e.playmode,this.active=e.active,this.movement=e.tweened,this.easing=e.easing,this.target=e.target,this.targetmode=e.targetmode,this.useCurrent=e.useCurrent,this.duration=e.duration,this.enforce=e.enforce,this.value=e.value},n.setProgressTo=function(e){for(var t in 1<e&&(e=1),0>e&&(e=0),this.tween_list){var n=this.tween_list[t];n.lastKnownValue=0,n.lastKnownValue2=0,n.state=3,n.progress=e*n.duration;var a=n.OnTick(0);this.updateTween(n,a)}},n.startTween=function(e){for(var t in this.tween_list){var n=this.tween_list[t];if(this.useCurrent){var a=this.parseCurrent(n.tweened,"current"),r=this.parseCurrent(n.tweened,this.target);n.setInitial(a),n.setTarget(r)}0===e&&(n.progress=1e-6,n.lastKnownValue=0,n.lastKnownValue2=0,n.onStart=!0,n.state=1),1===e&&(n.state=n.lastState),(2===e||4===e)&&(n.progress=1e-6,n.lastKnownValue=0,n.lastKnownValue2=0,n.onStart=!0,2==e&&(n.state=4),4==e&&(n.state=6)),3===e&&(n.progress=1e-6,n.lastKnownValue=0,n.lastKnownValue2=0,n.onStart=!0,n.state=5)}},n.stopTween=function(e){for(var t in this.tween_list){var n=this.tween_list[t];3!=n.state&&0!=n.state&&(n.lastState=n.state),1===e&&(n.progress=0),2===e&&(n.progress=n.duration),n.state=3;var a=n.OnTick(0);this.updateTween(n,a)}},n.reverseTween=function(e){for(var t in this.tween_list){var n=this.tween_list[t];1===e&&(n.progress=n.duration,n.lastKnownValue=0,n.lastKnownValue2=0,n.onReverseStart=!0),n.state=2}},n.updateTween=function(e,t){if(0===e.tweened)e.enforce?(this.inst.x=e.initialparam1+(e.targetparam1-e.initialparam1)*t,this.inst.y=e.initialparam2+(e.targetparam2-e.initialparam2)*t):(this.inst.x+=(e.targetparam1-e.initialparam1)*t-e.lastKnownValue,this.inst.y+=(e.targetparam2-e.initialparam2)*t-e.lastKnownValue2,e.lastKnownValue=(e.targetparam1-e.initialparam1)*t,e.lastKnownValue2=(e.targetparam2-e.initialparam2)*t);else if(1===e.tweened)e.enforce?(this.inst.width=e.initialparam1+(e.targetparam1-e.initialparam1)*t,this.inst.height=e.initialparam2+(e.targetparam2-e.initialparam2)*t):(this.inst.width+=(e.targetparam1-e.initialparam1)*t-e.lastKnownValue,this.inst.height+=(e.targetparam2-e.initialparam2)*t-e.lastKnownValue2,e.lastKnownValue=(e.targetparam1-e.initialparam1)*t,e.lastKnownValue2=(e.targetparam2-e.initialparam2)*t);else if(2===e.tweened)e.enforce?this.inst.width=e.initialparam1+(e.targetparam1-e.initialparam1)*t:(this.inst.width+=(e.targetparam1-e.initialparam1)*t-e.lastKnownValue,e.lastKnownValue=(e.targetparam1-e.initialparam1)*t);else if(3===e.tweened)e.enforce?this.inst.height=e.initialparam2+(e.targetparam2-e.initialparam2)*t:(this.inst.height+=(e.targetparam2-e.initialparam2)*t-e.lastKnownValue2,e.lastKnownValue2=(e.targetparam2-e.initialparam2)*t);else if(4===e.tweened){if(e.enforce){var n=e.initialparam1+(e.targetparam1-e.initialparam1)*t;this.inst.angle=cr.clamp_angle(cr.to_radians(n))}else{var n=(e.targetparam1-e.initialparam1)*t-e.lastKnownValue;this.inst.angle=cr.clamp_angle(this.inst.angle+cr.to_radians(n)),e.lastKnownValue=(e.targetparam1-e.initialparam1)*t}}else if(5===e.tweened)e.enforce?this.inst.opacity=(e.initialparam1+(e.targetparam1-e.initialparam1)*t)/100:(this.inst.opacity+=((e.targetparam1-e.initialparam1)*t-e.lastKnownValue)/100,e.lastKnownValue=(e.targetparam1-e.initialparam1)*t);else if(6===e.tweened)e.enforce?this.value=e.initialparam1+(e.targetparam1-e.initialparam1)*t:(this.value+=(e.targetparam1-e.initialparam1)*t-e.lastKnownValue,e.lastKnownValue=(e.targetparam1-e.initialparam1)*t);else if(7===e.tweened)e.enforce?this.inst.x=e.initialparam1+(e.targetparam1-e.initialparam1)*t:(this.inst.x+=(e.targetparam1-e.initialparam1)*t-e.lastKnownValue,e.lastKnownValue=(e.targetparam1-e.initialparam1)*t);else if(8===e.tweened)e.enforce?this.inst.y=e.initialparam2+(e.targetparam2-e.initialparam2)*t:(this.inst.y+=(e.targetparam2-e.initialparam2)*t-e.lastKnownValue2,e.lastKnownValue2=(e.targetparam2-e.initialparam2)*t);else if(9===e.tweened){var a=e.initialparam1+(e.targetparam1-e.initialparam1)*t,r=e.initialparam2+(e.targetparam2-e.initialparam2)*t;0>this.inst.width&&(a=e.initialparam1+(e.targetparam1+e.initialparam1)*-t),0>this.inst.height&&(r=e.initialparam2+(e.targetparam2+e.initialparam2)*-t),e.enforce?(this.inst.width=this.inst.curFrame.width*a,this.inst.height=this.inst.curFrame.height*r):(0>this.inst.width?(this.inst.width=a*(this.inst.width/(-1+e.lastKnownValue)),e.lastKnownValue=a+1):(this.inst.width=a*(this.inst.width/(1+e.lastKnownValue)),e.lastKnownValue=a-1),0>this.inst.height?(this.inst.height=r*(this.inst.height/(-1+e.lastKnownValue2)),e.lastKnownValue2=r+1):(this.inst.height=r*(this.inst.height/(1+e.lastKnownValue2)),e.lastKnownValue2=r-1))}this.inst.set_bbox_changed()},n.tick=function(){var e=this.runtime.getDt(this.inst),t=this.tween_list["default"];if(0!==t.state){t.onStart&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnStart,this.inst),t.onStart=!1),t.onReverseStart&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseStart,this.inst),t.onReverseStart=!1),this.active=1==t.state||2==t.state||4==t.state||5==t.state||6==t.state;var n=t.OnTick(e);this.updateTween(t,n),t.onEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnEnd,this.inst),t.onEnd=!1),t.onReverseEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseEnd,this.inst),t.onReverseEnd=!1)}},e.cnds={};var a=e.cnds;a.IsActive=function(){return 0!==this.tween_list["default"].state},a.IsReversing=function(){return 2==this.tween_list["default"].state},a.CompareProgress=function(e,t){var n=this.tween_list["default"];return cr.do_cmp(n.progress/n.duration,e,t)},a.OnThreshold=function(e,t){var n=this.tween_list["default"];this.threshold=cr.do_cmp(n.progress/n.duration,e,t);var a=this.oldthreshold!=this.threshold&&this.threshold;return a&&(this.oldthreshold=this.threshold),a},a.OnStart=function(){return void 0!==this.tween_list["default"]&&this.tween_list["default"].onStart},a.OnReverseStart=function(){return void 0!==this.tween_list["default"]&&this.tween_list["default"].onReverseStart},a.OnEnd=function(){return void 0!==this.tween_list["default"]&&this.tween_list["default"].onEnd},a.OnReverseEnd=function(){return void 0!==this.tween_list["default"]&&this.tween_list["default"].onReverseEnd},e.acts={};var r=e.acts;r.Start=function(e,t){this.threshold=!1,this.oldthreshold=!1,this.useCurrent=1==t,this.startTween(e)},r.Stop=function(e){this.stopTween(e)},r.Reverse=function(e){this.threshold=!1,this.oldthreshold=!1,this.reverseTween(e)},r.ProgressTo=function(e){this.setProgressTo(e)},r.SetDuration=function(e){isNaN(e)||0>e||void 0===this.tween_list["default"]||(this.tween_list["default"].duration=e)},r.SetEnforce=function(e){void 0===this.tween_list["default"]||(this.tween_list["default"].enforce=1===e)},r.SetInitial=function(e){if(void 0!==this.tween_list["default"]){var t=this.parseCurrent(this.tween_list["default"].tweened,e);this.tween_list["default"].setInitial(t)}},r.SetTarget=function(e,t,n){if(void 0!==this.tween_list["default"]&&!isNaN(n)){var a=this.tween_list["default"],r=n+"";this.targetmode=t;var i="",o="";if(1===t){switch(this.target="relative("+r+")",e){case 0:i=this.inst.x+n,o=a.targetparam2;break;case 1:i=a.targetparam1,o=this.inst.y+n;break;case 2:i=""+cr.to_degrees(this.inst.angle+cr.to_radians(n)),o=i;break;case 3:i=""+100*this.inst.opacity+n,o=i;break;case 4:i=this.inst.width+n,o=a.targetparam2;break;case 5:i=a.targetparam1,o=this.inst.height+n;break;case 6:i=n,o=n;break;default:}r=i+","+o}else{switch(e){case 0:i=n,o=a.targetparam2;break;case 1:i=a.targetparam1,o=n;break;case 2:i=n,o=n;break;case 3:i=n,o=n;break;case 4:i=n,o=a.targetparam2;break;case 5:i=a.targetparam1,o=n;break;case 6:i=n,o=n;break;default:}r=i+","+o,this.target=r}var s=this.parseCurrent(this.tween_list["default"].tweened,"current"),l=this.parseCurrent(this.tween_list["default"].tweened,r);a.setInitial(s),a.setTarget(l)}},r.SetTweenedProperty=function(e){void 0===this.tween_list["default"]||(this.tween_list["default"].tweened=e)},r.SetEasing=function(e){void 0===this.tween_list["default"]||(this.tween_list["default"].easefunc=e)},r.SetEasingParam=function(e,n,a,r,t){void 0===this.tween_list["default"]||(this.tween_list["default"].easingparam[e].optimized=!1,this.tween_list["default"].easingparam[e].a=n,this.tween_list["default"].easingparam[e].p=a,this.tween_list["default"].easingparam[e].t=r,this.tween_list["default"].easingparam[e].s=t)},r.ResetEasingParam=function(){void 0===this.tween_list["default"]||(this.tween_list["default"].optimized=!0)},r.SetValue=function(e){var t=this.tween_list["default"];this.value=e,6===t.tweened&&t.setInitial(this.parseCurrent(t.tweened,"current"))},r.SetParameter=function(e,t,n,a,r){if(this.tween_list["default"]===void 0)this.addToTweenList("default",e,t,initial,n,a,r,0);else{var i=this.tween_list["default"];i.tweened=e,i.easefunc=t,i.setInitial(this.parseCurrent(e,"current")),i.setTarget(this.parseCurrent(e,n)),i.duration=a,i.enforce=1===r}},e.exps={};var i=e.exps;i.State=function(e){var t="N/A";switch(this.tween_list["default"].state){case 0:t="paused";break;case 1:t="playing";break;case 2:t="reversing";break;case 3:t="seeking";break;default:}e.set_string(t)},i.Progress=function(e){var t=this.tween_list["default"].progress/this.tween_list["default"].duration;e.set_float(t)},i.Duration=function(e){e.set_float(this.tween_list["default"].duration)},i.Target=function(e){var t=this.tween_list["default"],n="N/A";switch(t.tweened){case 0:n=t.targetparam1;break;case 1:n=t.targetparam2;break;case 2:n=t.targetparam1;break;case 3:n=t.targetparam1;break;case 4:n=t.targetparam1;break;case 5:n=t.targetparam2;break;case 6:n=t.targetparam1;break;default:}e.set_float(n)},i.Value=function(e){var t=this.value;e.set_float(t)},i.Tween=function(e,t,n,a,r){var i=1<a?1:a,o=easeFunc(r,0>i?0:i,0,1,1,!1,!1);e.set_float(t+o*(n-t))}}();cr.behaviors.Sin=function(e){this.runtime=e},function(){function e(){}function t(){}function n(){}var a=Math.sin,r=Math.PI,i=cr.behaviors.Sin.prototype;i.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var o=i.Type.prototype;o.onCreate=function(){},i.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime,this.i=0};var s=i.Instance.prototype,l=2*r,p=r/2,d=3*r/2,c=[0,1,8,3,4,2,5,6,7];s.onCreate=function(){this.movement=c[this.properties[0]],this.wave=this.properties[1],this.period=this.properties[2],this.period+=Math.random()*this.properties[3],0===this.period?this.i=0:(this.i=this.properties[4]/this.period*l,this.i+=Math.random()*this.properties[5]/this.period*l),this.mag=this.properties[6],this.mag+=Math.random()*this.properties[7],this.isEnabled=this.properties[8],this.initialValue=0,this.initialValue2=0,this.ratio=0,5===this.movement&&(this.mag=cr.to_radians(this.mag)),this.init()},s.saveToJSON=function(){return{i:this.i,a:this.isEnabled,mv:this.movement,w:this.wave,p:this.period,mag:this.mag,iv:this.initialValue,iv2:this.initialValue2,r:this.ratio,lkv:this.lastKnownValue,lkv2:this.lastKnownValue2}},s.loadFromJSON=function(e){this.i=e.i,this.isEnabled=e.a,this.movement=e.mv,this.wave=e.w,this.period=e.p,this.mag=e.mag,this.initialValue=e.iv,this.initialValue2=e.iv2||0,this.ratio=e.r,this.lastKnownValue=e.lkv,this.lastKnownValue2=e.lkv2||0},s.init=function(){switch(this.movement){case 0:this.initialValue=this.inst.x;break;case 1:this.initialValue=this.inst.y;break;case 2:this.initialValue=this.inst.width,this.ratio=this.inst.height/this.inst.width;break;case 3:this.initialValue=this.inst.width;break;case 4:this.initialValue=this.inst.height;break;case 5:this.initialValue=this.inst.angle;break;case 6:this.initialValue=this.inst.opacity;break;case 7:this.initialValue=0;break;case 8:this.initialValue=this.inst.x,this.initialValue2=this.inst.y;break;default:;}this.lastKnownValue=this.initialValue,this.lastKnownValue2=this.initialValue2},s.waveFunc=function(e){switch(e%=l,this.wave){case 0:return a(e);case 1:return e<=p?e/p:e<=d?1-2*(e-p)/r:(e-d)/p-1;case 2:return 2*e/l-1;case 3:return-2*e/l+1;case 4:return e<r?-1:1;}return 0},s.tick=function(){var e=this.runtime.getDt(this.inst);this.isEnabled&&0!==e&&(0===this.period?this.i=0:(this.i+=e/this.period*l,this.i%=l),this.updateFromPhase())},s.updateFromPhase=function(){switch(this.movement){case 0:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.x=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x;break;case 1:this.inst.y!==this.lastKnownValue&&(this.initialValue+=this.inst.y-this.lastKnownValue),this.inst.y=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.y;break;case 2:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag,this.inst.height=this.inst.width*this.ratio;break;case 3:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 4:this.inst.height=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 5:this.inst.angle!==this.lastKnownValue&&(this.initialValue=cr.clamp_angle(this.initialValue+(this.inst.angle-this.lastKnownValue))),this.inst.angle=cr.clamp_angle(this.initialValue+this.waveFunc(this.i)*this.mag),this.lastKnownValue=this.inst.angle;break;case 6:this.inst.opacity=this.initialValue+this.waveFunc(this.i)*this.mag/100,0>this.inst.opacity?this.inst.opacity=0:1<this.inst.opacity&&(this.inst.opacity=1);break;case 8:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.y!==this.lastKnownValue2&&(this.initialValue2+=this.inst.y-this.lastKnownValue2),this.inst.x=this.initialValue+Math.cos(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.inst.y=this.initialValue2+a(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x,this.lastKnownValue2=this.inst.y;}this.inst.set_bbox_changed()},s.onSpriteFrameChanged=function(e,t){switch(this.movement){case 2:this.initialValue*=t.width/e.width,this.ratio=t.height/t.width;break;case 3:this.initialValue*=t.width/e.width;break;case 4:this.initialValue*=t.height/e.height;}};e.prototype.IsEnabled=function(){return this.isEnabled},e.prototype.CompareMovement=function(e){return this.movement===e},e.prototype.ComparePeriod=function(e,t){return cr.do_cmp(this.period,e,t)},e.prototype.CompareMagnitude=function(e,t){return 5===this.movement?cr.do_cmp(this.mag,e,cr.to_radians(t)):cr.do_cmp(this.mag,e,t)},e.prototype.CompareWave=function(e){return this.wave===e},i.cnds=new e;t.prototype.SetEnabled=function(e){this.isEnabled=1===e},t.prototype.SetPeriod=function(e){this.period=e},t.prototype.SetMagnitude=function(e){this.mag=e,5===this.movement&&(this.mag=cr.to_radians(this.mag))},t.prototype.SetMovement=function(e){5===this.movement&&5!==e&&(this.mag=cr.to_degrees(this.mag)),this.movement=e,this.init()},t.prototype.SetWave=function(e){this.wave=e},t.prototype.SetPhase=function(e){this.i=e*l%l,this.updateFromPhase()},t.prototype.UpdateInitialState=function(){this.init()},i.acts=new t;n.prototype.CyclePosition=function(e){e.set_float(this.i/l)},n.prototype.Period=function(e){e.set_float(this.period)},n.prototype.Magnitude=function(e){5===this.movement?e.set_float(cr.to_degrees(this.mag)):e.set_float(this.mag)},n.prototype.Value=function(e){e.set_float(this.waveFunc(this.i)*this.mag)},i.exps=new n}();cr.behaviors.DragnDrop=function(e){this.runtime=e;var t=this;document.addEventListener("mousemove",function(e){t.onMouseMove(e)}),document.addEventListener("mousedown",function(e){t.onMouseDown(e)}),document.addEventListener("mouseup",function(e){t.onMouseUp(e)});var n=0<this.runtime.fullscreen_mode?document:this.runtime.canvas;"undefined"==typeof PointerEvent?window.navigator.msPointerEnabled?(n.addEventListener("MSPointerDown",function(e){t.onPointerStart(e)},!1),n.addEventListener("MSPointerMove",function(e){t.onPointerMove(e)},!1),n.addEventListener("MSPointerUp",function(e){t.onPointerEnd(e)},!1),n.addEventListener("MSPointerCancel",function(e){t.onPointerEnd(e)},!1)):(n.addEventListener("touchstart",function(e){t.onTouchStart(e)},!1),n.addEventListener("touchmove",function(e){t.onTouchMove(e)},!1),n.addEventListener("touchend",function(e){t.onTouchEnd(e)},!1),n.addEventListener("touchcancel",function(e){t.onTouchEnd(e)},!1)):(n.addEventListener("pointerdown",function(e){t.onPointerStart(e)},!1),n.addEventListener("pointermove",function(e){t.onPointerMove(e)},!1),n.addEventListener("pointerup",function(e){t.onPointerEnd(e)},!1),n.addEventListener("pointercancel",function(e){t.onPointerEnd(e)},!1))},function(){function e(e){var t,n;for(t=0,n=e.behavior_insts.length;t<n;t++)if(e.behavior_insts[t]instanceof a.Instance)return e.behavior_insts[t];return null}function t(){}function n(){}var a=cr.behaviors.DragnDrop.prototype;a.onMouseDown=function(e){1!==e.which||this.onInputDown("leftmouse",e.pageX,e.pageY)},a.onMouseMove=function(e){1!==e.which||this.onInputMove("leftmouse",e.pageX,e.pageY)},a.onMouseUp=function(e){1!==e.which||this.onInputUp("leftmouse")},a.onTouchStart=function(e){e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault();var n,a,r,o;for(n=0,a=e.changedTouches.length;n<a;n++)r=e.changedTouches[n],o=r.identifier,this.onInputDown(o?o.toString():"<none>",r.pageX,r.pageY)},a.onTouchMove=function(e){e.preventDefault&&e.preventDefault();var n,a,r,o;for(n=0,a=e.changedTouches.length;n<a;n++)r=e.changedTouches[n],o=r.identifier,this.onInputMove(o?o.toString():"<none>",r.pageX,r.pageY)},a.onTouchEnd=function(e){e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault();var n,a,r,o;for(n=0,a=e.changedTouches.length;n<a;n++)r=e.changedTouches[n],o=r.identifier,this.onInputUp(o?o.toString():"<none>")},a.onPointerStart=function(e){e.pointerType===e.MSPOINTER_TYPE_MOUSE||"mouse"===e.pointerType||(e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault(),this.onInputDown(e.pointerId.toString(),e.pageX,e.pageY))},a.onPointerMove=function(e){e.pointerType===e.MSPOINTER_TYPE_MOUSE||"mouse"===e.pointerType||(e.preventDefault&&e.preventDefault(),this.onInputMove(e.pointerId.toString(),e.pageX,e.pageY))},a.onPointerEnd=function(e){e.pointerType===e.MSPOINTER_TYPE_MOUSE||"mouse"===e.pointerType||(e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault(),this.onInputUp(e.pointerId.toString()))},a.onInputDown=function(t,n,a){var r=this.runtime.canvas.offsetLeft,o=this.runtime.canvas.offsetTop,s=n-r,l=a-o,p=this.my_instances.valuesRef(),d=null,c,u,g,m,y,_,h,f;for(y=0,_=p.length;y<_;y++)if(f=p[y],h=e(f),h.enabled&&!h.dragging&&(c=f.layer.canvasToLayer(s,l,!0),u=f.layer.canvasToLayer(s,l,!1),f.update_bbox(),f.contains_pt(c,u))){if(!d){d=f,g=c,m=u;continue}if(f.layer.index>d.layer.index){d=f,g=c,m=u;continue}if(f.layer.index===d.layer.index&&f.get_zindex()>d.get_zindex()){d=f,g=c,m=u;continue}}d&&e(d).onDown(t,g,m)},a.onInputMove=function(t,n,a){var r=this.runtime.canvas.offsetLeft,o=this.runtime.canvas.offsetTop,s=n-r,l=a-o,p=this.my_instances.valuesRef(),d,c,u,g,m,y;for(u=0,g=p.length;u<g;u++)y=p[u],m=e(y),!m.enabled||!m.dragging||m.dragging&&m.dragsource!==t||(d=y.layer.canvasToLayer(s,l,!0),c=y.layer.canvasToLayer(s,l,!1),m.onMove(d,c))},a.onInputUp=function(t){var n=this.my_instances.valuesRef(),a,r,o,s;for(a=0,r=n.length;a<r;a++)s=n[a],o=e(s),o.dragging&&o.dragsource===t&&o.onUp()},a.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var r=a.Type.prototype;r.onCreate=function(){},a.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime};var i=a.Instance.prototype;i.onCreate=function(){this.dragging=!1,this.dx=0,this.dy=0,this.dragsource="<none>",this.axes=this.properties[0],this.enabled=this.properties[1]},i.saveToJSON=function(){return{enabled:this.enabled}},i.loadFromJSON=function(e){this.enabled=e.enabled,this.dragging=!1},i.onDown=function(e,t,n){this.dx=t-this.inst.x,this.dy=n-this.inst.y,this.dragging=!0,this.dragsource=e,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.behaviors.DragnDrop.prototype.cnds.OnDragStart,this.inst),this.runtime.isInUserInputEvent=!1},i.onMove=function(e,t){var n=e-this.dx,a=t-this.dy;0===this.axes?(this.inst.x!==n||this.inst.y!==a)&&(this.inst.x=n,this.inst.y=a,this.inst.set_bbox_changed()):1===this.axes?this.inst.x!==n&&(this.inst.x=n,this.inst.set_bbox_changed()):2===this.axes&&this.inst.y!==a&&(this.inst.y=a,this.inst.set_bbox_changed())},i.onUp=function(){this.dragging=!1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.behaviors.DragnDrop.prototype.cnds.OnDrop,this.inst),this.runtime.isInUserInputEvent=!1},i.tick=function(){};t.prototype.IsDragging=function(){return this.dragging},t.prototype.OnDragStart=function(){return!0},t.prototype.OnDrop=function(){return!0},t.prototype.IsEnabled=function(){return!!this.enabled},a.cnds=new t;n.prototype.SetEnabled=function(e){this.enabled=0!==e,this.enabled||(this.dragging=!1)},n.prototype.SetAxes=function(e){this.axes=e},n.prototype.Drop=function(){this.dragging&&this.onUp()},a.acts=new n;a.exps=new function(){}}();cr.behaviors.Fade=function(e){this.runtime=e},function(){function e(){}function t(){}function n(){}var a=cr.behaviors.Fade.prototype;a.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var r=a.Type.prototype;r.onCreate=function(){},a.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime};var i=a.Instance.prototype;i.onCreate=function(){this.fadeInTime=this.properties[0],this.waitTime=this.properties[1],this.fadeOutTime=this.properties[2],this.destroy=this.properties[3],this.activeAtStart=this.properties[4],this.setMaxOpacity=!1,this.stage=this.activeAtStart?0:3,this.recycled?this.stageTime.reset():this.stageTime=new cr.KahanAdder,this.maxOpacity=this.inst.opacity?this.inst.opacity:1,this.activeAtStart&&(0===this.fadeInTime?(this.stage=1,0===this.waitTime&&(this.stage=2)):(this.inst.opacity=0,this.runtime.redraw=!0))},i.saveToJSON=function(){return{fit:this.fadeInTime,wt:this.waitTime,fot:this.fadeOutTime,s:this.stage,st:this.stageTime.sum,mo:this.maxOpacity}},i.loadFromJSON=function(e){this.fadeInTime=e.fit,this.waitTime=e.wt,this.fadeOutTime=e.fot,this.stage=e.s,this.stageTime.reset(),this.stageTime.sum=e.st,this.maxOpacity=e.mo},i.tick=function(){this.stageTime.add(this.runtime.getDt(this.inst)),0===this.stage&&(this.inst.opacity=this.stageTime.sum/this.fadeInTime*this.maxOpacity,this.runtime.redraw=!0,this.inst.opacity>=this.maxOpacity&&(this.inst.opacity=this.maxOpacity,this.stage=1,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeInEnd,this.inst))),1===this.stage&&this.stageTime.sum>=this.waitTime&&(this.stage=2,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnWaitEnd,this.inst)),2===this.stage&&0!==this.fadeOutTime&&(this.inst.opacity=this.maxOpacity-this.stageTime.sum/this.fadeOutTime*this.maxOpacity,this.runtime.redraw=!0,0>this.inst.opacity&&(this.inst.opacity=0,this.stage=3,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeOutEnd,this.inst),this.destroy&&this.runtime.DestroyInstance(this.inst)))},i.doStart=function(){this.stage=0,this.stageTime.reset(),0===this.fadeInTime?(this.stage=1,0===this.waitTime&&(this.stage=2)):(this.inst.opacity=0,this.runtime.redraw=!0)};e.prototype.OnFadeOutEnd=function(){return!0},e.prototype.OnFadeInEnd=function(){return!0},e.prototype.OnWaitEnd=function(){return!0},a.cnds=new e;t.prototype.StartFade=function(){this.activeAtStart||this.setMaxOpacity||(this.maxOpacity=this.inst.opacity?this.inst.opacity:1,this.setMaxOpacity=!0),3===this.stage&&this.doStart()},t.prototype.RestartFade=function(){this.doStart()},t.prototype.SetFadeInTime=function(e){0>e&&(e=0),this.fadeInTime=e},t.prototype.SetWaitTime=function(e){0>e&&(e=0),this.waitTime=e},t.prototype.SetFadeOutTime=function(e){0>e&&(e=0),this.fadeOutTime=e},a.acts=new t;n.prototype.FadeInTime=function(e){e.set_float(this.fadeInTime)},n.prototype.WaitTime=function(e){e.set_float(this.waitTime)},n.prototype.FadeOutTime=function(e){e.set_float(this.fadeOutTime)},a.exps=new n}(),cr.getObjectRefTable=function(){return[cr.plugins_.Sprite,cr.behaviors.Platform,cr.behaviors.wrap,cr.behaviors.solid,cr.behaviors.Bullet,cr.plugins_.Text,cr.plugins_.Touch,cr.plugins_.WebStorage,cr.plugins_.Button,cr.plugins_.AJAX,cr.plugins_.Audio,cr.plugins_.TextBox,cr.behaviors.lunarray_LiteTween,cr.plugins_.TiledBg,cr.behaviors.Sin,cr.behaviors.DragnDrop,cr.behaviors.Fade,cr.system_object.prototype.cnds.Every,cr.system_object.prototype.acts.CreateObject,cr.system_object.prototype.exps.random,cr.system_object.prototype.exps.layoutwidth,cr.system_object.prototype.exps.layoutheight,cr.system_object.prototype.acts.AddVar,cr.plugins_.Sprite.prototype.cnds.OnCollision,cr.system_object.prototype.acts.GoToLayout,cr.system_object.prototype.acts.SetTimescale,cr.system_object.prototype.cnds.Compare,cr.system_object.prototype.acts.SetVar,cr.plugins_.WebStorage.prototype.acts.StoreLocal,cr.plugins_.Touch.prototype.cnds.IsTouchingObject,cr.system_object.prototype.acts.ResetGlobals,cr.system_object.prototype.acts.RestartLayout,cr.plugins_.Text.prototype.acts.SetText,cr.system_object.prototype.cnds.OnLayoutStart,cr.plugins_.WebStorage.prototype.cnds.LocalStorageExists,cr.plugins_.WebStorage.prototype.exps.LocalValue,cr.system_object.prototype.cnds.Else,cr.system_object.prototype.cnds.EveryTick,cr.behaviors.Platform.prototype.acts.SimulateControl,cr.system_object.prototype.exps.zeropad,cr.plugins_.TextBox.prototype.cnds.OnTextChanged,cr.plugins_.TextBox.prototype.acts.SetEnabled,cr.system_object.prototype.cnds.RegexTest,cr.plugins_.TextBox.prototype.exps.Text,cr.plugins_.Sprite.prototype.acts.SetVisible,cr.plugins_.Sprite.prototype.acts.SetPos,cr.system_object.prototype.exps.len,cr.plugins_.TextBox.prototype.acts.SetText,cr.system_object.prototype.exps.left,cr.plugins_.Touch.prototype.cnds.OnTouchObject,cr.system_object.prototype.exps.urlencode,cr.system_object.prototype.exps.floor,cr.system_object.prototype.exps.mid,cr.system_object.prototype.exps.int,cr.plugins_.AJAX.prototype.acts.Post,cr.plugins_.Text.prototype.acts.SetVisible,cr.plugins_.Sprite.prototype.acts.Destroy,cr.system_object.prototype.cnds.CompareVar,cr.plugins_.TextBox.prototype.acts.SetVisible,cr.system_object.prototype.acts.Wait,cr.system_object.prototype.cnds.IsGroupActive,cr.plugins_.Sprite.prototype.acts.SetAnimFrame,cr.plugins_.AJAX.prototype.cnds.OnProgress,cr.plugins_.AJAX.prototype.cnds.OnComplete,cr.plugins_.AJAX.prototype.exps.LastData,cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,cr.plugins_.Sprite.prototype.cnds.IsBoolInstanceVarSet,cr.behaviors.lunarray_LiteTween.prototype.acts.Start,cr.plugins_.Sprite.prototype.acts.SetBoolInstanceVar,cr.plugins_.TiledBg.prototype.acts.SetSize,cr.plugins_.Sprite.prototype.acts.SetPosToObject,cr.behaviors.lunarray_LiteTween.prototype.cnds.OnEnd,cr.behaviors.Fade.prototype.acts.StartFade]},self.C3_JsPropNameTable=[{Platform:0},{Wrap:0},{Bola:0},{Solid:0},{Bullet:0},{Piso:0},{LineaMortal:0},{GameOverLabel:0},{Touch:0},{PuntosLabel:0},{Mejor:0},{WebStorage:0},{Text:0},{Text2:0},{Text3:0},{jugar:0},{instrucciones:0},{regresar:0},{LeftScreen:0},{RightScreen:0},{AJAX:0},{Audio:0},{TextInput:0},{over:0},{NameInput:0},{EmailInput:0},{PhoneInput:0},{NameText:0},{EmailText:0},{Confirmation:0},{Display:0},{Discore:0},{final:0},{replay:0},{home:0},{submit_button:0},{Top_10:0},{High:0},{Top10:0},{decor:0},{Temp:0},{Sprite2:0},{menuplaybtn:0},{LiteTween:0},{help:0},{LiteTween2:0},{instructions:0},{cross:0},{opacity:0},{Sprite11:0},{menu_back:0},{Sine:0},{logo:0},{DragDrop:0},{btn_play:0},{Fade:0},{Fade2:0},{Transition:0},{Gaming_Screen_BG:0},{Arrow:0},{Arrow2:0},{Arrow3:0},{Intro_Screen_Rolling_Ball:0},{input:0},{ClaveMejor:0},{MejorPuntuacion:0},{Point:0},{web_app_url:0},{Timer:0},{SpeedVar:0},{s:0},{value0:0},{value1:0},{value2:0},{sum:0},{string0:0},{string1:0},{string2:0}];